(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79],{5238:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return Wr}});var r=n(4051),o=n.n(r),i=n(5893),a=n(7294),s=n(6486),c=n.n(s),u=n(8231),l=(0,u.Z)("ADD_SHAPE"),h=(0,u.Z)("SET_CURSOR"),f=(0,u.Z)("SET_STROKE_COLOR_TO_ACTIVE_SHAPE"),d=(0,u.Z)("SET_STROKE_WIDTH_TO_ACTIVE_SHAPE"),p=(0,u.Z)("SET_FONT_SIZE_TO_ACTIVE_SHAPE"),y=(0,u.Z)("DELETE_ACTIVE_SHAPES"),v=(0,u.Z)("DELETE_ALL_SHAPES"),g=(0,u.Z)("DELETE_SHAPE"),b=(0,u.Z)("BLUR_SHAPES"),w=(0,u.Z)("SCALE_SHAPES"),m=(0,u.Z)("CROP_SHAPES"),x=(0,u.Z)("SET_ADDING_SHAPE"),S=(0,u.Z)("SHAPE_ADDED"),k=(0,u.Z)("DRAW_LAYERS"),P=(0,u.Z)("CHANGE_ORDER_OF_ACTIVE_SHAPE"),A=(0,u.Z)("SKETCHIFY_ACTIVE_SHAPE"),O=n(9569),E=n(3620),R=(0,u.Z)("SET_STAGE"),T=(0,u.Z)("SET_STAGE_SIZE"),j=(0,u.Z)("SET_STAGE_DRAGGABLE"),C=(0,u.Z)("SET_RATIO_SHIFT");function _(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function L(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){_(t,e,n[e])}))}return t}var D,M,Z,H=(0,E.Z)((_(D={},"".concat(R),(function(t,e){return L({},t,{instance:e.payload})})),_(D,"".concat(T),(function(t,e){var n,r=e.payload,o=r.width,i=r.height;return null===(n=t.instance)||void 0===n||n.setAttrs({width:o,height:i}),t})),_(D,"".concat(j),(function(t,e){var n,r=e.payload;return null===(n=t.instance)||void 0===n||n.draggable(r),L({},t,{isDraggable:r})})),_(D,"".concat(C),(function(t,e){var n,r=e.payload;return null===(n=t.instance)||void 0===n||n.draggable(r),L({},t,{ratioShiftIsActive:r})})),D),{instance:null,isDraggable:!1,ratioShiftIsActive:!1}),I=n(9649);!function(t){t.AUTO="auto",t.MOVE="move",t.POINTER="pointer",t.GRAB="grab"}(M||(M={})),function(t){t.SHAPES_LAYER="shapes_layer",t.ANCHORS_LAYER="anchors_layer"}(Z||(Z={}));var N=(0,n(8111).i)(),B=function(t){return function(e){return N.on(t,e)}},W=function(t){N.emit("SHAPES_BLURRED",t)},z=function(t){N.emit("SHAPE_ADDED",t)},G=function(t){N.emit("SHAPE_DELETED",t)},U=n(5693),F=n(9021),Y=n.n(F);function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function X(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function q(t){return function(t){if(Array.isArray(t))return K(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return K(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return K(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var V=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new Map}var e,n,r;return e=t,(n=[{key:"set",value:function(t,e){this.cbMap.set(t,e)}},{key:"call",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=this.cbMap.get(t);o&&o.apply(void 0,q(n))}},{key:"get",value:function(t){var e=this.cbMap.get(t);return null!==e&&void 0!==e?e:c().noop}},{key:"has",value:function(t){return this.cbMap.has(t)}}])&&X(e.prototype,n),r&&X(e,r),t}();function $(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var J,Q=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=U.Z.SHAPE,this.cbMap=new V,this._isSelected=!1,this.onClick=function(t){var n;ie.getState().shapes.addingShapeRef||(n=e,N.emit("SHAPE_CLICKED",n),t.cancelBubble=!0,e.focus(),e.cbMap.call("click",e))},this.onDragStart=function(){var t;t=e,N.emit("SHAPE_DRAG_STARTED",t),e.focus(),e.cbMap.call("dragstart",e)}}var e,n,r;return e=t,(n=[{key:"blur",value:function(){this._isSelected=!1}},{key:"focus",value:function(){this._isSelected=!0}},{key:"isSelected",value:function(){return this._isSelected}},{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"addToLayer",value:function(t,e){this.focus()}},{key:"clone",value:function(){console.warn("clone() is not implemented"),console.warn(this)}},{key:"crop",value:function(t){console.warn("crop() is not implemented"),console.warn(this)}},{key:"draggable",value:function(t){console.warn("draggable() is not implemented"),console.warn(this)}},{key:"attachBasicEvents",value:function(t){var e=this;t.on("click",this.onClick),t.on("dragstart",this.onDragStart),t.on("mouseover",(function(){e.cbMap.call("mouseover",e)})),t.on("mouseout",(function(){e.cbMap.call("mouseout",e)}))}},{key:"destroy",value:function(){this.cbMap.call("_beforedestroy",this)}}])&&$(e.prototype,n),r&&$(e,r),t}();function tt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function et(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t.left="left",t.top="top",t.right="right",t.bottom="bottom",t.leftTop="leftTop",t.leftBottom="leftBottom",t.rightTop="rightTop",t.rightBottom="rightBottom"}(J||(J={}));var nt={width:10,height:10,stroke:"#2196f3",strokeWidth:1,fill:"#ffffff",draggable:!0},rt=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new V,this.onDragMove=function(t){n.cbMap.call("dragmove",n.attrs.type,t)},this.attrs=e,this.anchor=new I.Z.Rect(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){et(t,e,n[e])}))}return t}({},nt,{x:e.x-nt.width/2,y:e.y-nt.height/2,dragBoundFunc:function(t){return{x:t.x,y:t.y}}})),this.anchor.on("dragmove",this.onDragMove)}var e,n,r;return e=t,(n=[{key:"show",value:function(){this.anchor.visible(!0)}},{key:"hide",value:function(){this.anchor.visible(!1)}},{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"getPos",value:function(){var t=this.anchor.getAttrs();return{x:t.x+nt.width/2,y:t.y+nt.height/2}}},{key:"setPos",value:function(t){var e=this.getPos(),n=t.x||e.x,r=t.y||e.y;this.anchor.setAttrs({x:n-nt.width/2,y:r-nt.height/2})}},{key:"addToLayer",value:function(t){t.add(this.anchor)}},{key:"destroy",value:function(){this.anchor.destroy()}}])&&tt(e.prototype,n),r&&tt(e,r),t}();function ot(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function it(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function at(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){it(t,e,n[e])}))}return t}var st=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new V,this.originRatio=1,this.onMoveAnchor=function(t,e){var r=ie.getState().stage.ratioShiftIsActive,o=e.evt,i=o.layerX,a=o.layerY,s=n.getCurrentAnchor(t),c=r?{x:i,y:a}:s.getPos(),u=n.getOppositeAnchor(t).getPos(),l=c.x-u.x,h=c.y-u.y,f=Math.min(Math.abs(l/n.originRatio),Math.abs(h));r&&(c={x:u.x+Math.sign(l)*f*n.originRatio,y:u.y+Math.sign(h)*f},s.setPos(c));var d=n.getNeighborAnchors(t);d.neighborX.setPos({x:c.x}),d.neighborY.setPos({y:c.y});var p=n.getLeftTopPos();n.cbMap.call("dragmove",{x:p.x,y:p.y,width:Math.abs(r?f*n.originRatio:l),height:Math.abs(r?f:h)})},this.anchors={leftTop:new rt(at({},t.calcAnchorPosition(J.leftTop,e),{type:J.leftTop})),rightTop:new rt(at({},t.calcAnchorPosition(J.rightTop,e),{type:J.rightTop})),rightBottom:new rt(at({},t.calcAnchorPosition(J.rightBottom,e),{type:J.rightBottom})),leftBottom:new rt(at({},t.calcAnchorPosition(J.leftBottom,e),{type:J.leftBottom}))},this.anchors.leftTop.on("dragmove",this.onMoveAnchor),this.anchors.rightTop.on("dragmove",this.onMoveAnchor),this.anchors.rightBottom.on("dragmove",this.onMoveAnchor),this.anchors.leftBottom.on("dragmove",this.onMoveAnchor)}var e,n,r;return e=t,r=[{key:"calcAnchorPosition",value:function(t,e){switch(t){case J.left:return{x:e.x,y:e.y+e.height/2};case J.top:return{x:e.x+e.width/2,y:e.y};case J.right:return{x:e.x+e.width,y:e.y+e.height/2};case J.bottom:return{x:e.x+e.width/2,y:e.y+e.height};case J.leftTop:return{x:e.x,y:e.y};case J.rightTop:return{x:e.x+e.width,y:e.y};case J.rightBottom:return{x:e.x+e.width,y:e.y+e.height};case J.leftBottom:return{x:e.x,y:e.y+e.height};default:throw new Error("Position can't be calculated for given type: ".concat(t))}}}],(n=[{key:"getCurrentAnchor",value:function(t){switch(t){case J.leftTop:return this.anchors.leftTop;case J.leftBottom:return this.anchors.leftBottom;case J.rightTop:return this.anchors.rightTop;case J.rightBottom:return this.anchors.rightBottom;default:throw new Error("Can't find anchor for provided type. Given ".concat(t))}}},{key:"getOppositeAnchor",value:function(t){switch(t){case J.leftTop:return this.anchors.rightBottom;case J.leftBottom:return this.anchors.rightTop;case J.rightTop:return this.anchors.leftBottom;case J.rightBottom:return this.anchors.leftTop;default:throw new Error("Can't find anchor for provided type. Given ".concat(t))}}},{key:"getNeighborAnchors",value:function(t){switch(t){case J.leftTop:return{neighborX:this.anchors.leftBottom,neighborY:this.anchors.rightTop};case J.leftBottom:return{neighborX:this.anchors.leftTop,neighborY:this.anchors.rightBottom};case J.rightTop:return{neighborX:this.anchors.rightBottom,neighborY:this.anchors.leftTop};case J.rightBottom:return{neighborX:this.anchors.rightTop,neighborY:this.anchors.leftBottom};default:throw new Error("Width and height can't be calculated for the given type: ".concat(t))}}},{key:"getLeftTopPos",value:function(){var t=this;return Object.keys(this.anchors).reduce((function(e,n){var r=t.anchors[n].getPos();return r.x<e.x||r.y<e.y?r:e}),{x:1/0,y:1/0})}},{key:"setOriginRatio",value:function(t){this.originRatio=t}},{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"updatePosition",value:function(e){this.anchors.leftTop.setPos(t.calcAnchorPosition(J.leftTop,e)),this.anchors.rightTop.setPos(t.calcAnchorPosition(J.rightTop,e)),this.anchors.rightBottom.setPos(t.calcAnchorPosition(J.rightBottom,e)),this.anchors.leftBottom.setPos(t.calcAnchorPosition(J.leftBottom,e))}},{key:"show",value:function(){this.anchors.leftTop.show(),this.anchors.rightTop.show(),this.anchors.rightBottom.show(),this.anchors.leftBottom.show()}},{key:"hide",value:function(){this.anchors.leftTop.hide(),this.anchors.rightTop.hide(),this.anchors.rightBottom.hide(),this.anchors.leftBottom.hide()}},{key:"addToLayer",value:function(t){this.anchors.leftTop.addToLayer(t),this.anchors.rightTop.addToLayer(t),this.anchors.rightBottom.addToLayer(t),this.anchors.leftBottom.addToLayer(t)}},{key:"destroy",value:function(){this.anchors.leftTop.destroy(),this.anchors.rightTop.destroy(),this.anchors.rightBottom.destroy(),this.anchors.leftBottom.destroy()}}])&&ot(e.prototype,n),r&&ot(e,r),t}();function ct(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ut=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new V,this.onDragMove=function(t){var e="_dragmoveanchor";if(n.cbMap.call(e,t),!n.cbMap.has(e))throw new Error('"'.concat(e,'" should be defined'))},this.anchors=new st(e),this.anchors.on("dragmove",this.onDragMove)}var e,n,r;return e=t,(n=[{key:"setOriginRatio",value:function(t){this.anchors.setOriginRatio(t)}},{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.anchors.updatePosition(t),e&&ie.dispatch(k(Z.ANCHORS_LAYER))}},{key:"addToLayer",value:function(t){this.anchors.addToLayer(t)}},{key:"show",value:function(){this.anchors.show()}},{key:"hide",value:function(){this.anchors.hide()}},{key:"destroy",value:function(){this.anchors.destroy()}}])&&ct(e.prototype,n),r&&ct(e,r),t}();function lt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ht(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ft(t,e,n){return(ft="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function dt(t){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){ht(t,e,n[e])}))}return t}function yt(t,e){return!e||"object"!==gt(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function vt(t,e){return(vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var gt=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function bt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=dt(t);if(e){var o=dt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return yt(this,n)}}var wt=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vt(t,e)}(i,t);var e,n,r,o=bt(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this)).type=U.Z.RECT,e.onDragMove=function(t){var n;e.cbMap.call("dragmove",t),null===(n=e.sizeTransform)||void 0===n||n.update(e.getSizePos())},e.getSizePos=function(){var t=e.getAttrs();return{x:t.x,y:t.y,width:t.width,height:t.height}},e.onDragMoveAnchor=function(t){e.setShapeAttrs(t)},e.props=pt({},t),e}return e=i,(n=[{key:"defineShape",value:function(){this.shape=new I.Z.Rect({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,dash:this.props.dash,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth,fill:this.props.fill,draggable:!0})}},{key:"addToLayer",value:function(t,e){this.defineShape(),this.shape.on("dragmove",this.onDragMove),ft(dt(i.prototype),"attachBasicEvents",this).call(this,this.shape),this.sizeTransform=new ut(this.getSizePos()),this.sizeTransform.on("_dragmoveanchor",this.onDragMoveAnchor),t.add(this.shape),this.sizeTransform.addToLayer(e),ft(dt(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"blur",value:function(){var t;ft(dt(i.prototype),"blur",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.hide()}},{key:"focus",value:function(){var t;ft(dt(i.prototype),"focus",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.show()}},{key:"getFillColor",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("fill")}},{key:"setFillColor",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttr("fill",t)}},{key:"getStrokeColor",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("stroke")}},{key:"getAttrs",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttrs()}},{key:"hide",value:function(){var t;null===(t=this.shape)||void 0===t||t.setAttrs({stroke:"transparent"})}},{key:"setShapeAttrs",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttrs(t),ie.dispatch(k(Z.SHAPES_LAYER))}},{key:"setAttrs",value:function(t){var e;this.setShapeAttrs(t),null===(e=this.sizeTransform)||void 0===e||e.update(this.getSizePos())}},{key:"setStrokeColor",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttr("stroke",t)}},{key:"setStrokeWidth",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttrs({strokeWidth:t})}},{key:"getStrokeWidth",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("strokeWidth")}},{key:"getSelfRect",value:function(){if(!this.shape)throw new Error("Shape is not defined");var t=this.shape.getAbsolutePosition(),e=this.shape.getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}},{key:"draggable",value:function(t){var e,n;if(void 0===t)return null===(n=this.shape)||void 0===n?void 0:n.draggable();null===(e=this.shape)||void 0===e||e.draggable(t)}},{key:"scale",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y,a=r.width,s=r.height;null===(e=this.shape)||void 0===e||e.setAttrs({x:o*t.wFactor,y:i*t.hFactor,width:a*t.wFactor,height:s*t.hFactor}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"getCloningProps",value:function(){var t,e=null===(t=this.shape)||void 0===t?void 0:t.getAttrs();return pt({},this.props,e&&{x:e.x,y:e.y,width:e.width,height:e.height,stroke:e.stroke,strokeWidth:e.strokeWidth})}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=this.shape)||void 0===n?void 0:n.zIndex();null===(e=this.shape)||void 0===e||e.zIndex(t)}},{key:"crop",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y;null===(e=this.shape)||void 0===e||e.setAttrs({x:o-t.x,y:i-t.y}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"clone",value:function(){return new i(this.getCloningProps())}},{key:"initDraw",value:function(t,e){this.type===U.Z.RECT&&this.blur(),this.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y})}},{key:"destroy",value:function(){var t,e;ft(dt(i.prototype),"destroy",this).call(this),null===(t=this.shape)||void 0===t||t.destroy(),null===(e=this.sizeTransform)||void 0===e||e.destroy()}}])&&lt(e.prototype,n),r&&lt(e,r),i}(Q),mt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nonzero";t.beginPath();var r=!0,o=!1,i=void 0;try{for(var a,s=e.ops[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value,u=c.data;switch(c.op){case"move":t.moveTo(u[0],u[1]);break;case"bcurveTo":t.bezierCurveTo(u[0],u[1],u[2],u[3],u[4],u[5]);break;case"lineTo":t.lineTo(u[0],u[1])}}}catch(l){o=!0,i=l}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}"fillPath"===e.type?t.fill(n):t.stroke()},xt=function(t,e,n){var r=n.fillWeight;r<0&&(r=n.strokeWidth/2),t.save(),n.fillLineDash&&t.setLineDash(n.fillLineDash),n.fillLineDashOffset&&(t.lineDashOffset=n.fillLineDashOffset),t.strokeStyle=n.fill||"",t.lineWidth=r,mt(t,e),t.restore()},St=function(t,e){var n=e.sets||[],r=e.options,o=!0,i=!1,a=void 0;try{for(var s,c=n[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;switch(u.type){case"path":t.save(),t.strokeStyle="none"===r.stroke?"transparent":r.stroke,t.lineWidth=r.strokeWidth,r.strokeLineDash&&t.setLineDash(r.strokeLineDash),r.strokeLineDashOffset&&(t.lineDashOffset=r.strokeLineDashOffset),mt(t,u),t.restore();break;case"fillPath":t.save(),t.fillStyle=r.fill||"";var l="curve"===e.shape||"polygon"===e.shape?"evenodd":"nonzero";mt(t,u,l),t.restore();break;case"fillSketch":xt(t,u,r)}}}catch(h){i=!0,a=h}finally{try{o||null==c.return||c.return()}finally{if(i)throw a}}};function kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function At(t,e,n){return(At="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ot(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Ot(t){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Et(t,e){return!e||"object"!==Tt(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Rt(t,e){return(Rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Tt=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function jt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ot(t);if(e){var o=Ot(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Et(this,n)}}var Ct=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Rt(t,e)}(i,t);var e,n,r,o=jt(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).type=U.Z.RECT_ROUGH,e.isDragging=!1,e.prevWidth=0,e.prevHeight=0,e.onDragMoveSubRect=function(t){var n,r;e.cbMap.call("dragmove",t);var o=e.getSizePosSubRect();null===(n=e.sizeTransform)||void 0===n||n.update(o),null===(r=e.shape)||void 0===r||r.setAttrs(o)},e.onDragMoveAnchor=function(t){var n;null===(n=e.substrateKonvaShape)||void 0===n||n.setAttrs(t),e.setShapeAttrs(t)},e.getSizePosSubRect=function(){var t,n=null===(t=e.substrateKonvaShape)||void 0===t?void 0:t.getAttrs();return{x:n.x,y:n.y,width:n.width,height:n.height}},e.props=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Pt(t,e,n[e])}))}return t}({},t);var n=gr();return e.roughCanvas=Y().canvas(n),e}return e=i,(n=[{key:"defineShape",value:function(){var t=this;this.shape=new I.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:function(e,n){var r=n.getWidth(),o=n.getHeight(),i=n.getStroke(),a=n.getStrokeWidth();r===t.prevWidth&&o===t.prevHeight&&t.lastDrawable?(t.lastDrawable.options.stroke=i,t.lastDrawable.options.strokeWidth=a):(t.prevWidth=r,t.prevHeight=o,t.lastDrawable=t.roughCanvas.generator.rectangle(0,0,r,o,{roughness:2.5,stroke:i,strokeWidth:a})),St(e,t.lastDrawable),e.fillStrokeShape(n)}}),this.substrateKonvaShape=new I.Z.Rect({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:"transparent",fill:"transparent",draggable:!0}),this.shape.on("dragstart",(function(){t.isDragging=!0})),this.shape.on("dragend",(function(){t.isDragging=!1})),this.substrateKonvaShape.on("dragstart",(function(){t.isDragging=!0})),this.substrateKonvaShape.on("dragend",(function(){t.isDragging=!1})),this.substrateKonvaShape.on("click",(function(e){t.onClick(e)})),this.substrateKonvaShape.on("dragstart",(function(){t.onDragStart()})),this.substrateKonvaShape.on("mouseover",(function(){t.cbMap.call("mouseover")})),this.substrateKonvaShape.on("mouseout",(function(){t.cbMap.call("mouseout")}))}},{key:"setStrokeWidth",value:function(t){At(Ot(i.prototype),"setStrokeWidth",this).call(this,t/2)}},{key:"getStrokeWidth",value:function(){return 2*At(Ot(i.prototype),"getStrokeWidth",this).call(this)}},{key:"addToLayer",value:function(t,e){if(At(Ot(i.prototype),"addToLayer",this).call(this,t,e),!this.substrateKonvaShape)throw new Error("`this.substrateKonvaShape` is not defined");this.substrateKonvaShape.on("dragmove",this.onDragMoveSubRect),t.add(this.substrateKonvaShape)}},{key:"draggable",value:function(t){var e,n=At(Ot(i.prototype),"draggable",this).call(this,t);return null===(e=this.substrateKonvaShape)||void 0===e||e.setAttr("draggable",t),n}},{key:"initDraw",value:function(t,e){var n;null===(n=this.substrateKonvaShape)||void 0===n||n.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y}),At(Ot(i.prototype),"initDraw",this).call(this,t,e)}},{key:"destroy",value:function(){var t;At(Ot(i.prototype),"destroy",this).call(this),null===(t=this.substrateKonvaShape)||void 0===t||t.destroy()}},{key:"scale",value:function(t){var e;At(Ot(i.prototype),"scale",this).call(this,t);var n=this.getAttrs(),r=n.x,o=n.y,a=n.width,s=n.height;null===(e=this.substrateKonvaShape)||void 0===e||e.setAttrs({x:r,y:o,width:a,height:s})}},{key:"crop",value:function(t){var e;At(Ot(i.prototype),"crop",this).call(this,t);var n=this.getAttrs(),r=n.x,o=n.y;null===(e=this.substrateKonvaShape)||void 0===e||e.setAttrs({x:r,y:o})}},{key:"clone",value:function(){return new i(this.getCloningProps())}}])&&kt(e.prototype,n),r&&kt(e,r),i}(wt);function _t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Lt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Dt(t,e,n){return(Dt="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Mt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Mt(t){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Zt(t,e){return!e||"object"!==It(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ht(t,e){return(Ht=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var It=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Nt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Mt(t);if(e){var o=Mt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Zt(this,n)}}var Bt=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ht(t,e)}(i,t);var e,n,r,o=Nt(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).type=U.Z.ELLIPSE_ROUGH,e.isDragging=!1,e.prevWidth=0,e.prevHeight=0,e.props=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Lt(t,e,n[e])}))}return t}({},t);var n=gr();return e.roughCanvas=Y().canvas(n),e}return e=i,(n=[{key:"defineShape",value:function(){var t=this;this.shape=new I.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:function(e,n){var r=n.getWidth(),o=n.getHeight();r===t.prevWidth&&o===t.prevHeight&&t.lastDrawable?t.lastDrawable.options.stroke=n.getStroke():(t.prevWidth=r,t.prevHeight=o,t.lastDrawable=t.roughCanvas.generator.ellipse(r/2,o/2,r,o,{roughness:2.5,stroke:n.getStroke()})),St(e,t.lastDrawable),e.fillStrokeShape(n)}}),this.shape.on("dragstart",(function(){t.isDragging=!0})),this.shape.on("dragend",(function(){t.isDragging=!1}))}},{key:"setStrokeWidth",value:function(t){Dt(Mt(i.prototype),"setStrokeWidth",this).call(this,t/2)}},{key:"getStrokeWidth",value:function(){return 2*Dt(Mt(i.prototype),"getStrokeWidth",this).call(this)}},{key:"scale",value:function(t){Dt(Mt(i.prototype),"scale",this).call(this,t)}},{key:"clone",value:function(){return new i(this.getCloningProps())}}])&&_t(e.prototype,n),r&&_t(e,r),i}(wt),Wt=n(3710);function zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Gt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ut(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Gt(t,e,n[e])}))}return t}function Ft(t){return function(t){if(Array.isArray(t))return zt(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return zt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Yt,Kt=function(){var t=new I.Z.Layer;return t.imageSmoothingEnabled(!0),t},Xt={cursor:M.AUTO,shapesLayer:Kt(),anchorsLayer:Kt(),list:[],addingShapeRef:null},qt=(0,E.Z)((Gt(Yt={},"".concat(l),(function(t,e){e.payload.addToLayer(t.shapesLayer,t.anchorsLayer);var n=Ft(t.list).concat([e.payload]);return c().get(e.payload,"type")===U.Z.IMAGE&&z({addedShape:e.payload}),t.shapesLayer.draw(),t.anchorsLayer.draw(),Ut({},t,{list:n})})),Gt(Yt,"".concat(x),(function(t,e){var n;t.addingShapeRef&&(null===(n=e.payload)||void 0===n?void 0:n.type)&&t.addingShapeRef.type!==e.payload.type&&t.addingShapeRef.destroy();var r=c().get(e.payload,"type",null),o=c().get(e.payload,"options",null),i=null;switch(r){case U.Z.ARROW:i=Tn(void 0,o);break;case U.Z.TEXT:i=Cn(void 0,o);break;case U.Z.RECT:case U.Z.RECT_ROUGH:case U.Z.ELLIPSE:case U.Z.ELLIPSE_ROUGH:case U.Z.SELECT_RECT:i=Ln(void 0,o,r);break;case null:i=null;break;default:console.error("Can't set adding shape for the selected shape type: ".concat(r))}return Ut({},t,{addingShapeRef:i})})),Gt(Yt,"".concat(S),(function(t,e){var n=e.payload;return z({addedShape:n}),t})),Gt(Yt,"".concat(v),(function(t){return t.list.forEach((function(t){return t.destroy()})),t.shapesLayer.draw(),t.anchorsLayer.draw(),G({}),Ut({},t,{list:[]})})),Gt(Yt,"".concat(g),(function(t,e){var n=t.list.find((function(t){return t===e.payload}));n&&n.destroy(),W();var r=t.list.filter((function(t){return t!==e.payload}));return G({deletedShape:n}),Ut({},t,{list:r})})),Gt(Yt,"".concat(b),(function(t,e){return t.list.forEach((function(t){t!==e.payload&&t.blur()})),t.anchorsLayer.draw(),t.shapesLayer.draw(),W(),t})),Gt(Yt,"".concat(m),(function(t,e){return t.list.forEach((function(t){t.crop(e.payload)})),t.shapesLayer.draw(),t.anchorsLayer.draw(),t})),Gt(Yt,"".concat(y),(function(t){var e=t.list.find((function(t){return t.isSelected()}));e&&e.destroy(),t.shapesLayer.draw(),t.anchorsLayer.draw(),W();var n=t.list.filter((function(t){return t!==e}));return G({deletedShape:e}),Ut({},t,{list:n})})),Gt(Yt,"".concat(P),(function(t,e){var n=e.payload,r=t.list.find((function(t){return t.isSelected()}));return null===r||void 0===r||r.zIndex(n===Wt.Q.BringToFront?2*t.list.length:0),t})),Gt(Yt,"".concat(h),(function(t,e){return Ut({},t,{cursor:e.payload})})),Gt(Yt,"".concat(f),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case U.Z.ARROW:case U.Z.RECT:case U.Z.RECT_ROUGH:case U.Z.ELLIPSE:case U.Z.ELLIPSE_ROUGH:n.setStrokeColor(e.payload);break;case U.Z.TEXT:n.setFillColor(e.payload);break;default:console.error("Can't set stroke color for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t})),Gt(Yt,"".concat(d),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case U.Z.ARROW:case U.Z.RECT:case U.Z.RECT_ROUGH:case U.Z.ELLIPSE:case U.Z.ELLIPSE_ROUGH:n.setStrokeWidth(e.payload);break;default:console.error("Can't set stroke width for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t})),Gt(Yt,"".concat(p),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case U.Z.TEXT:n.setFontSize(e.payload);break;default:console.error("Can't set font size for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t.anchorsLayer.draw(),t})),Gt(Yt,"".concat(w),(function(t,e){return e.payload&&t.list.forEach((function(t){return t.scale(e.payload)})),t.shapesLayer.draw(),t})),Gt(Yt,"".concat(k),(function(t,e){switch(e.payload){case Z.SHAPES_LAYER:t.shapesLayer.draw();break;case Z.ANCHORS_LAYER:t.anchorsLayer.draw();break;default:t.shapesLayer.draw(),t.anchorsLayer.draw()}return t})),Gt(Yt,"".concat(A),(function(t){var e=t.list.find((function(t){return t.isSelected()}));switch(null===e||void 0===e?void 0:e.type){case U.Z.RECT:case U.Z.ELLIPSE:var n=e.getCloningProps(),r=(null===e||void 0===e?void 0:e.type)===U.Z.RECT?Ct:Bt,o=Ln(new r(n));o.addToLayer(t.shapesLayer,t.anchorsLayer);var i=t.list.map((function(t){return t===e?(t.destroy(),o):t}));return t.shapesLayer.draw(),t.anchorsLayer.draw(),z({addedShape:o}),Ut({},t,{list:i});default:console.error("Can't sketchify the selected shape"),console.log(e)}return t})),Yt),Xt),Vt=(0,u.Z)("SET_SAVE_STAGE"),$t=(0,u.Z)("SAVE_STAGE"),Jt=(0,u.Z)("COPY_STAGE");function Qt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var te,ee=(0,E.Z)((Qt(te={},"".concat(Vt),(function(t,e){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Qt(t,e,n[e])}))}return t}({},t,{instance:e.payload})})),Qt(te,"".concat($t),(function(t,e){var n=e.payload;if(!t.instance)throw new Error("SaveStage is not defined");return t.instance.saveFromLayer(n.layer,n.name,n.contentRect),t})),Qt(te,"".concat(Jt),(function(t,e){var n=e.payload;if(!t.instance)throw new Error("SaveStage is not defined");return t.instance.copyFromLayer(n.layer,n.contentRect),t})),te),{instance:null}),ne=(0,O.UY)({stage:H,shapes:qt,saveCanvas:ee});function re(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var oe,ie=(0,O.MT)(ne,O.md.apply(void 0,function(t){if(Array.isArray(t))return re(t)}(oe=[])||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(oe)||function(t,e){if(t){if("string"===typeof t)return re(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?re(t,e):void 0}}(oe)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()));function ae(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function se(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ce(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ue(t,e,n){return(ue="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=le(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function le(t){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function he(t,e){return null!=e&&"undefined"!==typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function fe(t,e){return!e||"object"!==pe(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function de(t,e){return(de=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var pe=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function ye(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=le(t);if(e){var o=le(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return fe(this,n)}}var ve=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&de(t,e)}(i,t);var e,n,r,o=ye(i);function i(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ae(this,i),(e=o.call(this)).type=U.Z.IMAGE,e.onDragMove=function(){var t;null===(t=e.sizeTransform)||void 0===t||t.update(e.getSizePos())},e.onDragMoveAnchor=function(t){var n;null===(n=e.image)||void 0===n||n.setAttrs(t)},e.getSizePos=function(){return{x:e.image.x(),y:e.image.y(),width:e.image.width(),height:e.image.height()}},e.props=n,he(t,I.Z.Image)?e.image=t:e.image=new I.Z.Image({image:t,draggable:!0,x:n.x,y:n.y,width:n.width,height:n.height}),e}return e=i,(n=[{key:"addToLayer",value:function(t,e){var n;ue(le(i.prototype),"addToLayer",this).call(this,t,e),this.image.on("dragmove",this.onDragMove),this.sizeTransform=new ut(this.getSizePos()),null===(n=this.sizeTransform)||void 0===n||n.setOriginRatio(this.image.width()/this.image.height()),this.sizeTransform.on("_dragmoveanchor",this.onDragMoveAnchor),ue(le(i.prototype),"attachBasicEvents",this).call(this,this.image),t.add(this.image),this.sizeTransform.addToLayer(e)}},{key:"destroy",value:function(){var t;ue(le(i.prototype),"destroy",this).call(this),this.image.destroy(),null===(t=this.sizeTransform)||void 0===t||t.destroy()}},{key:"getSelfRect",value:function(){var t=this.image.getAbsolutePosition(),e=this.image.getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}},{key:"blur",value:function(){var t;ue(le(i.prototype),"blur",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.hide()}},{key:"focus",value:function(){var t;ue(le(i.prototype),"focus",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.show()}},{key:"draggable",value:function(t){var e,n;return null===(e=this.image)||void 0===e||e.setAttr("draggable",t),null===(n=this.image)||void 0===n?void 0:n.getAttr("draggable")}},{key:"zIndex",value:function(t){if(void 0===t)return this.image.zIndex();this.image.zIndex(t)}},{key:"clone",value:function(){return new i(this.image.clone(),function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){ce(t,e,n[e])}))}return t}({},this.getSizePos()))}},{key:"initDraw",value:function(t,e){}},{key:"scale",value:function(t){}}])&&se(e.prototype,n),r&&se(e,r),i}(Q);function ge(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function be(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function we(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function me(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){we(t,e,n[e])}))}return t}function xe(t){return function(t){if(Array.isArray(t))return ge(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return ge(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ge(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Se,ke={radius:5,stroke:"#855824",fill:"#dddd45",strokeWidth:1},Pe={radius:6,stroke:"#666",fill:"#ddd",strokeWidth:1};!function(t){t.START="start",t.CONTROL="control",t.END="end"}(Se||(Se={}));var Ae=function(){function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new V,this.on=function(t,e){o.cbMap.set(t,e)};var i=me({},{x:e,y:n,draggable:!0,visible:!1},Pe);r===Se.CONTROL&&(i=me({},i,ke)),this.anchor=new I.Z.Circle(i),this.originalPosition={x:e,y:n},this.delta={x:0,y:0},this.appliedDelta={x:0,y:0},this.initEvents()}var e,n,r;return e=t,(n=[{key:"initEvents",value:function(){var t=this;this.anchor.on("mouseover",this.cbMap.get("mouseover")),this.anchor.on("mouseout",this.cbMap.get("mouseout")),this.anchor.on("mousedown",this.cbMap.get("mousedown")),this.anchor.on("mouseup",this.cbMap.get("mouseup")),this.anchor.on("dragend",(function(){t.cbMap.call("dragend");var e=t.getPosition();t.originalPosition.x=e.x,t.originalPosition.y=e.y,t.appliedDelta.x=t.delta.x,t.appliedDelta.y=t.delta.y})),this.anchor.on("dragmove",c().throttle((function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var o;(o=t.cbMap).call.apply(o,["dragmove"].concat(xe(n)))}),50))}},{key:"getAnchor",value:function(){return this.anchor}},{key:"setPosition",value:function(t,e){this.anchor.setAttr("x",t),this.anchor.setAttr("y",e),this.originalPosition.x=t,this.originalPosition.y=e,this.appliedDelta.x=this.delta.x,this.appliedDelta.y=this.delta.y}},{key:"getPosition",value:function(){var t=this.anchor.getAttrs();return{x:t.x,y:t.y}}},{key:"draw",value:function(){this.anchor.draw()}},{key:"setDelta",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.anchor.setAttr("x",this.originalPosition.x+(t-this.appliedDelta.x)),this.anchor.setAttr("y",this.originalPosition.y+(e-this.appliedDelta.y)),this.delta.x=t,this.delta.y=e}},{key:"setAttr",value:function(t,e){this.anchor.setAttr(t,e)}},{key:"visible",value:function(t){this.anchor.visible(t)}},{key:"destroy",value:function(){this.anchor.destroy()}}])&&be(e.prototype,n),r&&be(e,r),t}(),Oe=function(t,e){var n=0-Math.abs(e.x),r=t.x-e.x,o=t.y-e.y,i=n*r+0*o,a=Math.sqrt(Math.pow(n,2)+Math.pow(0,2))*Math.sqrt(Math.pow(r,2)+Math.pow(o,2));if(0===a)return 0;var s=Math.acos(i/a);return t.y>e.y?2*Math.PI-s:s},Ee=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))};function Re(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Te=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new V,this.moveStart=function(){if(!n.anchors)throw new Error("`this.anchors` is not defined");var t=n.anchors.start.getPosition(),e=n.anchors.end.getPosition(),r=Oe(t,e),o=r-n.prevAnchorsPosition.angles.start,i=n.calculateMovedControlPos(n.calculateRotatedControlPos(o,e),"end");n.anchors.control.setPosition(i.x,i.y),n.moveControl(),n.prevAnchorsPosition.start=t,n.prevAnchorsPosition.control=i,n.prevAnchorsPosition.end=e,n.prevAnchorsPosition.angles.start=r,n.prevAnchorsPosition.angles.end=Math.PI+r},this.moveControl=function(){n.cbMap.call("dragmove")},this.moveEnd=function(){if(!n.anchors)throw new Error("`this.anchors` is not defined");var t=n.anchors.start.getPosition(),e=n.anchors.end.getPosition(),r=Oe(e,t),o=r-n.prevAnchorsPosition.angles.end,i=n.calculateMovedControlPos(n.calculateRotatedControlPos(o,t),"start");n.anchors.control.setPosition(i.x,i.y),n.moveControl(),n.prevAnchorsPosition.start=t,n.prevAnchorsPosition.control=i,n.prevAnchorsPosition.end=e,n.prevAnchorsPosition.angles.start=Math.PI+r,n.prevAnchorsPosition.angles.end=r},this.onDragEnd=function(){n.cbMap.call("dragend")},this.visible=function(t){var e,r,o;null===(e=n.anchors)||void 0===e||e.start.visible(t),null===(r=n.anchors)||void 0===r||r.control.visible(t),null===(o=n.anchors)||void 0===o||o.end.visible(t)},this.on=function(t,e){n.cbMap.set(t,e)},this.anchorsPosition=e,this.prevAnchorsPosition={start:{x:0,y:0},control:{x:0,y:0},end:{x:0,y:0},angles:{start:c().get(e,"angles.start",0),control:c().get(e,"angles.control",0),end:c().get(e,"angles.end",Math.PI)}}}var e,n,r;return e=t,r=[{key:"defineAnchors",value:function(t,e,n){var r,o,i,a,s,c;return n?(r=n.start.x,o=n.start.y,i=n.control.x,a=n.control.y,s=n.end.x,c=n.end.y):(r=t.width/4,o=t.height/2,i=t.width/2,a=o,s=3*r,c=o,Math.abs(s-r)>e&&(r=i-e/2,s=i+e/2)),{start:new Ae(r,o,Se.START),control:new Ae(i,a,Se.CONTROL),end:new Ae(s,c,Se.END)}}}],(n=[{key:"calculateRotatedControlPos",value:function(t,e){if(!this.anchors)throw new Error("`this.anchors` is not defined");var n=this.anchors.control.getPosition(),r=n.x-e.x,o=n.y-e.y,i=Math.cos(t),a=Math.sin(t),s=o*i+r*a;return{x:r*i-o*a+e.x,y:s+e.y}}},{key:"calculateMovedControlPos",value:function(t,e){if(!this.anchors)throw new Error("`this.anchors` is not defined");var n=Ee(this.prevAnchorsPosition.start,this.prevAnchorsPosition.end),r=this.anchors.start.getPosition(),o=this.anchors.end.getPosition(),i=Ee(r,o)/n,a="start"===e?r:o,s=Ee(t,a),c=(a.x-t.x)/s,u=(a.y-t.y)/s,l=s-s*i;return{x:t.x+l*c,y:t.y+l*u}}},{key:"draw",value:function(){var t,e,n;null===(t=this.anchors)||void 0===t||t.start.draw(),null===(e=this.anchors)||void 0===e||e.control.draw(),null===(n=this.anchors)||void 0===n||n.end.draw(),ie.dispatch(k(Z.ANCHORS_LAYER))}},{key:"setAnchors",value:function(e,n){this.anchors=t.defineAnchors(e,n,this.anchorsPosition),this.prevAnchorsPosition.start=this.anchors.start.getPosition(),this.prevAnchorsPosition.control=this.anchors.control.getPosition(),this.prevAnchorsPosition.end=this.anchors.end.getPosition(),this.anchors.start.on("dragmove",this.moveStart),this.anchors.control.on("dragmove",this.moveControl),this.anchors.end.on("dragmove",this.moveEnd),this.anchors.start.on("dragend",this.onDragEnd),this.anchors.control.on("dragend",this.onDragEnd),this.anchors.end.on("dragend",this.onDragEnd)}},{key:"addToLayer",value:function(t){if(!this.anchors)throw new Error("`this.anchors` is not defined");t.add(this.anchors.start.getAnchor()),t.add(this.anchors.control.getAnchor()),t.add(this.anchors.end.getAnchor())}},{key:"getPositions",value:function(){var t;return!this.anchors&&this.anchorsPosition?this.anchorsPosition:{start:this.anchors.start.getPosition(),control:this.anchors.control.getPosition(),end:this.anchors.end.getPosition(),angles:null===(t=this.prevAnchorsPosition)||void 0===t?void 0:t.angles}}},{key:"setAnchorsCoordinates",value:function(t){var e,n,r;this.prevAnchorsPosition.start=t.start,this.prevAnchorsPosition.control=t.control,this.prevAnchorsPosition.end=t.end,null===(e=this.anchors)||void 0===e||e.start.setPosition(t.start.x,t.start.y),null===(n=this.anchors)||void 0===n||n.control.setPosition(t.control.x,t.control.y),null===(r=this.anchors)||void 0===r||r.end.setPosition(t.end.x,t.end.y);var o=Oe(t.start,t.end);this.prevAnchorsPosition.angles.start=o,this.prevAnchorsPosition.angles.end=Math.PI+o}},{key:"setDelta",value:function(t,e){var n,r,o;null===(n=this.anchors)||void 0===n||n.start.setDelta(t,e),null===(r=this.anchors)||void 0===r||r.control.setDelta(t,e),null===(o=this.anchors)||void 0===o||o.end.setDelta(t,e)}},{key:"destroy",value:function(){var t,e,n,r,o,i;null===(t=this.anchors)||void 0===t||null===(e=t.start)||void 0===e||e.destroy(),null===(n=this.anchors)||void 0===n||null===(r=n.control)||void 0===r||r.destroy(),null===(o=this.anchors)||void 0===o||null===(i=o.end)||void 0===i||i.destroy()}}])&&Re(e.prototype,n),r&&Re(e,r),t}();function je(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ce=function(t){return t*(Math.PI/180)},_e=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new V,this.on=function(t,e){n.cbMap.set(t,e)},this.arrowHead=new I.Z.Line({lineCap:"round",lineJoin:"round",stroke:e.stroke,strokeWidth:e.strokeWidth,points:t.calculateHeadPoints(e.start,e.control,e.strokeWidth)}),this.arrowHead.on("click",(function(t){n.cbMap.call("click",t)})),this.arrowHead.on("mouseover",(function(t){n.cbMap.call("mouseover",t)})),this.arrowHead.on("mouseout",(function(t){n.cbMap.call("mouseout",t)})),this.delta={x:0,y:0},this.appliedDelta={x:0,y:0}}var e,n,r;return e=t,r=[{key:"calculateHeadPoints",value:function(t,e,n){var r,o={x:0,y:0},i={x:0,y:0},a=t.x-e.x,s=t.y-e.y;0===a?r=t.y<e.y?Ce(90):Ce(270):(r=Math.atan(s/a),a>0&&(r+=Ce(180)));var c=10*n,u=Ce(Math.min(40,c<20?20:c)),l=Math.min(14,4.5*n),h=u-r;o.x=t.x+l*Math.cos(h),o.y=t.y-l*Math.sin(h);var f=Ce(90)-(r+u);return i.x=t.x+l*Math.sin(f),i.y=t.y+l*Math.cos(f),[i.x,i.y,t.x,t.y,o.x,o.y]}}],(n=[{key:"update",value:function(e,n,r){this.arrowHead.setPoints(t.calculateHeadPoints(e,n,r)),this.arrowHead.setAttrs({x:0,y:0,strokeWidth:r}),this.arrowHead.draw(),this.appliedDelta.x=this.delta.x,this.appliedDelta.y=this.delta.y}},{key:"draw",value:function(){this.arrowHead.draw()}},{key:"zIndex",value:function(t){var e;null===(e=this.arrowHead)||void 0===e||e.zIndex(t)}},{key:"setDelta",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.arrowHead.setAttr("x",t-this.appliedDelta.x),this.arrowHead.setAttr("y",e-this.appliedDelta.y),this.delta.x=t,this.delta.y=e}},{key:"setAttr",value:function(t,e){this.arrowHead.setAttr(t,e)}},{key:"addToLayer",value:function(t){t.add(this.arrowHead)}},{key:"destroy",value:function(){this.arrowHead.destroy()}}])&&je(e.prototype,n),r&&je(e,r),t}();function Le(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function De(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Me(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ze(t,e,n){return(Ze="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=He(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function He(t){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ie(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Me(t,e,n[e])}))}return t}function Ne(t,e){return!e||"object"!==We(e)&&"function"!==typeof e?Le(t):e}function Be(t,e){return(Be=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var We=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function ze(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=He(t);if(e){var o=He(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ne(this,n)}}var Ge,Ue=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Be(t,e)}(i,t);var e,n,r,o=ze(i);function i(t){var e,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this)).type=U.Z.ARROW,n.redrawArrow=function(){var t,e,r,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=n.anchorsGroup.getPositions(),a=n.getPathString(i);null===(t=n.visiblePath)||void 0===t||t.setData(a),null===(e=n.substratePath)||void 0===e||e.setData(a),null===(r=n.arrowHead)||void 0===r||r.update(i.start,i.control,n.props.strokeWidth),o&&ie.dispatch(k())},n.pathMove=function(){var t,e,r;if(!n.substratePath)throw new Error("`this.substratePath` is not defined");var o=n.substratePath.attrs.x,i=n.substratePath.attrs.y;n.anchorsGroup.setDelta(o,i),null===(t=n.visiblePath)||void 0===t||t.setAttrs({x:o,y:i}),null===(e=n.arrowHead)||void 0===e||e.setDelta(o,i),null===(r=n.arrowHead)||void 0===r||r.draw(),n.anchorsGroup.draw()},n.blur=function(){Ze((e=Le(n),He(i.prototype)),"blur",e).call(e),n.anchorsGroup.visible(!1)},n.onAnchor=function(t,e){n.anchorsGroup.on(t,e)},n.props=Ie({},t),n.anchorsGroup=new Te(n.props.anchorsPosition),n}return e=i,(n=[{key:"initArrowDraw",value:function(t,e){this.substratePath=new I.Z.Path({data:t,stroke:"transparent",strokeWidth:12,draggable:!0}),this.visiblePath=new I.Z.Path({data:t,stroke:this.props.stroke||"red",strokeWidth:this.props.strokeWidth,lineCap:"round",lineJoin:"round"}),this.substratePath.on("dragmove",this.pathMove),this.attachBasicEvents(this.substratePath),e.add(this.visiblePath),e.add(this.substratePath)}},{key:"getPathString",value:function(t){var e=c().get(this.visiblePath,"attrs.x",0),n=c().get(this.visiblePath,"attrs.y",0);return"M".concat(t.start.x-e,",").concat(t.start.y-n," ")+"Q".concat(t.control.x-e,",").concat(t.control.y-n," ")+"".concat(t.end.x-e,",").concat(t.end.y-n)}},{key:"focus",value:function(){Ze(He(i.prototype),"focus",this).call(this),this.anchorsGroup.visible(!0)}},{key:"addToLayer",value:function(t,e){var n=this;this.anchorsGroup.setAnchors({width:t.parent.attrs.width,height:t.parent.attrs.height},300),this.anchorsGroup.on("dragmove",(function(){return n.redrawArrow(!0)})),this.anchorsGroup.on("dragend",(function(){return n.redrawArrow(!0)}));var r=this.anchorsGroup.getPositions();this.arrowHead=new _e({start:r.start,control:r.control,stroke:this.props.stroke||"red",strokeWidth:this.props.strokeWidth}),this.arrowHead.on("click",this.onClick);var o=this.getPathString(r);this.initArrowDraw(o,t),this.arrowHead.addToLayer(t),this.anchorsGroup.addToLayer(e),this.redrawArrow(),Ze(He(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"setStrokeColor",value:function(t){var e,n,r,o;null===(e=this.visiblePath)||void 0===e||e.setAttr("stroke",t),null===(n=this.arrowHead)||void 0===n||n.setAttr("stroke",t),this.props.stroke=t,null===(r=this.visiblePath)||void 0===r||r.draw(),null===(o=this.arrowHead)||void 0===o||o.draw()}},{key:"getStrokeColor",value:function(){return this.props.stroke}},{key:"setStrokeWidth",value:function(t){var e;null===(e=this.visiblePath)||void 0===e||e.setAttr("strokeWidth",t),this.props.strokeWidth=t,this.redrawArrow()}},{key:"getSelfRect",value:function(){if(!this.visiblePath)throw new Error("Arrow is not defined");var t=this.visiblePath.getAbsolutePosition(),e=this.visiblePath.getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}},{key:"getStrokeWidth",value:function(){var t;return null===(t=this.visiblePath)||void 0===t?void 0:t.getAttr("strokeWidth")}},{key:"draggable",value:function(t){var e,n;return null===(e=this.substratePath)||void 0===e||e.setAttr("draggable",t),null===(n=this.substratePath)||void 0===n?void 0:n.getAttr("draggable")}},{key:"scale",value:function(t){var e=this.anchorsGroup.getPositions();this.anchorsGroup.setAnchorsCoordinates({start:{x:e.start.x*t.wFactor,y:e.start.y*t.hFactor},control:{x:e.control.x*t.wFactor,y:e.control.y*t.hFactor},end:{x:e.end.x*t.wFactor,y:e.end.y*t.hFactor}}),this.redrawArrow()}},{key:"initDraw",value:function(t,e){this.isSelected()&&this.blur(),this.anchorsGroup.setAnchorsCoordinates({start:{x:e.x,y:e.y},control:{x:(t.x+e.x)/2,y:(t.y+e.y)/2},end:{x:t.x,y:t.y}}),this.redrawArrow(!0)}},{key:"zIndex",value:function(t){var e,n,r,o;if(void 0===t)return null===(o=this.visiblePath)||void 0===o?void 0:o.zIndex();null===(e=this.substratePath)||void 0===e||e.zIndex(t),null===(n=this.visiblePath)||void 0===n||n.zIndex(t),null===(r=this.arrowHead)||void 0===r||r.zIndex(t)}},{key:"crop",value:function(t){var e=this.anchorsGroup.getPositions();this.anchorsGroup.setAnchorsCoordinates({start:{x:e.start.x-t.x,y:e.start.y-t.y},control:{x:e.control.x-t.x,y:e.control.y-t.y},end:{x:e.end.x-t.x,y:e.end.y-t.y}}),this.redrawArrow()}},{key:"clone",value:function(){var t=this.anchorsGroup?this.anchorsGroup.getPositions():this.props.anchorsPosition;return new i(Ie({},this.props,{anchorsPosition:t}))}},{key:"destroy",value:function(){var t,e,n,r;Ze(He(i.prototype),"destroy",this).call(this),null===(t=this.visiblePath)||void 0===t||t.destroy(),null===(e=this.substratePath)||void 0===e||e.destroy(),null===(n=this.arrowHead)||void 0===n||n.destroy(),null===(r=this.anchorsGroup)||void 0===r||r.destroy()}}])&&De(e.prototype,n),r&&De(e,r),i}(Q);function Fe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ye(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t.fontSize="fontSize",t.color="color"}(Ge||(Ge={}));var Ke=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this;Fe(this,t),this.onKeyDown=function(){var t=r.textNode.getAbsoluteScale().x;r.setTextareaWidth(r.textNode.width()*t),r.textArea.style.height="auto",r.textArea.style.height="".concat(r.textArea.scrollHeight+r.textNode.fontSize(),"px")},this.textNode=e,this.textArea=document.createElement("textarea"),this.textArea.value=n,document.body.appendChild(this.textArea),this.textArea.addEventListener("keydown",this.onKeyDown),this.textArea.style.display="none"}var e,n,r;return e=t,(n=[{key:"setTextareaWidth",value:function(t){t||(t=this.textNode.placeholder.length*this.textNode.fontSize());var e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;(e||n)&&(t=Math.ceil(t)),(document.documentMode||/Edge/.test(navigator.userAgent))&&(t+=1),this.textArea.style.width="".concat(t,"px")}},{key:"update",value:function(t){this.textArea.style.display="initial",this.textArea.value=t.value,this.textArea.style.position="absolute",this.textArea.style.top="".concat(t.top,"px"),this.textArea.style.left="".concat(t.left,"px"),this.textArea.style.width="".concat(t.width,"px"),this.textArea.style.height="".concat(t.height,"px"),this.textArea.style.fontSize="".concat(t.fontSize,"px"),this.textArea.style.fontFamily="Lato, Arial",this.textArea.style.border="1px dashed #2196f3",this.textArea.style.padding="0px",this.textArea.style.margin="0px",this.textArea.style.overflow="hidden",this.textArea.style.background="none",this.textArea.style.outline="none",this.textArea.style.resize="none",this.textArea.style.lineHeight=t.lineHeight,this.textArea.style.fontFamily=t.fontFamily,this.textArea.style.transformOrigin="left top",this.textArea.style.textAlign=t.textAlign,this.textArea.style.color=t.color;var e="rotateZ(".concat(t.rotation,"deg)");if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){var n=2+Math.round(t.fontSize/20);e+="translateY(-".concat(n,"px)")}this.textArea.style.transform=e,this.textArea.style.height="auto",this.textArea.style.height=this.textArea.scrollHeight+3+"px"}},{key:"setAttr",value:function(t,e){switch(t){case Ge.fontSize:this.textArea.style.fontSize="".concat(e,"px");break;case Ge.color:this.textArea.style.color=e}}},{key:"focus",value:function(){this.textArea.focus()}},{key:"hide",value:function(){this.textArea.style.display="none"}},{key:"getValue",value:function(){return this.textArea.value}},{key:"destroy",value:function(){var t;this.textArea.removeEventListener("keydown",this.onKeyDown),null===(t=this.textArea.parentNode)||void 0===t||t.removeChild(this.textArea)}}])&&Ye(e.prototype,n),r&&Ye(e,r),t}();function Xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ve(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){qe(t,e,n[e])}))}return t}var $e=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.makeEditable=function(){var t;n.textNode.hide();var e=null===(t=ie.getState().stage.instance)||void 0===t?void 0:t.absolutePosition();if(!e)throw new Error("Stage is not defined");var r=n.textNode.position();n.textArea.update({value:n.textNode.text(),top:r.y+e.y,left:r.x+e.x,width:n.textNode.width()-2*n.textNode.padding(),height:n.textNode.height()-2*n.textNode.padding()+5,fontSize:n.textNode.fontSize(),lineHeight:n.textNode.lineHeight(),fontFamily:n.textNode.fontFamily(),textAlign:n.textNode.align(),color:n.textNode.fill(),rotation:n.textNode.rotation()}),n.textArea.focus()},this.textNode=new I.Z.Text(Ve({},e,{draggable:!0})),this.textNode.on("transform",(function(){n.textNode.setAttrs({width:n.textNode.width()*n.textNode.scaleX(),scaleX:1})})),this.textArea=new Ke(this.textNode,e.text)}var e,n,r;return e=t,(n=[{key:"blur",value:function(){this.textNode.text(this.textArea.getValue()),this.textArea.hide(),this.textNode.show()}},{key:"setAttr",value:function(t,e){switch(this.textNode.setAttr(t,e),t){case"fontSize":this.textArea.setAttr(Ge.fontSize,e);break;case"fill":this.textArea.setAttr(Ge.color,e)}}},{key:"draggable",value:function(t){return this.textNode.setAttr("draggable",t),this.textNode.getAttr("draggable")}},{key:"on",value:function(t,e){this.textNode.on(t,e)}},{key:"addToLayer",value:function(t){t.add(this.textNode)}},{key:"setPosition",value:function(t,e){this.textNode.setAttrs({x:t,y:e})}},{key:"getPosition",value:function(){return{x:this.textNode.attrs.x,y:this.textNode.attrs.y}}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=this.textNode)||void 0===n?void 0:n.zIndex();null===(e=this.textNode)||void 0===e||e.zIndex(t)}},{key:"getText",value:function(){return this.textNode.attrs.text}},{key:"getRotation",value:function(){return this.textNode.rotation()}},{key:"getAttrs",value:function(){return this.textNode.getAttrs()}},{key:"getNode",value:function(){return this.textNode}},{key:"getSelfRect",value:function(){return Ve({},this.getPosition(),{width:this.textNode.width(),height:this.textNode.height()})}},{key:"destroy",value:function(){var t,e;null===(t=this.textNode)||void 0===t||t.destroy(),null===(e=this.textArea)||void 0===e||e.destroy()}}])&&Xe(e.prototype,n),r&&Xe(e,r),t}();function Je(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function tn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function en(t,e,n){return(en="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=nn(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function nn(t){return(nn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){tn(t,e,n[e])}))}return t}function on(t,e){return!e||"object"!==sn(e)&&"function"!==typeof e?Je(t):e}function an(t,e){return(an=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var sn=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function cn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=nn(t);if(e){var o=nn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return on(this,n)}}var un=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&an(t,e)}(i,t);var e,n,r,o=cn(i);function i(t){var e,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this)).type=U.Z.TEXT,n.focus=function(){var t;en((e=Je(n),nn(i.prototype)),"focus",e).call(e),null===(t=n.transformer)||void 0===t||t.show()},n.props=rn({},t),n}return e=i,(n=[{key:"addToLayer",value:function(t,e){var n,r=this,o=this.props.x||t.parent.attrs.width/2-100,a=this.props.y||t.parent.attrs.height/2-10;this.textNode=new $e({text:this.props.text||"Some text here",x:o,y:a,fontFamily:"Lato, Arial",fontSize:this.props.fontSize||20,width:this.props.width||200,fill:this.props.fill,rotation:null!==(n=this.props.rotation)&&void 0!==n?n:0}),this.attachBasicEvents(this.textNode),this.textNode.addToLayer(t),this.transformer=new I.Z.Transformer({node:this.textNode.getNode(),enabledAnchors:["middle-left","middle-right"],borderStroke:"#2196f3",anchorStroke:"#2196f3",anchorFill:"#ffffff",borderStrokeWidth:1,anchorStrokeWidth:1,boundBoxFunc:function(t,e){return e.width=Math.max(30,e.width),e}}),this.textNode.on("dblclick",(function(){var t,e;null===(t=r.textNode)||void 0===t||t.makeEditable(),null===(e=r.transformer)||void 0===e||e.hide(),ie.dispatch(k(Z.SHAPES_LAYER)),ie.dispatch(k(Z.ANCHORS_LAYER))})),this.textNode.on("click",this.focus),this.textNode.on("transform",(function(){ie.dispatch(k(Z.SHAPES_LAYER))})),this.transformer.hide(),e.add(this.transformer),en(nn(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"setFillColor",value:function(t){var e;null===(e=this.textNode)||void 0===e||e.setAttr("fill",t),this.props.fill=t}},{key:"getFillColor",value:function(){return this.props.fill}},{key:"setFontSize",value:function(t){var e;null===(e=this.textNode)||void 0===e||e.setAttr("fontSize",t),this.props.fontSize=t}},{key:"blur",value:function(){var t,e;en(nn(i.prototype),"blur",this).call(this),null===(t=this.textNode)||void 0===t||t.blur(),null===(e=this.transformer)||void 0===e||e.hide()}},{key:"scale",value:function(t){if(!this.textNode)throw new Error("`this.textNode` is not defined");var e=this.textNode.getPosition();this.textNode.setPosition(e.x*t.wFactor,e.y*t.hFactor)}},{key:"setAttrs",value:function(t){var e=this;Object.keys(t).forEach((function(n){var r;null===(r=e.textNode)||void 0===r||r.setAttr(n,t[n])}))}},{key:"crop",value:function(t){if(!this.textNode)throw new Error("`this.textNode` is not defined");var e=this.textNode.getPosition();this.textNode.setPosition(e.x-t.x,e.y-t.y)}},{key:"draggable",value:function(t){var e,n;return null!==(n=null===(e=this.textNode)||void 0===e?void 0:e.draggable(t))&&void 0!==n&&n}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=this.textNode)||void 0===n?void 0:n.zIndex();null===(e=this.textNode)||void 0===e||e.zIndex(t)}},{key:"clone",value:function(){var t,e,n,r,o=null===(t=this.textNode)||void 0===t?void 0:t.getText(),a=null===(e=this.textNode)||void 0===e?void 0:e.getRotation(),s=c().get(null===(n=this.textNode)||void 0===n?void 0:n.getAttrs(),"width");return new i(rn({},this.props,null===(r=this.textNode)||void 0===r?void 0:r.getPosition(),o&&{text:o},a&&{rotation:a},s&&{width:s}))}},{key:"getSelfRect",value:function(){if(!this.textNode)throw new Error("TextNode is not defined");return this.textNode.getSelfRect()}},{key:"initDraw",value:function(t,e){this.setAttrs({x:t.x,y:t.y,rotation:Oe(t,e)*(180/Math.PI)}),ie.dispatch(k(Z.SHAPES_LAYER))}},{key:"destroy",value:function(){var t,e;en(nn(i.prototype),"destroy",this).call(this),null===(t=this.textNode)||void 0===t||t.destroy(),null===(e=this.transformer)||void 0===e||e.destroy()}}])&&Qe(e.prototype,n),r&&Qe(e,r),i}(Q);function ln(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function hn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fn(t,e,n){return(fn="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dn(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function dn(t){return(dn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pn(t,e){return!e||"object"!==vn(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function yn(t,e){return(yn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var vn=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function gn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=dn(t);if(e){var o=dn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return pn(this,n)}}var bn=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yn(t,e)}(i,t);var e,n,r,o=gn(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){hn(t,e,n[e])}))}return t}({},t,{stroke:"#0d87dc",fill:"transparent",strokeWidth:2,dash:[10,5]}))).type=U.Z.SELECT_RECT,e}return e=i,(n=[{key:"blur",value:function(){fn(dn(i.prototype),"blur",this).call(this),this.destroy()}},{key:"scale",value:function(){this.destroy()}}])&&ln(e.prototype,n),r&&ln(e,r),i}(wt);function wn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xn(t){return(xn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Sn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){mn(t,e,n[e])}))}return t}function kn(t,e){return!e||"object"!==An(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Pn(t,e){return(Pn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var An=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function On(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=xn(t);if(e){var o=xn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return kn(this,n)}}var En=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pn(t,e)}(i,t);var e,n,r,o=On(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).type=U.Z.ELLIPSE,e.getSizePos=function(){var t=e.getAttrs(),n=t.x,r=t.y,o=t.radiusX,i=t.radiusY;return{x:n-o,y:r-i,width:2*o,height:2*i}},e.onDragMoveAnchor=function(t){t.x=t.x+t.width/2,t.y=t.y+t.height/2,e.setShapeAttrs(t)},e.props=Sn({},t),e}return e=i,(n=[{key:"defineShape",value:function(){this.shape=new I.Z.Ellipse({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,dash:this.props.dash,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth,fill:this.props.fill,draggable:!0})}},{key:"getCloningProps",value:function(){var t,e=null===(t=this.shape)||void 0===t?void 0:t.getAttrs();return Sn({},this.props,e&&{x:e.x-e.radiusX,y:e.y-e.radiusY,width:2*e.radiusX,height:2*e.radiusY,stroke:e.stroke,strokeWidth:e.strokeWidth})}},{key:"clone",value:function(){var t=this.getCloningProps();return t.x+=t.width/4,t.y+=t.height/4,new i(t)}},{key:"scale",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y,a=r.radiusX,s=r.radiusY;null===(e=this.shape)||void 0===e||e.setAttrs({x:o*t.wFactor,y:i*t.hFactor,width:2*a*t.wFactor,height:2*s*t.hFactor}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"initDraw",value:function(t,e){this.blur();var n=e.x-t.x,r=e.y-t.y;this.setAttrs({x:t.x+n/2,y:t.y+r/2,width:Math.abs(n),height:Math.abs(r)})}}])&&wn(e.prototype,n),r&&wn(e,r),i}(wt),Rn=function(t){t.on("click",(function(t){ie.dispatch(b(t))})),t.on("dragstart",(function(t){ie.dispatch(b(t))})),t.on("mouseover",(function(){var e=ie.getState(),n=e.shapes,r=e.stage;r.isDraggable?t.draggable(!1):t.draggable(!n.addingShapeRef);var o=n.addingShapeRef?M.AUTO:M.MOVE;r.isDraggable||ie.dispatch(h(o))})),t.on("mouseout",(function(){ie.getState().stage.isDraggable||ie.dispatch(h(M.AUTO))}))},Tn=function(t,e){var n=t||new Ue({stroke:c().get(e,"strokeColor","green"),strokeWidth:c().get(e,"strokeWidth")});return n.onAnchor("mouseover",(function(){return ie.dispatch(h(M.POINTER))})),n.onAnchor("mouseout",(function(){return ie.dispatch(h(M.AUTO))})),Rn(n),n},jn=function(t){ie.dispatch(l(t))},Cn=function(t,e){var n=t||new un({fill:c().get(e,"fillColor","green"),fontSize:c().get(e,"fontSize")});return Rn(n),n},_n=function(t){ie.dispatch(l(t))},Ln=function(t,e,n){var r={stroke:c().get(e,"strokeColor","green"),fill:c().get(e,"fill","transparent"),strokeWidth:c().get(e,"strokeWidth",2)},o=function(){if(t)return t;switch(n){case U.Z.RECT:return new wt(r);case U.Z.RECT_ROUGH:return new Ct(r);case U.Z.ELLIPSE:return new En(r);case U.Z.ELLIPSE_ROUGH:return new Bt(r);case U.Z.SELECT_RECT:return new bn}}();if(!o)throw new Error("rectNode is not defined");return Rn(o),o},Dn=function(t){ie.dispatch(l(t))},Mn=function(t){switch(t.type){case U.Z.ARROW:jn(t);break;case U.Z.TEXT:_n(t);break;case U.Z.RECT:case U.Z.RECT_ROUGH:case U.Z.ELLIPSE:case U.Z.ELLIPSE_ROUGH:case U.Z.SELECT_RECT:Dn(t);break;default:console.error("Can't connect given shape"),console.log(t)}},Zn=function(t,e){switch(t.type){case U.Z.ARROW:!function(t,e){var n=Tn(t,e);jn(n)}(t.clone(),e);break;case U.Z.TEXT:!function(t,e){var n=Cn(t,e);_n(n)}(t.clone(),e);break;case U.Z.RECT:case U.Z.RECT_ROUGH:case U.Z.ELLIPSE:case U.Z.ELLIPSE_ROUGH:!function(t,e,n){var r=Ln(t,e,n);Dn(r)}(t.clone(),e);break;case U.Z.IMAGE:Hn(t.clone());break;default:console.error("Can't clone and connect given shape"),console.log(t)}},Hn=function(t){Rn(t),ie.dispatch(l(t))},In=function(t){var e=ie.getState().stage;if(!e.instance)throw new Error("Stage is not defined");var n=e.instance.absolutePosition(),r=new ve(t.image,t.pos?{x:t.pos.x-n.x,y:t.pos.y-n.y}:{x:e.instance.width()/2-t.image.width/2-n.x,y:e.instance.height()/2-t.image.height/2-n.y});Hn(r)},Nn="shapes-layer",Bn=n(3274),Wn=function(t){navigator.clipboard?navigator.clipboard.writeText(t).then((function(){}),(function(t){console.error("Async: Could not copy text: ",t)})):function(t){var e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();try{document.execCommand("cut")}catch(n){return console.warn("Copy to clipboard failed.",n),!1}finally{document.body.removeChild(e)}}(t)},zn=function(t){var e=document.createElement("img");e.src=t;var n=document.createElement("div");n.contentEditable="true",n.appendChild(e),document.body.appendChild(n),function(t){if(!window.getSelection)throw new Error("Can't select text");var e=window.getSelection(),n=document.createRange();n.selectNodeContents(t),null===e||void 0===e||e.removeAllRanges(),null===e||void 0===e||e.addRange(n)}(n),document.execCommand("Copy"),document.body.removeChild(n)};function Gn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Un(t){return function(t){if(Array.isArray(t))return Gn(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return Gn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gn(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Fn={onDelete:["backspace","delete","del"],onCopy:["ctrl+c","command+c"],onPaste:["ctrl+v","command+v"],onActivateDrag:{sequence:"space",action:"keydown"},onDisableDrag:{sequence:"space",action:"keyup"},onActivateRatio:{sequence:"shift",action:"keydown"},onDisableRatio:{sequence:"shift",action:"keyup"}},Yn=function(){var t=(0,a.useRef)([]);(0,a.useEffect)((function(){var t=c().throttle((function(){e(),n()}),50);return window.addEventListener("focus",t,{capture:!0}),function(){window.removeEventListener("focus",t)}}),[]);var e=function(){var t=ie.getState().shapes;ie.dispatch(j(!1)),t.list.forEach((function(t){t.draggable(!0)})),ie.dispatch(h(M.AUTO))},n=function(){ie.dispatch(C(!1))};return(0,i.jsx)(Bn.GlobalHotKeys,{keyMap:Fn,handlers:{onDelete:function(){ie.dispatch(y()),ie.dispatch(h(M.AUTO))},onCopy:function(){var e=ie.getState().shapes;Wn("[Shape]"),t.current=e.list.reduce((function(t,e){return e.isSelected()?Un(t).concat([e.clone()]):t}),[])},onPaste:function(){ie.dispatch(b()),t.current.forEach((function(t){Zn(t)})),t.current=[]},onActivateDrag:function(){var t=ie.getState().shapes;ie.dispatch(j(!0)),t.list.forEach((function(t){t.draggable(!1)})),ie.dispatch(h(M.GRAB))},onDisableDrag:e,onActivateRatio:function(){ie.dispatch(C(!0))},onDisableRatio:n}})},Kn=n(96),Xn=n.n(Kn),qn=function(t){var e=t.children,n=(0,a.useState)(M.AUTO),r=n[0],o=n[1],s=(0,a.useRef)(c().throttle((function(){ie.dispatch(T({width:window.innerWidth,height:window.innerHeight}))}),80)),u=(0,a.useRef)((function(){var t=ie.getState().shapes;o(t.cursor)}));return(0,a.useEffect)((function(){window.addEventListener("resize",s.current);var t=ie.subscribe(u.current);return function(){window.removeEventListener("resize",s.current),t()}}),[]),(0,i.jsx)("div",{style:{cursor:r},className:Xn().CanvasWrapper,children:e})};function Vn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var $n=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new V,this.handleClick=function(t){ie.getState().shapes.addingShapeRef||ie.dispatch(b())},this.handleMouseDown=function(t){n.cbMap.call("mousedown",t)},this.handleMouseUp=function(t){n.cbMap.call("mouseup",t)},this.handleMouseMove=function(t){n.cbMap.call("mousemove",t)},this.stage=new I.Z.Stage({container:e,width:window.innerWidth,height:window.innerHeight});var r=ie.getState().shapes;this.add(r.shapesLayer),this.add(r.anchorsLayer);try{r.shapesLayer.getCanvas()._canvas.classList.add(Nn),r.anchorsLayer.getCanvas()._canvas.classList.add("anchors-layer")}catch(o){console.error("Can't set className to the canvas"),console.error(o)}this.stage.on("mousedown",this.handleMouseDown),this.stage.on("mouseup",this.handleMouseUp),this.stage.on("mousemove",this.handleMouseMove),this.stage.on("click",this.handleClick)}var e,n,r;return e=t,(n=[{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"add",value:function(t){this.stage.add(t)}},{key:"setAttrs",value:function(t){this.stage.setAttrs(t)}},{key:"draggable",value:function(t){if(void 0===t)return this.stage.draggable();this.stage.draggable(t)}},{key:"absolutePosition",value:function(t){if(void 0===t)return this.stage.absolutePosition();this.stage.absolutePosition(t)}},{key:"getBoundingClientRect",value:function(){return this.stage.container().getBoundingClientRect()}},{key:"toDataURL",value:function(){return this.stage.toDataURL()}},{key:"getPos",value:function(){return{x:this.stage.x(),y:this.stage.y()}}},{key:"width",value:function(){return this.stage.width()}},{key:"height",value:function(){return this.stage.height()}},{key:"getContentBoundariesRect",value:function(){var t=ie.getState().shapes.list;if(0===t.length)return{x:0,y:0,width:0,height:0};var e={xTopLeft:1/0,yTopLeft:1/0,xBottomRight:-1/0,yBottomRight:-1/0},n=t.reduce((function(t,e){var n=e.getSelfRect(),r=n.x+n.width,o=n.y+n.height;return{xTopLeft:n.x<t.xTopLeft?n.x:t.xTopLeft,yTopLeft:n.y<t.yTopLeft?n.y:t.yTopLeft,xBottomRight:r>t.xBottomRight?r:t.xBottomRight,yBottomRight:o>t.yBottomRight?o:t.yBottomRight}}),e);return{x:n.xTopLeft,y:n.yTopLeft,width:n.xBottomRight-n.xTopLeft,height:n.yBottomRight-n.yTopLeft}}}])&&Vn(e.prototype,n),r&&Vn(e,r),t}();var Jn=function(t,e){var n=function(t){var e=t.split(",");if(e[0]){var n=e[0].match(/:(.*?);/);if(n){for(var r=n[1],o=atob(e[1]),i=o.length,a=new Uint8Array(i);i--;)a[i]=o.charCodeAt(i);return new Blob([a],{type:r})}}return null}(t);if(!n)throw new Error("blob data is null");var r=document.createElement("a"),o=URL.createObjectURL(n);r.download=e.replace(/(\.[^.]+)$/gi,"")+".png",r.href=o,r.click()};function Qn(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}function tr(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Qn(i,r,o,a,s,"next",t)}function s(t){Qn(i,r,o,a,s,"throw",t)}a(void 0)}))}}function er(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var nr=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stage=new I.Z.Stage({container:e,width:10,height:10})}var e,n,r;return e=t,r=[{key:"normPosAxis",value:function(t){return t<0?Math.abs(t):0}}],(n=[{key:"trimLayer",value:function(e,n){var r=this,o=e.clone();return this.stage.add(o),this.stage.setAttrs({width:t.normPosAxis(n.x)+n.width+60,height:t.normPosAxis(n.y)+n.height+60,x:-1*n.x+30,y:-1*n.y+30}),new Promise((function(t,e){var n=r;setTimeout((function(){var r=n,i=o.getCanvas()._canvas;!function(t){var e,n,r,o,i,a,s,c,u,l,h,f,d;if(r=t.canvas.width,o=t.canvas.height,!r&&!o)return!1;for(d=t.getImageData(0,0,r,o),u=new Uint32Array(d.data.buffer),l=0,h=r*o-1,f=!1,n=0;n<o&&!f;n+=1){for(e=0;e<r;e+=1){if(u[l++]&&!i&&(i=n+1,c)){f=!0;break}if(u[h--]&&!c&&(c=o-n-1,i)){f=!0;break}}if(n>o-n&&!i&&!c)return!1}for(i-=1,f=!1,e=0;e<r&&!f;e+=1)for(l=i*r+e,h=i*r+(r-e-1),n=i;n<=c;n+=1){if(u[l]&&!a&&(a=e+1,s)){f=!0;break}if(u[h]&&!s&&(s=r-e-1,a)){f=!0;break}l+=r,h+=r}return r===s-(a-=1)+1&&o===c-i+1||(r=s-a+1,o=c-i+1,t.canvas.width=r,t.canvas.height=o,t.putImageData(d,-a,-i)),!0}(i.getContext("2d"))?e(new Error("Can't trim given context")):t(i),setTimeout((function(){r.stage.getLayers().forEach((function(t){return t.destroy()}))}),1e3)}))}))}},{key:"saveFromLayer",value:function(t,e,n){var r=this;return tr(o().mark((function i(){var a,s;return o().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r.trimLayer(t,n);case 2:a=o.sent,s=a.toDataURL(),Jn(s,e);case 5:case"end":return o.stop()}}),i)})))()}},{key:"copyFromLayer",value:function(t,e){var n=this;return tr(o().mark((function r(){var i,a,s,c;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(null===window||void 0===window||null===(i=window.navigator)||void 0===i||null===(a=i.clipboard)||void 0===a?void 0:a.write)){r.next=8;break}return r.next=4,n.trimLayer(t,e);case 4:r.sent.toBlob((function(t){var e=new ClipboardItem({"image/png":t});navigator.clipboard.write([e])})),r.next=13;break;case 8:return r.next=10,n.trimLayer(t,e);case 10:s=r.sent,c=s.toDataURL(),zn(c);case 13:case"end":return r.stop()}}),r)})))()}}])&&er(e.prototype,n),r&&er(e,r),t}(),rr=n(1908),or=n.n(rr),ir=function(){var t=(0,a.useRef)(null);return(0,a.useEffect)((function(){ie.dispatch(Vt(new nr(t.current)))}),[]),(0,i.jsx)("div",{ref:t,className:or().SaveCanvasEl})},ar=function(t){var e=t.shape,n=t.startPos,r=t.currentPos;if(t.ratioShiftIsActive&&e.type!==U.Z.ARROW){var o=r.x-n.x,i=r.y-n.y,a=Math.min(Math.abs(o),Math.abs(i));e.initDraw(n,{x:n.x+Math.sign(o)*a,y:n.y+Math.sign(i)*a})}else e.initDraw(n,r)},sr=function(){return{startAddingShape:function(t){ie.dispatch(b());var e=t.type,n=t.options;switch(e){case U.Z.TEXT:case U.Z.ARROW:case U.Z.RECT:case U.Z.RECT_ROUGH:case U.Z.ELLIPSE:case U.Z.ELLIPSE_ROUGH:case U.Z.SELECT_RECT:ie.dispatch(x({type:e,options:n}));break;case null:ie.dispatch(x({type:null}));break;default:throw new Error("Given shape type can't be added: ".concat(e))}},setImage:function(t){In(t)},setStrokeColorToActiveShape:function(t){ie.dispatch(f(t))},setStrokeWidthToActiveShape:function(t){ie.dispatch(d(t))},setFontSizeToActiveShape:function(t){ie.dispatch(p(t))},exportCanvasToImage:function(t){var e=ie.getState(),n=e.shapes,r=e.stage;if(!r.instance)throw new Error("Stage instance is not defined");ie.dispatch($t({layer:n.shapesLayer,name:t,contentRect:r.instance.getContentBoundariesRect()}))},copyAllToClipboard:function(){var t=ie.getState(),e=t.stage,n=t.shapes;if(!e.instance)throw new Error("Stage instance is not defined");ie.dispatch(Jt({layer:n.shapesLayer,contentRect:e.instance.getContentBoundariesRect()}))},blurShapes:function(){ie.dispatch(b())},sketchifyActiveShape:function(){ie.dispatch(A())},getShapesAmount:function(){return new Promise((function(t){requestAnimationFrame((function(){var e=ie.getState().shapes;t(e.list.length)}))}))},changeOrderOfActiveShape:function(t){ie.dispatch(P(t))},initBlankCanvas:function(t){if(!ie.getState().stage.instance)throw new Error('"instance" is not defined on stage. It looks like stage is not initialized yet.');(function(t,e,n){var r=document.createElement("svg");return r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("width",String(t)),r.setAttribute("height",String(e)),r.setAttribute("style","background-color:".concat(n)),new Promise((function(t,e){var n=new Image,o=new Blob([r.outerHTML],{type:"image/svg+xml"}),i=URL.createObjectURL(o);n.onload=function(){URL.revokeObjectURL(i),t(this)},n.onerror=e,n.src=i}))})(t.width,t.height,"#cdcdcd").then((function(t){In({image:t,name:"Blank canvas"})}))},onShapeClicked:B("SHAPE_CLICKED"),onShapeDragStarted:B("SHAPE_DRAG_STARTED"),onShapeBlurred:B("SHAPES_BLURRED"),onShapeAdded:B("SHAPE_ADDED"),onShapeDeleted:B("SHAPE_DELETED")}},cr=n(5170),ur=n.n(cr);function lr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function fr(t){return(fr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function dr(t,e){return!e||"object"!==yr(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function pr(t,e){return(pr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var yr=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function vr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=fr(t);if(e){var o=fr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return dr(this,n)}}var gr=function(){var t=document.querySelector(".".concat(Nn));if(t)return t;throw new Error("Shapes layer is not found")},br=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pr(t,e)}(s,t);var e,n,r,o=vr(s);function s(){var t;return lr(this,s),(t=o.apply(this,arguments)).canvasRef=a.createRef(),t.state={mouseIsDown:!1,mouseStartPos:{x:0,y:0}},t.handleStageOnMouseDown=function(e){var n=ie.getState(),r=n.shapes,o=n.stage;if(r.addingShapeRef&&o.instance){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY,u={x:s-i.x,y:c-i.y};t.setState({mouseIsDown:!0,mouseStartPos:u}),Mn(r.addingShapeRef),r.addingShapeRef.initDraw(u,u)}},t.handleStageOnMouseUp=function(e){t.setState({mouseIsDown:!1});var n=ie.getState(),r=n.shapes,o=n.stage;if(r.addingShapeRef){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY,u=Ee({x:s-i.x,y:c-i.y},t.state.mouseStartPos);r.addingShapeRef.type===U.Z.TEXT||u>10?(r.addingShapeRef.focus(),ie.dispatch(S(r.addingShapeRef))):ie.dispatch(g(r.addingShapeRef)),requestAnimationFrame((function(){ie.dispatch(x())}))}},t.handleStageOnMouseMove=function(e){var n=ie.getState(),r=n.shapes,o=n.stage;if(t.state.mouseIsDown&&r.addingShapeRef&&o.instance){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY;ar({shape:r.addingShapeRef,startPos:t.state.mouseStartPos,currentPos:{x:s-i.x,y:c-i.y},ratioShiftIsActive:o.ratioShiftIsActive})}},t}return e=s,(n=[{key:"componentDidMount",value:function(){if(this.canvasRef.current){var t=new $n(this.canvasRef.current);t.on("mousedown",this.handleStageOnMouseDown),t.on("mouseup",this.handleStageOnMouseUp),t.on("mousemove",this.handleStageOnMouseMove),ie.dispatch(R(t)),this.canvasRef.current.tabIndex=1,this.props.onReady(sr())}}},{key:"render",value:function(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(qn,{children:[(0,i.jsx)(Yn,{}),(0,i.jsx)("div",{ref:this.canvasRef,className:ur().CanvasEl})]}),(0,i.jsx)(ir,{})]})}}])&&hr(e.prototype,n),r&&hr(e,r),s}(a.PureComponent),wr=n(8523),mr=n(484),xr=n(27),Sr=n(5968),kr=n(3489),Pr=n(3425),Ar=n(4440);function Or(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}function Er(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Rr=function(t){var e=t.children,n=(0,a.useContext)(Sr.z),r=n.state,s=r.menu,c=r.canvas.canvasApi,u=n.dispatch,l=function(){var t,e=(t=o().mark((function t(e,n,r){var i,a,l,h,f,d,p,y;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=!1,!(e.length>0)){t.next=34;break}a=!0,l=!1,h=void 0,t.prev=3,f=e[Symbol.iterator]();case 5:if(a=(d=f.next()).done){t.next=20;break}if((p=d.value).type.startsWith("image")){t.next=12;break}return u((0,kr.c)({message:(0,Pr.t)("image-type-error"),type:Ar.k.Error})),xr.qP({eventCategory:xr.Ak.Error,eventAction:"image type error (".concat(p.type,")")}),i=!0,t.abrupt("continue",17);case 12:return t.next=14,(0,mr.Z)(p);case 14:y=t.sent,null===c||void 0===c||c.blurShapes(),null===c||void 0===c||c.setImage({image:y.image,name:y.name,pos:{x:r.clientX-y.image.width/2,y:r.clientY-s.menuHeight-y.image.height/2}});case 17:a=!0,t.next=5;break;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(3),l=!0,h=t.t0;case 26:t.prev=26,t.prev=27,a||null==f.return||f.return();case 29:if(t.prev=29,!l){t.next=32;break}throw h;case 32:return t.finish(29);case 33:return t.finish(26);case 34:i||xr.qP({eventCategory:xr.Ak.GlobalInteraction,eventAction:xr.UZ.DropImage});case 35:case"end":return t.stop()}}),t,null,[[3,22,26,34],[27,,29,33]])})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Or(i,r,o,a,s,"next",t)}function s(t){Or(i,r,o,a,s,"throw",t)}a(void 0)}))});return function(t,n,r){return e.apply(this,arguments)}}();return(0,i.jsx)(wr.ZP,{onDrop:l,children:function(t){var n=t.getRootProps;return(0,i.jsx)("div",function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Er(t,e,n[e])}))}return t}({},n(),{children:e}))}})},Tr=n(4801),jr=n.n(Tr),Cr=function(){return(0,i.jsx)("div",{className:jr().HowToStart,children:(0,Pr.t)("how-to-start")})},_r=n(4753),Lr=n(7214),Dr=n(1664),Mr=n(1163),Zr=n(1386),Hr=n.n(Zr),Ir=n(8944),Nr=function(){var t=(0,Mr.useRouter)().query,e=(0,a.useState)(""),n=e[0],r=e[1];return(0,a.useEffect)((function(){r((0,Ir.W)(t))}),[t]),(0,i.jsxs)("div",{className:Hr().Tips,children:["Psst...",(0,i.jsx)("br",{}),"You can add as many images as you want.",(0,i.jsx)("br",{}),"To read more about this feature\xa0",(0,i.jsx)(Dr.default,{href:"/features".concat(n),passHref:!0,children:(0,i.jsx)("a",{onClick:function(){xr.qP({eventCategory:xr.Ak.Content,eventAction:xr.UZ.FeaturesPage})},children:"click here"})}),(0,i.jsx)("br",{})]})};function Br(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}var Wr=function(){var t=(0,a.useState)(!1),e=t[0],n=t[1],r=(0,a.useContext)(Sr.z),s=r.state.canvas.canvasApi,u=r.dispatch,l=function(t){var e=(t.clipboardData||t.originalEvent.clipboardData).items,n=Array.from(e).find((function(t){return 0===t.type.indexOf("image")}));if(n){var r=n.getAsFile(),o=new Image;if(!r)throw new Error("blob data is null");var i=URL.createObjectURL(r);o.onload=function(){URL.revokeObjectURL(i),null===s||void 0===s||s.setImage({image:this,name:""})},o.onerror=function(t){console.error(t)},o.src=i}},h=function(){var t,e=(t=o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=5;break}return t.next=3,s.getShapesAmount();case 3:e=t.sent,n(e>0);case 5:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Br(i,r,o,a,s,"next",t)}function s(t){Br(i,r,o,a,s,"throw",t)}a(void 0)}))});return function(){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){(0,Lr.Oo)("paste",l);var t=c().noop,e=c().noop;return s&&(t=s.onShapeAdded(h),e=s.onShapeDeleted(h),h()),function(){(0,Lr.xg)("paste",l),t(),e(),null===s||void 0===s||s.blurShapes()}}),[s]),(0,i.jsxs)(Rr,{children:[!e&&(0,i.jsx)(Cr,{}),(0,i.jsx)(br,{onReady:function(t){u((0,_r.T)(t))}}),!e&&(0,i.jsx)(Nr,{})]})}},4801:function(t){t.exports={HowToStart:"HowToStart_HowToStart__U_ZpN"}},1386:function(t){t.exports={Tips:"Tips_Tips__YAVcx"}},5170:function(t){t.exports={CanvasEl:"CanvasEl_CanvasEl__olqIr"}},96:function(t){t.exports={CanvasWrapper:"CanvasWrapper_CanvasWrapper__JUeAG"}},1908:function(t){t.exports={SaveCanvasEl:"SaveCanvasEl_SaveCanvasEl__iEaxT"}}}]);