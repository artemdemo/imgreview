(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79],{407:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return Qr}});var r=n(4051),o=n.n(r),i=n(5893),a=n(7294),s=n(6486),c=n.n(s),u=n(8231),l=(0,u.Z)("ADD_SHAPE"),h=(0,u.Z)("SET_CURSOR"),f=(0,u.Z)("SET_FILL_COLOR_TO_ACTIVE_SHAPE"),d=(0,u.Z)("SET_STROKE_COLOR_TO_ACTIVE_SHAPE"),p=(0,u.Z)("SET_STROKE_WIDTH_TO_ACTIVE_SHAPE"),y=(0,u.Z)("SET_FONT_SIZE_TO_ACTIVE_SHAPE"),v=(0,u.Z)("DELETE_ACTIVE_SHAPES"),g=(0,u.Z)("DELETE_ALL_SHAPES"),b=(0,u.Z)("DELETE_SHAPE"),w=(0,u.Z)("BLUR_SHAPES"),m=(0,u.Z)("SCALE_SHAPES"),_=(0,u.Z)("CROP_SHAPES"),x=(0,u.Z)("SET_ADDING_SHAPE"),k=(0,u.Z)("SHAPE_ADDED"),S=(0,u.Z)("DRAW_LAYERS"),P=(0,u.Z)("CHANGE_ORDER_OF_ACTIVE_SHAPE"),A=(0,u.Z)("SKETCHIFY_ACTIVE_SHAPE"),O=n(9569),E=n(3620),R=(0,u.Z)("SET_STAGE"),T=(0,u.Z)("SET_STAGE_SIZE"),j=(0,u.Z)("SET_STAGE_DRAGGABLE"),C=(0,u.Z)("SET_RATIO_SHIFT");function L(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){L(t,e,n[e])}))}return t}var M,Z,I,N=(0,E.Z)((L(M={},"".concat(R),(function(t,e){return D({},t,{instance:e.payload})})),L(M,"".concat(T),(function(t,e){var n,r=e.payload,o=r.width,i=r.height;return null===(n=t.instance)||void 0===n||n.setAttrs({width:o,height:i}),t})),L(M,"".concat(j),(function(t,e){var n,r=e.payload;return null===(n=t.instance)||void 0===n||n.draggable(r),D({},t,{isDraggable:r})})),L(M,"".concat(C),(function(t,e){var n,r=e.payload;return null===(n=t.instance)||void 0===n||n.draggable(r),D({},t,{ratioShiftIsActive:r})})),M),{instance:null,isDraggable:!1,ratioShiftIsActive:!1}),H=n(9649);!function(t){t.AUTO="auto",t.MOVE="move",t.POINTER="pointer",t.GRAB="grab"}(Z||(Z={})),function(t){t.SHAPES_LAYER="shapes_layer",t.ANCHORS_LAYER="anchors_layer"}(I||(I={}));var W=(0,n(8111).i)(),B=function(t){return function(e){return W.on(t,e)}},z=function(t){W.emit("SHAPES_BLURRED",t)},G=function(t){W.emit("SHAPE_ADDED",t)},U=function(t){W.emit("SHAPE_DELETED",t)},F=n(5693),Y=n(9021),K=n.n(Y);function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function V(t){return function(t){if(Array.isArray(t))return X(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var $=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new Map}var e,n,r;return e=t,n=[{key:"set",value:function(t,e){this.cbMap.set(t,e)}},{key:"call",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=this.cbMap.get(t);o&&o.apply(void 0,V(n))}},{key:"get",value:function(t){var e=this.cbMap.get(t);return null!==e&&void 0!==e?e:c().noop}},{key:"has",value:function(t){return this.cbMap.has(t)}}],n&&q(e.prototype,n),r&&q(e,r),t}();function J(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Q,tt=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=F.Z.SHAPE,this.cbMap=new $,this._isSelected=!1,this.onClick=function(t){var n;le.getState().shapes.addingShapeRef||(n=e,W.emit("SHAPE_CLICKED",n),t.cancelBubble=!0,e.focus(),e.cbMap.call("click",e))},this.onDragStart=function(){var t;t=e,W.emit("SHAPE_DRAG_STARTED",t),e.focus(),e.cbMap.call("dragstart",e)}}var e,n,r;return e=t,(n=[{key:"blur",value:function(){this._isSelected=!1}},{key:"focus",value:function(){this._isSelected=!0}},{key:"isSelected",value:function(){return this._isSelected}},{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"addToLayer",value:function(t,e){this.focus()}},{key:"clone",value:function(){console.warn("clone() is not implemented"),console.warn(this)}},{key:"crop",value:function(t){console.warn("crop() is not implemented"),console.warn(this)}},{key:"draggable",value:function(t){console.warn("draggable() is not implemented"),console.warn(this)}},{key:"attachBasicEvents",value:function(t){var e=this;t.on("click",this.onClick),t.on("dragstart",this.onDragStart),t.on("mouseover",(function(){e.cbMap.call("mouseover",e)})),t.on("mouseout",(function(){e.cbMap.call("mouseout",e)}))}},{key:"destroy",value:function(){this.cbMap.call("_beforedestroy",this)}}])&&J(e.prototype,n),r&&J(e,r),t}();function et(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t.left="left",t.top="top",t.right="right",t.bottom="bottom",t.leftTop="leftTop",t.leftBottom="leftBottom",t.rightTop="rightTop",t.rightBottom="rightBottom"}(Q||(Q={}));var rt={width:10,height:10,stroke:"#2196f3",strokeWidth:1,fill:"#ffffff",draggable:!0},ot=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._cbMap=new $,this.onDragMove=function(t){n._cbMap.call("dragmove",n._attrs.type,t)},this._attrs=e,this._anchor=new H.Z.Rect(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){nt(t,e,n[e])}))}return t}({},rt,{x:e.x-rt.width/2,y:e.y-rt.height/2,dragBoundFunc:function(t){return{x:t.x,y:t.y}}})),this._anchor.on("dragmove",this.onDragMove)}var e,n,r;return e=t,(n=[{key:"show",value:function(){this._anchor.visible(!0)}},{key:"hide",value:function(){this._anchor.visible(!1)}},{key:"on",value:function(t,e){this._cbMap.set(t,e)}},{key:"getPos",value:function(){var t=this._anchor.getAttrs();return{x:t.x+rt.width/2,y:t.y+rt.height/2}}},{key:"setPos",value:function(t){var e=this.getPos(),n=t.x||e.x,r=t.y||e.y;this._anchor.setAttrs({x:n-rt.width/2,y:r-rt.height/2})}},{key:"addToLayer",value:function(t){t.add(this._anchor)}},{key:"destroy",value:function(){this._anchor.destroy()}}])&&et(e.prototype,n),r&&et(e,r),t}(),it=ot;function at(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function st(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ct(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){st(t,e,n[e])}))}return t}var ut=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._cbMap=new $,this._originRatio=1,this.onMoveAnchor=function(t,e){var r=le.getState().stage,o=r.ratioShiftIsActive,i=r.instance,a=e.evt,s=a.layerX,c=a.layerY,u=null===i||void 0===i?void 0:i.absolutePosition(),l=n.getCurrentAnchor(t),h=o?{x:s-u.x,y:c-u.y}:l.getPos(),f=n.getOppositeAnchor(t).getPos(),d=h.x-f.x,p=h.y-f.y,y=Math.min(Math.abs(d/n._originRatio),Math.abs(p));o&&(h={x:f.x+Math.sign(d)*y*n._originRatio,y:f.y+Math.sign(p)*y},l.setPos(h));var v=n.getNeighborAnchors(t);v.neighborX.setPos({x:h.x}),v.neighborY.setPos({y:h.y});var g=n.getLeftTopPos();n._cbMap.call("dragmove",{x:g.x,y:g.y,width:Math.abs(o?y*n._originRatio:d),height:Math.abs(o?y:p)})},this._anchors={leftTop:new it(ct({},t.calcAnchorPosition(Q.leftTop,e),{type:Q.leftTop})),rightTop:new it(ct({},t.calcAnchorPosition(Q.rightTop,e),{type:Q.rightTop})),rightBottom:new it(ct({},t.calcAnchorPosition(Q.rightBottom,e),{type:Q.rightBottom})),leftBottom:new it(ct({},t.calcAnchorPosition(Q.leftBottom,e),{type:Q.leftBottom}))},this._anchors.leftTop.on("dragmove",this.onMoveAnchor),this._anchors.rightTop.on("dragmove",this.onMoveAnchor),this._anchors.rightBottom.on("dragmove",this.onMoveAnchor),this._anchors.leftBottom.on("dragmove",this.onMoveAnchor)}var e,n,r;return e=t,r=[{key:"calcAnchorPosition",value:function(t,e){switch(t){case Q.left:return{x:e.x,y:e.y+e.height/2};case Q.top:return{x:e.x+e.width/2,y:e.y};case Q.right:return{x:e.x+e.width,y:e.y+e.height/2};case Q.bottom:return{x:e.x+e.width/2,y:e.y+e.height};case Q.leftTop:return{x:e.x,y:e.y};case Q.rightTop:return{x:e.x+e.width,y:e.y};case Q.rightBottom:return{x:e.x+e.width,y:e.y+e.height};case Q.leftBottom:return{x:e.x,y:e.y+e.height};default:throw new Error("Position can't be calculated for given type: ".concat(t))}}}],(n=[{key:"getCurrentAnchor",value:function(t){switch(t){case Q.leftTop:return this._anchors.leftTop;case Q.leftBottom:return this._anchors.leftBottom;case Q.rightTop:return this._anchors.rightTop;case Q.rightBottom:return this._anchors.rightBottom;default:throw new Error("Can't find anchor for provided type. Given ".concat(t))}}},{key:"getOppositeAnchor",value:function(t){switch(t){case Q.leftTop:return this._anchors.rightBottom;case Q.leftBottom:return this._anchors.rightTop;case Q.rightTop:return this._anchors.leftBottom;case Q.rightBottom:return this._anchors.leftTop;default:throw new Error("Can't find anchor for provided type. Given ".concat(t))}}},{key:"getNeighborAnchors",value:function(t){switch(t){case Q.leftTop:return{neighborX:this._anchors.leftBottom,neighborY:this._anchors.rightTop};case Q.leftBottom:return{neighborX:this._anchors.leftTop,neighborY:this._anchors.rightBottom};case Q.rightTop:return{neighborX:this._anchors.rightBottom,neighborY:this._anchors.leftTop};case Q.rightBottom:return{neighborX:this._anchors.rightTop,neighborY:this._anchors.leftBottom};default:throw new Error("Width and height can't be calculated for the given type: ".concat(t))}}},{key:"getLeftTopPos",value:function(){var t=this;return Object.keys(this._anchors).reduce((function(e,n){var r=t._anchors[n].getPos();return r.x<e.x||r.y<e.y?r:e}),{x:1/0,y:1/0})}},{key:"setOriginRatio",value:function(t){this._originRatio=t}},{key:"on",value:function(t,e){this._cbMap.set(t,e)}},{key:"updatePosition",value:function(e){this._anchors.leftTop.setPos(t.calcAnchorPosition(Q.leftTop,e)),this._anchors.rightTop.setPos(t.calcAnchorPosition(Q.rightTop,e)),this._anchors.rightBottom.setPos(t.calcAnchorPosition(Q.rightBottom,e)),this._anchors.leftBottom.setPos(t.calcAnchorPosition(Q.leftBottom,e))}},{key:"show",value:function(){this._anchors.leftTop.show(),this._anchors.rightTop.show(),this._anchors.rightBottom.show(),this._anchors.leftBottom.show()}},{key:"hide",value:function(){this._anchors.leftTop.hide(),this._anchors.rightTop.hide(),this._anchors.rightBottom.hide(),this._anchors.leftBottom.hide()}},{key:"addToLayer",value:function(t){this._anchors.leftTop.addToLayer(t),this._anchors.rightTop.addToLayer(t),this._anchors.rightBottom.addToLayer(t),this._anchors.leftBottom.addToLayer(t)}},{key:"destroy",value:function(){this._anchors.leftTop.destroy(),this._anchors.rightTop.destroy(),this._anchors.rightBottom.destroy(),this._anchors.leftBottom.destroy()}}])&&at(e.prototype,n),r&&at(e,r),t}();function lt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ht=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._cbMap=new $,this.onDragMove=function(t){var e="_dragmoveanchor";if(n._cbMap.call(e,t),!n._cbMap.has(e))throw new Error('"'.concat(e,'" should be defined'))},this._anchors=new ut(e),this._anchors.on("dragmove",this.onDragMove)}var e,n,r;return e=t,n=[{key:"setOriginRatio",value:function(t){this._anchors.setOriginRatio(t)}},{key:"on",value:function(t,e){this._cbMap.set(t,e)}},{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._anchors.updatePosition(t),e&&le.dispatch(S(I.ANCHORS_LAYER))}},{key:"addToLayer",value:function(t){this._anchors.addToLayer(t)}},{key:"show",value:function(){this._anchors.show()}},{key:"hide",value:function(){this._anchors.hide()}},{key:"destroy",value:function(){this._anchors.destroy()}}],n&&lt(e.prototype,n),r&&lt(e,r),t}(),ft=ht;function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function pt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function yt(t,e,n){return yt="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=vt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},yt(t,e,n||t)}function vt(t){return vt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},vt(t)}function gt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){pt(t,e,n[e])}))}return t}function bt(t,e){return!e||"object"!==mt(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function wt(t,e){return wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},wt(t,e)}var mt=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function _t(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=vt(t);if(e){var o=vt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return bt(this,n)}}var xt=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&wt(t,e)}(i,t);var e,n,r,o=_t(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this)).type=F.Z.RECT,e.onDragMove=function(t){var n;e.cbMap.call("dragmove",t),null===(n=e.sizeTransform)||void 0===n||n.update(e.getSizePos())},e.getSizePos=function(){var t=e.getAttrs();return{x:t.x,y:t.y,width:t.width,height:t.height}},e.onDragMoveAnchor=function(t){e.setShapeAttrs(t)},e._props=gt({},t),e}return e=i,(n=[{key:"defineShape",value:function(){this.shape=new H.Z.Rect({x:this._props.x||0,y:this._props.y||0,width:this._props.width||0,height:this._props.height||0,dash:this._props.dash,stroke:this._props.stroke,strokeWidth:this._props.strokeWidth,fill:this._props.fill,draggable:!0})}},{key:"addToLayer",value:function(t,e){this.defineShape(),this.shape.on("dragmove",this.onDragMove),yt(vt(i.prototype),"attachBasicEvents",this).call(this,this.shape),this.sizeTransform=new ft(this.getSizePos()),this.sizeTransform.on("_dragmoveanchor",this.onDragMoveAnchor),t.add(this.shape),this.sizeTransform.addToLayer(e),yt(vt(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"blur",value:function(){var t;yt(vt(i.prototype),"blur",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.hide()}},{key:"focus",value:function(){var t;yt(vt(i.prototype),"focus",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.show()}},{key:"getFillColor",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("fill")}},{key:"setFillColor",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttr("fill",t)}},{key:"getStrokeColor",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("stroke")}},{key:"getAttrs",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttrs()}},{key:"hide",value:function(){var t;null===(t=this.shape)||void 0===t||t.setAttrs({stroke:"transparent"})}},{key:"setShapeAttrs",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttrs(t),le.dispatch(S(I.SHAPES_LAYER))}},{key:"setAttrs",value:function(t){var e;this.setShapeAttrs(t),null===(e=this.sizeTransform)||void 0===e||e.update(this.getSizePos())}},{key:"setStrokeColor",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttr("stroke",t)}},{key:"setStrokeWidth",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttrs({strokeWidth:t})}},{key:"getStrokeWidth",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("strokeWidth")}},{key:"getSelfRect",value:function(){if(!this.shape)throw new Error("Shape is not defined");var t=this.shape.getAbsolutePosition(),e=this.shape.getSelfRect();return{x:e.x+t.x+(e.width<0?e.width:0),y:e.y+t.y+(e.height<0?e.height:0),width:Math.abs(e.width),height:Math.abs(e.height)}}},{key:"draggable",value:function(t){var e,n;if(void 0===t)return null===(n=this.shape)||void 0===n?void 0:n.draggable();null===(e=this.shape)||void 0===e||e.draggable(t)}},{key:"scale",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y,a=r.width,s=r.height;null===(e=this.shape)||void 0===e||e.setAttrs({x:o*t.wFactor,y:i*t.hFactor,width:a*t.wFactor,height:s*t.hFactor}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"getCloningProps",value:function(){var t,e=null===(t=this.shape)||void 0===t?void 0:t.getAttrs();return gt({},this._props,e&&{x:e.x,y:e.y,width:e.width,height:e.height,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill})}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=this.shape)||void 0===n?void 0:n.zIndex();null===(e=this.shape)||void 0===e||e.zIndex(t)}},{key:"crop",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y;null===(e=this.shape)||void 0===e||e.setAttrs({x:o-t.x,y:i-t.y}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"clone",value:function(){return new i(this.getCloningProps())}},{key:"initDraw",value:function(t,e){this.type===F.Z.RECT&&this.blur(),this.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y})}},{key:"destroy",value:function(){var t,e;yt(vt(i.prototype),"destroy",this).call(this),null===(t=this.shape)||void 0===t||t.destroy(),null===(e=this.sizeTransform)||void 0===e||e.destroy()}}])&&dt(e.prototype,n),r&&dt(e,r),i}(tt),kt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nonzero";t.beginPath();var r=!0,o=!1,i=void 0;try{for(var a,s=e.ops[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value,u=c.data;switch(c.op){case"move":t.moveTo(u[0],u[1]);break;case"bcurveTo":t.bezierCurveTo(u[0],u[1],u[2],u[3],u[4],u[5]);break;case"lineTo":t.lineTo(u[0],u[1])}}}catch(l){o=!0,i=l}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}"fillPath"===e.type?t.fill(n):t.stroke()},St=function(t,e,n){var r=n.fillWeight;r<0&&(r=n.strokeWidth/2),t.save(),n.fillLineDash&&t.setLineDash(n.fillLineDash),n.fillLineDashOffset&&(t.lineDashOffset=n.fillLineDashOffset),t.strokeStyle=n.fill||"",t.lineWidth=r,kt(t,e),t.restore()},Pt=function(t,e){var n=e.sets||[],r=e.options,o=!0,i=!1,a=void 0;try{for(var s,c=n[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;switch(u.type){case"path":t.save(),t.strokeStyle="none"===r.stroke?"transparent":r.stroke,t.lineWidth=r.strokeWidth,r.strokeLineDash&&t.setLineDash(r.strokeLineDash),r.strokeLineDashOffset&&(t.lineDashOffset=r.strokeLineDashOffset),kt(t,u),t.restore();break;case"fillPath":t.save(),t.fillStyle=r.fill||"";var l="curve"===e.shape||"polygon"===e.shape?"evenodd":"nonzero";kt(t,u,l),t.restore();break;case"fillSketch":St(t,u,r)}}}catch(h){i=!0,a=h}finally{try{o||null==c.return||c.return()}finally{if(i)throw a}}};function At(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ot(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Et(t,e,n){return Et="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Rt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},Et(t,e,n||t)}function Rt(t){return Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Rt(t)}function Tt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Ot(t,e,n[e])}))}return t}function jt(t,e){return!e||"object"!==Lt(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ct(t,e){return Ct=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ct(t,e)}var Lt=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Dt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Rt(t);if(e){var o=Rt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return jt(this,n)}}var Mt=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ct(t,e)}(i,t);var e,n,r,o=Dt(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).type=F.Z.RECT_ROUGH,e._isDragging=!1,e.prevWidth=0,e.prevHeight=0,e.onDragMoveSubRect=function(t){var n,r;e.cbMap.call("dragmove",t);var o=e.getSizePosSubRect();null===(n=e.sizeTransform)||void 0===n||n.update(o),null===(r=e.shape)||void 0===r||r.setAttrs(o)},e.onDragMoveAnchor=function(t){var n;null===(n=e.substrateKonvaShape)||void 0===n||n.setAttrs(t),e.setShapeAttrs(t)},e.getSizePosSubRect=function(){var t,n=null===(t=e.substrateKonvaShape)||void 0===t?void 0:t.getAttrs();return{x:n.x,y:n.y,width:n.width,height:n.height}},e.props=Tt({},t);var n=Rr();return e._roughCanvas=K().canvas(n),e}return e=i,(n=[{key:"defineShape",value:function(){var t=this;this.shape=new H.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:function(e,n){var r=n.width(),o=n.height(),i=n.stroke(),a=n.strokeWidth();r===t.prevWidth&&o===t.prevHeight&&t._lastDrawable?(t._lastDrawable.options.stroke=i,t._lastDrawable.options.strokeWidth=a,t._lastDrawable.options.fill=t.props.fill):(t.prevWidth=r,t.prevHeight=o,t._lastDrawable=t._roughCanvas.generator.rectangle(0,0,r,o,{roughness:2.5,stroke:i,strokeWidth:a,fill:t.props.fill,fillWeight:3,hachureGap:5})),Pt(e._context,t._lastDrawable),e.fillStrokeShape(n)}}),this.substrateKonvaShape=new H.Z.Rect({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:"transparent",fill:"transparent",draggable:!0}),this.shape.on("dragstart",(function(){t._isDragging=!0})),this.shape.on("dragend",(function(){t._isDragging=!1})),this.substrateKonvaShape.on("dragstart",(function(){t._isDragging=!0})),this.substrateKonvaShape.on("dragend",(function(){t._isDragging=!1})),this.substrateKonvaShape.on("click",(function(e){t.onClick(e)})),this.substrateKonvaShape.on("dragstart",(function(){t.onDragStart()})),this.substrateKonvaShape.on("mouseover",(function(){t.cbMap.call("mouseover")})),this.substrateKonvaShape.on("mouseout",(function(){t.cbMap.call("mouseout")}))}},{key:"setFillColor",value:function(t){this.props.fill=t}},{key:"getFillColor",value:function(){return this.props.fill}},{key:"setStrokeWidth",value:function(t){Et(Rt(i.prototype),"setStrokeWidth",this).call(this,t/2)}},{key:"getStrokeWidth",value:function(){return 2*Et(Rt(i.prototype),"getStrokeWidth",this).call(this)}},{key:"addToLayer",value:function(t,e){if(Et(Rt(i.prototype),"addToLayer",this).call(this,t,e),!this.substrateKonvaShape)throw new Error("`this.substrateKonvaShape` is not defined");this.substrateKonvaShape.on("dragmove",this.onDragMoveSubRect),t.add(this.substrateKonvaShape)}},{key:"draggable",value:function(t){var e,n=Et(Rt(i.prototype),"draggable",this).call(this,t);return null===(e=this.substrateKonvaShape)||void 0===e||e.setAttr("draggable",t),n}},{key:"initDraw",value:function(t,e){var n;null===(n=this.substrateKonvaShape)||void 0===n||n.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y}),Et(Rt(i.prototype),"initDraw",this).call(this,t,e)}},{key:"destroy",value:function(){var t;Et(Rt(i.prototype),"destroy",this).call(this),null===(t=this.substrateKonvaShape)||void 0===t||t.destroy()}},{key:"scale",value:function(t){var e;Et(Rt(i.prototype),"scale",this).call(this,t);var n=this.getAttrs(),r=n.x,o=n.y,a=n.width,s=n.height;null===(e=this.substrateKonvaShape)||void 0===e||e.setAttrs({x:r,y:o,width:a,height:s})}},{key:"crop",value:function(t){var e;Et(Rt(i.prototype),"crop",this).call(this,t);var n=this.getAttrs(),r=n.x,o=n.y;null===(e=this.substrateKonvaShape)||void 0===e||e.setAttrs({x:r,y:o})}},{key:"clone",value:function(){var t=this.getStrokeWidth();return new i(Tt({},this.getCloningProps(),Number.isNaN(t)?{}:{strokeWidth:t},{fill:this.props.fill}))}}])&&At(e.prototype,n),r&&At(e,r),i}(xt);function Zt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function It(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Nt(t,e,n){return Nt="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ht(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},Nt(t,e,n||t)}function Ht(t){return Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ht(t)}function Wt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){It(t,e,n[e])}))}return t}function Bt(t,e){return!e||"object"!==Gt(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function zt(t,e){return zt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},zt(t,e)}var Gt=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Ut(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ht(t);if(e){var o=Ht(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Bt(this,n)}}var Ft=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&zt(t,e)}(i,t);var e,n,r,o=Ut(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).type=F.Z.ELLIPSE_ROUGH,e._isDragging=!1,e.prevWidth=0,e.prevHeight=0,e.props=Wt({},t);var n=Rr();return e._roughCanvas=K().canvas(n),e}return e=i,(n=[{key:"defineShape",value:function(){var t=this;this.shape=new H.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:function(e,n){var r=n.width(),o=n.height(),i=n.stroke(),a=n.strokeWidth();r===t.prevWidth&&o===t.prevHeight&&t._lastDrawable?(t._lastDrawable.options.stroke=i,t._lastDrawable.options.fill=t.props.fill,t._lastDrawable.options.strokeWidth=a):(t.prevWidth=r,t.prevHeight=o,t._lastDrawable=t._roughCanvas.generator.ellipse(r/2,o/2,r,o,{roughness:2.5,stroke:i,strokeWidth:a,fill:t.props.fill,fillWeight:3})),Pt(e._context,t._lastDrawable),e.fillStrokeShape(n)}}),this.shape.on("dragstart",(function(){t._isDragging=!0})),this.shape.on("dragend",(function(){t._isDragging=!1}))}},{key:"setFillColor",value:function(t){this.props.fill=t}},{key:"getFillColor",value:function(){return this.props.fill}},{key:"setStrokeWidth",value:function(t){Nt(Ht(i.prototype),"setStrokeWidth",this).call(this,t/2)}},{key:"getStrokeWidth",value:function(){return 2*Nt(Ht(i.prototype),"getStrokeWidth",this).call(this)}},{key:"scale",value:function(t){Nt(Ht(i.prototype),"scale",this).call(this,t)}},{key:"clone",value:function(){var t=this.getStrokeWidth();return new i(Wt({},this.getCloningProps(),Number.isNaN(t)?{}:{strokeWidth:t},{fill:this.props.fill}))}}])&&Zt(e.prototype,n),r&&Zt(e,r),i}(xt),Yt=n(3710);function Kt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Xt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function qt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Xt(t,e,n[e])}))}return t}function Vt(t){return function(t){if(Array.isArray(t))return Kt(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return Kt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Kt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var $t,Jt=function(){var t=new H.Z.Layer;return t.imageSmoothingEnabled(!0),t},Qt={cursor:Z.AUTO,shapesLayer:Jt(),anchorsLayer:Jt(),list:[],addingShapeRef:null},te=(0,E.Z)((Xt($t={},"".concat(l),(function(t,e){return e.payload.addToLayer(t.shapesLayer,t.anchorsLayer),c().get(e.payload,"type")===F.Z.IMAGE&&G({addedShape:e.payload}),t.shapesLayer.draw(),t.anchorsLayer.draw(),qt({},t,{list:Vt(t.list).concat([e.payload])})})),Xt($t,"".concat(x),(function(t,e){var n;t.addingShapeRef&&(null===(n=e.payload)||void 0===n?void 0:n.type)&&t.addingShapeRef.type!==e.payload.type&&t.addingShapeRef.destroy();var r=c().get(e.payload,"type",null),o=c().get(e.payload,"options",null),i=null;switch(r){case F.Z.ARROW:i=Wn(void 0,o);break;case F.Z.TEXT:i=zn(void 0,o);break;case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:case F.Z.SELECT_RECT:i=Un(void 0,o,r);break;case null:i=null;break;default:console.error("Can't set adding shape for the selected shape type: ".concat(r))}return qt({},t,{addingShapeRef:i})})),Xt($t,"".concat(k),(function(t,e){var n=e.payload;return G({addedShape:n}),t})),Xt($t,"".concat(g),(function(t){return t.list.forEach((function(t){return t.destroy()})),t.shapesLayer.draw(),t.anchorsLayer.draw(),U({}),qt({},t,{list:[]})})),Xt($t,"".concat(b),(function(t,e){var n=t.list.find((function(t){return t===e.payload}));n&&n.destroy(),z();var r=t.list.filter((function(t){return t!==e.payload}));return U({deletedShape:n}),qt({},t,{list:r})})),Xt($t,"".concat(w),(function(t,e){return t.list.forEach((function(t){t!==e.payload&&t.blur()})),t.anchorsLayer.draw(),t.shapesLayer.draw(),z(),t})),Xt($t,"".concat(_),(function(t,e){return t.list.forEach((function(t){t.crop(e.payload)})),t.shapesLayer.draw(),t.anchorsLayer.draw(),t})),Xt($t,"".concat(v),(function(t){var e=t.list.find((function(t){return t.isSelected()}));e&&e.destroy(),t.shapesLayer.draw(),t.anchorsLayer.draw(),z();var n=t.list.filter((function(t){return t!==e}));return U({deletedShape:e}),qt({},t,{list:n})})),Xt($t,"".concat(P),(function(t,e){var n=e.payload,r=t.list.find((function(t){return t.isSelected()}));return null===r||void 0===r||r.zIndex(n===Yt.Q.BringToFront?2*t.list.length:0),t})),Xt($t,"".concat(h),(function(t,e){return qt({},t,{cursor:e.payload})})),Xt($t,"".concat(f),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:n.setFillColor(e.payload);break;default:console.error("Can't set stroke color for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t})),Xt($t,"".concat(d),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case F.Z.ARROW:case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:n.setStrokeColor(e.payload);break;case F.Z.TEXT:n.setFillColor(e.payload);break;default:console.error("Can't set stroke color for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t})),Xt($t,"".concat(p),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case F.Z.ARROW:case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:n.setStrokeWidth(e.payload);break;default:console.error("Can't set stroke width for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t})),Xt($t,"".concat(y),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));if((null===n||void 0===n?void 0:n.type)===F.Z.TEXT)n.setFontSize(e.payload);else console.error("Can't set font size for the selected shape"),console.log(n);return t.shapesLayer.draw(),t.anchorsLayer.draw(),t})),Xt($t,"".concat(m),(function(t,e){return e.payload&&t.list.forEach((function(t){return t.scale(e.payload)})),t.shapesLayer.draw(),t})),Xt($t,"".concat(S),(function(t,e){switch(e.payload){case I.SHAPES_LAYER:t.shapesLayer.draw();break;case I.ANCHORS_LAYER:t.anchorsLayer.draw();break;default:t.shapesLayer.draw(),t.anchorsLayer.draw()}return t})),Xt($t,"".concat(A),(function(t){var e=t.list.find((function(t){return t.isSelected()}));switch(null===e||void 0===e?void 0:e.type){case F.Z.RECT:case F.Z.ELLIPSE:var n=e.getCloningProps(),r=(null===e||void 0===e?void 0:e.type)===F.Z.RECT?Mt:Ft,o=Un(new r(n));o.addToLayer(t.shapesLayer,t.anchorsLayer);var i=t.list.map((function(t){return t===e?(t.destroy(),o):t}));return t.shapesLayer.draw(),t.anchorsLayer.draw(),G({addedShape:o}),qt({},t,{list:i});default:console.error("Can't sketchify the selected shape"),console.log(e)}return t})),$t),Qt),ee=(0,u.Z)("SET_SAVE_STAGE"),ne=(0,u.Z)("SAVE_STAGE"),re=(0,u.Z)("COPY_STAGE");function oe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ie,ae=(0,E.Z)((oe(ie={},"".concat(ee),(function(t,e){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){oe(t,e,n[e])}))}return t}({},t,{instance:e.payload})})),oe(ie,"".concat(ne),(function(t,e){var n=e.payload;if(!t.instance)throw new Error("SaveStage is not defined");return t.instance.saveFromLayer(n.layer,n.name,n.contentRect),t})),oe(ie,"".concat(re),(function(t,e){var n=e.payload;if(!t.instance)throw new Error("SaveStage is not defined");return t.instance.copyFromLayer(n.layer,n.contentRect),t})),ie),{instance:null}),se=(0,O.UY)({stage:N,shapes:te,saveCanvas:ae});function ce(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ue,le=(0,O.MT)(se,O.md.apply(void 0,function(t){if(Array.isArray(t))return ce(t)}(ue=[])||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(ue)||function(t,e){if(t){if("string"===typeof t)return ce(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(t,e):void 0}}(ue)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()));function he(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function de(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function pe(t,e,n){return pe="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ye(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},pe(t,e,n||t)}function ye(t){return ye=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ye(t)}function ve(t,e){return null!=e&&"undefined"!==typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function ge(t,e){return!e||"object"!==we(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function be(t,e){return be=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},be(t,e)}var we=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function me(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ye(t);if(e){var o=ye(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ge(this,n)}}var _e=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&be(t,e)}(i,t);var e,n,r,o=me(i);function i(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return he(this,i),(e=o.call(this)).type=F.Z.IMAGE,e.onDragMove=function(){var t;null===(t=e._sizeTransform)||void 0===t||t.update(e.getSizePos())},e.onDragMoveAnchor=function(t){var n;null===(n=e._image)||void 0===n||n.setAttrs(t)},e.getSizePos=function(){return{x:e._image.x(),y:e._image.y(),width:e._image.width(),height:e._image.height()}},e._props=n,ve(t,H.Z.Image)?e._image=t:e._image=new H.Z.Image({image:t,draggable:!0,x:n.x,y:n.y,width:n.width,height:n.height}),e}return e=i,n=[{key:"addToLayer",value:function(t,e){var n;pe(ye(i.prototype),"addToLayer",this).call(this,t,e),this._image.on("dragmove",this.onDragMove),this._sizeTransform=new ft(this.getSizePos()),null===(n=this._sizeTransform)||void 0===n||n.setOriginRatio(this._image.width()/this._image.height()),this._sizeTransform.on("_dragmoveanchor",this.onDragMoveAnchor),pe(ye(i.prototype),"attachBasicEvents",this).call(this,this._image),t.add(this._image),this._sizeTransform.addToLayer(e)}},{key:"destroy",value:function(){var t;pe(ye(i.prototype),"destroy",this).call(this),this._image.destroy(),null===(t=this._sizeTransform)||void 0===t||t.destroy()}},{key:"getSelfRect",value:function(){var t=this._image.getAbsolutePosition(),e=this._image.getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}},{key:"blur",value:function(){var t;pe(ye(i.prototype),"blur",this).call(this),null===(t=this._sizeTransform)||void 0===t||t.hide()}},{key:"focus",value:function(){var t;pe(ye(i.prototype),"focus",this).call(this),null===(t=this._sizeTransform)||void 0===t||t.show()}},{key:"draggable",value:function(t){var e,n;return null===(e=this._image)||void 0===e||e.setAttr("draggable",t),null===(n=this._image)||void 0===n?void 0:n.getAttr("draggable")}},{key:"zIndex",value:function(t){if(void 0===t)return this._image.zIndex();this._image.zIndex(t)}},{key:"clone",value:function(){return new i(this._image.clone(),function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){de(t,e,n[e])}))}return t}({},this.getSizePos()))}},{key:"initDraw",value:function(t,e){}},{key:"scale",value:function(t){}}],n&&fe(e.prototype,n),r&&fe(e,r),i}(tt),xe=_e;function ke(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Se(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ae(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Pe(t,e,n[e])}))}return t}function Oe(t){return function(t){if(Array.isArray(t))return ke(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return ke(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ke(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ee,Re={radius:5,stroke:"#855824",fill:"#dddd45",strokeWidth:1},Te={radius:6,stroke:"#666",fill:"#ddd",strokeWidth:1};!function(t){t.START="start",t.CONTROL="control",t.END="end"}(Ee||(Ee={}));var je=function(){function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._cbMap=new $,this.on=function(t,e){o._cbMap.set(t,e)};var i=Ae({},{x:e,y:n,draggable:!0,visible:!1},Te);r===Ee.CONTROL&&(i=Ae({},i,Re)),this._anchor=new H.Z.Circle(i),this._originalPosition={x:e,y:n},this._delta={x:0,y:0},this._appliedDelta={x:0,y:0},this.initEvents()}var e,n,r;return e=t,n=[{key:"initEvents",value:function(){var t=this;this._anchor.on("mouseover",this._cbMap.get("mouseover")),this._anchor.on("mouseout",this._cbMap.get("mouseout")),this._anchor.on("mousedown",this._cbMap.get("mousedown")),this._anchor.on("mouseup",this._cbMap.get("mouseup")),this._anchor.on("dragend",(function(){t._cbMap.call("dragend");var e=t.getPosition();t._originalPosition.x=e.x,t._originalPosition.y=e.y,t._appliedDelta.x=t._delta.x,t._appliedDelta.y=t._delta.y})),this._anchor.on("dragmove",c().throttle((function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var o;(o=t._cbMap).call.apply(o,["dragmove"].concat(Oe(n)))}),50))}},{key:"getAnchor",value:function(){return this._anchor}},{key:"setPosition",value:function(t,e){this._anchor.setAttr("x",t),this._anchor.setAttr("y",e),this._originalPosition.x=t,this._originalPosition.y=e,this._appliedDelta.x=this._delta.x,this._appliedDelta.y=this._delta.y}},{key:"getPosition",value:function(){var t=this._anchor.getAttrs();return{x:t.x,y:t.y}}},{key:"draw",value:function(){this._anchor.draw()}},{key:"setDelta",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._anchor.setAttr("x",this._originalPosition.x+(t-this._appliedDelta.x)),this._anchor.setAttr("y",this._originalPosition.y+(e-this._appliedDelta.y)),this._delta.x=t,this._delta.y=e}},{key:"setAttr",value:function(t,e){this._anchor.setAttr(t,e)}},{key:"visible",value:function(t){this._anchor.visible(t)}},{key:"destroy",value:function(){this._anchor.destroy()}}],n&&Se(e.prototype,n),r&&Se(e,r),t}(),Ce=je,Le=function(t,e){var n=0-Math.abs(e.x),r=t.x-e.x,o=t.y-e.y,i=n*r+0*o,a=Math.sqrt(Math.pow(n,2)+Math.pow(0,2))*Math.sqrt(Math.pow(r,2)+Math.pow(o,2));if(0===a)return 0;var s=Math.acos(i/a);return t.y>e.y?2*Math.PI-s:s},De=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))};function Me(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ze=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._cbMap=new $,this.moveStart=function(){if(!n._anchors)throw new Error("`this.anchors` is not defined");var t=n._anchors.start.getPosition(),e=n._anchors.end.getPosition(),r=Le(t,e),o=r-n._prevAnchorsPosition.angles.start,i=n.calculateMovedControlPos(n.calculateRotatedControlPos(o,e),"end");n._anchors.control.setPosition(i.x,i.y),n.moveControl(),n._prevAnchorsPosition.start=t,n._prevAnchorsPosition.control=i,n._prevAnchorsPosition.end=e,n._prevAnchorsPosition.angles.start=r,n._prevAnchorsPosition.angles.end=Math.PI+r},this.moveControl=function(){n._cbMap.call("dragmove")},this.moveEnd=function(){if(!n._anchors)throw new Error("`this.anchors` is not defined");var t=n._anchors.start.getPosition(),e=n._anchors.end.getPosition(),r=Le(e,t),o=r-n._prevAnchorsPosition.angles.end,i=n.calculateMovedControlPos(n.calculateRotatedControlPos(o,t),"start");n._anchors.control.setPosition(i.x,i.y),n.moveControl(),n._prevAnchorsPosition.start=t,n._prevAnchorsPosition.control=i,n._prevAnchorsPosition.end=e,n._prevAnchorsPosition.angles.start=Math.PI+r,n._prevAnchorsPosition.angles.end=r},this.onDragEnd=function(){n._cbMap.call("dragend")},this.visible=function(t){var e,r,o;null===(e=n._anchors)||void 0===e||e.start.visible(t),null===(r=n._anchors)||void 0===r||r.control.visible(t),null===(o=n._anchors)||void 0===o||o.end.visible(t)},this.on=function(t,e){n._cbMap.set(t,e)},this._anchorsPosition=e,this._prevAnchorsPosition={start:{x:0,y:0},control:{x:0,y:0},end:{x:0,y:0},angles:{start:c().get(e,"angles.start",0),control:c().get(e,"angles.control",0),end:c().get(e,"angles.end",Math.PI)}}}var e,n,r;return e=t,r=[{key:"defineAnchors",value:function(t,e,n){var r,o,i,a,s,c;return n?(r=n.start.x,o=n.start.y,i=n.control.x,a=n.control.y,s=n.end.x,c=n.end.y):(r=t.width/4,o=t.height/2,i=t.width/2,a=o,s=3*r,c=o,Math.abs(s-r)>e&&(r=i-e/2,s=i+e/2)),{start:new Ce(r,o,Ee.START),control:new Ce(i,a,Ee.CONTROL),end:new Ce(s,c,Ee.END)}}}],(n=[{key:"calculateRotatedControlPos",value:function(t,e){if(!this._anchors)throw new Error("`this.anchors` is not defined");var n=this._anchors.control.getPosition(),r=n.x-e.x,o=n.y-e.y,i=Math.cos(t),a=Math.sin(t),s=o*i+r*a;return{x:r*i-o*a+e.x,y:s+e.y}}},{key:"calculateMovedControlPos",value:function(t,e){if(!this._anchors)throw new Error("`this.anchors` is not defined");var n=De(this._prevAnchorsPosition.start,this._prevAnchorsPosition.end),r=this._anchors.start.getPosition(),o=this._anchors.end.getPosition(),i=De(r,o)/n,a="start"===e?r:o,s=De(t,a),c=(a.x-t.x)/s,u=(a.y-t.y)/s,l=s-s*i;return{x:t.x+l*c,y:t.y+l*u}}},{key:"draw",value:function(){var t,e,n;null===(t=this._anchors)||void 0===t||t.start.draw(),null===(e=this._anchors)||void 0===e||e.control.draw(),null===(n=this._anchors)||void 0===n||n.end.draw(),le.dispatch(S(I.ANCHORS_LAYER))}},{key:"setAnchors",value:function(e,n){this._anchors=t.defineAnchors(e,n,this._anchorsPosition),this._prevAnchorsPosition.start=this._anchors.start.getPosition(),this._prevAnchorsPosition.control=this._anchors.control.getPosition(),this._prevAnchorsPosition.end=this._anchors.end.getPosition(),this._anchors.start.on("dragmove",this.moveStart),this._anchors.control.on("dragmove",this.moveControl),this._anchors.end.on("dragmove",this.moveEnd),this._anchors.start.on("dragend",this.onDragEnd),this._anchors.control.on("dragend",this.onDragEnd),this._anchors.end.on("dragend",this.onDragEnd)}},{key:"addToLayer",value:function(t){if(!this._anchors)throw new Error("`this.anchors` is not defined");t.add(this._anchors.start.getAnchor()),t.add(this._anchors.control.getAnchor()),t.add(this._anchors.end.getAnchor())}},{key:"getPositions",value:function(){var t;return!this._anchors&&this._anchorsPosition?this._anchorsPosition:{start:this._anchors.start.getPosition(),control:this._anchors.control.getPosition(),end:this._anchors.end.getPosition(),angles:null===(t=this._prevAnchorsPosition)||void 0===t?void 0:t.angles}}},{key:"setAnchorsCoordinates",value:function(t){var e,n,r;this._prevAnchorsPosition.start=t.start,this._prevAnchorsPosition.control=t.control,this._prevAnchorsPosition.end=t.end,null===(e=this._anchors)||void 0===e||e.start.setPosition(t.start.x,t.start.y),null===(n=this._anchors)||void 0===n||n.control.setPosition(t.control.x,t.control.y),null===(r=this._anchors)||void 0===r||r.end.setPosition(t.end.x,t.end.y);var o=Le(t.start,t.end);this._prevAnchorsPosition.angles.start=o,this._prevAnchorsPosition.angles.end=Math.PI+o}},{key:"setDelta",value:function(t,e){var n,r,o;null===(n=this._anchors)||void 0===n||n.start.setDelta(t,e),null===(r=this._anchors)||void 0===r||r.control.setDelta(t,e),null===(o=this._anchors)||void 0===o||o.end.setDelta(t,e)}},{key:"destroy",value:function(){var t,e,n,r,o,i;null===(t=this._anchors)||void 0===t||null===(e=t.start)||void 0===e||e.destroy(),null===(n=this._anchors)||void 0===n||null===(r=n.control)||void 0===r||r.destroy(),null===(o=this._anchors)||void 0===o||null===(i=o.end)||void 0===i||i.destroy()}}])&&Me(e.prototype,n),r&&Me(e,r),t}();function Ie(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ne=function(t){return t*(Math.PI/180)},He=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._cbMap=new $,this.on=function(t,e){n._cbMap.set(t,e)},this._arrowHead=new H.Z.Line({lineCap:"round",lineJoin:"round",stroke:e.stroke,strokeWidth:e.strokeWidth,points:t.calculateHeadPoints(e.start,e.control,e.strokeWidth)}),this._arrowHead.on("click",(function(t){n._cbMap.call("click",t)})),this._arrowHead.on("mouseover",(function(t){n._cbMap.call("mouseover",t)})),this._arrowHead.on("mouseout",(function(t){n._cbMap.call("mouseout",t)})),this._delta={x:0,y:0},this._appliedDelta={x:0,y:0}}var e,n,r;return e=t,n=[{key:"update",value:function(e,n,r){this._arrowHead.points(t.calculateHeadPoints(e,n,r)),this._arrowHead.setAttrs({x:0,y:0,strokeWidth:r}),this._arrowHead.draw(),this._appliedDelta.x=this._delta.x,this._appliedDelta.y=this._delta.y}},{key:"draw",value:function(){this._arrowHead.draw()}},{key:"zIndex",value:function(t){var e;null===(e=this._arrowHead)||void 0===e||e.zIndex(t)}},{key:"setDelta",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._arrowHead.setAttr("x",t-this._appliedDelta.x),this._arrowHead.setAttr("y",e-this._appliedDelta.y),this._delta.x=t,this._delta.y=e}},{key:"setAttr",value:function(t,e){this._arrowHead.setAttr(t,e)}},{key:"addToLayer",value:function(t){t.add(this._arrowHead)}},{key:"destroy",value:function(){this._arrowHead.destroy()}}],r=[{key:"calculateHeadPoints",value:function(t,e,n){var r,o={x:0,y:0},i={x:0,y:0},a=t.x-e.x,s=t.y-e.y;0===a?r=t.y<e.y?Ne(90):Ne(270):(r=Math.atan(s/a),a>0&&(r+=Ne(180)));var c=10*n,u=Ne(Math.min(40,c<20?20:c)),l=Math.min(14,4.5*n),h=u-r;o.x=t.x+l*Math.cos(h),o.y=t.y-l*Math.sin(h);var f=Ne(90)-(r+u);return i.x=t.x+l*Math.sin(f),i.y=t.y+l*Math.cos(f),[i.x,i.y,t.x,t.y,o.x,o.y]}}],n&&Ie(e.prototype,n),r&&Ie(e,r),t}(),We=He;function Be(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ze(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ge(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ue(t,e,n){return Ue="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Fe(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},Ue(t,e,n||t)}function Fe(t){return Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Fe(t)}function Ye(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Ge(t,e,n[e])}))}return t}function Ke(t,e){return!e||"object"!==qe(e)&&"function"!==typeof e?Be(t):e}function Xe(t,e){return Xe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Xe(t,e)}var qe=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Ve(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Fe(t);if(e){var o=Fe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ke(this,n)}}var $e,Je=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Xe(t,e)}(i,t);var e,n,r,o=Ve(i);function i(t){var e,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this)).type=F.Z.ARROW,n.redrawArrow=function(){var t,e,r,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=n.anchorsGroup.getPositions(),a=n.getPathString(i);null===(t=n.visiblePath)||void 0===t||t.data(a),null===(e=n.substratePath)||void 0===e||e.data(a),null===(r=n.arrowHead)||void 0===r||r.update(i.start,i.control,n.props.strokeWidth),o&&le.dispatch(S())},n.pathMove=function(){var t,e,r;if(!n.substratePath)throw new Error("`this.substratePath` is not defined");var o=n.substratePath.attrs.x,i=n.substratePath.attrs.y;n.anchorsGroup.setDelta(o,i),null===(t=n.visiblePath)||void 0===t||t.setAttrs({x:o,y:i}),null===(e=n.arrowHead)||void 0===e||e.setDelta(o,i),null===(r=n.arrowHead)||void 0===r||r.draw(),n.anchorsGroup.draw()},n.blur=function(){Ue((e=Be(n),Fe(i.prototype)),"blur",e).call(e),n.anchorsGroup.visible(!1)},n.onAnchor=function(t,e){n.anchorsGroup.on(t,e)},n.props=Ye({},t),n.anchorsGroup=new Ze(n.props.anchorsPosition),n}return e=i,(n=[{key:"initArrowDraw",value:function(t,e){this.substratePath=new H.Z.Path({data:t,stroke:"transparent",strokeWidth:12,draggable:!0}),this.visiblePath=new H.Z.Path({data:t,stroke:this.props.stroke||"red",strokeWidth:this.props.strokeWidth,lineCap:"round",lineJoin:"round"}),this.substratePath.on("dragmove",this.pathMove),this.attachBasicEvents(this.substratePath),e.add(this.visiblePath),e.add(this.substratePath)}},{key:"getPathString",value:function(t){var e=c().get(this.visiblePath,"attrs.x",0),n=c().get(this.visiblePath,"attrs.y",0);return"M".concat(t.start.x-e,",").concat(t.start.y-n," ")+"Q".concat(t.control.x-e,",").concat(t.control.y-n," ")+"".concat(t.end.x-e,",").concat(t.end.y-n)}},{key:"focus",value:function(){Ue(Fe(i.prototype),"focus",this).call(this),this.anchorsGroup.visible(!0)}},{key:"addToLayer",value:function(t,e){var n=this;if(!t.parent)throw new Error("Layer doesn't have a parent");this.anchorsGroup.setAnchors({width:t.parent.attrs.width,height:t.parent.attrs.height},300),this.anchorsGroup.on("dragmove",(function(){return n.redrawArrow(!0)})),this.anchorsGroup.on("dragend",(function(){return n.redrawArrow(!0)}));var r=this.anchorsGroup.getPositions();this.arrowHead=new We({start:r.start,control:r.control,stroke:this.props.stroke||"red",strokeWidth:this.props.strokeWidth}),this.arrowHead.on("click",this.onClick);var o=this.getPathString(r);this.initArrowDraw(o,t),this.arrowHead.addToLayer(t),this.anchorsGroup.addToLayer(e),this.redrawArrow(),Ue(Fe(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"setStrokeColor",value:function(t){var e,n,r,o;null===(e=this.visiblePath)||void 0===e||e.setAttr("stroke",t),null===(n=this.arrowHead)||void 0===n||n.setAttr("stroke",t),this.props.stroke=t,null===(r=this.visiblePath)||void 0===r||r.draw(),null===(o=this.arrowHead)||void 0===o||o.draw()}},{key:"getStrokeColor",value:function(){return this.props.stroke}},{key:"setStrokeWidth",value:function(t){var e;null===(e=this.visiblePath)||void 0===e||e.setAttr("strokeWidth",t),this.props.strokeWidth=t,this.redrawArrow()}},{key:"getSelfRect",value:function(){if(!this.visiblePath)throw new Error("Arrow is not defined");var t=this.visiblePath.getAbsolutePosition(),e=this.visiblePath.getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}},{key:"getStrokeWidth",value:function(){var t;return null===(t=this.visiblePath)||void 0===t?void 0:t.getAttr("strokeWidth")}},{key:"draggable",value:function(t){var e,n;return null===(e=this.substratePath)||void 0===e||e.setAttr("draggable",t),null===(n=this.substratePath)||void 0===n?void 0:n.getAttr("draggable")}},{key:"scale",value:function(t){var e=this.anchorsGroup.getPositions();this.anchorsGroup.setAnchorsCoordinates({start:{x:e.start.x*t.wFactor,y:e.start.y*t.hFactor},control:{x:e.control.x*t.wFactor,y:e.control.y*t.hFactor},end:{x:e.end.x*t.wFactor,y:e.end.y*t.hFactor}}),this.redrawArrow()}},{key:"initDraw",value:function(t,e){this.isSelected()&&this.blur(),this.anchorsGroup.setAnchorsCoordinates({start:{x:e.x,y:e.y},control:{x:(t.x+e.x)/2,y:(t.y+e.y)/2},end:{x:t.x,y:t.y}}),this.redrawArrow(!0)}},{key:"zIndex",value:function(t){var e,n,r,o;if(void 0===t)return null===(o=this.visiblePath)||void 0===o?void 0:o.zIndex();null===(e=this.substratePath)||void 0===e||e.zIndex(t),null===(n=this.visiblePath)||void 0===n||n.zIndex(t),null===(r=this.arrowHead)||void 0===r||r.zIndex(t)}},{key:"crop",value:function(t){var e=this.anchorsGroup.getPositions();this.anchorsGroup.setAnchorsCoordinates({start:{x:e.start.x-t.x,y:e.start.y-t.y},control:{x:e.control.x-t.x,y:e.control.y-t.y},end:{x:e.end.x-t.x,y:e.end.y-t.y}}),this.redrawArrow()}},{key:"clone",value:function(){var t=this.anchorsGroup?this.anchorsGroup.getPositions():this.props.anchorsPosition;return new i(Ye({},this.props,{anchorsPosition:t}))}},{key:"destroy",value:function(){var t,e,n,r;Ue(Fe(i.prototype),"destroy",this).call(this),null===(t=this.visiblePath)||void 0===t||t.destroy(),null===(e=this.substratePath)||void 0===e||e.destroy(),null===(n=this.arrowHead)||void 0===n||n.destroy(),null===(r=this.anchorsGroup)||void 0===r||r.destroy()}}])&&ze(e.prototype,n),r&&ze(e,r),i}(tt),Qe=Je;function tn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function en(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t.fontSize="fontSize",t.color="color"}($e||($e={}));var nn=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this;tn(this,t),this.onKeyDown=function(){var t=r.textNode.getAbsoluteScale().x;r.setTextareaWidth(r.textNode.width()*t),r.textArea.style.height="auto",r.textArea.style.height="".concat(r.textArea.scrollHeight+r.textNode.fontSize(),"px")},this.textNode=e,this.textArea=document.createElement("textarea"),this.textArea.value=n,document.body.appendChild(this.textArea),this.textArea.addEventListener("keydown",this.onKeyDown),this.textArea.style.display="none"}var e,n,r;return e=t,(n=[{key:"setTextareaWidth",value:function(t){var e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;(e||n)&&(t=Math.ceil(t)),(document.documentMode||/Edge/.test(navigator.userAgent))&&(t+=1),this.textArea.style.width="".concat(t,"px")}},{key:"update",value:function(t){this.textArea.style.display="initial",this.textArea.value=t.value,this.textArea.style.position="absolute",this.textArea.style.top="".concat(t.top,"px"),this.textArea.style.left="".concat(t.left,"px"),this.textArea.style.width="".concat(t.width,"px"),this.textArea.style.height="".concat(t.height,"px"),this.textArea.style.fontSize="".concat(t.fontSize,"px"),this.textArea.style.border="1px dashed #2196f3",this.textArea.style.padding="0px",this.textArea.style.margin="0px",this.textArea.style.overflow="hidden",this.textArea.style.background="none",this.textArea.style.outline="none",this.textArea.style.resize="none",this.textArea.style.lineHeight=""+t.lineHeight,this.textArea.style.fontFamily=t.fontFamily,this.textArea.style.transformOrigin="left top",this.textArea.style.textAlign=t.textAlign,this.textArea.style.color=t.color;var e="rotateZ(".concat(t.rotation,"deg)");if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){var n=2+Math.round(t.fontSize/20);e+="translateY(-".concat(n,"px)")}this.textArea.style.transform=e,this.textArea.style.height="auto",this.textArea.style.height=this.textArea.scrollHeight+3+"px"}},{key:"setAttr",value:function(t,e){switch(t){case $e.fontSize:this.textArea.style.fontSize="".concat(e,"px");break;case $e.color:this.textArea.style.color=e}}},{key:"focus",value:function(){this.textArea.focus()}},{key:"hide",value:function(){this.textArea.style.display="none"}},{key:"getValue",value:function(){return this.textArea.value}},{key:"destroy",value:function(){var t;this.textArea.removeEventListener("keydown",this.onKeyDown),null===(t=this.textArea.parentNode)||void 0===t||t.removeChild(this.textArea)}}])&&en(e.prototype,n),r&&en(e,r),t}(),rn=nn;function on(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function an(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function sn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){an(t,e,n[e])}))}return t}var cn=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.makeEditable=function(){var t;n.textNode.hide();var e=null===(t=le.getState().stage.instance)||void 0===t?void 0:t.absolutePosition();if(!e)throw new Error("Stage is not defined");var r=n.textNode.position();n.textArea.update({value:n.textNode.text(),top:r.y+e.y,left:r.x+e.x,width:n.textNode.width()-2*n.textNode.padding(),height:n.textNode.height()-2*n.textNode.padding()+5,fontSize:n.textNode.fontSize(),lineHeight:n.textNode.lineHeight(),fontFamily:n.textNode.fontFamily(),textAlign:n.textNode.align(),color:n.textNode.fill(),rotation:n.textNode.rotation()}),n.textArea.focus()},this.textNode=new H.Z.Text(sn({},e,{draggable:!0})),this.textNode.on("transform",(function(){n.textNode.setAttrs({width:n.textNode.width()*n.textNode.scaleX(),scaleX:1})})),this.textArea=new rn(this.textNode,e.text)}var e,n,r;return e=t,(n=[{key:"blur",value:function(){this.textNode.text(this.textArea.getValue()),this.textArea.hide(),this.textNode.show()}},{key:"setAttr",value:function(t,e){switch(this.textNode.setAttr(t,e),t){case"fontSize":this.textArea.setAttr($e.fontSize,e);break;case"fill":this.textArea.setAttr($e.color,e)}}},{key:"draggable",value:function(t){return this.textNode.setAttr("draggable",t),this.textNode.getAttr("draggable")}},{key:"on",value:function(t,e){this.textNode.on(t,e)}},{key:"addToLayer",value:function(t){t.add(this.textNode)}},{key:"setPosition",value:function(t,e){this.textNode.setAttrs({x:t,y:e})}},{key:"getPosition",value:function(){return{x:this.textNode.attrs.x,y:this.textNode.attrs.y}}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=this.textNode)||void 0===n?void 0:n.zIndex();null===(e=this.textNode)||void 0===e||e.zIndex(t)}},{key:"getText",value:function(){return this.textNode.attrs.text}},{key:"getRotation",value:function(){return this.textNode.rotation()}},{key:"getAttrs",value:function(){return this.textNode.getAttrs()}},{key:"getNode",value:function(){return this.textNode}},{key:"getSelfRect",value:function(){return sn({},this.getPosition(),{width:this.textNode.width(),height:this.textNode.height()})}},{key:"destroy",value:function(){var t,e;null===(t=this.textNode)||void 0===t||t.destroy(),null===(e=this.textArea)||void 0===e||e.destroy()}}])&&on(e.prototype,n),r&&on(e,r),t}();function un(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ln(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function hn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fn(t,e,n){return fn="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dn(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},fn(t,e,n||t)}function dn(t){return dn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},dn(t)}function pn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){hn(t,e,n[e])}))}return t}function yn(t,e){return!e||"object"!==gn(e)&&"function"!==typeof e?un(t):e}function vn(t,e){return vn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},vn(t,e)}var gn=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function bn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=dn(t);if(e){var o=dn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return yn(this,n)}}var wn=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vn(t,e)}(i,t);var e,n,r,o=bn(i);function i(t){var e,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this)).type=F.Z.TEXT,n.focus=function(){var t;fn((e=un(n),dn(i.prototype)),"focus",e).call(e),null===(t=n._transformer)||void 0===t||t.show()},n._props=pn({},t),n}return e=i,(n=[{key:"addToLayer",value:function(t,e){var n=this;if(!t.parent)throw new Error("Layer doesn't have a parent");var r,o=this._props.x||t.parent.attrs.width/2-100,a=this._props.y||t.parent.attrs.height/2-10;this._textNode=new cn({text:this._props.text||"Some text here",x:o,y:a,fontFamily:"Lato, Arial",fontSize:this._props.fontSize||20,width:this._props.width||200,fill:this._props.fill,rotation:null!==(r=this._props.rotation)&&void 0!==r?r:0}),this.attachBasicEvents(this._textNode),this._textNode.addToLayer(t),this._transformer=new H.Z.Transformer({node:this._textNode.getNode(),enabledAnchors:["middle-left","middle-right"],borderStroke:"#2196f3",anchorStroke:"#2196f3",anchorFill:"#ffffff",borderStrokeWidth:1,anchorStrokeWidth:1,boundBoxFunc:function(t,e){return e.width=Math.max(30,e.width),e}}),this._textNode.on("dblclick",(function(){var t,e;null===(t=n._textNode)||void 0===t||t.makeEditable(),null===(e=n._transformer)||void 0===e||e.hide(),le.dispatch(S(I.SHAPES_LAYER)),le.dispatch(S(I.ANCHORS_LAYER))})),this._textNode.on("click",this.focus),this._textNode.on("transform",(function(){le.dispatch(S(I.SHAPES_LAYER))})),this._transformer.hide(),e.add(this._transformer),fn(dn(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"setFillColor",value:function(t){var e;null===(e=this._textNode)||void 0===e||e.setAttr("fill",t),this._props.fill=t}},{key:"getFillColor",value:function(){return this._props.fill}},{key:"setFontSize",value:function(t){var e;null===(e=this._textNode)||void 0===e||e.setAttr("fontSize",t),this._props.fontSize=t}},{key:"blur",value:function(){var t,e;fn(dn(i.prototype),"blur",this).call(this),null===(t=this._textNode)||void 0===t||t.blur(),null===(e=this._transformer)||void 0===e||e.hide()}},{key:"scale",value:function(t){if(!this._textNode)throw new Error("`this.textNode` is not defined");var e=this._textNode.getPosition();this._textNode.setPosition(e.x*t.wFactor,e.y*t.hFactor)}},{key:"setAttrs",value:function(t){var e=this;Object.keys(t).forEach((function(n){var r;null===(r=e._textNode)||void 0===r||r.setAttr(n,t[n])}))}},{key:"crop",value:function(t){if(!this._textNode)throw new Error("`this.textNode` is not defined");var e=this._textNode.getPosition();this._textNode.setPosition(e.x-t.x,e.y-t.y)}},{key:"draggable",value:function(t){var e,n;return null!==(n=null===(e=this._textNode)||void 0===e?void 0:e.draggable(t))&&void 0!==n&&n}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=this._textNode)||void 0===n?void 0:n.zIndex();null===(e=this._textNode)||void 0===e||e.zIndex(t)}},{key:"clone",value:function(){var t,e,n,r,o=null===(t=this._textNode)||void 0===t?void 0:t.getText(),a=null===(e=this._textNode)||void 0===e?void 0:e.getRotation(),s=c().get(null===(n=this._textNode)||void 0===n?void 0:n.getAttrs(),"width");return new i(pn({},this._props,null===(r=this._textNode)||void 0===r?void 0:r.getPosition(),o&&{text:o},a&&{rotation:a},s&&{width:s}))}},{key:"getSelfRect",value:function(){if(!this._textNode)throw new Error("TextNode is not defined");return this._textNode.getSelfRect()}},{key:"initDraw",value:function(t,e){this.setAttrs({x:t.x,y:t.y,rotation:Le(t,e)*(180/Math.PI)}),le.dispatch(S(I.SHAPES_LAYER))}},{key:"destroy",value:function(){var t,e;fn(dn(i.prototype),"destroy",this).call(this),null===(t=this._textNode)||void 0===t||t.destroy(),null===(e=this._transformer)||void 0===e||e.destroy()}}])&&ln(e.prototype,n),r&&ln(e,r),i}(tt);function mn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xn(t,e,n){return xn="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=kn(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},xn(t,e,n||t)}function kn(t){return kn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},kn(t)}function Sn(t,e){return!e||"object"!==An(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Pn(t,e){return Pn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Pn(t,e)}var An=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function On(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=kn(t);if(e){var o=kn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Sn(this,n)}}var En=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pn(t,e)}(i,t);var e,n,r,o=On(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),e=o.call(this,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){_n(t,e,n[e])}))}return t}({},t,{stroke:"#0d87dc",fill:"transparent",strokeWidth:2,dash:[10,5]})),e.type=F.Z.SELECT_RECT,e}return e=i,(n=[{key:"blur",value:function(){xn(kn(i.prototype),"blur",this).call(this),this.destroy()}},{key:"scale",value:function(){this.destroy()}}])&&mn(e.prototype,n),r&&mn(e,r),i}(xt),Rn=En;function Tn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function jn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Cn(t){return Cn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Cn(t)}function Ln(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){jn(t,e,n[e])}))}return t}function Dn(t,e){return!e||"object"!==Zn(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Mn(t,e){return Mn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Mn(t,e)}var Zn=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function In(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Cn(t);if(e){var o=Cn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Dn(this,n)}}var Nn=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mn(t,e)}(i,t);var e,n,r,o=In(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).type=F.Z.ELLIPSE,e.getSizePos=function(){var t=e.getAttrs(),n=t.x,r=t.y,o=t.radiusX,i=t.radiusY;return{x:n-o,y:r-i,width:2*o,height:2*i}},e.onDragMoveAnchor=function(t){t.x=t.x+t.width/2,t.y=t.y+t.height/2,e.setShapeAttrs(t)},e.props=Ln({},t),e}return e=i,(n=[{key:"defineShape",value:function(){this.shape=new H.Z.Ellipse({x:this.props.x||0,y:this.props.y||0,radiusX:this.props.width||0,radiusY:this.props.height||0,dash:this.props.dash,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth,fill:this.props.fill,draggable:!0})}},{key:"getCloningProps",value:function(){var t,e=null===(t=this.shape)||void 0===t?void 0:t.getAttrs();return Ln({},this.props,e&&{x:e.x-e.radiusX,y:e.y-e.radiusY,width:2*e.radiusX,height:2*e.radiusY,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill})}},{key:"clone",value:function(){var t=this.getCloningProps();return t.x+=t.width/4,t.y+=t.height/4,new i(t)}},{key:"scale",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y,a=r.radiusX,s=r.radiusY;null===(e=this.shape)||void 0===e||e.setAttrs({x:o*t.wFactor,y:i*t.hFactor,width:2*a*t.wFactor,height:2*s*t.hFactor}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"initDraw",value:function(t,e){this.blur();var n=e.x-t.x,r=e.y-t.y;this.setAttrs({x:t.x+n/2,y:t.y+r/2,width:Math.abs(n),height:Math.abs(r)})}}])&&Tn(e.prototype,n),r&&Tn(e,r),i}(xt),Hn=function(t){t.on("click",(function(t){le.dispatch(w(t))})),t.on("dragstart",(function(t){le.dispatch(w(t))})),t.on("mouseover",(function(){var e=le.getState(),n=e.shapes,r=e.stage;r.isDraggable?t.draggable(!1):t.draggable(!n.addingShapeRef);var o=n.addingShapeRef?Z.AUTO:Z.MOVE;r.isDraggable||le.dispatch(h(o))})),t.on("mouseout",(function(){le.getState().stage.isDraggable||le.dispatch(h(Z.AUTO))}))},Wn=function(t,e){var n=t||new Qe({stroke:c().get(e,"strokeColor","green"),strokeWidth:c().get(e,"strokeWidth")});return n.onAnchor("mouseover",(function(){return le.dispatch(h(Z.POINTER))})),n.onAnchor("mouseout",(function(){return le.dispatch(h(Z.AUTO))})),Hn(n),n},Bn=function(t){le.dispatch(l(t))},zn=function(t,e){var n=t||new wn({fill:c().get(e,"fillColor","green"),fontSize:c().get(e,"fontSize")});return Hn(n),n},Gn=function(t){le.dispatch(l(t))},Un=function(t,e,n){var r={stroke:c().get(e,"strokeColor","green"),fill:c().get(e,"fillColor","transparent"),strokeWidth:c().get(e,"strokeWidth",2)},o=function(){if(t)return t;switch(n){case F.Z.RECT:return new xt(r);case F.Z.RECT_ROUGH:return new Mt(r);case F.Z.ELLIPSE:return new Nn(r);case F.Z.ELLIPSE_ROUGH:return new Ft(r);case F.Z.SELECT_RECT:return new Rn}}();if(!o)throw new Error("rectNode is not defined");return Hn(o),o},Fn=function(t){le.dispatch(l(t))},Yn=function(t){switch(t.type){case F.Z.ARROW:Bn(t);break;case F.Z.TEXT:Gn(t);break;case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:case F.Z.SELECT_RECT:Fn(t);break;default:console.error("Can't connect given shape"),console.log(t)}},Kn=function(t,e){switch(t.type){case F.Z.ARROW:!function(t,e){var n=Wn(t,e);Bn(n)}(t.clone(),e);break;case F.Z.TEXT:!function(t,e){var n=zn(t,e);Gn(n)}(t.clone(),e);break;case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:!function(t,e,n){var r=Un(t,e,n);Fn(r)}(t.clone(),e);break;case F.Z.IMAGE:Xn(t.clone());break;default:console.error("Can't clone and connect given shape"),console.log(t)}},Xn=function(t){Hn(t),le.dispatch(l(t))},qn=function(t){var e=le.getState().stage;if(!e.instance)throw new Error("Stage is not defined");var n=e.instance.absolutePosition(),r=new xe(t.image,t.pos?{x:t.pos.x-n.x,y:t.pos.y-n.y}:{x:e.instance.width()/2-t.image.width/2-n.x,y:e.instance.height()/2-t.image.height/2-n.y});Xn(r)},Vn="shapes-layer",$n=n(3274),Jn=function(t){navigator.clipboard?navigator.clipboard.writeText(t).then((function(){}),(function(t){console.error("Async: Could not copy text: ",t)})):function(t){var e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();try{document.execCommand("cut")}catch(n){return console.warn("Copy to clipboard failed.",n),!1}finally{document.body.removeChild(e)}}(t)},Qn=function(t){var e=document.createElement("img");e.src=t;var n=document.createElement("div");n.contentEditable="true",n.appendChild(e),document.body.appendChild(n),function(t){if(!window.getSelection)throw new Error("Can't select text");var e=window.getSelection(),n=document.createRange();n.selectNodeContents(t),null===e||void 0===e||e.removeAllRanges(),null===e||void 0===e||e.addRange(n)}(n),document.execCommand("Copy"),document.body.removeChild(n)};function tr(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function er(t){return function(t){if(Array.isArray(t))return tr(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return tr(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tr(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var nr={onDelete:["backspace","delete","del"],onCopy:["ctrl+c","command+c"],onPaste:["ctrl+v","command+v"],onActivateDrag:{sequence:"space",action:"keydown"},onDisableDrag:{sequence:"space",action:"keyup"},onActivateRatio:{sequence:"shift",action:"keydown"},onDisableRatio:{sequence:"shift",action:"keyup"}},rr=function(){var t=(0,a.useRef)([]);(0,a.useEffect)((function(){var t=c().throttle((function(){e(),n()}),50);return window.addEventListener("focus",t,{capture:!0}),function(){window.removeEventListener("focus",t)}}),[]);var e=function(){var t=le.getState().shapes;le.dispatch(j(!1)),t.list.forEach((function(t){t.draggable(!0)})),le.dispatch(h(Z.AUTO))},n=function(){le.dispatch(C(!1))};return(0,i.jsx)($n.GlobalHotKeys,{keyMap:nr,handlers:{onDelete:function(){le.dispatch(v()),le.dispatch(h(Z.AUTO))},onCopy:function(){var e=le.getState().shapes;Jn("[Shape]"),t.current=e.list.reduce((function(t,e){return e.isSelected()?er(t).concat([e.clone()]):t}),[])},onPaste:function(){le.dispatch(w()),t.current.forEach((function(t){Kn(t)})),t.current=[]},onActivateDrag:function(){var t=le.getState().shapes;le.dispatch(j(!0)),t.list.forEach((function(t){t.draggable(!1)})),le.dispatch(h(Z.GRAB))},onDisableDrag:e,onActivateRatio:function(){le.dispatch(C(!0))},onDisableRatio:n}})},or=n(96),ir=n.n(or),ar=function(t){var e=t.children,n=(0,a.useState)(Z.AUTO),r=n[0],o=n[1],s=(0,a.useRef)(c().throttle((function(){le.dispatch(T({width:window.innerWidth,height:window.innerHeight}))}),80)),u=(0,a.useRef)((function(){var t=le.getState().shapes;o(t.cursor)}));return(0,a.useEffect)((function(){window.addEventListener("resize",s.current);var t=le.subscribe(u.current);return function(){window.removeEventListener("resize",s.current),t()}}),[]),(0,i.jsx)("div",{style:{cursor:r},className:ir().CanvasWrapper,children:e})};function sr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var cr=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new $,this.handleClick=function(t){le.getState().shapes.addingShapeRef||le.dispatch(w())},this.handleMouseDown=function(t){n.cbMap.call("mousedown",t)},this.handleMouseUp=function(t){n.cbMap.call("mouseup",t)},this.handleMouseMove=function(t){n.cbMap.call("mousemove",t)},this.stage=new H.Z.Stage({container:e,width:window.innerWidth,height:window.innerHeight});var r=le.getState().shapes;this.add(r.shapesLayer),this.add(r.anchorsLayer);try{r.shapesLayer.getCanvas()._canvas.classList.add(Vn),r.anchorsLayer.getCanvas()._canvas.classList.add("anchors-layer")}catch(o){console.error("Can't set className to the canvas"),console.error(o)}this.stage.on("mousedown",this.handleMouseDown),this.stage.on("mouseup",this.handleMouseUp),this.stage.on("mousemove",this.handleMouseMove),this.stage.on("click",this.handleClick)}var e,n,r;return e=t,(n=[{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"add",value:function(t){this.stage.add(t)}},{key:"setAttrs",value:function(t){this.stage.setAttrs(t)}},{key:"draggable",value:function(t){if(void 0===t)return this.stage.draggable();this.stage.draggable(t)}},{key:"absolutePosition",value:function(t){if(void 0===t)return this.stage.absolutePosition();this.stage.absolutePosition(t)}},{key:"getBoundingClientRect",value:function(){return this.stage.container().getBoundingClientRect()}},{key:"toDataURL",value:function(){return this.stage.toDataURL()}},{key:"getPos",value:function(){return{x:this.stage.x(),y:this.stage.y()}}},{key:"width",value:function(){return this.stage.width()}},{key:"height",value:function(){return this.stage.height()}},{key:"getContentBoundariesRect",value:function(){var t=le.getState().shapes.list;if(0===t.length)return{x:0,y:0,width:0,height:0};var e={xTopLeft:1/0,yTopLeft:1/0,xBottomRight:-1/0,yBottomRight:-1/0},n=t.reduce((function(t,e){var n=e.getSelfRect(),r=n.x+n.width,o=n.y+n.height;return{xTopLeft:n.x<t.xTopLeft?n.x:t.xTopLeft,yTopLeft:n.y<t.yTopLeft?n.y:t.yTopLeft,xBottomRight:r>t.xBottomRight?r:t.xBottomRight,yBottomRight:o>t.yBottomRight?o:t.yBottomRight}}),e);return{x:n.xTopLeft,y:n.yTopLeft,width:n.xBottomRight-n.xTopLeft,height:n.yBottomRight-n.yTopLeft}}}])&&sr(e.prototype,n),r&&sr(e,r),t}();var ur=function(t,e){var n=function(t){var e=t.split(",");if(e[0]){var n=e[0].match(/:(.*?);/);if(n){for(var r=n[1],o=atob(e[1]),i=o.length,a=new Uint8Array(i);i--;)a[i]=o.charCodeAt(i);return new Blob([a],{type:r})}}return null}(t);if(!n)throw new Error("blob data is null");var r=document.createElement("a"),o=URL.createObjectURL(n);r.download=e.replace(/(\.[^.]+)$/gi,"")+".png",r.href=o,r.click()};function lr(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}function hr(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){lr(i,r,o,a,s,"next",t)}function s(t){lr(i,r,o,a,s,"throw",t)}a(void 0)}))}}function fr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var dr=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stage=new H.Z.Stage({container:e,width:10,height:10})}var e,n,r;return e=t,r=[{key:"normPosAxis",value:function(t){return t<0?Math.abs(t):0}}],(n=[{key:"trimLayer",value:function(e,n){var r=this,o=e.clone();return this.stage.add(o),this.stage.setAttrs({width:t.normPosAxis(n.x)+n.width+60,height:t.normPosAxis(n.y)+n.height+60,x:-1*n.x+30,y:-1*n.y+30}),new Promise((function(t,e){var n=r;setTimeout((function(){var r=n,i=o.getCanvas()._canvas;!function(t){var e,n,r,o,i,a,s,c,u,l,h,f,d;if(r=t.canvas.width,o=t.canvas.height,!r&&!o)return!1;for(d=t.getImageData(0,0,r,o),u=new Uint32Array(d.data.buffer),l=0,h=r*o-1,f=!1,n=0;n<o&&!f;n+=1){for(e=0;e<r;e+=1){if(u[l++]&&!i&&(i=n+1,c)){f=!0;break}if(u[h--]&&!c&&(c=o-n-1,i)){f=!0;break}}if(n>o-n&&!i&&!c)return!1}for(i-=1,f=!1,e=0;e<r&&!f;e+=1)for(l=i*r+e,h=i*r+(r-e-1),n=i;n<=c;n+=1){if(u[l]&&!a&&(a=e+1,s)){f=!0;break}if(u[h]&&!s&&(s=r-e-1,a)){f=!0;break}l+=r,h+=r}return r===s-(a-=1)+1&&o===c-i+1||(r=s-a+1,o=c-i+1,t.canvas.width=r,t.canvas.height=o,t.putImageData(d,-a,-i)),!0}(i.getContext("2d"))?e(new Error("Can't trim given context")):t(i),setTimeout((function(){r.stage.getLayers().forEach((function(t){return t.destroy()}))}),1e3)}))}))}},{key:"saveFromLayer",value:function(t,e,n){var r=this;return hr(o().mark((function i(){var a,s;return o().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r.trimLayer(t,n);case 2:a=o.sent,s=a.toDataURL(),ur(s,e);case 5:case"end":return o.stop()}}),i)})))()}},{key:"copyFromLayer",value:function(t,e){var n=this;return hr(o().mark((function r(){var i,a,s,c;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(null===window||void 0===window||null===(i=window.navigator)||void 0===i||null===(a=i.clipboard)||void 0===a?void 0:a.write)){r.next=8;break}return r.next=4,n.trimLayer(t,e);case 4:r.sent.toBlob((function(t){var e=new ClipboardItem({"image/png":t});navigator.clipboard.write([e])})),r.next=13;break;case 8:return r.next=10,n.trimLayer(t,e);case 10:s=r.sent,c=s.toDataURL(),Qn(c);case 13:case"end":return r.stop()}}),r)})))()}}])&&fr(e.prototype,n),r&&fr(e,r),t}(),pr=n(1908),yr=n.n(pr),vr=function(){var t=(0,a.useRef)(null);return(0,a.useEffect)((function(){le.dispatch(ee(new dr(t.current)))}),[]),(0,i.jsx)("div",{ref:t,className:yr().SaveCanvasEl})},gr=function(t){var e=t.shape,n=t.startPos,r=t.currentPos;if(t.ratioShiftIsActive&&e.type!==F.Z.ARROW&&e.type!==F.Z.TEXT){var o=r.x-n.x,i=r.y-n.y,a=Math.min(Math.abs(o),Math.abs(i));e.initDraw(n,{x:n.x+Math.sign(o)*a,y:n.y+Math.sign(i)*a})}else e.initDraw(n,r)},br=function(){return{startAddingShape:function(t){le.dispatch(w());var e=t.type,n=t.options;switch(e){case F.Z.TEXT:case F.Z.ARROW:case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:case F.Z.SELECT_RECT:le.dispatch(x({type:e,options:n}));break;case null:le.dispatch(x({type:null}));break;default:throw new Error("Given shape type can't be added: ".concat(e))}},setImage:function(t){qn(t)},setFillColorToActiveShape:function(t){le.dispatch(f(t))},setStrokeColorToActiveShape:function(t){le.dispatch(d(t))},setStrokeWidthToActiveShape:function(t){le.dispatch(p(t))},setFontSizeToActiveShape:function(t){le.dispatch(y(t))},exportCanvasToImage:function(t){var e=le.getState(),n=e.shapes,r=e.stage;if(!r.instance)throw new Error("Stage instance is not defined");le.dispatch(ne({layer:n.shapesLayer,name:t,contentRect:r.instance.getContentBoundariesRect()}))},copyAllToClipboard:function(){var t=le.getState(),e=t.stage,n=t.shapes;if(!e.instance)throw new Error("Stage instance is not defined");le.dispatch(re({layer:n.shapesLayer,contentRect:e.instance.getContentBoundariesRect()}))},blurShapes:function(){le.dispatch(w())},sketchifyActiveShape:function(){le.dispatch(A())},getShapesAmount:function(){return new Promise((function(t){requestAnimationFrame((function(){var e=le.getState().shapes;t(e.list.length)}))}))},changeOrderOfActiveShape:function(t){le.dispatch(P(t))},initBlankCanvas:function(t){if(!le.getState().stage.instance)throw new Error('"instance" is not defined on stage. It looks like stage is not initialized yet.');(function(t,e,n){var r=document.createElement("svg");return r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("width",String(t)),r.setAttribute("height",String(e)),r.setAttribute("style","background-color:".concat(n)),new Promise((function(t,e){var n=new Image,o=new Blob([r.outerHTML],{type:"image/svg+xml"}),i=URL.createObjectURL(o);n.onload=function(){URL.revokeObjectURL(i),t(this)},n.onerror=e,n.src=i}))})(t.width,t.height,"#cdcdcd").then((function(t){qn({image:t,name:"Blank canvas"})}))},onShapeClicked:B("SHAPE_CLICKED"),onShapeDragStarted:B("SHAPE_DRAG_STARTED"),onShapeBlurred:B("SHAPES_BLURRED"),onShapeAdded:B("SHAPE_ADDED"),onShapeDeleted:B("SHAPE_DELETED")}},wr=n(5170),mr=n.n(wr),_r=n(7214);function xr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Sr(t){return Sr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Sr(t)}function Pr(t,e){return!e||"object"!==Or(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ar(t,e){return Ar=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ar(t,e)}var Or=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Er(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Sr(t);if(e){var o=Sr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Pr(this,n)}}var Rr=function(){var t=(0,_r.R2)(".".concat(Vn));if(t)return t;throw new Error("Shapes layer is not found")},Tr=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ar(t,e)}(s,t);var e,n,r,o=Er(s);function s(){var t;return xr(this,s),(t=o.apply(this,arguments)).canvasRef=a.createRef(),t.state={mouseIsDown:!1,mouseStartPos:{x:0,y:0}},t.handleStageOnMouseDown=function(e){var n=le.getState(),r=n.shapes,o=n.stage;if(r.addingShapeRef&&o.instance){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY,u={x:s-i.x,y:c-i.y};t.setState({mouseIsDown:!0,mouseStartPos:u}),Yn(r.addingShapeRef),r.addingShapeRef.initDraw(u,u)}},t.handleStageOnMouseUp=function(e){t.setState({mouseIsDown:!1});var n=le.getState(),r=n.shapes,o=n.stage;if(r.addingShapeRef){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY,u=De({x:s-i.x,y:c-i.y},t.state.mouseStartPos);r.addingShapeRef.type===F.Z.TEXT||u>10?(r.addingShapeRef.focus(),le.dispatch(k(r.addingShapeRef))):le.dispatch(b(r.addingShapeRef)),requestAnimationFrame((function(){le.dispatch(x())}))}},t.handleStageOnMouseMove=function(e){var n=le.getState(),r=n.shapes,o=n.stage;if(t.state.mouseIsDown&&r.addingShapeRef&&o.instance){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY;gr({shape:r.addingShapeRef,startPos:t.state.mouseStartPos,currentPos:{x:s-i.x,y:c-i.y},ratioShiftIsActive:o.ratioShiftIsActive})}},t}return e=s,(n=[{key:"componentDidMount",value:function(){if(this.canvasRef.current){var t=new cr(this.canvasRef.current);t.on("mousedown",this.handleStageOnMouseDown),t.on("mouseup",this.handleStageOnMouseUp),t.on("mousemove",this.handleStageOnMouseMove),le.dispatch(R(t)),this.canvasRef.current.tabIndex=1,this.props.onReady(br())}}},{key:"render",value:function(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(ar,{children:[(0,i.jsx)(rr,{}),(0,i.jsx)("div",{ref:this.canvasRef,className:mr().CanvasEl})]}),(0,i.jsx)(vr,{})]})}}])&&kr(e.prototype,n),r&&kr(e,r),s}(a.PureComponent),jr=Tr,Cr=n(8523),Lr=n(484),Dr=n(27),Mr=n(5968),Zr=n(3489),Ir=n(3425),Nr=n(4440);function Hr(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}function Wr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Br=function(t){var e=t.children,n=(0,a.useContext)(Mr.z),r=n.state,s=r.menu,c=r.canvas.canvasApi,u=n.dispatch,l=function(){var t,e=(t=o().mark((function t(e,n,r){var i,a,l,h,f,d,p,y;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=!1,!(e.length>0)){t.next=34;break}a=!0,l=!1,h=void 0,t.prev=3,f=e[Symbol.iterator]();case 5:if(a=(d=f.next()).done){t.next=20;break}if((p=d.value).type.startsWith("image")){t.next=12;break}return u((0,Zr.c)({message:(0,Ir.t)("image-type-error"),type:Nr.k.Error})),Dr.qP({eventCategory:Dr.Ak.Error,eventAction:"image type error (".concat(p.type,")")}),i=!0,t.abrupt("continue",17);case 12:return t.next=14,(0,Lr.Z)(p);case 14:y=t.sent,null===c||void 0===c||c.blurShapes(),null===c||void 0===c||c.setImage({image:y.image,name:y.name,pos:{x:r.clientX-y.image.width/2,y:r.clientY-s.menuHeight-y.image.height/2}});case 17:a=!0,t.next=5;break;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(3),l=!0,h=t.t0;case 26:t.prev=26,t.prev=27,a||null==f.return||f.return();case 29:if(t.prev=29,!l){t.next=32;break}throw h;case 32:return t.finish(29);case 33:return t.finish(26);case 34:i||Dr.qP({eventCategory:Dr.Ak.GlobalInteraction,eventAction:Dr.UZ.DropImage});case 35:case"end":return t.stop()}}),t,null,[[3,22,26,34],[27,,29,33]])})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Hr(i,r,o,a,s,"next",t)}function s(t){Hr(i,r,o,a,s,"throw",t)}a(void 0)}))});return function(t,n,r){return e.apply(this,arguments)}}();return(0,i.jsx)(Cr.ZP,{onDrop:l,children:function(t){var n=t.getRootProps;return(0,i.jsx)("div",function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Wr(t,e,n[e])}))}return t}({},n(),{children:e}))}})},zr=n(4801),Gr=n.n(zr),Ur=function(){return(0,i.jsx)("div",{className:Gr().HowToStart,children:(0,Ir.t)("how-to-start")})},Fr=n(4753),Yr=n(1664),Kr=n(1163),Xr=n(1386),qr=n.n(Xr),Vr=n(8944),$r=function(){var t=(0,Kr.useRouter)().query,e=(0,a.useState)(""),n=e[0],r=e[1];return(0,a.useEffect)((function(){r((0,Vr.W)(t))}),[t]),(0,i.jsxs)("div",{className:qr().Tips,children:["Psst...",(0,i.jsx)("br",{}),"You can add as many images as you want.",(0,i.jsx)("br",{}),"To read more about this feature\xa0",(0,i.jsx)(Yr.default,{href:"/features".concat(n),passHref:!0,children:(0,i.jsx)("a",{onClick:function(){Dr.qP({eventCategory:Dr.Ak.Content,eventAction:Dr.UZ.FeaturesPage})},children:"click here"})}),(0,i.jsx)("br",{})]})};function Jr(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}var Qr=function(){var t=(0,a.useState)(!1),e=t[0],n=t[1],r=(0,a.useContext)(Mr.z),s=r.state.canvas.canvasApi,u=r.dispatch,l=function(t){var e=(t.clipboardData||t.originalEvent.clipboardData).items,n=Array.from(e).find((function(t){return 0===t.type.indexOf("image")}));if(n){var r=n.getAsFile(),o=new Image;if(!r)throw new Error("blob data is null");var i=URL.createObjectURL(r);o.onload=function(){URL.revokeObjectURL(i),null===s||void 0===s||s.setImage({image:this,name:""})},o.onerror=function(t){console.error(t)},o.src=i}},h=function(){var t,e=(t=o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=5;break}return t.next=3,s.getShapesAmount();case 3:e=t.sent,n(e>0);case 5:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Jr(i,r,o,a,s,"next",t)}function s(t){Jr(i,r,o,a,s,"throw",t)}a(void 0)}))});return function(){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){(0,_r.Oo)("paste",l);var t=c().noop,e=c().noop;return s&&(t=s.onShapeAdded(h),e=s.onShapeDeleted(h),h()),function(){(0,_r.xg)("paste",l),t(),e(),null===s||void 0===s||s.blurShapes()}}),[s]),(0,i.jsxs)(Br,{children:[!e&&(0,i.jsx)(Ur,{}),(0,i.jsx)(jr,{onReady:function(t){u((0,Fr.T)(t))}}),!e&&(0,i.jsx)($r,{})]})}},4801:function(t){t.exports={HowToStart:"HowToStart_HowToStart__U_ZpN"}},1386:function(t){t.exports={Tips:"Tips_Tips__YAVcx"}},5170:function(t){t.exports={CanvasEl:"CanvasEl_CanvasEl__olqIr"}},96:function(t){t.exports={CanvasWrapper:"CanvasWrapper_CanvasWrapper__JUeAG"}},1908:function(t){t.exports={SaveCanvasEl:"SaveCanvasEl_SaveCanvasEl__iEaxT"}}}]);