(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79],{407:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return Ur}});var r=n(4051),o=n.n(r),i=n(5893),a=n(7294),s=n(6486),c=n.n(s),u=n(8231),l=(0,u.Z)("ADD_SHAPE"),h=(0,u.Z)("SET_CURSOR"),f=(0,u.Z)("SET_FILL_COLOR_TO_ACTIVE_SHAPE"),d=(0,u.Z)("SET_STROKE_COLOR_TO_ACTIVE_SHAPE"),p=(0,u.Z)("SET_STROKE_WIDTH_TO_ACTIVE_SHAPE"),y=(0,u.Z)("SET_FONT_SIZE_TO_ACTIVE_SHAPE"),v=(0,u.Z)("DELETE_ACTIVE_SHAPES"),g=(0,u.Z)("DELETE_ALL_SHAPES"),b=(0,u.Z)("DELETE_SHAPE"),w=(0,u.Z)("BLUR_SHAPES"),m=(0,u.Z)("SCALE_SHAPES"),x=(0,u.Z)("CROP_SHAPES"),k=(0,u.Z)("SET_ADDING_SHAPE"),S=(0,u.Z)("SHAPE_ADDED"),P=(0,u.Z)("DRAW_LAYERS"),A=(0,u.Z)("CHANGE_ORDER_OF_ACTIVE_SHAPE"),O=(0,u.Z)("SKETCHIFY_ACTIVE_SHAPE"),E=n(9569),R=n(3620),T=(0,u.Z)("SET_STAGE"),j=(0,u.Z)("SET_STAGE_SIZE"),C=(0,u.Z)("SET_STAGE_DRAGGABLE"),_=(0,u.Z)("SET_RATIO_SHIFT");function L(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function D(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){L(t,e,n[e])}))}return t}var M,Z,N,I=(0,R.Z)((L(M={},"".concat(T),(function(t,e){return D({},t,{instance:e.payload})})),L(M,"".concat(j),(function(t,e){var n,r=e.payload,o=r.width,i=r.height;return null===(n=t.instance)||void 0===n||n.setAttrs({width:o,height:i}),t})),L(M,"".concat(C),(function(t,e){var n,r=e.payload;return null===(n=t.instance)||void 0===n||n.draggable(r),D({},t,{isDraggable:r})})),L(M,"".concat(_),(function(t,e){var n,r=e.payload;return null===(n=t.instance)||void 0===n||n.draggable(r),D({},t,{ratioShiftIsActive:r})})),M),{instance:null,isDraggable:!1,ratioShiftIsActive:!1}),H=n(9649);!function(t){t.AUTO="auto",t.MOVE="move",t.POINTER="pointer",t.GRAB="grab"}(Z||(Z={})),function(t){t.SHAPES_LAYER="shapes_layer",t.ANCHORS_LAYER="anchors_layer"}(N||(N={}));var W=(0,n(8111).i)(),B=function(t){return function(e){return W.on(t,e)}},z=function(t){W.emit("SHAPES_BLURRED",t)},G=function(t){W.emit("SHAPE_ADDED",t)},U=function(t){W.emit("SHAPE_DELETED",t)},F=n(5693),Y=n(9021),K=n.n(Y);function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function V(t){return function(t){if(Array.isArray(t))return X(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var $=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new Map}var e,n,r;return e=t,(n=[{key:"set",value:function(t,e){this.cbMap.set(t,e)}},{key:"call",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=this.cbMap.get(t);o&&o.apply(void 0,V(n))}},{key:"get",value:function(t){var e=this.cbMap.get(t);return null!==e&&void 0!==e?e:c().noop}},{key:"has",value:function(t){return this.cbMap.has(t)}}])&&q(e.prototype,n),r&&q(e,r),t}();function J(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Q,tt=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.type=F.Z.SHAPE,this.cbMap=new $,this._isSelected=!1,this.onClick=function(t){var n;ce.getState().shapes.addingShapeRef||(n=e,W.emit("SHAPE_CLICKED",n),t.cancelBubble=!0,e.focus(),e.cbMap.call("click",e))},this.onDragStart=function(){var t;t=e,W.emit("SHAPE_DRAG_STARTED",t),e.focus(),e.cbMap.call("dragstart",e)}}var e,n,r;return e=t,(n=[{key:"blur",value:function(){this._isSelected=!1}},{key:"focus",value:function(){this._isSelected=!0}},{key:"isSelected",value:function(){return this._isSelected}},{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"addToLayer",value:function(t,e){this.focus()}},{key:"clone",value:function(){console.warn("clone() is not implemented"),console.warn(this)}},{key:"crop",value:function(t){console.warn("crop() is not implemented"),console.warn(this)}},{key:"draggable",value:function(t){console.warn("draggable() is not implemented"),console.warn(this)}},{key:"attachBasicEvents",value:function(t){var e=this;t.on("click",this.onClick),t.on("dragstart",this.onDragStart),t.on("mouseover",(function(){e.cbMap.call("mouseover",e)})),t.on("mouseout",(function(){e.cbMap.call("mouseout",e)}))}},{key:"destroy",value:function(){this.cbMap.call("_beforedestroy",this)}}])&&J(e.prototype,n),r&&J(e,r),t}();function et(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t.left="left",t.top="top",t.right="right",t.bottom="bottom",t.leftTop="leftTop",t.leftBottom="leftBottom",t.rightTop="rightTop",t.rightBottom="rightBottom"}(Q||(Q={}));var rt={width:10,height:10,stroke:"#2196f3",strokeWidth:1,fill:"#ffffff",draggable:!0},ot=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new $,this.onDragMove=function(t){n.cbMap.call("dragmove",n.attrs.type,t)},this.attrs=e,this.anchor=new H.Z.Rect(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){nt(t,e,n[e])}))}return t}({},rt,{x:e.x-rt.width/2,y:e.y-rt.height/2,dragBoundFunc:function(t){return{x:t.x,y:t.y}}})),this.anchor.on("dragmove",this.onDragMove)}var e,n,r;return e=t,(n=[{key:"show",value:function(){this.anchor.visible(!0)}},{key:"hide",value:function(){this.anchor.visible(!1)}},{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"getPos",value:function(){var t=this.anchor.getAttrs();return{x:t.x+rt.width/2,y:t.y+rt.height/2}}},{key:"setPos",value:function(t){var e=this.getPos(),n=t.x||e.x,r=t.y||e.y;this.anchor.setAttrs({x:n-rt.width/2,y:r-rt.height/2})}},{key:"addToLayer",value:function(t){t.add(this.anchor)}},{key:"destroy",value:function(){this.anchor.destroy()}}])&&et(e.prototype,n),r&&et(e,r),t}();function it(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function at(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function st(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){at(t,e,n[e])}))}return t}var ct=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new $,this.originRatio=1,this.onMoveAnchor=function(t,e){var r=ce.getState().stage,o=r.ratioShiftIsActive,i=r.instance,a=e.evt,s=a.layerX,c=a.layerY,u=null===i||void 0===i?void 0:i.absolutePosition(),l=n.getCurrentAnchor(t),h=o?{x:s-u.x,y:c-u.y}:l.getPos(),f=n.getOppositeAnchor(t).getPos(),d=h.x-f.x,p=h.y-f.y,y=Math.min(Math.abs(d/n.originRatio),Math.abs(p));o&&(h={x:f.x+Math.sign(d)*y*n.originRatio,y:f.y+Math.sign(p)*y},l.setPos(h));var v=n.getNeighborAnchors(t);v.neighborX.setPos({x:h.x}),v.neighborY.setPos({y:h.y});var g=n.getLeftTopPos();n.cbMap.call("dragmove",{x:g.x,y:g.y,width:Math.abs(o?y*n.originRatio:d),height:Math.abs(o?y:p)})},this.anchors={leftTop:new ot(st({},t.calcAnchorPosition(Q.leftTop,e),{type:Q.leftTop})),rightTop:new ot(st({},t.calcAnchorPosition(Q.rightTop,e),{type:Q.rightTop})),rightBottom:new ot(st({},t.calcAnchorPosition(Q.rightBottom,e),{type:Q.rightBottom})),leftBottom:new ot(st({},t.calcAnchorPosition(Q.leftBottom,e),{type:Q.leftBottom}))},this.anchors.leftTop.on("dragmove",this.onMoveAnchor),this.anchors.rightTop.on("dragmove",this.onMoveAnchor),this.anchors.rightBottom.on("dragmove",this.onMoveAnchor),this.anchors.leftBottom.on("dragmove",this.onMoveAnchor)}var e,n,r;return e=t,r=[{key:"calcAnchorPosition",value:function(t,e){switch(t){case Q.left:return{x:e.x,y:e.y+e.height/2};case Q.top:return{x:e.x+e.width/2,y:e.y};case Q.right:return{x:e.x+e.width,y:e.y+e.height/2};case Q.bottom:return{x:e.x+e.width/2,y:e.y+e.height};case Q.leftTop:return{x:e.x,y:e.y};case Q.rightTop:return{x:e.x+e.width,y:e.y};case Q.rightBottom:return{x:e.x+e.width,y:e.y+e.height};case Q.leftBottom:return{x:e.x,y:e.y+e.height};default:throw new Error("Position can't be calculated for given type: ".concat(t))}}}],(n=[{key:"getCurrentAnchor",value:function(t){switch(t){case Q.leftTop:return this.anchors.leftTop;case Q.leftBottom:return this.anchors.leftBottom;case Q.rightTop:return this.anchors.rightTop;case Q.rightBottom:return this.anchors.rightBottom;default:throw new Error("Can't find anchor for provided type. Given ".concat(t))}}},{key:"getOppositeAnchor",value:function(t){switch(t){case Q.leftTop:return this.anchors.rightBottom;case Q.leftBottom:return this.anchors.rightTop;case Q.rightTop:return this.anchors.leftBottom;case Q.rightBottom:return this.anchors.leftTop;default:throw new Error("Can't find anchor for provided type. Given ".concat(t))}}},{key:"getNeighborAnchors",value:function(t){switch(t){case Q.leftTop:return{neighborX:this.anchors.leftBottom,neighborY:this.anchors.rightTop};case Q.leftBottom:return{neighborX:this.anchors.leftTop,neighborY:this.anchors.rightBottom};case Q.rightTop:return{neighborX:this.anchors.rightBottom,neighborY:this.anchors.leftTop};case Q.rightBottom:return{neighborX:this.anchors.rightTop,neighborY:this.anchors.leftBottom};default:throw new Error("Width and height can't be calculated for the given type: ".concat(t))}}},{key:"getLeftTopPos",value:function(){var t=this;return Object.keys(this.anchors).reduce((function(e,n){var r=t.anchors[n].getPos();return r.x<e.x||r.y<e.y?r:e}),{x:1/0,y:1/0})}},{key:"setOriginRatio",value:function(t){this.originRatio=t}},{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"updatePosition",value:function(e){this.anchors.leftTop.setPos(t.calcAnchorPosition(Q.leftTop,e)),this.anchors.rightTop.setPos(t.calcAnchorPosition(Q.rightTop,e)),this.anchors.rightBottom.setPos(t.calcAnchorPosition(Q.rightBottom,e)),this.anchors.leftBottom.setPos(t.calcAnchorPosition(Q.leftBottom,e))}},{key:"show",value:function(){this.anchors.leftTop.show(),this.anchors.rightTop.show(),this.anchors.rightBottom.show(),this.anchors.leftBottom.show()}},{key:"hide",value:function(){this.anchors.leftTop.hide(),this.anchors.rightTop.hide(),this.anchors.rightBottom.hide(),this.anchors.leftBottom.hide()}},{key:"addToLayer",value:function(t){this.anchors.leftTop.addToLayer(t),this.anchors.rightTop.addToLayer(t),this.anchors.rightBottom.addToLayer(t),this.anchors.leftBottom.addToLayer(t)}},{key:"destroy",value:function(){this.anchors.leftTop.destroy(),this.anchors.rightTop.destroy(),this.anchors.rightBottom.destroy(),this.anchors.leftBottom.destroy()}}])&&it(e.prototype,n),r&&it(e,r),t}();function ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var lt=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new $,this.onDragMove=function(t){var e="_dragmoveanchor";if(n.cbMap.call(e,t),!n.cbMap.has(e))throw new Error('"'.concat(e,'" should be defined'))},this.anchors=new ct(e),this.anchors.on("dragmove",this.onDragMove)}var e,n,r;return e=t,(n=[{key:"setOriginRatio",value:function(t){this.anchors.setOriginRatio(t)}},{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.anchors.updatePosition(t),e&&ce.dispatch(P(N.ANCHORS_LAYER))}},{key:"addToLayer",value:function(t){this.anchors.addToLayer(t)}},{key:"show",value:function(){this.anchors.show()}},{key:"hide",value:function(){this.anchors.hide()}},{key:"destroy",value:function(){this.anchors.destroy()}}])&&ut(e.prototype,n),r&&ut(e,r),t}();function ht(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ft(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function dt(t,e,n){return(dt="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=pt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function pt(t){return(pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function yt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){ft(t,e,n[e])}))}return t}function vt(t,e){return!e||"object"!==bt(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function gt(t,e){return(gt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var bt=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function wt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=pt(t);if(e){var o=pt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return vt(this,n)}}var mt=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gt(t,e)}(i,t);var e,n,r,o=wt(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this)).type=F.Z.RECT,e.onDragMove=function(t){var n;e.cbMap.call("dragmove",t),null===(n=e.sizeTransform)||void 0===n||n.update(e.getSizePos())},e.getSizePos=function(){var t=e.getAttrs();return{x:t.x,y:t.y,width:t.width,height:t.height}},e.onDragMoveAnchor=function(t){e.setShapeAttrs(t)},e.props=yt({},t),e}return e=i,(n=[{key:"defineShape",value:function(){this.shape=new H.Z.Rect({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,dash:this.props.dash,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth,fill:this.props.fill,draggable:!0})}},{key:"addToLayer",value:function(t,e){this.defineShape(),this.shape.on("dragmove",this.onDragMove),dt(pt(i.prototype),"attachBasicEvents",this).call(this,this.shape),this.sizeTransform=new lt(this.getSizePos()),this.sizeTransform.on("_dragmoveanchor",this.onDragMoveAnchor),t.add(this.shape),this.sizeTransform.addToLayer(e),dt(pt(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"blur",value:function(){var t;dt(pt(i.prototype),"blur",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.hide()}},{key:"focus",value:function(){var t;dt(pt(i.prototype),"focus",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.show()}},{key:"getFillColor",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("fill")}},{key:"setFillColor",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttr("fill",t)}},{key:"getStrokeColor",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("stroke")}},{key:"getAttrs",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttrs()}},{key:"hide",value:function(){var t;null===(t=this.shape)||void 0===t||t.setAttrs({stroke:"transparent"})}},{key:"setShapeAttrs",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttrs(t),ce.dispatch(P(N.SHAPES_LAYER))}},{key:"setAttrs",value:function(t){var e;this.setShapeAttrs(t),null===(e=this.sizeTransform)||void 0===e||e.update(this.getSizePos())}},{key:"setStrokeColor",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttr("stroke",t)}},{key:"setStrokeWidth",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttrs({strokeWidth:t})}},{key:"getStrokeWidth",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("strokeWidth")}},{key:"getSelfRect",value:function(){if(!this.shape)throw new Error("Shape is not defined");var t=this.shape.getAbsolutePosition(),e=this.shape.getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}},{key:"draggable",value:function(t){var e,n;if(void 0===t)return null===(n=this.shape)||void 0===n?void 0:n.draggable();null===(e=this.shape)||void 0===e||e.draggable(t)}},{key:"scale",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y,a=r.width,s=r.height;null===(e=this.shape)||void 0===e||e.setAttrs({x:o*t.wFactor,y:i*t.hFactor,width:a*t.wFactor,height:s*t.hFactor}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"getCloningProps",value:function(){var t,e=null===(t=this.shape)||void 0===t?void 0:t.getAttrs();return yt({},this.props,e&&{x:e.x,y:e.y,width:e.width,height:e.height,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill})}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=this.shape)||void 0===n?void 0:n.zIndex();null===(e=this.shape)||void 0===e||e.zIndex(t)}},{key:"crop",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y;null===(e=this.shape)||void 0===e||e.setAttrs({x:o-t.x,y:i-t.y}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"clone",value:function(){return new i(this.getCloningProps())}},{key:"initDraw",value:function(t,e){this.type===F.Z.RECT&&this.blur(),this.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y})}},{key:"destroy",value:function(){var t,e;dt(pt(i.prototype),"destroy",this).call(this),null===(t=this.shape)||void 0===t||t.destroy(),null===(e=this.sizeTransform)||void 0===e||e.destroy()}}])&&ht(e.prototype,n),r&&ht(e,r),i}(tt),xt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nonzero";t.beginPath();var r=!0,o=!1,i=void 0;try{for(var a,s=e.ops[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value,u=c.data;switch(c.op){case"move":t.moveTo(u[0],u[1]);break;case"bcurveTo":t.bezierCurveTo(u[0],u[1],u[2],u[3],u[4],u[5]);break;case"lineTo":t.lineTo(u[0],u[1])}}}catch(l){o=!0,i=l}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}"fillPath"===e.type?t.fill(n):t.stroke()},kt=function(t,e,n){var r=n.fillWeight;r<0&&(r=n.strokeWidth/2),t.save(),n.fillLineDash&&t.setLineDash(n.fillLineDash),n.fillLineDashOffset&&(t.lineDashOffset=n.fillLineDashOffset),t.strokeStyle=n.fill||"",t.lineWidth=r,xt(t,e),t.restore()},St=function(t,e){var n=e.sets||[],r=e.options,o=!0,i=!1,a=void 0;try{for(var s,c=n[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;switch(u.type){case"path":t.save(),t.strokeStyle="none"===r.stroke?"transparent":r.stroke,t.lineWidth=r.strokeWidth,r.strokeLineDash&&t.setLineDash(r.strokeLineDash),r.strokeLineDashOffset&&(t.lineDashOffset=r.strokeLineDashOffset),xt(t,u),t.restore();break;case"fillPath":t.save(),t.fillStyle=r.fill||"";var l="curve"===e.shape||"polygon"===e.shape?"evenodd":"nonzero";xt(t,u,l),t.restore();break;case"fillSketch":kt(t,u,r)}}}catch(h){i=!0,a=h}finally{try{o||null==c.return||c.return()}finally{if(i)throw a}}};function Pt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function At(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ot(t,e,n){return(Ot="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Et(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Et(t){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Rt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){At(t,e,n[e])}))}return t}function Tt(t,e){return!e||"object"!==Ct(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function jt(t,e){return(jt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ct=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function _t(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Et(t);if(e){var o=Et(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Tt(this,n)}}var Lt=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&jt(t,e)}(i,t);var e,n,r,o=_t(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).type=F.Z.RECT_ROUGH,e.isDragging=!1,e.prevWidth=0,e.prevHeight=0,e.onDragMoveSubRect=function(t){var n,r;e.cbMap.call("dragmove",t);var o=e.getSizePosSubRect();null===(n=e.sizeTransform)||void 0===n||n.update(o),null===(r=e.shape)||void 0===r||r.setAttrs(o)},e.onDragMoveAnchor=function(t){var n;null===(n=e.substrateKonvaShape)||void 0===n||n.setAttrs(t),e.setShapeAttrs(t)},e.getSizePosSubRect=function(){var t,n=null===(t=e.substrateKonvaShape)||void 0===t?void 0:t.getAttrs();return{x:n.x,y:n.y,width:n.width,height:n.height}},e.props=Rt({},t);var n=xr();return e.roughCanvas=K().canvas(n),e}return e=i,(n=[{key:"defineShape",value:function(){var t=this;this.shape=new H.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:function(e,n){var r=n.getWidth(),o=n.getHeight(),i=n.getStroke(),a=n.getStrokeWidth();r===t.prevWidth&&o===t.prevHeight&&t.lastDrawable?(t.lastDrawable.options.stroke=i,t.lastDrawable.options.fill=t.props.fill,t.lastDrawable.options.strokeWidth=a):(t.prevWidth=r,t.prevHeight=o,t.lastDrawable=t.roughCanvas.generator.rectangle(0,0,r,o,{roughness:2.5,stroke:i,strokeWidth:a,fill:t.props.fill,fillWeight:3})),St(e,t.lastDrawable),e.fillStrokeShape(n)}}),this.substrateKonvaShape=new H.Z.Rect({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:"transparent",fill:"transparent",draggable:!0}),this.shape.on("dragstart",(function(){t.isDragging=!0})),this.shape.on("dragend",(function(){t.isDragging=!1})),this.substrateKonvaShape.on("dragstart",(function(){t.isDragging=!0})),this.substrateKonvaShape.on("dragend",(function(){t.isDragging=!1})),this.substrateKonvaShape.on("click",(function(e){t.onClick(e)})),this.substrateKonvaShape.on("dragstart",(function(){t.onDragStart()})),this.substrateKonvaShape.on("mouseover",(function(){t.cbMap.call("mouseover")})),this.substrateKonvaShape.on("mouseout",(function(){t.cbMap.call("mouseout")}))}},{key:"setFillColor",value:function(t){this.props.fill=t}},{key:"getFillColor",value:function(){return this.props.fill}},{key:"setStrokeWidth",value:function(t){Ot(Et(i.prototype),"setStrokeWidth",this).call(this,t/2)}},{key:"getStrokeWidth",value:function(){return 2*Ot(Et(i.prototype),"getStrokeWidth",this).call(this)}},{key:"addToLayer",value:function(t,e){if(Ot(Et(i.prototype),"addToLayer",this).call(this,t,e),!this.substrateKonvaShape)throw new Error("`this.substrateKonvaShape` is not defined");this.substrateKonvaShape.on("dragmove",this.onDragMoveSubRect),t.add(this.substrateKonvaShape)}},{key:"draggable",value:function(t){var e,n=Ot(Et(i.prototype),"draggable",this).call(this,t);return null===(e=this.substrateKonvaShape)||void 0===e||e.setAttr("draggable",t),n}},{key:"initDraw",value:function(t,e){var n;null===(n=this.substrateKonvaShape)||void 0===n||n.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y}),Ot(Et(i.prototype),"initDraw",this).call(this,t,e)}},{key:"destroy",value:function(){var t;Ot(Et(i.prototype),"destroy",this).call(this),null===(t=this.substrateKonvaShape)||void 0===t||t.destroy()}},{key:"scale",value:function(t){var e;Ot(Et(i.prototype),"scale",this).call(this,t);var n=this.getAttrs(),r=n.x,o=n.y,a=n.width,s=n.height;null===(e=this.substrateKonvaShape)||void 0===e||e.setAttrs({x:r,y:o,width:a,height:s})}},{key:"crop",value:function(t){var e;Ot(Et(i.prototype),"crop",this).call(this,t);var n=this.getAttrs(),r=n.x,o=n.y;null===(e=this.substrateKonvaShape)||void 0===e||e.setAttrs({x:r,y:o})}},{key:"clone",value:function(){var t=this.getStrokeWidth();return new i(Rt({},this.getCloningProps(),Number.isNaN(t)?{}:{strokeWidth:t},{fill:this.props.fill}))}}])&&Pt(e.prototype,n),r&&Pt(e,r),i}(mt);function Dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Mt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Zt(t,e,n){return(Zt="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Nt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Nt(t){return(Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function It(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Mt(t,e,n[e])}))}return t}function Ht(t,e){return!e||"object"!==Bt(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Wt(t,e){return(Wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Bt=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function zt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Nt(t);if(e){var o=Nt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ht(this,n)}}var Gt=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Wt(t,e)}(i,t);var e,n,r,o=zt(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).type=F.Z.ELLIPSE_ROUGH,e.isDragging=!1,e.prevWidth=0,e.prevHeight=0,e.props=It({},t);var n=xr();return e.roughCanvas=K().canvas(n),e}return e=i,(n=[{key:"defineShape",value:function(){var t=this;this.shape=new H.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:function(e,n){var r=n.getWidth(),o=n.getHeight(),i=n.getStroke(),a=n.getStrokeWidth();r===t.prevWidth&&o===t.prevHeight&&t.lastDrawable?(t.lastDrawable.options.stroke=i,t.lastDrawable.options.fill=t.props.fill,t.lastDrawable.options.strokeWidth=a):(t.prevWidth=r,t.prevHeight=o,t.lastDrawable=t.roughCanvas.generator.ellipse(r/2,o/2,r,o,{roughness:2.5,stroke:i,strokeWidth:a,fill:t.props.fill,fillWeight:3})),St(e,t.lastDrawable),e.fillStrokeShape(n)}}),this.shape.on("dragstart",(function(){t.isDragging=!0})),this.shape.on("dragend",(function(){t.isDragging=!1}))}},{key:"setFillColor",value:function(t){this.props.fill=t}},{key:"getFillColor",value:function(){return this.props.fill}},{key:"setStrokeWidth",value:function(t){Zt(Nt(i.prototype),"setStrokeWidth",this).call(this,t/2)}},{key:"getStrokeWidth",value:function(){return 2*Zt(Nt(i.prototype),"getStrokeWidth",this).call(this)}},{key:"scale",value:function(t){Zt(Nt(i.prototype),"scale",this).call(this,t)}},{key:"clone",value:function(){var t=this.getStrokeWidth();return new i(It({},this.getCloningProps(),Number.isNaN(t)?{}:{strokeWidth:t},{fill:this.props.fill}))}}])&&Dt(e.prototype,n),r&&Dt(e,r),i}(mt),Ut=n(3710);function Ft(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Yt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Kt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Yt(t,e,n[e])}))}return t}function Xt(t){return function(t){if(Array.isArray(t))return Ft(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return Ft(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ft(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var qt,Vt=function(){var t=new H.Z.Layer;return t.imageSmoothingEnabled(!0),t},$t={cursor:Z.AUTO,shapesLayer:Vt(),anchorsLayer:Vt(),list:[],addingShapeRef:null},Jt=(0,R.Z)((Yt(qt={},"".concat(l),(function(t,e){e.payload.addToLayer(t.shapesLayer,t.anchorsLayer);var n=Xt(t.list).concat([e.payload]);return c().get(e.payload,"type")===F.Z.IMAGE&&G({addedShape:e.payload}),t.shapesLayer.draw(),t.anchorsLayer.draw(),Kt({},t,{list:n})})),Yt(qt,"".concat(k),(function(t,e){var n;t.addingShapeRef&&(null===(n=e.payload)||void 0===n?void 0:n.type)&&t.addingShapeRef.type!==e.payload.type&&t.addingShapeRef.destroy();var r=c().get(e.payload,"type",null),o=c().get(e.payload,"options",null),i=null;switch(r){case F.Z.ARROW:i=_n(void 0,o);break;case F.Z.TEXT:i=Dn(void 0,o);break;case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:case F.Z.SELECT_RECT:i=Zn(void 0,o,r);break;case null:i=null;break;default:console.error("Can't set adding shape for the selected shape type: ".concat(r))}return Kt({},t,{addingShapeRef:i})})),Yt(qt,"".concat(S),(function(t,e){var n=e.payload;return G({addedShape:n}),t})),Yt(qt,"".concat(g),(function(t){return t.list.forEach((function(t){return t.destroy()})),t.shapesLayer.draw(),t.anchorsLayer.draw(),U({}),Kt({},t,{list:[]})})),Yt(qt,"".concat(b),(function(t,e){var n=t.list.find((function(t){return t===e.payload}));n&&n.destroy(),z();var r=t.list.filter((function(t){return t!==e.payload}));return U({deletedShape:n}),Kt({},t,{list:r})})),Yt(qt,"".concat(w),(function(t,e){return t.list.forEach((function(t){t!==e.payload&&t.blur()})),t.anchorsLayer.draw(),t.shapesLayer.draw(),z(),t})),Yt(qt,"".concat(x),(function(t,e){return t.list.forEach((function(t){t.crop(e.payload)})),t.shapesLayer.draw(),t.anchorsLayer.draw(),t})),Yt(qt,"".concat(v),(function(t){var e=t.list.find((function(t){return t.isSelected()}));e&&e.destroy(),t.shapesLayer.draw(),t.anchorsLayer.draw(),z();var n=t.list.filter((function(t){return t!==e}));return U({deletedShape:e}),Kt({},t,{list:n})})),Yt(qt,"".concat(A),(function(t,e){var n=e.payload,r=t.list.find((function(t){return t.isSelected()}));return null===r||void 0===r||r.zIndex(n===Ut.Q.BringToFront?2*t.list.length:0),t})),Yt(qt,"".concat(h),(function(t,e){return Kt({},t,{cursor:e.payload})})),Yt(qt,"".concat(f),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:n.setFillColor(e.payload);break;default:console.error("Can't set stroke color for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t})),Yt(qt,"".concat(d),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case F.Z.ARROW:case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:n.setStrokeColor(e.payload);break;case F.Z.TEXT:n.setFillColor(e.payload);break;default:console.error("Can't set stroke color for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t})),Yt(qt,"".concat(p),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case F.Z.ARROW:case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:n.setStrokeWidth(e.payload);break;default:console.error("Can't set stroke width for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t})),Yt(qt,"".concat(y),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case F.Z.TEXT:n.setFontSize(e.payload);break;default:console.error("Can't set font size for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t.anchorsLayer.draw(),t})),Yt(qt,"".concat(m),(function(t,e){return e.payload&&t.list.forEach((function(t){return t.scale(e.payload)})),t.shapesLayer.draw(),t})),Yt(qt,"".concat(P),(function(t,e){switch(e.payload){case N.SHAPES_LAYER:t.shapesLayer.draw();break;case N.ANCHORS_LAYER:t.anchorsLayer.draw();break;default:t.shapesLayer.draw(),t.anchorsLayer.draw()}return t})),Yt(qt,"".concat(O),(function(t){var e=t.list.find((function(t){return t.isSelected()}));switch(null===e||void 0===e?void 0:e.type){case F.Z.RECT:case F.Z.ELLIPSE:var n=e.getCloningProps(),r=(null===e||void 0===e?void 0:e.type)===F.Z.RECT?Lt:Gt,o=Zn(new r(n));o.addToLayer(t.shapesLayer,t.anchorsLayer);var i=t.list.map((function(t){return t===e?(t.destroy(),o):t}));return t.shapesLayer.draw(),t.anchorsLayer.draw(),G({addedShape:o}),Kt({},t,{list:i});default:console.error("Can't sketchify the selected shape"),console.log(e)}return t})),qt),$t),Qt=(0,u.Z)("SET_SAVE_STAGE"),te=(0,u.Z)("SAVE_STAGE"),ee=(0,u.Z)("COPY_STAGE");function ne(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var re,oe=(0,R.Z)((ne(re={},"".concat(Qt),(function(t,e){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){ne(t,e,n[e])}))}return t}({},t,{instance:e.payload})})),ne(re,"".concat(te),(function(t,e){var n=e.payload;if(!t.instance)throw new Error("SaveStage is not defined");return t.instance.saveFromLayer(n.layer,n.name,n.contentRect),t})),ne(re,"".concat(ee),(function(t,e){var n=e.payload;if(!t.instance)throw new Error("SaveStage is not defined");return t.instance.copyFromLayer(n.layer,n.contentRect),t})),re),{instance:null}),ie=(0,E.UY)({stage:I,shapes:Jt,saveCanvas:oe});function ae(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var se,ce=(0,E.MT)(ie,E.md.apply(void 0,function(t){if(Array.isArray(t))return ae(t)}(se=[])||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(se)||function(t,e){if(t){if("string"===typeof t)return ae(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ae(t,e):void 0}}(se)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()));function ue(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function le(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function he(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fe(t,e,n){return(fe="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=de(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function de(t){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pe(t,e){return null!=e&&"undefined"!==typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function ye(t,e){return!e||"object"!==ge(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ve(t,e){return(ve=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ge=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function be(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=de(t);if(e){var o=de(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ye(this,n)}}var we=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ve(t,e)}(i,t);var e,n,r,o=be(i);function i(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ue(this,i),(e=o.call(this)).type=F.Z.IMAGE,e.onDragMove=function(){var t;null===(t=e.sizeTransform)||void 0===t||t.update(e.getSizePos())},e.onDragMoveAnchor=function(t){var n;null===(n=e.image)||void 0===n||n.setAttrs(t)},e.getSizePos=function(){return{x:e.image.x(),y:e.image.y(),width:e.image.width(),height:e.image.height()}},e.props=n,pe(t,H.Z.Image)?e.image=t:e.image=new H.Z.Image({image:t,draggable:!0,x:n.x,y:n.y,width:n.width,height:n.height}),e}return e=i,(n=[{key:"addToLayer",value:function(t,e){var n;fe(de(i.prototype),"addToLayer",this).call(this,t,e),this.image.on("dragmove",this.onDragMove),this.sizeTransform=new lt(this.getSizePos()),null===(n=this.sizeTransform)||void 0===n||n.setOriginRatio(this.image.width()/this.image.height()),this.sizeTransform.on("_dragmoveanchor",this.onDragMoveAnchor),fe(de(i.prototype),"attachBasicEvents",this).call(this,this.image),t.add(this.image),this.sizeTransform.addToLayer(e)}},{key:"destroy",value:function(){var t;fe(de(i.prototype),"destroy",this).call(this),this.image.destroy(),null===(t=this.sizeTransform)||void 0===t||t.destroy()}},{key:"getSelfRect",value:function(){var t=this.image.getAbsolutePosition(),e=this.image.getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}},{key:"blur",value:function(){var t;fe(de(i.prototype),"blur",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.hide()}},{key:"focus",value:function(){var t;fe(de(i.prototype),"focus",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.show()}},{key:"draggable",value:function(t){var e,n;return null===(e=this.image)||void 0===e||e.setAttr("draggable",t),null===(n=this.image)||void 0===n?void 0:n.getAttr("draggable")}},{key:"zIndex",value:function(t){if(void 0===t)return this.image.zIndex();this.image.zIndex(t)}},{key:"clone",value:function(){return new i(this.image.clone(),function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){he(t,e,n[e])}))}return t}({},this.getSizePos()))}},{key:"initDraw",value:function(t,e){}},{key:"scale",value:function(t){}}])&&le(e.prototype,n),r&&le(e,r),i}(tt);function me(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ke(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Se(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){ke(t,e,n[e])}))}return t}function Pe(t){return function(t){if(Array.isArray(t))return me(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return me(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return me(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ae,Oe={radius:5,stroke:"#855824",fill:"#dddd45",strokeWidth:1},Ee={radius:6,stroke:"#666",fill:"#ddd",strokeWidth:1};!function(t){t.START="start",t.CONTROL="control",t.END="end"}(Ae||(Ae={}));var Re=function(){function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new $,this.on=function(t,e){o.cbMap.set(t,e)};var i=Se({},{x:e,y:n,draggable:!0,visible:!1},Ee);r===Ae.CONTROL&&(i=Se({},i,Oe)),this.anchor=new H.Z.Circle(i),this.originalPosition={x:e,y:n},this.delta={x:0,y:0},this.appliedDelta={x:0,y:0},this.initEvents()}var e,n,r;return e=t,(n=[{key:"initEvents",value:function(){var t=this;this.anchor.on("mouseover",this.cbMap.get("mouseover")),this.anchor.on("mouseout",this.cbMap.get("mouseout")),this.anchor.on("mousedown",this.cbMap.get("mousedown")),this.anchor.on("mouseup",this.cbMap.get("mouseup")),this.anchor.on("dragend",(function(){t.cbMap.call("dragend");var e=t.getPosition();t.originalPosition.x=e.x,t.originalPosition.y=e.y,t.appliedDelta.x=t.delta.x,t.appliedDelta.y=t.delta.y})),this.anchor.on("dragmove",c().throttle((function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var o;(o=t.cbMap).call.apply(o,["dragmove"].concat(Pe(n)))}),50))}},{key:"getAnchor",value:function(){return this.anchor}},{key:"setPosition",value:function(t,e){this.anchor.setAttr("x",t),this.anchor.setAttr("y",e),this.originalPosition.x=t,this.originalPosition.y=e,this.appliedDelta.x=this.delta.x,this.appliedDelta.y=this.delta.y}},{key:"getPosition",value:function(){var t=this.anchor.getAttrs();return{x:t.x,y:t.y}}},{key:"draw",value:function(){this.anchor.draw()}},{key:"setDelta",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.anchor.setAttr("x",this.originalPosition.x+(t-this.appliedDelta.x)),this.anchor.setAttr("y",this.originalPosition.y+(e-this.appliedDelta.y)),this.delta.x=t,this.delta.y=e}},{key:"setAttr",value:function(t,e){this.anchor.setAttr(t,e)}},{key:"visible",value:function(t){this.anchor.visible(t)}},{key:"destroy",value:function(){this.anchor.destroy()}}])&&xe(e.prototype,n),r&&xe(e,r),t}(),Te=function(t,e){var n=0-Math.abs(e.x),r=t.x-e.x,o=t.y-e.y,i=n*r+0*o,a=Math.sqrt(Math.pow(n,2)+Math.pow(0,2))*Math.sqrt(Math.pow(r,2)+Math.pow(o,2));if(0===a)return 0;var s=Math.acos(i/a);return t.y>e.y?2*Math.PI-s:s},je=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))};function Ce(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var _e=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new $,this.moveStart=function(){if(!n.anchors)throw new Error("`this.anchors` is not defined");var t=n.anchors.start.getPosition(),e=n.anchors.end.getPosition(),r=Te(t,e),o=r-n.prevAnchorsPosition.angles.start,i=n.calculateMovedControlPos(n.calculateRotatedControlPos(o,e),"end");n.anchors.control.setPosition(i.x,i.y),n.moveControl(),n.prevAnchorsPosition.start=t,n.prevAnchorsPosition.control=i,n.prevAnchorsPosition.end=e,n.prevAnchorsPosition.angles.start=r,n.prevAnchorsPosition.angles.end=Math.PI+r},this.moveControl=function(){n.cbMap.call("dragmove")},this.moveEnd=function(){if(!n.anchors)throw new Error("`this.anchors` is not defined");var t=n.anchors.start.getPosition(),e=n.anchors.end.getPosition(),r=Te(e,t),o=r-n.prevAnchorsPosition.angles.end,i=n.calculateMovedControlPos(n.calculateRotatedControlPos(o,t),"start");n.anchors.control.setPosition(i.x,i.y),n.moveControl(),n.prevAnchorsPosition.start=t,n.prevAnchorsPosition.control=i,n.prevAnchorsPosition.end=e,n.prevAnchorsPosition.angles.start=Math.PI+r,n.prevAnchorsPosition.angles.end=r},this.onDragEnd=function(){n.cbMap.call("dragend")},this.visible=function(t){var e,r,o;null===(e=n.anchors)||void 0===e||e.start.visible(t),null===(r=n.anchors)||void 0===r||r.control.visible(t),null===(o=n.anchors)||void 0===o||o.end.visible(t)},this.on=function(t,e){n.cbMap.set(t,e)},this.anchorsPosition=e,this.prevAnchorsPosition={start:{x:0,y:0},control:{x:0,y:0},end:{x:0,y:0},angles:{start:c().get(e,"angles.start",0),control:c().get(e,"angles.control",0),end:c().get(e,"angles.end",Math.PI)}}}var e,n,r;return e=t,r=[{key:"defineAnchors",value:function(t,e,n){var r,o,i,a,s,c;return n?(r=n.start.x,o=n.start.y,i=n.control.x,a=n.control.y,s=n.end.x,c=n.end.y):(r=t.width/4,o=t.height/2,i=t.width/2,a=o,s=3*r,c=o,Math.abs(s-r)>e&&(r=i-e/2,s=i+e/2)),{start:new Re(r,o,Ae.START),control:new Re(i,a,Ae.CONTROL),end:new Re(s,c,Ae.END)}}}],(n=[{key:"calculateRotatedControlPos",value:function(t,e){if(!this.anchors)throw new Error("`this.anchors` is not defined");var n=this.anchors.control.getPosition(),r=n.x-e.x,o=n.y-e.y,i=Math.cos(t),a=Math.sin(t),s=o*i+r*a;return{x:r*i-o*a+e.x,y:s+e.y}}},{key:"calculateMovedControlPos",value:function(t,e){if(!this.anchors)throw new Error("`this.anchors` is not defined");var n=je(this.prevAnchorsPosition.start,this.prevAnchorsPosition.end),r=this.anchors.start.getPosition(),o=this.anchors.end.getPosition(),i=je(r,o)/n,a="start"===e?r:o,s=je(t,a),c=(a.x-t.x)/s,u=(a.y-t.y)/s,l=s-s*i;return{x:t.x+l*c,y:t.y+l*u}}},{key:"draw",value:function(){var t,e,n;null===(t=this.anchors)||void 0===t||t.start.draw(),null===(e=this.anchors)||void 0===e||e.control.draw(),null===(n=this.anchors)||void 0===n||n.end.draw(),ce.dispatch(P(N.ANCHORS_LAYER))}},{key:"setAnchors",value:function(e,n){this.anchors=t.defineAnchors(e,n,this.anchorsPosition),this.prevAnchorsPosition.start=this.anchors.start.getPosition(),this.prevAnchorsPosition.control=this.anchors.control.getPosition(),this.prevAnchorsPosition.end=this.anchors.end.getPosition(),this.anchors.start.on("dragmove",this.moveStart),this.anchors.control.on("dragmove",this.moveControl),this.anchors.end.on("dragmove",this.moveEnd),this.anchors.start.on("dragend",this.onDragEnd),this.anchors.control.on("dragend",this.onDragEnd),this.anchors.end.on("dragend",this.onDragEnd)}},{key:"addToLayer",value:function(t){if(!this.anchors)throw new Error("`this.anchors` is not defined");t.add(this.anchors.start.getAnchor()),t.add(this.anchors.control.getAnchor()),t.add(this.anchors.end.getAnchor())}},{key:"getPositions",value:function(){var t;return!this.anchors&&this.anchorsPosition?this.anchorsPosition:{start:this.anchors.start.getPosition(),control:this.anchors.control.getPosition(),end:this.anchors.end.getPosition(),angles:null===(t=this.prevAnchorsPosition)||void 0===t?void 0:t.angles}}},{key:"setAnchorsCoordinates",value:function(t){var e,n,r;this.prevAnchorsPosition.start=t.start,this.prevAnchorsPosition.control=t.control,this.prevAnchorsPosition.end=t.end,null===(e=this.anchors)||void 0===e||e.start.setPosition(t.start.x,t.start.y),null===(n=this.anchors)||void 0===n||n.control.setPosition(t.control.x,t.control.y),null===(r=this.anchors)||void 0===r||r.end.setPosition(t.end.x,t.end.y);var o=Te(t.start,t.end);this.prevAnchorsPosition.angles.start=o,this.prevAnchorsPosition.angles.end=Math.PI+o}},{key:"setDelta",value:function(t,e){var n,r,o;null===(n=this.anchors)||void 0===n||n.start.setDelta(t,e),null===(r=this.anchors)||void 0===r||r.control.setDelta(t,e),null===(o=this.anchors)||void 0===o||o.end.setDelta(t,e)}},{key:"destroy",value:function(){var t,e,n,r,o,i;null===(t=this.anchors)||void 0===t||null===(e=t.start)||void 0===e||e.destroy(),null===(n=this.anchors)||void 0===n||null===(r=n.control)||void 0===r||r.destroy(),null===(o=this.anchors)||void 0===o||null===(i=o.end)||void 0===i||i.destroy()}}])&&Ce(e.prototype,n),r&&Ce(e,r),t}();function Le(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var De=function(t){return t*(Math.PI/180)},Me=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new $,this.on=function(t,e){n.cbMap.set(t,e)},this.arrowHead=new H.Z.Line({lineCap:"round",lineJoin:"round",stroke:e.stroke,strokeWidth:e.strokeWidth,points:t.calculateHeadPoints(e.start,e.control,e.strokeWidth)}),this.arrowHead.on("click",(function(t){n.cbMap.call("click",t)})),this.arrowHead.on("mouseover",(function(t){n.cbMap.call("mouseover",t)})),this.arrowHead.on("mouseout",(function(t){n.cbMap.call("mouseout",t)})),this.delta={x:0,y:0},this.appliedDelta={x:0,y:0}}var e,n,r;return e=t,r=[{key:"calculateHeadPoints",value:function(t,e,n){var r,o={x:0,y:0},i={x:0,y:0},a=t.x-e.x,s=t.y-e.y;0===a?r=t.y<e.y?De(90):De(270):(r=Math.atan(s/a),a>0&&(r+=De(180)));var c=10*n,u=De(Math.min(40,c<20?20:c)),l=Math.min(14,4.5*n),h=u-r;o.x=t.x+l*Math.cos(h),o.y=t.y-l*Math.sin(h);var f=De(90)-(r+u);return i.x=t.x+l*Math.sin(f),i.y=t.y+l*Math.cos(f),[i.x,i.y,t.x,t.y,o.x,o.y]}}],(n=[{key:"update",value:function(e,n,r){this.arrowHead.setPoints(t.calculateHeadPoints(e,n,r)),this.arrowHead.setAttrs({x:0,y:0,strokeWidth:r}),this.arrowHead.draw(),this.appliedDelta.x=this.delta.x,this.appliedDelta.y=this.delta.y}},{key:"draw",value:function(){this.arrowHead.draw()}},{key:"zIndex",value:function(t){var e;null===(e=this.arrowHead)||void 0===e||e.zIndex(t)}},{key:"setDelta",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.arrowHead.setAttr("x",t-this.appliedDelta.x),this.arrowHead.setAttr("y",e-this.appliedDelta.y),this.delta.x=t,this.delta.y=e}},{key:"setAttr",value:function(t,e){this.arrowHead.setAttr(t,e)}},{key:"addToLayer",value:function(t){t.add(this.arrowHead)}},{key:"destroy",value:function(){this.arrowHead.destroy()}}])&&Le(e.prototype,n),r&&Le(e,r),t}();function Ze(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ne(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ie(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function He(t,e,n){return(He="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=We(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function We(t){return(We=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Be(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Ie(t,e,n[e])}))}return t}function ze(t,e){return!e||"object"!==Ue(e)&&"function"!==typeof e?Ze(t):e}function Ge(t,e){return(Ge=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ue=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Fe(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=We(t);if(e){var o=We(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ze(this,n)}}var Ye,Ke=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ge(t,e)}(i,t);var e,n,r,o=Fe(i);function i(t){var e,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this)).type=F.Z.ARROW,n.redrawArrow=function(){var t,e,r,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=n.anchorsGroup.getPositions(),a=n.getPathString(i);null===(t=n.visiblePath)||void 0===t||t.setData(a),null===(e=n.substratePath)||void 0===e||e.setData(a),null===(r=n.arrowHead)||void 0===r||r.update(i.start,i.control,n.props.strokeWidth),o&&ce.dispatch(P())},n.pathMove=function(){var t,e,r;if(!n.substratePath)throw new Error("`this.substratePath` is not defined");var o=n.substratePath.attrs.x,i=n.substratePath.attrs.y;n.anchorsGroup.setDelta(o,i),null===(t=n.visiblePath)||void 0===t||t.setAttrs({x:o,y:i}),null===(e=n.arrowHead)||void 0===e||e.setDelta(o,i),null===(r=n.arrowHead)||void 0===r||r.draw(),n.anchorsGroup.draw()},n.blur=function(){He((e=Ze(n),We(i.prototype)),"blur",e).call(e),n.anchorsGroup.visible(!1)},n.onAnchor=function(t,e){n.anchorsGroup.on(t,e)},n.props=Be({},t),n.anchorsGroup=new _e(n.props.anchorsPosition),n}return e=i,(n=[{key:"initArrowDraw",value:function(t,e){this.substratePath=new H.Z.Path({data:t,stroke:"transparent",strokeWidth:12,draggable:!0}),this.visiblePath=new H.Z.Path({data:t,stroke:this.props.stroke||"red",strokeWidth:this.props.strokeWidth,lineCap:"round",lineJoin:"round"}),this.substratePath.on("dragmove",this.pathMove),this.attachBasicEvents(this.substratePath),e.add(this.visiblePath),e.add(this.substratePath)}},{key:"getPathString",value:function(t){var e=c().get(this.visiblePath,"attrs.x",0),n=c().get(this.visiblePath,"attrs.y",0);return"M".concat(t.start.x-e,",").concat(t.start.y-n," ")+"Q".concat(t.control.x-e,",").concat(t.control.y-n," ")+"".concat(t.end.x-e,",").concat(t.end.y-n)}},{key:"focus",value:function(){He(We(i.prototype),"focus",this).call(this),this.anchorsGroup.visible(!0)}},{key:"addToLayer",value:function(t,e){var n=this;this.anchorsGroup.setAnchors({width:t.parent.attrs.width,height:t.parent.attrs.height},300),this.anchorsGroup.on("dragmove",(function(){return n.redrawArrow(!0)})),this.anchorsGroup.on("dragend",(function(){return n.redrawArrow(!0)}));var r=this.anchorsGroup.getPositions();this.arrowHead=new Me({start:r.start,control:r.control,stroke:this.props.stroke||"red",strokeWidth:this.props.strokeWidth}),this.arrowHead.on("click",this.onClick);var o=this.getPathString(r);this.initArrowDraw(o,t),this.arrowHead.addToLayer(t),this.anchorsGroup.addToLayer(e),this.redrawArrow(),He(We(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"setStrokeColor",value:function(t){var e,n,r,o;null===(e=this.visiblePath)||void 0===e||e.setAttr("stroke",t),null===(n=this.arrowHead)||void 0===n||n.setAttr("stroke",t),this.props.stroke=t,null===(r=this.visiblePath)||void 0===r||r.draw(),null===(o=this.arrowHead)||void 0===o||o.draw()}},{key:"getStrokeColor",value:function(){return this.props.stroke}},{key:"setStrokeWidth",value:function(t){var e;null===(e=this.visiblePath)||void 0===e||e.setAttr("strokeWidth",t),this.props.strokeWidth=t,this.redrawArrow()}},{key:"getSelfRect",value:function(){if(!this.visiblePath)throw new Error("Arrow is not defined");var t=this.visiblePath.getAbsolutePosition(),e=this.visiblePath.getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}},{key:"getStrokeWidth",value:function(){var t;return null===(t=this.visiblePath)||void 0===t?void 0:t.getAttr("strokeWidth")}},{key:"draggable",value:function(t){var e,n;return null===(e=this.substratePath)||void 0===e||e.setAttr("draggable",t),null===(n=this.substratePath)||void 0===n?void 0:n.getAttr("draggable")}},{key:"scale",value:function(t){var e=this.anchorsGroup.getPositions();this.anchorsGroup.setAnchorsCoordinates({start:{x:e.start.x*t.wFactor,y:e.start.y*t.hFactor},control:{x:e.control.x*t.wFactor,y:e.control.y*t.hFactor},end:{x:e.end.x*t.wFactor,y:e.end.y*t.hFactor}}),this.redrawArrow()}},{key:"initDraw",value:function(t,e){this.isSelected()&&this.blur(),this.anchorsGroup.setAnchorsCoordinates({start:{x:e.x,y:e.y},control:{x:(t.x+e.x)/2,y:(t.y+e.y)/2},end:{x:t.x,y:t.y}}),this.redrawArrow(!0)}},{key:"zIndex",value:function(t){var e,n,r,o;if(void 0===t)return null===(o=this.visiblePath)||void 0===o?void 0:o.zIndex();null===(e=this.substratePath)||void 0===e||e.zIndex(t),null===(n=this.visiblePath)||void 0===n||n.zIndex(t),null===(r=this.arrowHead)||void 0===r||r.zIndex(t)}},{key:"crop",value:function(t){var e=this.anchorsGroup.getPositions();this.anchorsGroup.setAnchorsCoordinates({start:{x:e.start.x-t.x,y:e.start.y-t.y},control:{x:e.control.x-t.x,y:e.control.y-t.y},end:{x:e.end.x-t.x,y:e.end.y-t.y}}),this.redrawArrow()}},{key:"clone",value:function(){var t=this.anchorsGroup?this.anchorsGroup.getPositions():this.props.anchorsPosition;return new i(Be({},this.props,{anchorsPosition:t}))}},{key:"destroy",value:function(){var t,e,n,r;He(We(i.prototype),"destroy",this).call(this),null===(t=this.visiblePath)||void 0===t||t.destroy(),null===(e=this.substratePath)||void 0===e||e.destroy(),null===(n=this.arrowHead)||void 0===n||n.destroy(),null===(r=this.anchorsGroup)||void 0===r||r.destroy()}}])&&Ne(e.prototype,n),r&&Ne(e,r),i}(tt);function Xe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t.fontSize="fontSize",t.color="color"}(Ye||(Ye={}));var Ve=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this;Xe(this,t),this.onKeyDown=function(){var t=r.textNode.getAbsoluteScale().x;r.setTextareaWidth(r.textNode.width()*t),r.textArea.style.height="auto",r.textArea.style.height="".concat(r.textArea.scrollHeight+r.textNode.fontSize(),"px")},this.textNode=e,this.textArea=document.createElement("textarea"),this.textArea.value=n,document.body.appendChild(this.textArea),this.textArea.addEventListener("keydown",this.onKeyDown),this.textArea.style.display="none"}var e,n,r;return e=t,(n=[{key:"setTextareaWidth",value:function(t){t||(t=this.textNode.placeholder.length*this.textNode.fontSize());var e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;(e||n)&&(t=Math.ceil(t)),(document.documentMode||/Edge/.test(navigator.userAgent))&&(t+=1),this.textArea.style.width="".concat(t,"px")}},{key:"update",value:function(t){this.textArea.style.display="initial",this.textArea.value=t.value,this.textArea.style.position="absolute",this.textArea.style.top="".concat(t.top,"px"),this.textArea.style.left="".concat(t.left,"px"),this.textArea.style.width="".concat(t.width,"px"),this.textArea.style.height="".concat(t.height,"px"),this.textArea.style.fontSize="".concat(t.fontSize,"px"),this.textArea.style.fontFamily="Lato, Arial",this.textArea.style.border="1px dashed #2196f3",this.textArea.style.padding="0px",this.textArea.style.margin="0px",this.textArea.style.overflow="hidden",this.textArea.style.background="none",this.textArea.style.outline="none",this.textArea.style.resize="none",this.textArea.style.lineHeight=t.lineHeight,this.textArea.style.fontFamily=t.fontFamily,this.textArea.style.transformOrigin="left top",this.textArea.style.textAlign=t.textAlign,this.textArea.style.color=t.color;var e="rotateZ(".concat(t.rotation,"deg)");if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){var n=2+Math.round(t.fontSize/20);e+="translateY(-".concat(n,"px)")}this.textArea.style.transform=e,this.textArea.style.height="auto",this.textArea.style.height=this.textArea.scrollHeight+3+"px"}},{key:"setAttr",value:function(t,e){switch(t){case Ye.fontSize:this.textArea.style.fontSize="".concat(e,"px");break;case Ye.color:this.textArea.style.color=e}}},{key:"focus",value:function(){this.textArea.focus()}},{key:"hide",value:function(){this.textArea.style.display="none"}},{key:"getValue",value:function(){return this.textArea.value}},{key:"destroy",value:function(){var t;this.textArea.removeEventListener("keydown",this.onKeyDown),null===(t=this.textArea.parentNode)||void 0===t||t.removeChild(this.textArea)}}])&&qe(e.prototype,n),r&&qe(e,r),t}();function $e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Je(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Qe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Je(t,e,n[e])}))}return t}var tn=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.makeEditable=function(){var t;n.textNode.hide();var e=null===(t=ce.getState().stage.instance)||void 0===t?void 0:t.absolutePosition();if(!e)throw new Error("Stage is not defined");var r=n.textNode.position();n.textArea.update({value:n.textNode.text(),top:r.y+e.y,left:r.x+e.x,width:n.textNode.width()-2*n.textNode.padding(),height:n.textNode.height()-2*n.textNode.padding()+5,fontSize:n.textNode.fontSize(),lineHeight:n.textNode.lineHeight(),fontFamily:n.textNode.fontFamily(),textAlign:n.textNode.align(),color:n.textNode.fill(),rotation:n.textNode.rotation()}),n.textArea.focus()},this.textNode=new H.Z.Text(Qe({},e,{draggable:!0})),this.textNode.on("transform",(function(){n.textNode.setAttrs({width:n.textNode.width()*n.textNode.scaleX(),scaleX:1})})),this.textArea=new Ve(this.textNode,e.text)}var e,n,r;return e=t,(n=[{key:"blur",value:function(){this.textNode.text(this.textArea.getValue()),this.textArea.hide(),this.textNode.show()}},{key:"setAttr",value:function(t,e){switch(this.textNode.setAttr(t,e),t){case"fontSize":this.textArea.setAttr(Ye.fontSize,e);break;case"fill":this.textArea.setAttr(Ye.color,e)}}},{key:"draggable",value:function(t){return this.textNode.setAttr("draggable",t),this.textNode.getAttr("draggable")}},{key:"on",value:function(t,e){this.textNode.on(t,e)}},{key:"addToLayer",value:function(t){t.add(this.textNode)}},{key:"setPosition",value:function(t,e){this.textNode.setAttrs({x:t,y:e})}},{key:"getPosition",value:function(){return{x:this.textNode.attrs.x,y:this.textNode.attrs.y}}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=this.textNode)||void 0===n?void 0:n.zIndex();null===(e=this.textNode)||void 0===e||e.zIndex(t)}},{key:"getText",value:function(){return this.textNode.attrs.text}},{key:"getRotation",value:function(){return this.textNode.rotation()}},{key:"getAttrs",value:function(){return this.textNode.getAttrs()}},{key:"getNode",value:function(){return this.textNode}},{key:"getSelfRect",value:function(){return Qe({},this.getPosition(),{width:this.textNode.width(),height:this.textNode.height()})}},{key:"destroy",value:function(){var t,e;null===(t=this.textNode)||void 0===t||t.destroy(),null===(e=this.textArea)||void 0===e||e.destroy()}}])&&$e(e.prototype,n),r&&$e(e,r),t}();function en(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function nn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function rn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function on(t,e,n){return(on="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=an(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function an(t){return(an=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function sn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){rn(t,e,n[e])}))}return t}function cn(t,e){return!e||"object"!==ln(e)&&"function"!==typeof e?en(t):e}function un(t,e){return(un=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ln=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function hn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=an(t);if(e){var o=an(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return cn(this,n)}}var fn=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&un(t,e)}(i,t);var e,n,r,o=hn(i);function i(t){var e,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this)).type=F.Z.TEXT,n.focus=function(){var t;on((e=en(n),an(i.prototype)),"focus",e).call(e),null===(t=n.transformer)||void 0===t||t.show()},n.props=sn({},t),n}return e=i,(n=[{key:"addToLayer",value:function(t,e){var n,r=this,o=this.props.x||t.parent.attrs.width/2-100,a=this.props.y||t.parent.attrs.height/2-10;this.textNode=new tn({text:this.props.text||"Some text here",x:o,y:a,fontFamily:"Lato, Arial",fontSize:this.props.fontSize||20,width:this.props.width||200,fill:this.props.fill,rotation:null!==(n=this.props.rotation)&&void 0!==n?n:0}),this.attachBasicEvents(this.textNode),this.textNode.addToLayer(t),this.transformer=new H.Z.Transformer({node:this.textNode.getNode(),enabledAnchors:["middle-left","middle-right"],borderStroke:"#2196f3",anchorStroke:"#2196f3",anchorFill:"#ffffff",borderStrokeWidth:1,anchorStrokeWidth:1,boundBoxFunc:function(t,e){return e.width=Math.max(30,e.width),e}}),this.textNode.on("dblclick",(function(){var t,e;null===(t=r.textNode)||void 0===t||t.makeEditable(),null===(e=r.transformer)||void 0===e||e.hide(),ce.dispatch(P(N.SHAPES_LAYER)),ce.dispatch(P(N.ANCHORS_LAYER))})),this.textNode.on("click",this.focus),this.textNode.on("transform",(function(){ce.dispatch(P(N.SHAPES_LAYER))})),this.transformer.hide(),e.add(this.transformer),on(an(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"setFillColor",value:function(t){var e;null===(e=this.textNode)||void 0===e||e.setAttr("fill",t),this.props.fill=t}},{key:"getFillColor",value:function(){return this.props.fill}},{key:"setFontSize",value:function(t){var e;null===(e=this.textNode)||void 0===e||e.setAttr("fontSize",t),this.props.fontSize=t}},{key:"blur",value:function(){var t,e;on(an(i.prototype),"blur",this).call(this),null===(t=this.textNode)||void 0===t||t.blur(),null===(e=this.transformer)||void 0===e||e.hide()}},{key:"scale",value:function(t){if(!this.textNode)throw new Error("`this.textNode` is not defined");var e=this.textNode.getPosition();this.textNode.setPosition(e.x*t.wFactor,e.y*t.hFactor)}},{key:"setAttrs",value:function(t){var e=this;Object.keys(t).forEach((function(n){var r;null===(r=e.textNode)||void 0===r||r.setAttr(n,t[n])}))}},{key:"crop",value:function(t){if(!this.textNode)throw new Error("`this.textNode` is not defined");var e=this.textNode.getPosition();this.textNode.setPosition(e.x-t.x,e.y-t.y)}},{key:"draggable",value:function(t){var e,n;return null!==(n=null===(e=this.textNode)||void 0===e?void 0:e.draggable(t))&&void 0!==n&&n}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=this.textNode)||void 0===n?void 0:n.zIndex();null===(e=this.textNode)||void 0===e||e.zIndex(t)}},{key:"clone",value:function(){var t,e,n,r,o=null===(t=this.textNode)||void 0===t?void 0:t.getText(),a=null===(e=this.textNode)||void 0===e?void 0:e.getRotation(),s=c().get(null===(n=this.textNode)||void 0===n?void 0:n.getAttrs(),"width");return new i(sn({},this.props,null===(r=this.textNode)||void 0===r?void 0:r.getPosition(),o&&{text:o},a&&{rotation:a},s&&{width:s}))}},{key:"getSelfRect",value:function(){if(!this.textNode)throw new Error("TextNode is not defined");return this.textNode.getSelfRect()}},{key:"initDraw",value:function(t,e){this.setAttrs({x:t.x,y:t.y,rotation:Te(t,e)*(180/Math.PI)}),ce.dispatch(P(N.SHAPES_LAYER))}},{key:"destroy",value:function(){var t,e;on(an(i.prototype),"destroy",this).call(this),null===(t=this.textNode)||void 0===t||t.destroy(),null===(e=this.transformer)||void 0===e||e.destroy()}}])&&nn(e.prototype,n),r&&nn(e,r),i}(tt);function dn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function pn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function yn(t,e,n){return(yn="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=vn(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function vn(t){return(vn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function gn(t,e){return!e||"object"!==wn(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function bn(t,e){return(bn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var wn=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function mn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=vn(t);if(e){var o=vn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return gn(this,n)}}var xn=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bn(t,e)}(i,t);var e,n,r,o=mn(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){pn(t,e,n[e])}))}return t}({},t,{stroke:"#0d87dc",fill:"transparent",strokeWidth:2,dash:[10,5]}))).type=F.Z.SELECT_RECT,e}return e=i,(n=[{key:"blur",value:function(){yn(vn(i.prototype),"blur",this).call(this),this.destroy()}},{key:"scale",value:function(){this.destroy()}}])&&dn(e.prototype,n),r&&dn(e,r),i}(mt);function kn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Sn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Pn(t){return(Pn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function An(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Sn(t,e,n[e])}))}return t}function On(t,e){return!e||"object"!==Rn(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function En(t,e){return(En=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Rn=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Tn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Pn(t);if(e){var o=Pn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return On(this,n)}}var jn=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&En(t,e)}(i,t);var e,n,r,o=Tn(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).type=F.Z.ELLIPSE,e.getSizePos=function(){var t=e.getAttrs(),n=t.x,r=t.y,o=t.radiusX,i=t.radiusY;return{x:n-o,y:r-i,width:2*o,height:2*i}},e.onDragMoveAnchor=function(t){t.x=t.x+t.width/2,t.y=t.y+t.height/2,e.setShapeAttrs(t)},e.props=An({},t),e}return e=i,(n=[{key:"defineShape",value:function(){this.shape=new H.Z.Ellipse({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,dash:this.props.dash,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth,fill:this.props.fill,draggable:!0})}},{key:"getCloningProps",value:function(){var t,e=null===(t=this.shape)||void 0===t?void 0:t.getAttrs();return An({},this.props,e&&{x:e.x-e.radiusX,y:e.y-e.radiusY,width:2*e.radiusX,height:2*e.radiusY,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill})}},{key:"clone",value:function(){var t=this.getCloningProps();return t.x+=t.width/4,t.y+=t.height/4,new i(t)}},{key:"scale",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y,a=r.radiusX,s=r.radiusY;null===(e=this.shape)||void 0===e||e.setAttrs({x:o*t.wFactor,y:i*t.hFactor,width:2*a*t.wFactor,height:2*s*t.hFactor}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"initDraw",value:function(t,e){this.blur();var n=e.x-t.x,r=e.y-t.y;this.setAttrs({x:t.x+n/2,y:t.y+r/2,width:Math.abs(n),height:Math.abs(r)})}}])&&kn(e.prototype,n),r&&kn(e,r),i}(mt),Cn=function(t){t.on("click",(function(t){ce.dispatch(w(t))})),t.on("dragstart",(function(t){ce.dispatch(w(t))})),t.on("mouseover",(function(){var e=ce.getState(),n=e.shapes,r=e.stage;r.isDraggable?t.draggable(!1):t.draggable(!n.addingShapeRef);var o=n.addingShapeRef?Z.AUTO:Z.MOVE;r.isDraggable||ce.dispatch(h(o))})),t.on("mouseout",(function(){ce.getState().stage.isDraggable||ce.dispatch(h(Z.AUTO))}))},_n=function(t,e){var n=t||new Ke({stroke:c().get(e,"strokeColor","green"),strokeWidth:c().get(e,"strokeWidth")});return n.onAnchor("mouseover",(function(){return ce.dispatch(h(Z.POINTER))})),n.onAnchor("mouseout",(function(){return ce.dispatch(h(Z.AUTO))})),Cn(n),n},Ln=function(t){ce.dispatch(l(t))},Dn=function(t,e){var n=t||new fn({fill:c().get(e,"fillColor","green"),fontSize:c().get(e,"fontSize")});return Cn(n),n},Mn=function(t){ce.dispatch(l(t))},Zn=function(t,e,n){var r={stroke:c().get(e,"strokeColor","green"),fill:c().get(e,"fillColor","transparent"),strokeWidth:c().get(e,"strokeWidth",2)},o=function(){if(t)return t;switch(n){case F.Z.RECT:return new mt(r);case F.Z.RECT_ROUGH:return new Lt(r);case F.Z.ELLIPSE:return new jn(r);case F.Z.ELLIPSE_ROUGH:return new Gt(r);case F.Z.SELECT_RECT:return new xn}}();if(!o)throw new Error("rectNode is not defined");return Cn(o),o},Nn=function(t){ce.dispatch(l(t))},In=function(t){switch(t.type){case F.Z.ARROW:Ln(t);break;case F.Z.TEXT:Mn(t);break;case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:case F.Z.SELECT_RECT:Nn(t);break;default:console.error("Can't connect given shape"),console.log(t)}},Hn=function(t,e){switch(t.type){case F.Z.ARROW:!function(t,e){var n=_n(t,e);Ln(n)}(t.clone(),e);break;case F.Z.TEXT:!function(t,e){var n=Dn(t,e);Mn(n)}(t.clone(),e);break;case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:!function(t,e,n){var r=Zn(t,e,n);Nn(r)}(t.clone(),e);break;case F.Z.IMAGE:Wn(t.clone());break;default:console.error("Can't clone and connect given shape"),console.log(t)}},Wn=function(t){Cn(t),ce.dispatch(l(t))},Bn=function(t){var e=ce.getState().stage;if(!e.instance)throw new Error("Stage is not defined");var n=e.instance.absolutePosition(),r=new we(t.image,t.pos?{x:t.pos.x-n.x,y:t.pos.y-n.y}:{x:e.instance.width()/2-t.image.width/2-n.x,y:e.instance.height()/2-t.image.height/2-n.y});Wn(r)},zn="shapes-layer",Gn=n(3274),Un=function(t){navigator.clipboard?navigator.clipboard.writeText(t).then((function(){}),(function(t){console.error("Async: Could not copy text: ",t)})):function(t){var e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();try{document.execCommand("cut")}catch(n){return console.warn("Copy to clipboard failed.",n),!1}finally{document.body.removeChild(e)}}(t)},Fn=function(t){var e=document.createElement("img");e.src=t;var n=document.createElement("div");n.contentEditable="true",n.appendChild(e),document.body.appendChild(n),function(t){if(!window.getSelection)throw new Error("Can't select text");var e=window.getSelection(),n=document.createRange();n.selectNodeContents(t),null===e||void 0===e||e.removeAllRanges(),null===e||void 0===e||e.addRange(n)}(n),document.execCommand("Copy"),document.body.removeChild(n)};function Yn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Kn(t){return function(t){if(Array.isArray(t))return Yn(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return Yn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yn(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Xn={onDelete:["backspace","delete","del"],onCopy:["ctrl+c","command+c"],onPaste:["ctrl+v","command+v"],onActivateDrag:{sequence:"space",action:"keydown"},onDisableDrag:{sequence:"space",action:"keyup"},onActivateRatio:{sequence:"shift",action:"keydown"},onDisableRatio:{sequence:"shift",action:"keyup"}},qn=function(){var t=(0,a.useRef)([]);(0,a.useEffect)((function(){var t=c().throttle((function(){e(),n()}),50);return window.addEventListener("focus",t,{capture:!0}),function(){window.removeEventListener("focus",t)}}),[]);var e=function(){var t=ce.getState().shapes;ce.dispatch(C(!1)),t.list.forEach((function(t){t.draggable(!0)})),ce.dispatch(h(Z.AUTO))},n=function(){ce.dispatch(_(!1))};return(0,i.jsx)(Gn.GlobalHotKeys,{keyMap:Xn,handlers:{onDelete:function(){ce.dispatch(v()),ce.dispatch(h(Z.AUTO))},onCopy:function(){var e=ce.getState().shapes;Un("[Shape]"),t.current=e.list.reduce((function(t,e){return e.isSelected()?Kn(t).concat([e.clone()]):t}),[])},onPaste:function(){ce.dispatch(w()),t.current.forEach((function(t){Hn(t)})),t.current=[]},onActivateDrag:function(){var t=ce.getState().shapes;ce.dispatch(C(!0)),t.list.forEach((function(t){t.draggable(!1)})),ce.dispatch(h(Z.GRAB))},onDisableDrag:e,onActivateRatio:function(){ce.dispatch(_(!0))},onDisableRatio:n}})},Vn=n(96),$n=n.n(Vn),Jn=function(t){var e=t.children,n=(0,a.useState)(Z.AUTO),r=n[0],o=n[1],s=(0,a.useRef)(c().throttle((function(){ce.dispatch(j({width:window.innerWidth,height:window.innerHeight}))}),80)),u=(0,a.useRef)((function(){var t=ce.getState().shapes;o(t.cursor)}));return(0,a.useEffect)((function(){window.addEventListener("resize",s.current);var t=ce.subscribe(u.current);return function(){window.removeEventListener("resize",s.current),t()}}),[]),(0,i.jsx)("div",{style:{cursor:r},className:$n().CanvasWrapper,children:e})};function Qn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var tr=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cbMap=new $,this.handleClick=function(t){ce.getState().shapes.addingShapeRef||ce.dispatch(w())},this.handleMouseDown=function(t){n.cbMap.call("mousedown",t)},this.handleMouseUp=function(t){n.cbMap.call("mouseup",t)},this.handleMouseMove=function(t){n.cbMap.call("mousemove",t)},this.stage=new H.Z.Stage({container:e,width:window.innerWidth,height:window.innerHeight});var r=ce.getState().shapes;this.add(r.shapesLayer),this.add(r.anchorsLayer);try{r.shapesLayer.getCanvas()._canvas.classList.add(zn),r.anchorsLayer.getCanvas()._canvas.classList.add("anchors-layer")}catch(o){console.error("Can't set className to the canvas"),console.error(o)}this.stage.on("mousedown",this.handleMouseDown),this.stage.on("mouseup",this.handleMouseUp),this.stage.on("mousemove",this.handleMouseMove),this.stage.on("click",this.handleClick)}var e,n,r;return e=t,(n=[{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"add",value:function(t){this.stage.add(t)}},{key:"setAttrs",value:function(t){this.stage.setAttrs(t)}},{key:"draggable",value:function(t){if(void 0===t)return this.stage.draggable();this.stage.draggable(t)}},{key:"absolutePosition",value:function(t){if(void 0===t)return this.stage.absolutePosition();this.stage.absolutePosition(t)}},{key:"getBoundingClientRect",value:function(){return this.stage.container().getBoundingClientRect()}},{key:"toDataURL",value:function(){return this.stage.toDataURL()}},{key:"getPos",value:function(){return{x:this.stage.x(),y:this.stage.y()}}},{key:"width",value:function(){return this.stage.width()}},{key:"height",value:function(){return this.stage.height()}},{key:"getContentBoundariesRect",value:function(){var t=ce.getState().shapes.list;if(0===t.length)return{x:0,y:0,width:0,height:0};var e={xTopLeft:1/0,yTopLeft:1/0,xBottomRight:-1/0,yBottomRight:-1/0},n=t.reduce((function(t,e){var n=e.getSelfRect(),r=n.x+n.width,o=n.y+n.height;return{xTopLeft:n.x<t.xTopLeft?n.x:t.xTopLeft,yTopLeft:n.y<t.yTopLeft?n.y:t.yTopLeft,xBottomRight:r>t.xBottomRight?r:t.xBottomRight,yBottomRight:o>t.yBottomRight?o:t.yBottomRight}}),e);return{x:n.xTopLeft,y:n.yTopLeft,width:n.xBottomRight-n.xTopLeft,height:n.yBottomRight-n.yTopLeft}}}])&&Qn(e.prototype,n),r&&Qn(e,r),t}();var er=function(t,e){var n=function(t){var e=t.split(",");if(e[0]){var n=e[0].match(/:(.*?);/);if(n){for(var r=n[1],o=atob(e[1]),i=o.length,a=new Uint8Array(i);i--;)a[i]=o.charCodeAt(i);return new Blob([a],{type:r})}}return null}(t);if(!n)throw new Error("blob data is null");var r=document.createElement("a"),o=URL.createObjectURL(n);r.download=e.replace(/(\.[^.]+)$/gi,"")+".png",r.href=o,r.click()};function nr(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}function rr(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){nr(i,r,o,a,s,"next",t)}function s(t){nr(i,r,o,a,s,"throw",t)}a(void 0)}))}}function or(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ir=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stage=new H.Z.Stage({container:e,width:10,height:10})}var e,n,r;return e=t,r=[{key:"normPosAxis",value:function(t){return t<0?Math.abs(t):0}}],(n=[{key:"trimLayer",value:function(e,n){var r=this,o=e.clone();return this.stage.add(o),this.stage.setAttrs({width:t.normPosAxis(n.x)+n.width+60,height:t.normPosAxis(n.y)+n.height+60,x:-1*n.x+30,y:-1*n.y+30}),new Promise((function(t,e){var n=r;setTimeout((function(){var r=n,i=o.getCanvas()._canvas;!function(t){var e,n,r,o,i,a,s,c,u,l,h,f,d;if(r=t.canvas.width,o=t.canvas.height,!r&&!o)return!1;for(d=t.getImageData(0,0,r,o),u=new Uint32Array(d.data.buffer),l=0,h=r*o-1,f=!1,n=0;n<o&&!f;n+=1){for(e=0;e<r;e+=1){if(u[l++]&&!i&&(i=n+1,c)){f=!0;break}if(u[h--]&&!c&&(c=o-n-1,i)){f=!0;break}}if(n>o-n&&!i&&!c)return!1}for(i-=1,f=!1,e=0;e<r&&!f;e+=1)for(l=i*r+e,h=i*r+(r-e-1),n=i;n<=c;n+=1){if(u[l]&&!a&&(a=e+1,s)){f=!0;break}if(u[h]&&!s&&(s=r-e-1,a)){f=!0;break}l+=r,h+=r}return r===s-(a-=1)+1&&o===c-i+1||(r=s-a+1,o=c-i+1,t.canvas.width=r,t.canvas.height=o,t.putImageData(d,-a,-i)),!0}(i.getContext("2d"))?e(new Error("Can't trim given context")):t(i),setTimeout((function(){r.stage.getLayers().forEach((function(t){return t.destroy()}))}),1e3)}))}))}},{key:"saveFromLayer",value:function(t,e,n){var r=this;return rr(o().mark((function i(){var a,s;return o().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,r.trimLayer(t,n);case 2:a=o.sent,s=a.toDataURL(),er(s,e);case 5:case"end":return o.stop()}}),i)})))()}},{key:"copyFromLayer",value:function(t,e){var n=this;return rr(o().mark((function r(){var i,a,s,c;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(null===window||void 0===window||null===(i=window.navigator)||void 0===i||null===(a=i.clipboard)||void 0===a?void 0:a.write)){r.next=8;break}return r.next=4,n.trimLayer(t,e);case 4:r.sent.toBlob((function(t){var e=new ClipboardItem({"image/png":t});navigator.clipboard.write([e])})),r.next=13;break;case 8:return r.next=10,n.trimLayer(t,e);case 10:s=r.sent,c=s.toDataURL(),Fn(c);case 13:case"end":return r.stop()}}),r)})))()}}])&&or(e.prototype,n),r&&or(e,r),t}(),ar=n(1908),sr=n.n(ar),cr=function(){var t=(0,a.useRef)(null);return(0,a.useEffect)((function(){ce.dispatch(Qt(new ir(t.current)))}),[]),(0,i.jsx)("div",{ref:t,className:sr().SaveCanvasEl})},ur=function(t){var e=t.shape,n=t.startPos,r=t.currentPos;if(t.ratioShiftIsActive&&e.type!==F.Z.ARROW&&e.type!==F.Z.TEXT){var o=r.x-n.x,i=r.y-n.y,a=Math.min(Math.abs(o),Math.abs(i));e.initDraw(n,{x:n.x+Math.sign(o)*a,y:n.y+Math.sign(i)*a})}else e.initDraw(n,r)},lr=function(){return{startAddingShape:function(t){ce.dispatch(w());var e=t.type,n=t.options;switch(e){case F.Z.TEXT:case F.Z.ARROW:case F.Z.RECT:case F.Z.RECT_ROUGH:case F.Z.ELLIPSE:case F.Z.ELLIPSE_ROUGH:case F.Z.SELECT_RECT:ce.dispatch(k({type:e,options:n}));break;case null:ce.dispatch(k({type:null}));break;default:throw new Error("Given shape type can't be added: ".concat(e))}},setImage:function(t){Bn(t)},setFillColorToActiveShape:function(t){ce.dispatch(f(t))},setStrokeColorToActiveShape:function(t){ce.dispatch(d(t))},setStrokeWidthToActiveShape:function(t){ce.dispatch(p(t))},setFontSizeToActiveShape:function(t){ce.dispatch(y(t))},exportCanvasToImage:function(t){var e=ce.getState(),n=e.shapes,r=e.stage;if(!r.instance)throw new Error("Stage instance is not defined");ce.dispatch(te({layer:n.shapesLayer,name:t,contentRect:r.instance.getContentBoundariesRect()}))},copyAllToClipboard:function(){var t=ce.getState(),e=t.stage,n=t.shapes;if(!e.instance)throw new Error("Stage instance is not defined");ce.dispatch(ee({layer:n.shapesLayer,contentRect:e.instance.getContentBoundariesRect()}))},blurShapes:function(){ce.dispatch(w())},sketchifyActiveShape:function(){ce.dispatch(O())},getShapesAmount:function(){return new Promise((function(t){requestAnimationFrame((function(){var e=ce.getState().shapes;t(e.list.length)}))}))},changeOrderOfActiveShape:function(t){ce.dispatch(A(t))},initBlankCanvas:function(t){if(!ce.getState().stage.instance)throw new Error('"instance" is not defined on stage. It looks like stage is not initialized yet.');(function(t,e,n){var r=document.createElement("svg");return r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("width",String(t)),r.setAttribute("height",String(e)),r.setAttribute("style","background-color:".concat(n)),new Promise((function(t,e){var n=new Image,o=new Blob([r.outerHTML],{type:"image/svg+xml"}),i=URL.createObjectURL(o);n.onload=function(){URL.revokeObjectURL(i),t(this)},n.onerror=e,n.src=i}))})(t.width,t.height,"#cdcdcd").then((function(t){Bn({image:t,name:"Blank canvas"})}))},onShapeClicked:B("SHAPE_CLICKED"),onShapeDragStarted:B("SHAPE_DRAG_STARTED"),onShapeBlurred:B("SHAPES_BLURRED"),onShapeAdded:B("SHAPE_ADDED"),onShapeDeleted:B("SHAPE_DELETED")}},hr=n(5170),fr=n.n(hr),dr=n(7214);function pr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vr(t){return(vr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function gr(t,e){return!e||"object"!==wr(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function br(t,e){return(br=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var wr=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function mr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=vr(t);if(e){var o=vr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return gr(this,n)}}var xr=function(){var t=(0,dr.R2)(".".concat(zn));if(t)return t;throw new Error("Shapes layer is not found")},kr=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&br(t,e)}(s,t);var e,n,r,o=mr(s);function s(){var t;return pr(this,s),(t=o.apply(this,arguments)).canvasRef=a.createRef(),t.state={mouseIsDown:!1,mouseStartPos:{x:0,y:0}},t.handleStageOnMouseDown=function(e){var n=ce.getState(),r=n.shapes,o=n.stage;if(r.addingShapeRef&&o.instance){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY,u={x:s-i.x,y:c-i.y};t.setState({mouseIsDown:!0,mouseStartPos:u}),In(r.addingShapeRef),r.addingShapeRef.initDraw(u,u)}},t.handleStageOnMouseUp=function(e){t.setState({mouseIsDown:!1});var n=ce.getState(),r=n.shapes,o=n.stage;if(r.addingShapeRef){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY,u=je({x:s-i.x,y:c-i.y},t.state.mouseStartPos);r.addingShapeRef.type===F.Z.TEXT||u>10?(r.addingShapeRef.focus(),ce.dispatch(S(r.addingShapeRef))):ce.dispatch(b(r.addingShapeRef)),requestAnimationFrame((function(){ce.dispatch(k())}))}},t.handleStageOnMouseMove=function(e){var n=ce.getState(),r=n.shapes,o=n.stage;if(t.state.mouseIsDown&&r.addingShapeRef&&o.instance){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY;ur({shape:r.addingShapeRef,startPos:t.state.mouseStartPos,currentPos:{x:s-i.x,y:c-i.y},ratioShiftIsActive:o.ratioShiftIsActive})}},t}return e=s,(n=[{key:"componentDidMount",value:function(){if(this.canvasRef.current){var t=new tr(this.canvasRef.current);t.on("mousedown",this.handleStageOnMouseDown),t.on("mouseup",this.handleStageOnMouseUp),t.on("mousemove",this.handleStageOnMouseMove),ce.dispatch(T(t)),this.canvasRef.current.tabIndex=1,this.props.onReady(lr())}}},{key:"render",value:function(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(Jn,{children:[(0,i.jsx)(qn,{}),(0,i.jsx)("div",{ref:this.canvasRef,className:fr().CanvasEl})]}),(0,i.jsx)(cr,{})]})}}])&&yr(e.prototype,n),r&&yr(e,r),s}(a.PureComponent),Sr=n(8523),Pr=n(484),Ar=n(27),Or=n(5968),Er=n(3489),Rr=n(3425),Tr=n(4440);function jr(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}function Cr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _r=function(t){var e=t.children,n=(0,a.useContext)(Or.z),r=n.state,s=r.menu,c=r.canvas.canvasApi,u=n.dispatch,l=function(){var t,e=(t=o().mark((function t(e,n,r){var i,a,l,h,f,d,p,y;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=!1,!(e.length>0)){t.next=34;break}a=!0,l=!1,h=void 0,t.prev=3,f=e[Symbol.iterator]();case 5:if(a=(d=f.next()).done){t.next=20;break}if((p=d.value).type.startsWith("image")){t.next=12;break}return u((0,Er.c)({message:(0,Rr.t)("image-type-error"),type:Tr.k.Error})),Ar.qP({eventCategory:Ar.Ak.Error,eventAction:"image type error (".concat(p.type,")")}),i=!0,t.abrupt("continue",17);case 12:return t.next=14,(0,Pr.Z)(p);case 14:y=t.sent,null===c||void 0===c||c.blurShapes(),null===c||void 0===c||c.setImage({image:y.image,name:y.name,pos:{x:r.clientX-y.image.width/2,y:r.clientY-s.menuHeight-y.image.height/2}});case 17:a=!0,t.next=5;break;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(3),l=!0,h=t.t0;case 26:t.prev=26,t.prev=27,a||null==f.return||f.return();case 29:if(t.prev=29,!l){t.next=32;break}throw h;case 32:return t.finish(29);case 33:return t.finish(26);case 34:i||Ar.qP({eventCategory:Ar.Ak.GlobalInteraction,eventAction:Ar.UZ.DropImage});case 35:case"end":return t.stop()}}),t,null,[[3,22,26,34],[27,,29,33]])})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){jr(i,r,o,a,s,"next",t)}function s(t){jr(i,r,o,a,s,"throw",t)}a(void 0)}))});return function(t,n,r){return e.apply(this,arguments)}}();return(0,i.jsx)(Sr.ZP,{onDrop:l,children:function(t){var n=t.getRootProps;return(0,i.jsx)("div",function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Cr(t,e,n[e])}))}return t}({},n(),{children:e}))}})},Lr=n(4801),Dr=n.n(Lr),Mr=function(){return(0,i.jsx)("div",{className:Dr().HowToStart,children:(0,Rr.t)("how-to-start")})},Zr=n(4753),Nr=n(1664),Ir=n(1163),Hr=n(1386),Wr=n.n(Hr),Br=n(8944),zr=function(){var t=(0,Ir.useRouter)().query,e=(0,a.useState)(""),n=e[0],r=e[1];return(0,a.useEffect)((function(){r((0,Br.W)(t))}),[t]),(0,i.jsxs)("div",{className:Wr().Tips,children:["Psst...",(0,i.jsx)("br",{}),"You can add as many images as you want.",(0,i.jsx)("br",{}),"To read more about this feature\xa0",(0,i.jsx)(Nr.default,{href:"/features".concat(n),passHref:!0,children:(0,i.jsx)("a",{onClick:function(){Ar.qP({eventCategory:Ar.Ak.Content,eventAction:Ar.UZ.FeaturesPage})},children:"click here"})}),(0,i.jsx)("br",{})]})};function Gr(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}var Ur=function(){var t=(0,a.useState)(!1),e=t[0],n=t[1],r=(0,a.useContext)(Or.z),s=r.state.canvas.canvasApi,u=r.dispatch,l=function(t){var e=(t.clipboardData||t.originalEvent.clipboardData).items,n=Array.from(e).find((function(t){return 0===t.type.indexOf("image")}));if(n){var r=n.getAsFile(),o=new Image;if(!r)throw new Error("blob data is null");var i=URL.createObjectURL(r);o.onload=function(){URL.revokeObjectURL(i),null===s||void 0===s||s.setImage({image:this,name:""})},o.onerror=function(t){console.error(t)},o.src=i}},h=function(){var t,e=(t=o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=5;break}return t.next=3,s.getShapesAmount();case 3:e=t.sent,n(e>0);case 5:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Gr(i,r,o,a,s,"next",t)}function s(t){Gr(i,r,o,a,s,"throw",t)}a(void 0)}))});return function(){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){(0,dr.Oo)("paste",l);var t=c().noop,e=c().noop;return s&&(t=s.onShapeAdded(h),e=s.onShapeDeleted(h),h()),function(){(0,dr.xg)("paste",l),t(),e(),null===s||void 0===s||s.blurShapes()}}),[s]),(0,i.jsxs)(_r,{children:[!e&&(0,i.jsx)(Mr,{}),(0,i.jsx)(kr,{onReady:function(t){u((0,Zr.T)(t))}}),!e&&(0,i.jsx)(zr,{})]})}},4801:function(t){t.exports={HowToStart:"HowToStart_HowToStart__U_ZpN"}},1386:function(t){t.exports={Tips:"Tips_Tips__YAVcx"}},5170:function(t){t.exports={CanvasEl:"CanvasEl_CanvasEl__olqIr"}},96:function(t){t.exports={CanvasWrapper:"CanvasWrapper_CanvasWrapper__JUeAG"}},1908:function(t){t.exports={SaveCanvasEl:"SaveCanvasEl_SaveCanvasEl__iEaxT"}}}]);