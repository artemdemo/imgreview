(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79],{5711:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return ui}});var r=n(4051),o=n.n(r),i=n(5893),a=n(7294),s=n(6486),c=n.n(s),u=n(8231),l=(0,u.Z)("ADD_SHAPE"),h=(0,u.Z)("SET_CURSOR"),f=(0,u.Z)("SET_STROKE_COLOR_TO_ACTIVE_SHAPE"),d=(0,u.Z)("SET_STROKE_WIDTH_TO_ACTIVE_SHAPE"),p=(0,u.Z)("SET_FONT_SIZE_TO_ACTIVE_SHAPE"),y=(0,u.Z)("DELETE_ACTIVE_SHAPES"),v=(0,u.Z)("DELETE_ALL_SHAPES"),g=(0,u.Z)("DELETE_SHAPE"),w=(0,u.Z)("BLUR_SHAPES"),b=(0,u.Z)("SCALE_SHAPES"),m=(0,u.Z)("CROP_SHAPES"),k=(0,u.Z)("SET_ADDING_SHAPE"),S=(0,u.Z)("SHAPE_ADDED"),E=(0,u.Z)("DRAW_LAYERS"),x=(0,u.Z)("CHANGE_ORDER_OF_ACTIVE_SHAPE"),O=(0,u.Z)("SKETCHIFY_ACTIVE_SHAPE"),P=n(9569),A=n(3620),T=(0,u.Z)("SET_STAGE"),R=(0,u.Z)("SET_STAGE_SIZE"),j=(0,u.Z)("SET_STAGE_DRAGGABLE"),L=(0,u.Z)("SET_RATIO_SHIFT");function C(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){C(t,e,n[e])}))}return t}var M,D,W,Z=(0,A.Z)((C(M={},"".concat(T),(function(t,e){return _({},t,{instance:e.payload})})),C(M,"".concat(R),(function(t,e){var n,r=e.payload,o=r.width,i=r.height;return null===(n=t.instance)||void 0===n||n.setAttrs({width:o,height:i}),t})),C(M,"".concat(j),(function(t,e){var n,r=e.payload;return null===(n=t.instance)||void 0===n||n.draggable(r),_({},t,{isDraggable:r})})),C(M,"".concat(L),(function(t,e){var n,r=e.payload;return null===(n=t.instance)||void 0===n||n.draggable(r),_({},t,{ratioShiftIsActive:r})})),M),{instance:null,isDraggable:!1,ratioShiftIsActive:!1}),I=n(9649);!function(t){t.AUTO="auto",t.MOVE="move",t.POINTER="pointer",t.GRAB="grab"}(D||(D={})),function(t){t.SHAPES_LAYER="shapes_layer",t.ANCHORS_LAYER="anchors_layer"}(W||(W={}));var B=(0,n(8111).i)(),H=function(t){return function(e){return B.on(t,e)}},z=function(t){B.emit("SHAPES_BLURRED",t)},U=function(t){B.emit("SHAPE_ADDED",t)},F=function(t){B.emit("SHAPE_DELETED",t)},G=n(8176),Y=n(4247);function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function K(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function X(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function V(t){return function(t){if(Array.isArray(t))return N(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return N(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return N(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var q=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),$.set(this,{writable:!0,value:new Map})}var e,n,r;return e=t,(n=[{key:"set",value:function(t,e){K(this,$).set(t,e)}},{key:"call",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=K(this,$).get(t);o&&o.apply(void 0,V(n))}},{key:"get",value:function(t){var e=K(this,$).get(t);return null!==e&&void 0!==e?e:c().noop}},{key:"has",value:function(t){return K(this,$).has(t)}}])&&X(e.prototype,n),r&&X(e,r),t}(),$=new WeakMap;function J(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function Q(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var tt,et=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),nt.set(this,{writable:!0,value:!1}),this.type=G.Z.SHAPE,this.cbMap=new q,this.onClick=function(t){var n;Ie.getState().shapes.addingShapeRef||(n=e,B.emit("SHAPE_CLICKED",n),t.cancelBubble=!0,e.focus(),e.cbMap.call("click",e))},this.onDragStart=function(){var t;t=e,B.emit("SHAPE_DRAG_STARTED",t),e.focus(),e.cbMap.call("dragstart",e)}}var e,n,r;return e=t,(n=[{key:"blur",value:function(){J(this,nt,!1)}},{key:"focus",value:function(){J(this,nt,!0)}},{key:"isSelected",value:function(){return function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}(this,nt)}},{key:"on",value:function(t,e){this.cbMap.set(t,e)}},{key:"addToLayer",value:function(t,e){this.focus()}},{key:"clone",value:function(){console.warn("clone() is not implemented"),console.warn(this)}},{key:"crop",value:function(t){console.warn("crop() is not implemented"),console.warn(this)}},{key:"draggable",value:function(t){console.warn("draggable() is not implemented"),console.warn(this)}},{key:"attachBasicEvents",value:function(t){var e=this;t.on("click",this.onClick),t.on("dragstart",this.onDragStart),t.on("mouseover",(function(){e.cbMap.call("mouseover",e)})),t.on("mouseout",(function(){e.cbMap.call("mouseout",e)}))}},{key:"destroy",value:function(){this.cbMap.call("_beforedestroy",this)}}])&&Q(e.prototype,n),r&&Q(e,r),t}(),nt=new WeakMap,rt=et;function ot(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function it(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function at(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function st(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t.left="left",t.top="top",t.right="right",t.bottom="bottom",t.leftTop="leftTop",t.leftBottom="leftBottom",t.rightTop="rightTop",t.rightBottom="rightBottom"}(tt||(tt={}));var ct={width:10,height:10,stroke:"#2196f3",strokeWidth:1,fill:"#ffffff",draggable:!0},ut=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),lt.set(this,{writable:!0,value:new q}),ht.set(this,{writable:!0,value:void 0}),ft.set(this,{writable:!0,value:void 0}),this.onDragMove=function(t){ot(n,lt).call("dragmove",ot(n,ft).type,t)},it(this,ft,e),it(this,ht,new I.Z.Rect(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){st(t,e,n[e])}))}return t}({},ct,{x:e.x-ct.width/2,y:e.y-ct.height/2,dragBoundFunc:function(t){return{x:t.x,y:t.y}}}))),ot(this,ht).on("dragmove",this.onDragMove)}var e,n,r;return e=t,(n=[{key:"show",value:function(){ot(this,ht).visible(!0)}},{key:"hide",value:function(){ot(this,ht).visible(!1)}},{key:"on",value:function(t,e){ot(this,lt).set(t,e)}},{key:"getPos",value:function(){var t=ot(this,ht).getAttrs();return{x:t.x+ct.width/2,y:t.y+ct.height/2}}},{key:"setPos",value:function(t){var e=this.getPos(),n=t.x||e.x,r=t.y||e.y;ot(this,ht).setAttrs({x:n-ct.width/2,y:r-ct.height/2})}},{key:"addToLayer",value:function(t){t.add(ot(this,ht))}},{key:"destroy",value:function(){ot(this,ht).destroy()}}])&&at(e.prototype,n),r&&at(e,r),t}(),lt=new WeakMap,ht=new WeakMap,ft=new WeakMap,dt=ut;function pt(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function yt(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function vt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function gt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function wt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){gt(t,e,n[e])}))}return t}var bt=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),mt.set(this,{writable:!0,value:new q}),kt.set(this,{writable:!0,value:void 0}),St.set(this,{writable:!0,value:1}),this.onMoveAnchor=function(t,e){var r=Ie.getState().stage.ratioShiftIsActive,o=e.evt,i=o.layerX,a=o.layerY,s=n.getCurrentAnchor(t),c=r?{x:i,y:a}:s.getPos(),u=n.getOppositeAnchor(t).getPos(),l=c.x-u.x,h=c.y-u.y,f=Math.min(Math.abs(l/pt(n,St)),Math.abs(h));r&&(c={x:u.x+Math.sign(l)*f*pt(n,St),y:u.y+Math.sign(h)*f},s.setPos(c));var d=n.getNeighborAnchors(t);d.neighborX.setPos({x:c.x}),d.neighborY.setPos({y:c.y});var p=n.getLeftTopPos();pt(n,mt).call("dragmove",{x:p.x,y:p.y,width:Math.abs(r?f*pt(n,St):l),height:Math.abs(r?f:h)})},yt(this,kt,{leftTop:new dt(wt({},t.calcAnchorPosition(tt.leftTop,e),{type:tt.leftTop})),rightTop:new dt(wt({},t.calcAnchorPosition(tt.rightTop,e),{type:tt.rightTop})),rightBottom:new dt(wt({},t.calcAnchorPosition(tt.rightBottom,e),{type:tt.rightBottom})),leftBottom:new dt(wt({},t.calcAnchorPosition(tt.leftBottom,e),{type:tt.leftBottom}))}),pt(this,kt).leftTop.on("dragmove",this.onMoveAnchor),pt(this,kt).rightTop.on("dragmove",this.onMoveAnchor),pt(this,kt).rightBottom.on("dragmove",this.onMoveAnchor),pt(this,kt).leftBottom.on("dragmove",this.onMoveAnchor)}var e,n,r;return e=t,r=[{key:"calcAnchorPosition",value:function(t,e){switch(t){case tt.left:return{x:e.x,y:e.y+e.height/2};case tt.top:return{x:e.x+e.width/2,y:e.y};case tt.right:return{x:e.x+e.width,y:e.y+e.height/2};case tt.bottom:return{x:e.x+e.width/2,y:e.y+e.height};case tt.leftTop:return{x:e.x,y:e.y};case tt.rightTop:return{x:e.x+e.width,y:e.y};case tt.rightBottom:return{x:e.x+e.width,y:e.y+e.height};case tt.leftBottom:return{x:e.x,y:e.y+e.height};default:throw new Error("Position can't be calculated for given type: ".concat(t))}}}],(n=[{key:"getCurrentAnchor",value:function(t){switch(t){case tt.leftTop:return pt(this,kt).leftTop;case tt.leftBottom:return pt(this,kt).leftBottom;case tt.rightTop:return pt(this,kt).rightTop;case tt.rightBottom:return pt(this,kt).rightBottom;default:throw new Error("Can't find anchor for provided type. Given ".concat(t))}}},{key:"getOppositeAnchor",value:function(t){switch(t){case tt.leftTop:return pt(this,kt).rightBottom;case tt.leftBottom:return pt(this,kt).rightTop;case tt.rightTop:return pt(this,kt).leftBottom;case tt.rightBottom:return pt(this,kt).leftTop;default:throw new Error("Can't find anchor for provided type. Given ".concat(t))}}},{key:"getNeighborAnchors",value:function(t){switch(t){case tt.leftTop:return{neighborX:pt(this,kt).leftBottom,neighborY:pt(this,kt).rightTop};case tt.leftBottom:return{neighborX:pt(this,kt).leftTop,neighborY:pt(this,kt).rightBottom};case tt.rightTop:return{neighborX:pt(this,kt).rightBottom,neighborY:pt(this,kt).leftTop};case tt.rightBottom:return{neighborX:pt(this,kt).rightTop,neighborY:pt(this,kt).leftBottom};default:throw new Error("Width and height can't be calculated for the given type: ".concat(t))}}},{key:"getLeftTopPos",value:function(){var t=this;return Object.keys(pt(this,kt)).reduce((function(e,n){var r=pt(t,kt)[n].getPos();return r.x<e.x||r.y<e.y?r:e}),{x:1/0,y:1/0})}},{key:"setOriginRatio",value:function(t){yt(this,St,t)}},{key:"on",value:function(t,e){pt(this,mt).set(t,e)}},{key:"updatePosition",value:function(e){pt(this,kt).leftTop.setPos(t.calcAnchorPosition(tt.leftTop,e)),pt(this,kt).rightTop.setPos(t.calcAnchorPosition(tt.rightTop,e)),pt(this,kt).rightBottom.setPos(t.calcAnchorPosition(tt.rightBottom,e)),pt(this,kt).leftBottom.setPos(t.calcAnchorPosition(tt.leftBottom,e))}},{key:"show",value:function(){pt(this,kt).leftTop.show(),pt(this,kt).rightTop.show(),pt(this,kt).rightBottom.show(),pt(this,kt).leftBottom.show()}},{key:"hide",value:function(){pt(this,kt).leftTop.hide(),pt(this,kt).rightTop.hide(),pt(this,kt).rightBottom.hide(),pt(this,kt).leftBottom.hide()}},{key:"addToLayer",value:function(t){pt(this,kt).leftTop.addToLayer(t),pt(this,kt).rightTop.addToLayer(t),pt(this,kt).rightBottom.addToLayer(t),pt(this,kt).leftBottom.addToLayer(t)}},{key:"destroy",value:function(){pt(this,kt).leftTop.destroy(),pt(this,kt).rightTop.destroy(),pt(this,kt).rightBottom.destroy(),pt(this,kt).leftBottom.destroy()}}])&&vt(e.prototype,n),r&&vt(e,r),t}(),mt=new WeakMap,kt=new WeakMap,St=new WeakMap,Et=bt;function xt(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function Ot(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Pt=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),At.set(this,{writable:!0,value:new q}),Tt.set(this,{writable:!0,value:void 0}),this.onDragMove=function(t){var e="_dragmoveanchor";if(xt(n,At).call(e,t),!xt(n,At).has(e))throw new Error('"'.concat(e,'" should be defined'))},function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}(this,Tt,new Et(e)),xt(this,Tt).on("dragmove",this.onDragMove)}var e,n,r;return e=t,(n=[{key:"setOriginRatio",value:function(t){xt(this,Tt).setOriginRatio(t)}},{key:"on",value:function(t,e){xt(this,At).set(t,e)}},{key:"update",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];xt(this,Tt).updatePosition(t),e&&Ie.dispatch(E(W.ANCHORS_LAYER))}},{key:"addToLayer",value:function(t){xt(this,Tt).addToLayer(t)}},{key:"show",value:function(){xt(this,Tt).show()}},{key:"hide",value:function(){xt(this,Tt).hide()}},{key:"destroy",value:function(){xt(this,Tt).destroy()}}])&&Ot(e.prototype,n),r&&Ot(e,r),t}(),At=new WeakMap,Tt=new WeakMap,Rt=Pt;function jt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Lt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ct(t,e,n){return(Ct="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_t(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function _t(t){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Lt(t,e,n[e])}))}return t}function Dt(t,e){return!e||"object"!==Zt(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Wt(t,e){return(Wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Zt=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function It(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=_t(t);if(e){var o=_t(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Dt(this,n)}}var Bt=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Wt(t,e)}(i,t);var e,n,r,o=It(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this)).type=G.Z.RECT,e.onDragMove=function(t){var n;e.cbMap.call("dragmove",t),null===(n=e.sizeTransform)||void 0===n||n.update(e.getSizePos())},e.getSizePos=function(){var t=e.getAttrs();return{x:t.x,y:t.y,width:t.width,height:t.height}},e.onDragMoveAnchor=function(t){e.setShapeAttrs(t)},e.props=Mt({},t),e}return e=i,(n=[{key:"defineShape",value:function(){this.shape=new I.Z.Rect({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,dash:this.props.dash,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth,fill:this.props.fill,draggable:!0})}},{key:"addToLayer",value:function(t,e){this.defineShape(),this.shape.on("dragmove",this.onDragMove),Ct(_t(i.prototype),"attachBasicEvents",this).call(this,this.shape),this.sizeTransform=new Rt(this.getSizePos()),this.sizeTransform.on("_dragmoveanchor",this.onDragMoveAnchor),t.add(this.shape),this.sizeTransform.addToLayer(e),Ct(_t(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"blur",value:function(){var t;Ct(_t(i.prototype),"blur",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.hide()}},{key:"focus",value:function(){var t;Ct(_t(i.prototype),"focus",this).call(this),null===(t=this.sizeTransform)||void 0===t||t.show()}},{key:"getFillColor",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("fill")}},{key:"setFillColor",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttr("fill",t)}},{key:"getStrokeColor",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("stroke")}},{key:"getAttrs",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttrs()}},{key:"hide",value:function(){var t;null===(t=this.shape)||void 0===t||t.setAttrs({stroke:"transparent"})}},{key:"setShapeAttrs",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttrs(t),Ie.dispatch(E(W.SHAPES_LAYER))}},{key:"setAttrs",value:function(t){var e;this.setShapeAttrs(t),null===(e=this.sizeTransform)||void 0===e||e.update(this.getSizePos())}},{key:"setStrokeColor",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttr("stroke",t)}},{key:"setStrokeWidth",value:function(t){var e;null===(e=this.shape)||void 0===e||e.setAttrs({strokeWidth:t})}},{key:"getStrokeWidth",value:function(){var t;return null===(t=this.shape)||void 0===t?void 0:t.getAttr("strokeWidth")}},{key:"getSelfRect",value:function(){if(!this.shape)throw new Error("Shape is not defined");var t=this.shape.getAbsolutePosition(),e=this.shape.getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}},{key:"draggable",value:function(t){var e,n;if(void 0===t)return null===(n=this.shape)||void 0===n?void 0:n.draggable();null===(e=this.shape)||void 0===e||e.draggable(t)}},{key:"scale",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y,a=r.width,s=r.height;null===(e=this.shape)||void 0===e||e.setAttrs({x:o*t.wFactor,y:i*t.hFactor,width:a*t.wFactor,height:s*t.hFactor}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"getCloningProps",value:function(){var t,e=null===(t=this.shape)||void 0===t?void 0:t.getAttrs();return Mt({},this.props,e&&{x:e.x,y:e.y,width:e.width,height:e.height,stroke:e.stroke,strokeWidth:e.strokeWidth})}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=this.shape)||void 0===n?void 0:n.zIndex();null===(e=this.shape)||void 0===e||e.zIndex(t)}},{key:"crop",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y;null===(e=this.shape)||void 0===e||e.setAttrs({x:o-t.x,y:i-t.y}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"clone",value:function(){return new i(this.getCloningProps())}},{key:"initDraw",value:function(t,e){this.type===G.Z.RECT&&this.blur(),this.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y})}},{key:"destroy",value:function(){var t,e;Ct(_t(i.prototype),"destroy",this).call(this),null===(t=this.shape)||void 0===t||t.destroy(),null===(e=this.sizeTransform)||void 0===e||e.destroy()}}])&&jt(e.prototype,n),r&&jt(e,r),i}(rt),Ht=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nonzero";t.beginPath();var r=!0,o=!1,i=void 0;try{for(var a,s=e.ops[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value,u=c.data;switch(c.op){case"move":t.moveTo(u[0],u[1]);break;case"bcurveTo":t.bezierCurveTo(u[0],u[1],u[2],u[3],u[4],u[5]);break;case"lineTo":t.lineTo(u[0],u[1])}}}catch(l){o=!0,i=l}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}"fillPath"===e.type?t.fill(n):t.stroke()},zt=function(t,e,n){var r=n.fillWeight;r<0&&(r=n.strokeWidth/2),t.save(),n.fillLineDash&&t.setLineDash(n.fillLineDash),n.fillLineDashOffset&&(t.lineDashOffset=n.fillLineDashOffset),t.strokeStyle=n.fill||"",t.lineWidth=r,Ht(t,e),t.restore()},Ut=function(t,e){var n=e.sets||[],r=e.options,o=!0,i=!1,a=void 0;try{for(var s,c=n[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var u=s.value;switch(u.type){case"path":t.save(),t.strokeStyle="none"===r.stroke?"transparent":r.stroke,t.lineWidth=r.strokeWidth,r.strokeLineDash&&t.setLineDash(r.strokeLineDash),r.strokeLineDashOffset&&(t.lineDashOffset=r.strokeLineDashOffset),Ht(t,u),t.restore();break;case"fillPath":t.save(),t.fillStyle=r.fill||"";var l="curve"===e.shape||"polygon"===e.shape?"evenodd":"nonzero";Ht(t,u,l),t.restore();break;case"fillSketch":zt(t,u,r)}}}catch(h){i=!0,a=h}finally{try{o||null==c.return||c.return()}finally{if(i)throw a}}};function Ft(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Gt(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function Yt(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function Nt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Kt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Xt(t,e,n){return(Xt="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Vt(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Vt(t){return(Vt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qt(t,e){return!e||"object"!==Jt(e)&&"function"!==typeof e?Ft(t):e}function $t(t,e){return($t=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Jt=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Qt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Vt(t);if(e){var o=Vt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return qt(this,n)}}var te=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$t(t,e)}(i,t);var e,n,r,o=Qt(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),e=o.call(this,t),ee.set(Ft(e),{writable:!0,value:void 0}),ne.set(Ft(e),{writable:!0,value:void 0}),re.set(Ft(e),{writable:!0,value:!1}),e.type=G.Z.RECT_ROUGH,e.prevWidth=0,e.prevHeight=0,e.onDragMoveSubRect=function(t){var n,r;e.cbMap.call("dragmove",t);var o=e.getSizePosSubRect();null===(n=e.sizeTransform)||void 0===n||n.update(o),null===(r=e.shape)||void 0===r||r.setAttrs(o)},e.onDragMoveAnchor=function(t){var n;null===(n=e.substrateKonvaShape)||void 0===n||n.setAttrs(t),e.setShapeAttrs(t)},e.getSizePosSubRect=function(){var t,n=null===(t=e.substrateKonvaShape)||void 0===t?void 0:t.getAttrs();return{x:n.x,y:n.y,width:n.width,height:n.height}},e.props=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Kt(t,e,n[e])}))}return t}({},t);var n=qo();return Yt(Ft(e),ee,Y.Z.canvas(n)),e}return e=i,(n=[{key:"defineShape",value:function(){var t=this;this.shape=new I.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:function(e,n){var r=n.getWidth(),o=n.getHeight(),i=n.getStroke(),a=n.getStrokeWidth();r===t.prevWidth&&o===t.prevHeight&&Gt(t,ne)?(Gt(t,ne).options.stroke=i,Gt(t,ne).options.strokeWidth=a):(t.prevWidth=r,t.prevHeight=o,Yt(t,ne,Gt(t,ee).generator.rectangle(0,0,r,o,{roughness:2.5,stroke:i,strokeWidth:a}))),Ut(e,Gt(t,ne)),e.fillStrokeShape(n)}}),this.substrateKonvaShape=new I.Z.Rect({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:"transparent",fill:"transparent",draggable:!0}),this.shape.on("dragstart",(function(){Yt(t,re,!0)})),this.shape.on("dragend",(function(){Yt(t,re,!1)})),this.substrateKonvaShape.on("dragstart",(function(){Yt(t,re,!0)})),this.substrateKonvaShape.on("dragend",(function(){Yt(t,re,!1)})),this.substrateKonvaShape.on("click",(function(e){t.onClick(e)})),this.substrateKonvaShape.on("dragstart",(function(){t.onDragStart()})),this.substrateKonvaShape.on("mouseover",(function(){t.cbMap.call("mouseover")})),this.substrateKonvaShape.on("mouseout",(function(){t.cbMap.call("mouseout")}))}},{key:"setStrokeWidth",value:function(t){Xt(Vt(i.prototype),"setStrokeWidth",this).call(this,t/2)}},{key:"getStrokeWidth",value:function(){return 2*Xt(Vt(i.prototype),"getStrokeWidth",this).call(this)}},{key:"addToLayer",value:function(t,e){if(Xt(Vt(i.prototype),"addToLayer",this).call(this,t,e),!this.substrateKonvaShape)throw new Error("`this.substrateKonvaShape` is not defined");this.substrateKonvaShape.on("dragmove",this.onDragMoveSubRect),t.add(this.substrateKonvaShape)}},{key:"draggable",value:function(t){var e,n=Xt(Vt(i.prototype),"draggable",this).call(this,t);return null===(e=this.substrateKonvaShape)||void 0===e||e.setAttr("draggable",t),n}},{key:"initDraw",value:function(t,e){var n;null===(n=this.substrateKonvaShape)||void 0===n||n.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y}),Xt(Vt(i.prototype),"initDraw",this).call(this,t,e)}},{key:"destroy",value:function(){var t;Xt(Vt(i.prototype),"destroy",this).call(this),null===(t=this.substrateKonvaShape)||void 0===t||t.destroy()}},{key:"scale",value:function(t){var e;Xt(Vt(i.prototype),"scale",this).call(this,t);var n=this.getAttrs(),r=n.x,o=n.y,a=n.width,s=n.height;null===(e=this.substrateKonvaShape)||void 0===e||e.setAttrs({x:r,y:o,width:a,height:s})}},{key:"crop",value:function(t){var e;Xt(Vt(i.prototype),"crop",this).call(this,t);var n=this.getAttrs(),r=n.x,o=n.y;null===(e=this.substrateKonvaShape)||void 0===e||e.setAttrs({x:r,y:o})}},{key:"clone",value:function(){return new i(this.getCloningProps())}}])&&Nt(e.prototype,n),r&&Nt(e,r),i}(Bt),ee=new WeakMap,ne=new WeakMap,re=new WeakMap,oe=te;function ie(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ae(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function se(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function ce(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ue(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function le(t,e,n){return(le="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=he(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function he(t){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function fe(t,e){return!e||"object"!==pe(e)&&"function"!==typeof e?ie(t):e}function de(t,e){return(de=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var pe=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function ye(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=he(t);if(e){var o=he(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return fe(this,n)}}var ve=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&de(t,e)}(i,t);var e,n,r,o=ye(i);function i(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),e=o.call(this,t),ge.set(ie(e),{writable:!0,value:void 0}),we.set(ie(e),{writable:!0,value:void 0}),be.set(ie(e),{writable:!0,value:!1}),e.type=G.Z.ELLIPSE_ROUGH,e.prevWidth=0,e.prevHeight=0,e.props=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){ue(t,e,n[e])}))}return t}({},t);var n=qo();return se(ie(e),ge,Y.Z.canvas(n)),e}return e=i,(n=[{key:"defineShape",value:function(){var t=this;this.shape=new I.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:function(e,n){var r=n.getWidth(),o=n.getHeight();r===t.prevWidth&&o===t.prevHeight&&ae(t,we)?ae(t,we).options.stroke=n.getStroke():(t.prevWidth=r,t.prevHeight=o,se(t,we,ae(t,ge).generator.ellipse(r/2,o/2,r,o,{roughness:2.5,stroke:n.getStroke()}))),Ut(e,ae(t,we)),e.fillStrokeShape(n)}}),this.shape.on("dragstart",(function(){se(t,be,!0)})),this.shape.on("dragend",(function(){se(t,be,!1)}))}},{key:"setStrokeWidth",value:function(t){le(he(i.prototype),"setStrokeWidth",this).call(this,t/2)}},{key:"getStrokeWidth",value:function(){return 2*le(he(i.prototype),"getStrokeWidth",this).call(this)}},{key:"scale",value:function(t){le(he(i.prototype),"scale",this).call(this,t)}},{key:"clone",value:function(){return new i(this.getCloningProps())}}])&&ce(e.prototype,n),r&&ce(e,r),i}(Bt),ge=new WeakMap,we=new WeakMap,be=new WeakMap,me=ve,ke=n(3710);function Se(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ee(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Ee(t,e,n[e])}))}return t}function Oe(t){return function(t){if(Array.isArray(t))return Se(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return Se(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Se(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Pe,Ae={cursor:D.AUTO,shapesLayer:new I.Z.Layer,anchorsLayer:new I.Z.Layer,list:[],addingShapeRef:null},Te=(0,A.Z)((Ee(Pe={},"".concat(l),(function(t,e){e.payload.addToLayer(t.shapesLayer,t.anchorsLayer);var n=Oe(t.list).concat([e.payload]);return c().get(e.payload,"type")===G.Z.IMAGE&&U({addedShape:e.payload}),t.shapesLayer.draw(),t.anchorsLayer.draw(),xe({},t,{list:n})})),Ee(Pe,"".concat(k),(function(t,e){var n;t.addingShapeRef&&(null===(n=e.payload)||void 0===n?void 0:n.type)&&t.addingShapeRef.type!==e.payload.type&&t.addingShapeRef.destroy();var r=c().get(e.payload,"type",null),o=c().get(e.payload,"options",null),i=null;switch(r){case G.Z.ARROW:i=so(void 0,o);break;case G.Z.TEXT:i=uo(void 0,o);break;case G.Z.RECT:case G.Z.RECT_ROUGH:case G.Z.ELLIPSE:case G.Z.ELLIPSE_ROUGH:case G.Z.SELECT_RECT:i=ho(void 0,o,r);break;case null:i=null;break;default:console.error("Can't set adding shape for the selected shape type: ".concat(r))}return xe({},t,{addingShapeRef:i})})),Ee(Pe,"".concat(S),(function(t,e){var n=e.payload;return U({addedShape:n}),t})),Ee(Pe,"".concat(v),(function(t){return t.list.forEach((function(t){return t.destroy()})),t.shapesLayer.draw(),t.anchorsLayer.draw(),F({}),xe({},t,{list:[]})})),Ee(Pe,"".concat(g),(function(t,e){var n=t.list.find((function(t){return t===e.payload}));n&&n.destroy(),z();var r=t.list.filter((function(t){return t!==e.payload}));return F({deletedShape:n}),xe({},t,{list:r})})),Ee(Pe,"".concat(w),(function(t,e){return t.list.forEach((function(t){t!==e.payload&&t.blur()})),t.anchorsLayer.draw(),t.shapesLayer.draw(),z(),t})),Ee(Pe,"".concat(m),(function(t,e){return t.list.forEach((function(t){t.crop(e.payload)})),t.shapesLayer.draw(),t.anchorsLayer.draw(),t})),Ee(Pe,"".concat(y),(function(t){var e=t.list.find((function(t){return t.isSelected()}));e&&e.destroy(),t.shapesLayer.draw(),t.anchorsLayer.draw(),z();var n=t.list.filter((function(t){return t!==e}));return F({deletedShape:e}),xe({},t,{list:n})})),Ee(Pe,"".concat(x),(function(t,e){var n=e.payload,r=t.list.find((function(t){return t.isSelected()}));return null===r||void 0===r||r.zIndex(n===ke.Q.BringToFront?2*t.list.length:0),t})),Ee(Pe,"".concat(h),(function(t,e){return xe({},t,{cursor:e.payload})})),Ee(Pe,"".concat(f),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case G.Z.ARROW:case G.Z.RECT:case G.Z.RECT_ROUGH:case G.Z.ELLIPSE:case G.Z.ELLIPSE_ROUGH:n.setStrokeColor(e.payload);break;case G.Z.TEXT:n.setFillColor(e.payload);break;default:console.error("Can't set stroke color for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t})),Ee(Pe,"".concat(d),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case G.Z.ARROW:case G.Z.RECT:case G.Z.RECT_ROUGH:case G.Z.ELLIPSE:case G.Z.ELLIPSE_ROUGH:n.setStrokeWidth(e.payload);break;default:console.error("Can't set stroke width for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t})),Ee(Pe,"".concat(p),(function(t,e){var n=t.list.find((function(t){return t.isSelected()}));switch(null===n||void 0===n?void 0:n.type){case G.Z.TEXT:n.setFontSize(e.payload);break;default:console.error("Can't set font size for the selected shape"),console.log(n)}return t.shapesLayer.draw(),t.anchorsLayer.draw(),t})),Ee(Pe,"".concat(b),(function(t,e){return e.payload&&t.list.forEach((function(t){return t.scale(e.payload)})),t.shapesLayer.draw(),t})),Ee(Pe,"".concat(E),(function(t,e){switch(e.payload){case W.SHAPES_LAYER:t.shapesLayer.draw();break;case W.ANCHORS_LAYER:t.anchorsLayer.draw();break;default:t.shapesLayer.draw(),t.anchorsLayer.draw()}return t})),Ee(Pe,"".concat(O),(function(t){var e=t.list.find((function(t){return t.isSelected()}));switch(null===e||void 0===e?void 0:e.type){case G.Z.RECT:case G.Z.ELLIPSE:var n=e.getCloningProps(),r=(null===e||void 0===e?void 0:e.type)===G.Z.RECT?oe:me,o=ho(new r(n));o.addToLayer(t.shapesLayer,t.anchorsLayer);var i=t.list.map((function(t){return t===e?(t.destroy(),o):t}));return t.shapesLayer.draw(),t.anchorsLayer.draw(),U({addedShape:o}),xe({},t,{list:i});default:console.error("Can't sketchify the selected shape"),console.log(e)}return t})),Pe),Ae),Re=(0,u.Z)("SET_SAVE_STAGE"),je=(0,u.Z)("SAVE_STAGE"),Le=(0,u.Z)("COPY_STAGE");function Ce(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _e,Me=(0,A.Z)((Ce(_e={},"".concat(Re),(function(t,e){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Ce(t,e,n[e])}))}return t}({},t,{instance:e.payload})})),Ce(_e,"".concat(je),(function(t,e){var n=e.payload;if(!t.instance)throw new Error("SaveStage is not defined");return t.instance.saveFromLayer(n.layer,n.name,n.contentRect),t})),Ce(_e,"".concat(Le),(function(t,e){var n=e.payload;if(!t.instance)throw new Error("SaveStage is not defined");return t.instance.copyFromLayer(n.layer,n.contentRect),t})),_e),{instance:null}),De=(0,P.UY)({stage:Z,shapes:Te,saveCanvas:Me});function We(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ze,Ie=(0,P.MT)(De,P.md.apply(void 0,function(t){if(Array.isArray(t))return We(t)}(Ze=[])||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(Ze)||function(t,e){if(t){if("string"===typeof t)return We(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?We(t,e):void 0}}(Ze)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()));function Be(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function He(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ze(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function Ue(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function Fe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ge(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ye(t,e,n){return(Ye="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ne(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Ne(t){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ke(t,e){return null!=e&&"undefined"!==typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e}function Xe(t,e){return!e||"object"!==qe(e)&&"function"!==typeof e?Be(t):e}function Ve(t,e){return(Ve=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var qe=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function $e(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ne(t);if(e){var o=Ne(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Xe(this,n)}}var Je=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ve(t,e)}(i,t);var e,n,r,o=$e(i);function i(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return He(this,i),e=o.call(this),Qe.set(Be(e),{writable:!0,value:void 0}),tn.set(Be(e),{writable:!0,value:void 0}),en.set(Be(e),{writable:!0,value:void 0}),e.type=G.Z.IMAGE,e.onDragMove=function(){var t;null===(t=ze(Be(e),en))||void 0===t||t.update(e.getSizePos())},e.onDragMoveAnchor=function(t){var n;null===(n=ze(Be(e),Qe))||void 0===n||n.setAttrs(t)},e.getSizePos=function(){return{x:ze(e,Qe).x(),y:ze(e,Qe).y(),width:ze(e,Qe).width(),height:ze(e,Qe).height()}},Ue(Be(e),tn,n),Ke(t,I.Z.Image)?Ue(Be(e),Qe,t):Ue(Be(e),Qe,new I.Z.Image({image:t,draggable:!0,x:n.x,y:n.y,width:n.width,height:n.height})),e}return e=i,(n=[{key:"addToLayer",value:function(t,e){var n;Ye(Ne(i.prototype),"addToLayer",this).call(this,t,e),ze(this,Qe).on("dragmove",this.onDragMove),Ue(this,en,new Rt(this.getSizePos())),null===(n=ze(this,en))||void 0===n||n.setOriginRatio(ze(this,Qe).width()/ze(this,Qe).height()),ze(this,en).on("_dragmoveanchor",this.onDragMoveAnchor),Ye(Ne(i.prototype),"attachBasicEvents",this).call(this,ze(this,Qe)),t.add(ze(this,Qe)),ze(this,en).addToLayer(e)}},{key:"destroy",value:function(){var t;Ye(Ne(i.prototype),"destroy",this).call(this),ze(this,Qe).destroy(),null===(t=ze(this,en))||void 0===t||t.destroy()}},{key:"getSelfRect",value:function(){var t=ze(this,Qe).getAbsolutePosition(),e=ze(this,Qe).getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}},{key:"blur",value:function(){var t;Ye(Ne(i.prototype),"blur",this).call(this),null===(t=ze(this,en))||void 0===t||t.hide()}},{key:"focus",value:function(){var t;Ye(Ne(i.prototype),"focus",this).call(this),null===(t=ze(this,en))||void 0===t||t.show()}},{key:"draggable",value:function(t){var e,n;return null===(e=ze(this,Qe))||void 0===e||e.setAttr("draggable",t),null===(n=ze(this,Qe))||void 0===n?void 0:n.getAttr("draggable")}},{key:"zIndex",value:function(t){if(void 0===t)return ze(this,Qe).zIndex();ze(this,Qe).zIndex(t)}},{key:"clone",value:function(){return new i(ze(this,Qe).clone(),function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Ge(t,e,n[e])}))}return t}({},this.getSizePos()))}},{key:"initDraw",value:function(t,e){}},{key:"scale",value:function(t){}}])&&Fe(e.prototype,n),r&&Fe(e,r),i}(rt),Qe=new WeakMap,tn=new WeakMap,en=new WeakMap,nn=Je;function rn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function on(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function an(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function sn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function cn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function un(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){cn(t,e,n[e])}))}return t}function ln(t){return function(t){if(Array.isArray(t))return rn(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return rn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rn(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var hn,fn={radius:5,stroke:"#855824",fill:"#dddd45",strokeWidth:1},dn={radius:6,stroke:"#666",fill:"#ddd",strokeWidth:1};!function(t){t.START="start",t.CONTROL="control",t.END="end"}(hn||(hn={}));var pn=function(){function t(e,n,r){var o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),yn.set(this,{writable:!0,value:void 0}),vn.set(this,{writable:!0,value:new q}),gn.set(this,{writable:!0,value:void 0}),wn.set(this,{writable:!0,value:void 0}),bn.set(this,{writable:!0,value:void 0}),this.on=function(t,e){on(o,vn).set(t,e)};var i=un({},{x:e,y:n,draggable:!0,visible:!1},dn);r===hn.CONTROL&&(i=un({},i,fn)),an(this,yn,new I.Z.Circle(i)),an(this,bn,{x:e,y:n}),an(this,gn,{x:0,y:0}),an(this,wn,{x:0,y:0}),this.initEvents()}var e,n,r;return e=t,(n=[{key:"initEvents",value:function(){var t=this;on(this,yn).on("mouseover",on(this,vn).get("mouseover")),on(this,yn).on("mouseout",on(this,vn).get("mouseout")),on(this,yn).on("mousedown",on(this,vn).get("mousedown")),on(this,yn).on("mouseup",on(this,vn).get("mouseup")),on(this,yn).on("dragend",(function(){on(t,vn).call("dragend");var e=t.getPosition();on(t,bn).x=e.x,on(t,bn).y=e.y,on(t,wn).x=on(t,gn).x,on(t,wn).y=on(t,gn).y})),on(this,yn).on("dragmove",c().throttle((function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var o;(o=on(t,vn)).call.apply(o,["dragmove"].concat(ln(n)))}),50))}},{key:"getAnchor",value:function(){return on(this,yn)}},{key:"setPosition",value:function(t,e){on(this,yn).setAttr("x",t),on(this,yn).setAttr("y",e),on(this,bn).x=t,on(this,bn).y=e,on(this,wn).x=on(this,gn).x,on(this,wn).y=on(this,gn).y}},{key:"getPosition",value:function(){var t=on(this,yn).getAttrs();return{x:t.x,y:t.y}}},{key:"draw",value:function(){on(this,yn).draw()}},{key:"setDelta",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;on(this,yn).setAttr("x",on(this,bn).x+(t-on(this,wn).x)),on(this,yn).setAttr("y",on(this,bn).y+(e-on(this,wn).y)),on(this,gn).x=t,on(this,gn).y=e}},{key:"setAttr",value:function(t,e){on(this,yn).setAttr(t,e)}},{key:"visible",value:function(t){on(this,yn).visible(t)}},{key:"destroy",value:function(){on(this,yn).destroy()}}])&&sn(e.prototype,n),r&&sn(e,r),t}(),yn=new WeakMap,vn=new WeakMap,gn=new WeakMap,wn=new WeakMap,bn=new WeakMap,mn=pn,kn=function(t,e){var n=0-Math.abs(e.x),r=t.x-e.x,o=t.y-e.y,i=n*r+0*o,a=Math.sqrt(Math.pow(n,2)+Math.pow(0,2))*Math.sqrt(Math.pow(r,2)+Math.pow(o,2));if(0===a)return 0;var s=Math.acos(i/a);return t.y>e.y?2*Math.PI-s:s},Sn=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))};function En(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function xn(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function On(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Pn=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),An.set(this,{writable:!0,value:void 0}),Tn.set(this,{writable:!0,value:void 0}),Rn.set(this,{writable:!0,value:void 0}),jn.set(this,{writable:!0,value:new q}),this.moveStart=function(){if(!En(n,An))throw new Error("`this.#anchors` is not defined");var t=En(n,An).start.getPosition(),e=En(n,An).end.getPosition(),r=kn(t,e),o=r-En(n,Rn).angles.start,i=n.calculateMovedControlPos(n.calculateRotatedControlPos(o,e),"end");En(n,An).control.setPosition(i.x,i.y),n.moveControl(),En(n,Rn).start=t,En(n,Rn).control=i,En(n,Rn).end=e,En(n,Rn).angles.start=r,En(n,Rn).angles.end=Math.PI+r},this.moveControl=function(){En(n,jn).call("dragmove")},this.moveEnd=function(){if(!En(n,An))throw new Error("`this.#anchors` is not defined");var t=En(n,An).start.getPosition(),e=En(n,An).end.getPosition(),r=kn(e,t),o=r-En(n,Rn).angles.end,i=n.calculateMovedControlPos(n.calculateRotatedControlPos(o,t),"start");En(n,An).control.setPosition(i.x,i.y),n.moveControl(),En(n,Rn).start=t,En(n,Rn).control=i,En(n,Rn).end=e,En(n,Rn).angles.start=Math.PI+r,En(n,Rn).angles.end=r},this.onDragEnd=function(){En(n,jn).call("dragend")},this.visible=function(t){var e,r,o;null===(e=En(n,An))||void 0===e||e.start.visible(t),null===(r=En(n,An))||void 0===r||r.control.visible(t),null===(o=En(n,An))||void 0===o||o.end.visible(t)},this.on=function(t,e){En(n,jn).set(t,e)},xn(this,Tn,e),xn(this,Rn,{start:{x:0,y:0},control:{x:0,y:0},end:{x:0,y:0},angles:{start:c().get(e,"angles.start",0),control:c().get(e,"angles.control",0),end:c().get(e,"angles.end",Math.PI)}})}var e,n,r;return e=t,r=[{key:"defineAnchors",value:function(t,e,n){var r,o,i,a,s,c;return n?(r=n.start.x,o=n.start.y,i=n.control.x,a=n.control.y,s=n.end.x,c=n.end.y):(r=t.width/4,o=t.height/2,i=t.width/2,a=o,s=3*r,c=o,Math.abs(s-r)>e&&(r=i-e/2,s=i+e/2)),{start:new mn(r,o,hn.START),control:new mn(i,a,hn.CONTROL),end:new mn(s,c,hn.END)}}}],(n=[{key:"calculateRotatedControlPos",value:function(t,e){if(!En(this,An))throw new Error("`this.#anchors` is not defined");var n=En(this,An).control.getPosition(),r=n.x-e.x,o=n.y-e.y,i=Math.cos(t),a=Math.sin(t),s=o*i+r*a;return{x:r*i-o*a+e.x,y:s+e.y}}},{key:"calculateMovedControlPos",value:function(t,e){if(!En(this,An))throw new Error("`this.#anchors` is not defined");var n=Sn(En(this,Rn).start,En(this,Rn).end),r=En(this,An).start.getPosition(),o=En(this,An).end.getPosition(),i=Sn(r,o)/n,a="start"===e?r:o,s=Sn(t,a),c=(a.x-t.x)/s,u=(a.y-t.y)/s,l=s-s*i;return{x:t.x+l*c,y:t.y+l*u}}},{key:"draw",value:function(){var t,e,n;null===(t=En(this,An))||void 0===t||t.start.draw(),null===(e=En(this,An))||void 0===e||e.control.draw(),null===(n=En(this,An))||void 0===n||n.end.draw(),Ie.dispatch(E(W.ANCHORS_LAYER))}},{key:"setAnchors",value:function(e,n){xn(this,An,t.defineAnchors(e,n,En(this,Tn))),En(this,Rn).start=En(this,An).start.getPosition(),En(this,Rn).control=En(this,An).control.getPosition(),En(this,Rn).end=En(this,An).end.getPosition(),En(this,An).start.on("dragmove",this.moveStart),En(this,An).control.on("dragmove",this.moveControl),En(this,An).end.on("dragmove",this.moveEnd),En(this,An).start.on("dragend",this.onDragEnd),En(this,An).control.on("dragend",this.onDragEnd),En(this,An).end.on("dragend",this.onDragEnd)}},{key:"addToLayer",value:function(t){if(!En(this,An))throw new Error("`this.#anchors` is not defined");t.add(En(this,An).start.getAnchor()),t.add(En(this,An).control.getAnchor()),t.add(En(this,An).end.getAnchor())}},{key:"getPositions",value:function(){var t;return!En(this,An)&&En(this,Tn)?En(this,Tn):{start:En(this,An).start.getPosition(),control:En(this,An).control.getPosition(),end:En(this,An).end.getPosition(),angles:null===(t=En(this,Rn))||void 0===t?void 0:t.angles}}},{key:"setAnchorsCoordinates",value:function(t){var e,n,r;En(this,Rn).start=t.start,En(this,Rn).control=t.control,En(this,Rn).end=t.end,null===(e=En(this,An))||void 0===e||e.start.setPosition(t.start.x,t.start.y),null===(n=En(this,An))||void 0===n||n.control.setPosition(t.control.x,t.control.y),null===(r=En(this,An))||void 0===r||r.end.setPosition(t.end.x,t.end.y);var o=kn(t.start,t.end);En(this,Rn).angles.start=o,En(this,Rn).angles.end=Math.PI+o}},{key:"setDelta",value:function(t,e){var n,r,o;null===(n=En(this,An))||void 0===n||n.start.setDelta(t,e),null===(r=En(this,An))||void 0===r||r.control.setDelta(t,e),null===(o=En(this,An))||void 0===o||o.end.setDelta(t,e)}},{key:"destroy",value:function(){var t,e,n,r,o,i;null===(t=En(this,An))||void 0===t||null===(e=t.start)||void 0===e||e.destroy(),null===(n=En(this,An))||void 0===n||null===(r=n.control)||void 0===r||r.destroy(),null===(o=En(this,An))||void 0===o||null===(i=o.end)||void 0===i||i.destroy()}}])&&On(e.prototype,n),r&&On(e,r),t}(),An=new WeakMap,Tn=new WeakMap,Rn=new WeakMap,jn=new WeakMap,Ln=Pn;function Cn(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function _n(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function Mn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Dn=function(t){return t*(Math.PI/180)},Wn=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Zn.set(this,{writable:!0,value:void 0}),In.set(this,{writable:!0,value:new q}),Bn.set(this,{writable:!0,value:void 0}),Hn.set(this,{writable:!0,value:void 0}),this.on=function(t,e){Cn(n,In).set(t,e)},_n(this,Zn,new I.Z.Line({lineCap:"round",lineJoin:"round",stroke:e.stroke,strokeWidth:e.strokeWidth,points:t.calculateHeadPoints(e.start,e.control,e.strokeWidth)})),Cn(this,Zn).on("click",(function(t){Cn(n,In).call("click",t)})),Cn(this,Zn).on("mouseover",(function(t){Cn(n,In).call("mouseover",t)})),Cn(this,Zn).on("mouseout",(function(t){Cn(n,In).call("mouseout",t)})),_n(this,Bn,{x:0,y:0}),_n(this,Hn,{x:0,y:0})}var e,n,r;return e=t,r=[{key:"calculateHeadPoints",value:function(t,e,n){var r,o={x:0,y:0},i={x:0,y:0},a=t.x-e.x,s=t.y-e.y;0===a?r=t.y<e.y?Dn(90):Dn(270):(r=Math.atan(s/a),a>0&&(r+=Dn(180)));var c=10*n,u=Dn(Math.min(40,c<20?20:c)),l=Math.min(14,4.5*n),h=u-r;o.x=t.x+l*Math.cos(h),o.y=t.y-l*Math.sin(h);var f=Dn(90)-(r+u);return i.x=t.x+l*Math.sin(f),i.y=t.y+l*Math.cos(f),[i.x,i.y,t.x,t.y,o.x,o.y]}}],(n=[{key:"update",value:function(e,n,r){Cn(this,Zn).setPoints(t.calculateHeadPoints(e,n,r)),Cn(this,Zn).setAttrs({x:0,y:0,strokeWidth:r}),Cn(this,Zn).draw(),Cn(this,Hn).x=Cn(this,Bn).x,Cn(this,Hn).y=Cn(this,Bn).y}},{key:"draw",value:function(){Cn(this,Zn).draw()}},{key:"zIndex",value:function(t){var e;null===(e=Cn(this,Zn))||void 0===e||e.zIndex(t)}},{key:"setDelta",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Cn(this,Zn).setAttr("x",t-Cn(this,Hn).x),Cn(this,Zn).setAttr("y",e-Cn(this,Hn).y),Cn(this,Bn).x=t,Cn(this,Bn).y=e}},{key:"setAttr",value:function(t,e){Cn(this,Zn).setAttr(t,e)}},{key:"addToLayer",value:function(t){t.add(Cn(this,Zn))}},{key:"destroy",value:function(){Cn(this,Zn).destroy()}}])&&Mn(e.prototype,n),r&&Mn(e,r),t}(),Zn=new WeakMap,In=new WeakMap,Bn=new WeakMap,Hn=new WeakMap,zn=Wn;function Un(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Fn(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function Gn(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function Yn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Nn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Kn(t,e,n){return(Kn="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Xn(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Xn(t){return(Xn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Nn(t,e,n[e])}))}return t}function qn(t,e){return!e||"object"!==Jn(e)&&"function"!==typeof e?Un(t):e}function $n(t,e){return($n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Jn=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Qn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Xn(t);if(e){var o=Xn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return qn(this,n)}}var tr,er=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$n(t,e)}(i,t);var e,n,r,o=Qn(i);function i(t){var e,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n=o.call(this),nr.set(Un(n),{writable:!0,value:void 0}),rr.set(Un(n),{writable:!0,value:void 0}),or.set(Un(n),{writable:!0,value:void 0}),ir.set(Un(n),{writable:!0,value:void 0}),ar.set(Un(n),{writable:!0,value:void 0}),n.type=G.Z.ARROW,n.redrawArrow=function(){var t,e,r,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=Fn(n,rr).getPositions(),a=n.getPathString(i);null===(t=Fn(Un(n),ir))||void 0===t||t.setData(a),null===(e=Fn(Un(n),or))||void 0===e||e.setData(a),null===(r=Fn(Un(n),ar))||void 0===r||r.update(i.start,i.control,Fn(n,nr).strokeWidth),o&&Ie.dispatch(E())},n.pathMove=function(){var t,e,r;if(!Fn(Un(n),or))throw new Error("`this.#substratePath` is not defined");var o=Fn(n,or).attrs.x,i=Fn(n,or).attrs.y;Fn(n,rr).setDelta(o,i),null===(t=Fn(Un(n),ir))||void 0===t||t.setAttrs({x:o,y:i}),null===(e=Fn(Un(n),ar))||void 0===e||e.setDelta(o,i),null===(r=Fn(Un(n),ar))||void 0===r||r.draw(),Fn(n,rr).draw()},n.blur=function(){Kn((e=Un(n),Xn(i.prototype)),"blur",e).call(e),Fn(n,rr).visible(!1)},n.onAnchor=function(t,e){Fn(n,rr).on(t,e)},Gn(Un(n),nr,Vn({},t)),Gn(Un(n),rr,new Ln(Fn(n,nr).anchorsPosition)),n}return e=i,(n=[{key:"initArrowDraw",value:function(t,e){Gn(this,or,new I.Z.Path({data:t,stroke:"transparent",strokeWidth:12,draggable:!0})),Gn(this,ir,new I.Z.Path({data:t,stroke:Fn(this,nr).stroke||"red",strokeWidth:Fn(this,nr).strokeWidth,lineCap:"round",lineJoin:"round"})),Fn(this,or).on("dragmove",this.pathMove),this.attachBasicEvents(Fn(this,or)),e.add(Fn(this,ir)),e.add(Fn(this,or))}},{key:"getPathString",value:function(t){var e=c().get(Fn(this,ir),"attrs.x",0),n=c().get(Fn(this,ir),"attrs.y",0);return"M".concat(t.start.x-e,",").concat(t.start.y-n," ")+"Q".concat(t.control.x-e,",").concat(t.control.y-n," ")+"".concat(t.end.x-e,",").concat(t.end.y-n)}},{key:"focus",value:function(){Kn(Xn(i.prototype),"focus",this).call(this),Fn(this,rr).visible(!0)}},{key:"addToLayer",value:function(t,e){var n=this;Fn(this,rr).setAnchors({width:t.parent.attrs.width,height:t.parent.attrs.height},300),Fn(this,rr).on("dragmove",(function(){return n.redrawArrow(!0)})),Fn(this,rr).on("dragend",(function(){return n.redrawArrow(!0)}));var r=Fn(this,rr).getPositions();Gn(this,ar,new zn({start:r.start,control:r.control,stroke:Fn(this,nr).stroke||"red",strokeWidth:Fn(this,nr).strokeWidth})),Fn(this,ar).on("click",this.onClick);var o=this.getPathString(r);this.initArrowDraw(o,t),Fn(this,ar).addToLayer(t),Fn(this,rr).addToLayer(e),this.redrawArrow(),Kn(Xn(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"setStrokeColor",value:function(t){var e,n,r,o;null===(e=Fn(this,ir))||void 0===e||e.setAttr("stroke",t),null===(n=Fn(this,ar))||void 0===n||n.setAttr("stroke",t),Fn(this,nr).stroke=t,null===(r=Fn(this,ir))||void 0===r||r.draw(),null===(o=Fn(this,ar))||void 0===o||o.draw()}},{key:"getStrokeColor",value:function(){return Fn(this,nr).stroke}},{key:"setStrokeWidth",value:function(t){var e;null===(e=Fn(this,ir))||void 0===e||e.setAttr("strokeWidth",t),Fn(this,nr).strokeWidth=t,this.redrawArrow()}},{key:"getSelfRect",value:function(){if(!Fn(this,ir))throw new Error("Arrow is not defined");var t=Fn(this,ir).getAbsolutePosition(),e=Fn(this,ir).getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}},{key:"getStrokeWidth",value:function(){var t;return null===(t=Fn(this,ir))||void 0===t?void 0:t.getAttr("strokeWidth")}},{key:"draggable",value:function(t){var e,n;return null===(e=Fn(this,or))||void 0===e||e.setAttr("draggable",t),null===(n=Fn(this,or))||void 0===n?void 0:n.getAttr("draggable")}},{key:"scale",value:function(t){var e=Fn(this,rr).getPositions();Fn(this,rr).setAnchorsCoordinates({start:{x:e.start.x*t.wFactor,y:e.start.y*t.hFactor},control:{x:e.control.x*t.wFactor,y:e.control.y*t.hFactor},end:{x:e.end.x*t.wFactor,y:e.end.y*t.hFactor}}),this.redrawArrow()}},{key:"initDraw",value:function(t,e){this.isSelected()&&this.blur(),Fn(this,rr).setAnchorsCoordinates({start:{x:e.x,y:e.y},control:{x:(t.x+e.x)/2,y:(t.y+e.y)/2},end:{x:t.x,y:t.y}}),this.redrawArrow(!0)}},{key:"zIndex",value:function(t){var e,n,r,o;if(void 0===t)return null===(o=Fn(this,ir))||void 0===o?void 0:o.zIndex();null===(e=Fn(this,or))||void 0===e||e.zIndex(t),null===(n=Fn(this,ir))||void 0===n||n.zIndex(t),null===(r=Fn(this,ar))||void 0===r||r.zIndex(t)}},{key:"crop",value:function(t){var e=Fn(this,rr).getPositions();Fn(this,rr).setAnchorsCoordinates({start:{x:e.start.x-t.x,y:e.start.y-t.y},control:{x:e.control.x-t.x,y:e.control.y-t.y},end:{x:e.end.x-t.x,y:e.end.y-t.y}}),this.redrawArrow()}},{key:"clone",value:function(){var t=Fn(this,rr)?Fn(this,rr).getPositions():Fn(this,nr).anchorsPosition;return new i(Vn({},Fn(this,nr),{anchorsPosition:t}))}},{key:"destroy",value:function(){var t,e,n,r;Kn(Xn(i.prototype),"destroy",this).call(this),null===(t=Fn(this,ir))||void 0===t||t.destroy(),null===(e=Fn(this,or))||void 0===e||e.destroy(),null===(n=Fn(this,ar))||void 0===n||n.destroy(),null===(r=Fn(this,rr))||void 0===r||r.destroy()}}])&&Yn(e.prototype,n),r&&Yn(e,r),i}(rt),nr=new WeakMap,rr=new WeakMap,or=new WeakMap,ir=new WeakMap,ar=new WeakMap,sr=er;function cr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ur(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function lr(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function hr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t.fontSize="fontSize",t.color="color"}(tr||(tr={}));var fr=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=this;cr(this,t),dr.set(this,{writable:!0,value:void 0}),pr.set(this,{writable:!0,value:void 0}),this.onKeyDown=function(){var t=ur(r,pr).getAbsoluteScale().x;r.setTextareaWidth(ur(r,pr).width()*t),ur(r,dr).style.height="auto",ur(r,dr).style.height="".concat(ur(r,dr).scrollHeight+ur(r,pr).fontSize(),"px")},lr(this,pr,e),lr(this,dr,document.createElement("textarea")),ur(this,dr).value=n,document.body.appendChild(ur(this,dr)),ur(this,dr).addEventListener("keydown",this.onKeyDown),ur(this,dr).style.display="none"}var e,n,r;return e=t,(n=[{key:"setTextareaWidth",value:function(t){t||(t=ur(this,pr).placeholder.length*ur(this,pr).fontSize());var e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;(e||n)&&(t=Math.ceil(t)),(document.documentMode||/Edge/.test(navigator.userAgent))&&(t+=1),ur(this,dr).style.width="".concat(t,"px")}},{key:"update",value:function(t){ur(this,dr).style.display="initial",ur(this,dr).value=t.value,ur(this,dr).style.position="absolute",ur(this,dr).style.top="".concat(t.top,"px"),ur(this,dr).style.left="".concat(t.left,"px"),ur(this,dr).style.width="".concat(t.width,"px"),ur(this,dr).style.height="".concat(t.height,"px"),ur(this,dr).style.fontSize="".concat(t.fontSize,"px"),ur(this,dr).style.fontFamily="Lato, Arial",ur(this,dr).style.border="1px dashed #2196f3",ur(this,dr).style.padding="0px",ur(this,dr).style.margin="0px",ur(this,dr).style.overflow="hidden",ur(this,dr).style.background="none",ur(this,dr).style.outline="none",ur(this,dr).style.resize="none",ur(this,dr).style.lineHeight=t.lineHeight,ur(this,dr).style.fontFamily=t.fontFamily,ur(this,dr).style.transformOrigin="left top",ur(this,dr).style.textAlign=t.textAlign,ur(this,dr).style.color=t.color;var e="rotateZ(".concat(t.rotation,"deg)");if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1){var n=2+Math.round(t.fontSize/20);e+="translateY(-".concat(n,"px)")}ur(this,dr).style.transform=e,ur(this,dr).style.height="auto",ur(this,dr).style.height=ur(this,dr).scrollHeight+3+"px"}},{key:"setAttr",value:function(t,e){switch(t){case tr.fontSize:ur(this,dr).style.fontSize="".concat(e,"px");break;case tr.color:ur(this,dr).style.color=e}}},{key:"focus",value:function(){ur(this,dr).focus()}},{key:"hide",value:function(){ur(this,dr).style.display="none"}},{key:"getValue",value:function(){return ur(this,dr).value}},{key:"destroy",value:function(){var t;ur(this,dr).removeEventListener("keydown",this.onKeyDown),null===(t=ur(this,dr).parentNode)||void 0===t||t.removeChild(ur(this,dr))}}])&&hr(e.prototype,n),r&&hr(e,r),t}(),dr=new WeakMap,pr=new WeakMap,yr=fr;function vr(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function gr(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function wr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function br(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function mr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){br(t,e,n[e])}))}return t}var kr=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Sr.set(this,{writable:!0,value:void 0}),Er.set(this,{writable:!0,value:void 0}),this.makeEditable=function(){var t;vr(n,Sr).hide();var e=null===(t=Ie.getState().stage.instance)||void 0===t?void 0:t.absolutePosition();if(!e)throw new Error("Stage is not defined");var r=vr(n,Sr).position();vr(n,Er).update({value:vr(n,Sr).text(),top:r.y+e.y,left:r.x+e.x,width:vr(n,Sr).width()-2*vr(n,Sr).padding(),height:vr(n,Sr).height()-2*vr(n,Sr).padding()+5,fontSize:vr(n,Sr).fontSize(),lineHeight:vr(n,Sr).lineHeight(),fontFamily:vr(n,Sr).fontFamily(),textAlign:vr(n,Sr).align(),color:vr(n,Sr).fill(),rotation:vr(n,Sr).rotation()}),vr(n,Er).focus()},gr(this,Sr,new I.Z.Text(mr({},e,{draggable:!0}))),vr(this,Sr).on("transform",(function(){vr(n,Sr).setAttrs({width:vr(n,Sr).width()*vr(n,Sr).scaleX(),scaleX:1})})),gr(this,Er,new yr(vr(this,Sr),e.text))}var e,n,r;return e=t,(n=[{key:"blur",value:function(){vr(this,Sr).text(vr(this,Er).getValue()),vr(this,Er).hide(),vr(this,Sr).show()}},{key:"setAttr",value:function(t,e){switch(vr(this,Sr).setAttr(t,e),t){case"fontSize":vr(this,Er).setAttr(tr.fontSize,e);break;case"fill":vr(this,Er).setAttr(tr.color,e)}}},{key:"draggable",value:function(t){return vr(this,Sr).setAttr("draggable",t),vr(this,Sr).getAttr("draggable")}},{key:"on",value:function(t,e){vr(this,Sr).on(t,e)}},{key:"addToLayer",value:function(t){t.add(vr(this,Sr))}},{key:"setPosition",value:function(t,e){vr(this,Sr).setAttrs({x:t,y:e})}},{key:"getPosition",value:function(){return{x:vr(this,Sr).attrs.x,y:vr(this,Sr).attrs.y}}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=vr(this,Sr))||void 0===n?void 0:n.zIndex();null===(e=vr(this,Sr))||void 0===e||e.zIndex(t)}},{key:"getText",value:function(){return vr(this,Sr).attrs.text}},{key:"getRotation",value:function(){return vr(this,Sr).rotation()}},{key:"getAttrs",value:function(){return vr(this,Sr).getAttrs()}},{key:"getNode",value:function(){return vr(this,Sr)}},{key:"getSelfRect",value:function(){return mr({},this.getPosition(),{width:vr(this,Sr).width(),height:vr(this,Sr).height()})}},{key:"destroy",value:function(){var t,e;null===(t=vr(this,Sr))||void 0===t||t.destroy(),null===(e=vr(this,Er))||void 0===e||e.destroy()}}])&&wr(e.prototype,n),r&&wr(e,r),t}(),Sr=new WeakMap,Er=new WeakMap,xr=kr;function Or(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Pr(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function Ar(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");return r.value=n,n}function Tr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Rr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jr(t,e,n){return(jr="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Lr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Lr(t){return(Lr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Cr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Rr(t,e,n[e])}))}return t}function _r(t,e){return!e||"object"!==Dr(e)&&"function"!==typeof e?Or(t):e}function Mr(t,e){return(Mr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Dr=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Wr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Lr(t);if(e){var o=Lr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return _r(this,n)}}var Zr=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mr(t,e)}(i,t);var e,n,r,o=Wr(i);function i(t){var e,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n=o.call(this),Ir.set(Or(n),{writable:!0,value:void 0}),Br.set(Or(n),{writable:!0,value:void 0}),Hr.set(Or(n),{writable:!0,value:void 0}),n.type=G.Z.TEXT,n.focus=function(){var t;jr((e=Or(n),Lr(i.prototype)),"focus",e).call(e),null===(t=Pr(Or(n),Hr))||void 0===t||t.show()},Ar(Or(n),Ir,Cr({},t)),n}return e=i,(n=[{key:"addToLayer",value:function(t,e){var n,r=this,o=Pr(this,Ir).x||t.parent.attrs.width/2-100,a=Pr(this,Ir).y||t.parent.attrs.height/2-10;Ar(this,Br,new xr({text:Pr(this,Ir).text||"Some text here",x:o,y:a,fontFamily:"Lato, Arial",fontSize:Pr(this,Ir).fontSize||20,width:Pr(this,Ir).width||200,fill:Pr(this,Ir).fill,rotation:null!==(n=Pr(this,Ir).rotation)&&void 0!==n?n:0})),this.attachBasicEvents(Pr(this,Br)),Pr(this,Br).addToLayer(t),Ar(this,Hr,new I.Z.Transformer({node:Pr(this,Br).getNode(),enabledAnchors:["middle-left","middle-right"],borderStroke:"#2196f3",anchorStroke:"#2196f3",anchorFill:"#ffffff",borderStrokeWidth:1,anchorStrokeWidth:1,boundBoxFunc:function(t,e){return e.width=Math.max(30,e.width),e}})),Pr(this,Br).on("dblclick",(function(){var t,e;null===(t=Pr(r,Br))||void 0===t||t.makeEditable(),null===(e=Pr(r,Hr))||void 0===e||e.hide(),Ie.dispatch(E(W.SHAPES_LAYER)),Ie.dispatch(E(W.ANCHORS_LAYER))})),Pr(this,Br).on("click",this.focus),Pr(this,Br).on("transform",(function(){Ie.dispatch(E(W.SHAPES_LAYER))})),Pr(this,Hr).hide(),e.add(Pr(this,Hr)),jr(Lr(i.prototype),"addToLayer",this).call(this,t,e)}},{key:"setFillColor",value:function(t){var e;null===(e=Pr(this,Br))||void 0===e||e.setAttr("fill",t),Pr(this,Ir).fill=t}},{key:"getFillColor",value:function(){return Pr(this,Ir).fill}},{key:"setFontSize",value:function(t){var e;null===(e=Pr(this,Br))||void 0===e||e.setAttr("fontSize",t),Pr(this,Ir).fontSize=t}},{key:"blur",value:function(){var t,e;jr(Lr(i.prototype),"blur",this).call(this),null===(t=Pr(this,Br))||void 0===t||t.blur(),null===(e=Pr(this,Hr))||void 0===e||e.hide()}},{key:"scale",value:function(t){if(!Pr(this,Br))throw new Error("`this.#textNode` is not defined");var e=Pr(this,Br).getPosition();Pr(this,Br).setPosition(e.x*t.wFactor,e.y*t.hFactor)}},{key:"setAttrs",value:function(t){var e=this;Object.keys(t).forEach((function(n){var r;null===(r=Pr(e,Br))||void 0===r||r.setAttr(n,t[n])}))}},{key:"crop",value:function(t){if(!Pr(this,Br))throw new Error("`this.#textNode` is not defined");var e=Pr(this,Br).getPosition();Pr(this,Br).setPosition(e.x-t.x,e.y-t.y)}},{key:"draggable",value:function(t){var e,n;return null!==(n=null===(e=Pr(this,Br))||void 0===e?void 0:e.draggable(t))&&void 0!==n&&n}},{key:"zIndex",value:function(t){var e,n;if(void 0===t)return null===(n=Pr(this,Br))||void 0===n?void 0:n.zIndex();null===(e=Pr(this,Br))||void 0===e||e.zIndex(t)}},{key:"clone",value:function(){var t,e,n,r,o=null===(t=Pr(this,Br))||void 0===t?void 0:t.getText(),a=null===(e=Pr(this,Br))||void 0===e?void 0:e.getRotation(),s=c().get(null===(n=Pr(this,Br))||void 0===n?void 0:n.getAttrs(),"width");return new i(Cr({},Pr(this,Ir),null===(r=Pr(this,Br))||void 0===r?void 0:r.getPosition(),o&&{text:o},a&&{rotation:a},s&&{width:s}))}},{key:"getSelfRect",value:function(){if(!Pr(this,Br))throw new Error("TextNode is not defined");return Pr(this,Br).getSelfRect()}},{key:"initDraw",value:function(t,e){this.setAttrs({x:t.x,y:t.y,rotation:kn(t,e)*(180/Math.PI)}),Ie.dispatch(E(W.SHAPES_LAYER))}},{key:"destroy",value:function(){var t,e;jr(Lr(i.prototype),"destroy",this).call(this),null===(t=Pr(this,Br))||void 0===t||t.destroy(),null===(e=Pr(this,Hr))||void 0===e||e.destroy()}}])&&Tr(e.prototype,n),r&&Tr(e,r),i}(rt),Ir=new WeakMap,Br=new WeakMap,Hr=new WeakMap,zr=Zr;function Ur(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Gr(t,e,n){return(Gr="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Yr(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Yr(t){return(Yr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Nr(t,e){return!e||"object"!==Xr(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Kr(t,e){return(Kr=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Xr=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Vr(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Yr(t);if(e){var o=Yr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Nr(this,n)}}var qr=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Kr(t,e)}(i,t);var e,n,r,o=Vr(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Fr(t,e,n[e])}))}return t}({},t,{stroke:"#0d87dc",fill:"transparent",strokeWidth:2,dash:[10,5]}))).type=G.Z.SELECT_RECT,e}return e=i,(n=[{key:"blur",value:function(){Gr(Yr(i.prototype),"blur",this).call(this),this.destroy()}},{key:"scale",value:function(){this.destroy()}}])&&Ur(e.prototype,n),r&&Ur(e,r),i}(Bt);function $r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Jr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Qr(t){return(Qr=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function to(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){Jr(t,e,n[e])}))}return t}function eo(t,e){return!e||"object"!==ro(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function no(t,e){return(no=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ro=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function oo(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Qr(t);if(e){var o=Qr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return eo(this,n)}}var io=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&no(t,e)}(i,t);var e,n,r,o=oo(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=o.call(this,t)).type=G.Z.ELLIPSE,e.getSizePos=function(){var t=e.getAttrs(),n=t.x,r=t.y,o=t.radiusX,i=t.radiusY;return{x:n-o,y:r-i,width:2*o,height:2*i}},e.onDragMoveAnchor=function(t){t.x=t.x+t.width/2,t.y=t.y+t.height/2,e.setShapeAttrs(t)},e.props=to({},t),e}return e=i,(n=[{key:"defineShape",value:function(){this.shape=new I.Z.Ellipse({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,dash:this.props.dash,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth,fill:this.props.fill,draggable:!0})}},{key:"getCloningProps",value:function(){var t,e=null===(t=this.shape)||void 0===t?void 0:t.getAttrs();return to({},this.props,e&&{x:e.x-e.radiusX,y:e.y-e.radiusY,width:2*e.radiusX,height:2*e.radiusY,stroke:e.stroke,strokeWidth:e.strokeWidth})}},{key:"clone",value:function(){var t=this.getCloningProps();return t.x+=t.width/4,t.y+=t.height/4,new i(t)}},{key:"scale",value:function(t){var e,n,r=this.getAttrs(),o=r.x,i=r.y,a=r.radiusX,s=r.radiusY;null===(e=this.shape)||void 0===e||e.setAttrs({x:o*t.wFactor,y:i*t.hFactor,width:2*a*t.wFactor,height:2*s*t.hFactor}),null===(n=this.sizeTransform)||void 0===n||n.update(this.getSizePos(),!1)}},{key:"initDraw",value:function(t,e){this.blur();var n=e.x-t.x,r=e.y-t.y;this.setAttrs({x:t.x+n/2,y:t.y+r/2,width:Math.abs(n),height:Math.abs(r)})}}])&&$r(e.prototype,n),r&&$r(e,r),i}(Bt),ao=function(t){t.on("click",(function(t){Ie.dispatch(w(t))})),t.on("dragstart",(function(t){Ie.dispatch(w(t))})),t.on("mouseover",(function(){var e=Ie.getState(),n=e.shapes,r=e.stage;r.isDraggable?t.draggable(!1):t.draggable(!n.addingShapeRef);var o=n.addingShapeRef?D.AUTO:D.MOVE;r.isDraggable||Ie.dispatch(h(o))})),t.on("mouseout",(function(){Ie.getState().stage.isDraggable||Ie.dispatch(h(D.AUTO))}))},so=function(t,e){var n=t||new sr({stroke:c().get(e,"strokeColor","green"),strokeWidth:c().get(e,"strokeWidth")});return n.onAnchor("mouseover",(function(){return Ie.dispatch(h(D.POINTER))})),n.onAnchor("mouseout",(function(){return Ie.dispatch(h(D.AUTO))})),ao(n),n},co=function(t){Ie.dispatch(l(t))},uo=function(t,e){var n=t||new zr({fill:c().get(e,"fillColor","green"),fontSize:c().get(e,"fontSize")});return ao(n),n},lo=function(t){Ie.dispatch(l(t))},ho=function(t,e,n){var r={stroke:c().get(e,"strokeColor","green"),fill:c().get(e,"fill","transparent"),strokeWidth:c().get(e,"strokeWidth",2)},o=function(){if(t)return t;switch(n){case G.Z.RECT:return new Bt(r);case G.Z.RECT_ROUGH:return new oe(r);case G.Z.ELLIPSE:return new io(r);case G.Z.ELLIPSE_ROUGH:return new me(r);case G.Z.SELECT_RECT:return new qr}}();if(!o)throw new Error("rectNode is not defined");return ao(o),o},fo=function(t){Ie.dispatch(l(t))},po=function(t){switch(t.type){case G.Z.ARROW:co(t);break;case G.Z.TEXT:lo(t);break;case G.Z.RECT:case G.Z.RECT_ROUGH:case G.Z.ELLIPSE:case G.Z.ELLIPSE_ROUGH:case G.Z.SELECT_RECT:fo(t);break;default:console.error("Can't connect given shape"),console.log(t)}},yo=function(t,e){switch(t.type){case G.Z.ARROW:!function(t,e){var n=so(t,e);co(n)}(t.clone(),e);break;case G.Z.TEXT:!function(t,e){var n=uo(t,e);lo(n)}(t.clone(),e);break;case G.Z.RECT:case G.Z.RECT_ROUGH:case G.Z.ELLIPSE:case G.Z.ELLIPSE_ROUGH:!function(t,e,n){var r=ho(t,e,n);fo(r)}(t.clone(),e);break;case G.Z.IMAGE:vo(t.clone());break;default:console.error("Can't clone and connect given shape"),console.log(t)}},vo=function(t){ao(t),Ie.dispatch(l(t))},go=function(t){var e=Ie.getState().stage;if(!e.instance)throw new Error("Stage is not defined");var n=e.instance.absolutePosition(),r=new nn(t.image,t.pos?{x:t.pos.x-n.x,y:t.pos.y-n.y}:{x:e.instance.width()/2-t.image.width/2-n.x,y:e.instance.height()/2-t.image.height/2-n.y});vo(r)},wo="shapes-layer",bo=n(3274),mo=function(t){navigator.clipboard?navigator.clipboard.writeText(t).then((function(){}),(function(t){console.error("Async: Could not copy text: ",t)})):function(t){var e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();try{document.execCommand("cut")}catch(n){return console.warn("Copy to clipboard failed.",n),!1}finally{document.body.removeChild(e)}}(t)},ko=function(t){var e=document.createElement("img");e.src=t;var n=document.createElement("div");n.contentEditable="true",n.appendChild(e),document.body.appendChild(n),function(t){if(!window.getSelection)throw new Error("Can't select text");var e=window.getSelection(),n=document.createRange();n.selectNodeContents(t),null===e||void 0===e||e.removeAllRanges(),null===e||void 0===e||e.addRange(n)}(n),document.execCommand("Copy"),document.body.removeChild(n)};function So(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Eo(t){return function(t){if(Array.isArray(t))return So(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"===typeof t)return So(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return So(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var xo={onDelete:["backspace","delete","del"],onCopy:["ctrl+c","command+c"],onPaste:["ctrl+v","command+v"],onActivateDrag:{sequence:"space",action:"keydown"},onDisableDrag:{sequence:"space",action:"keyup"},onActivateRatio:{sequence:"shift",action:"keydown"},onDisableRatio:{sequence:"shift",action:"keyup"}},Oo=function(){var t=(0,a.useRef)([]);(0,a.useEffect)((function(){var t=c().throttle((function(){e(),n()}),50);return window.addEventListener("focus",t,{capture:!0}),function(){window.removeEventListener("focus",t)}}),[]);var e=function(){var t=Ie.getState().shapes;Ie.dispatch(j(!1)),t.list.forEach((function(t){t.draggable(!0)})),Ie.dispatch(h(D.AUTO))},n=function(){Ie.dispatch(L(!1))};return(0,i.jsx)(bo.GlobalHotKeys,{keyMap:xo,handlers:{onDelete:function(){Ie.dispatch(y()),Ie.dispatch(h(D.AUTO))},onCopy:function(){var e=Ie.getState().shapes;mo("[Shape]"),t.current=e.list.reduce((function(t,e){return e.isSelected()?Eo(t).concat([e.clone()]):t}),[])},onPaste:function(){Ie.dispatch(w()),t.current.forEach((function(t){yo(t)})),t.current=[]},onActivateDrag:function(){var t=Ie.getState().shapes;Ie.dispatch(j(!0)),t.list.forEach((function(t){t.draggable(!1)})),Ie.dispatch(h(D.GRAB))},onDisableDrag:e,onActivateRatio:function(){Ie.dispatch(L(!0))},onDisableRatio:n}})},Po=(n(6267),function(t){var e=t.children,n=(0,a.useState)(D.AUTO),r=n[0],o=n[1],s=(0,a.useRef)(c().throttle((function(){Ie.dispatch(R({width:window.innerWidth,height:window.innerHeight}))}),80)),u=(0,a.useRef)((function(){var t=Ie.getState().shapes;o(t.cursor)}));return(0,a.useEffect)((function(){window.addEventListener("resize",s.current);var t=Ie.subscribe(u.current);return function(){window.removeEventListener("resize",s.current),t()}}),[]),(0,i.jsx)("div",{style:{cursor:r},className:"CanvasWrapper",children:e})});function Ao(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function To(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ro=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),jo.set(this,{writable:!0,value:void 0}),Lo.set(this,{writable:!0,value:new q}),this.handleClick=function(t){Ie.getState().shapes.addingShapeRef||Ie.dispatch(w())},this.handleMouseDown=function(t){Ao(n,Lo).call("mousedown",t)},this.handleMouseUp=function(t){Ao(n,Lo).call("mouseup",t)},this.handleMouseMove=function(t){Ao(n,Lo).call("mousemove",t)},function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}(this,jo,new I.Z.Stage({container:e,width:window.innerWidth,height:window.innerHeight}));var r=Ie.getState().shapes;this.add(r.shapesLayer),this.add(r.anchorsLayer);try{r.shapesLayer.getCanvas()._canvas.classList.add(wo),r.anchorsLayer.getCanvas()._canvas.classList.add("anchors-layer")}catch(o){console.error("Can't set className to the canvas"),console.error(o)}Ao(this,jo).on("mousedown",this.handleMouseDown),Ao(this,jo).on("mouseup",this.handleMouseUp),Ao(this,jo).on("mousemove",this.handleMouseMove),Ao(this,jo).on("click",this.handleClick)}var e,n,r;return e=t,(n=[{key:"on",value:function(t,e){Ao(this,Lo).set(t,e)}},{key:"add",value:function(t){Ao(this,jo).add(t)}},{key:"setAttrs",value:function(t){Ao(this,jo).setAttrs(t)}},{key:"draggable",value:function(t){if(void 0===t)return Ao(this,jo).draggable();Ao(this,jo).draggable(t)}},{key:"absolutePosition",value:function(t){if(void 0===t)return Ao(this,jo).absolutePosition();Ao(this,jo).absolutePosition(t)}},{key:"getBoundingClientRect",value:function(){return Ao(this,jo).container().getBoundingClientRect()}},{key:"toDataURL",value:function(){return Ao(this,jo).toDataURL()}},{key:"getPos",value:function(){return{x:Ao(this,jo).x(),y:Ao(this,jo).y()}}},{key:"width",value:function(){return Ao(this,jo).width()}},{key:"height",value:function(){return Ao(this,jo).height()}},{key:"getContentBoundariesRect",value:function(){var t=Ie.getState().shapes.list;if(0===t.length)return{x:0,y:0,width:0,height:0};var e={xTopLeft:1/0,yTopLeft:1/0,xBottomRight:-1/0,yBottomRight:-1/0},n=t.reduce((function(t,e){var n=e.getSelfRect(),r=n.x+n.width,o=n.y+n.height;return{xTopLeft:n.x<t.xTopLeft?n.x:t.xTopLeft,yTopLeft:n.y<t.yTopLeft?n.y:t.yTopLeft,xBottomRight:r>t.xBottomRight?r:t.xBottomRight,yBottomRight:o>t.yBottomRight?o:t.yBottomRight}}),e);return{x:n.xTopLeft,y:n.yTopLeft,width:n.xBottomRight-n.xTopLeft,height:n.yBottomRight-n.yTopLeft}}}])&&To(e.prototype,n),r&&To(e,r),t}(),jo=new WeakMap,Lo=new WeakMap,Co=Ro;var _o=function(t,e){var n=function(t){var e=t.split(",");if(e[0]){var n=e[0].match(/:(.*?);/);if(n){for(var r=n[1],o=atob(e[1]),i=o.length,a=new Uint8Array(i);i--;)a[i]=o.charCodeAt(i);return new Blob([a],{type:r})}}return null}(t);if(!n)throw new Error("blob data is null");var r=document.createElement("a"),o=URL.createObjectURL(n);r.download=e.replace(/(\.[^.]+)$/gi,"")+".png",r.href=o,r.click()};function Mo(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}function Do(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Mo(i,r,o,a,s,"next",t)}function s(t){Mo(i,r,o,a,s,"throw",t)}a(void 0)}))}}function Wo(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t).value}function Zo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Io=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Bo.set(this,{writable:!0,value:void 0}),function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");var r=e.get(t);if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}(this,Bo,new I.Z.Stage({container:e,width:10,height:10}))}var e,n,r;return e=t,r=[{key:"normPosAxis",value:function(t){return t<0?Math.abs(t):0}}],(n=[{key:"trimLayer",value:function(e,n){var r=this,o=e.clone();return Wo(this,Bo).add(o),Wo(this,Bo).setAttrs({width:t.normPosAxis(n.x)+n.width+60,height:t.normPosAxis(n.y)+n.height+60,x:-1*n.x+30,y:-1*n.y+30}),new Promise((function(t,e){var n=r;setTimeout((function(){var r=n,i=o.getCanvas()._canvas;!function(t){var e,n,r,o,i,a,s,c,u,l,h,f,d;if(r=t.canvas.width,o=t.canvas.height,!r&&!o)return!1;for(d=t.getImageData(0,0,r,o),u=new Uint32Array(d.data.buffer),l=0,h=r*o-1,f=!1,n=0;n<o&&!f;n+=1){for(e=0;e<r;e+=1){if(u[l++]&&!i&&(i=n+1,c)){f=!0;break}if(u[h--]&&!c&&(c=o-n-1,i)){f=!0;break}}if(n>o-n&&!i&&!c)return!1}for(i-=1,f=!1,e=0;e<r&&!f;e+=1)for(l=i*r+e,h=i*r+(r-e-1),n=i;n<=c;n+=1){if(u[l]&&!a&&(a=e+1,s)){f=!0;break}if(u[h]&&!s&&(s=r-e-1,a)){f=!0;break}l+=r,h+=r}return r===s-(a-=1)+1&&o===c-i+1||(r=s-a+1,o=c-i+1,t.canvas.width=r,t.canvas.height=o,t.putImageData(d,-a,-i)),!0}(i.getContext("2d"))?e(new Error("Can't trim given context")):t(i),setTimeout((function(){Wo(r,Bo).getLayers().forEach((function(t){return t.destroy()}))}),1e3)}))}))}},{key:"saveFromLayer",value:function(t,e,n){return Do(o().mark((function r(){var i,a;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.trimLayer(t,n);case 2:i=r.sent,a=i.toDataURL(),_o(a,e);case 5:case"end":return r.stop()}}),r,this)})).bind(this))()}},{key:"copyFromLayer",value:function(t,e){return Do(o().mark((function n(){var r,i,a,s;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(null===window||void 0===window||null===(r=window.navigator)||void 0===r||null===(i=r.clipboard)||void 0===i?void 0:i.write)){n.next=8;break}return n.next=4,this.trimLayer(t,e);case 4:n.sent.toBlob((function(t){var e=new ClipboardItem({"image/png":t});navigator.clipboard.write([e])})),n.next=13;break;case 8:return n.next=10,this.trimLayer(t,e);case 10:a=n.sent,s=a.toDataURL(),ko(s);case 13:case"end":return n.stop()}}),n,this)})).bind(this))()}}])&&Zo(e.prototype,n),r&&Zo(e,r),t}(),Bo=new WeakMap,Ho=(n(4893),function(){var t=(0,a.useRef)(null);return(0,a.useEffect)((function(){Ie.dispatch(Re(new Io(t.current)))}),[]),(0,i.jsx)("div",{ref:t,className:"SaveCanvasEl"})}),zo=(n(6331),function(t){var e=t.shape,n=t.startPos,r=t.currentPos;if(t.ratioShiftIsActive&&e.type!==G.Z.ARROW){var o=r.x-n.x,i=r.y-n.y,a=Math.min(Math.abs(o),Math.abs(i));e.initDraw(n,{x:n.x+Math.sign(o)*a,y:n.y+Math.sign(i)*a})}else e.initDraw(n,r)}),Uo=function(){return{startAddingShape:function(t){Ie.dispatch(w());var e=t.type,n=t.options;switch(e){case G.Z.TEXT:case G.Z.ARROW:case G.Z.RECT:case G.Z.RECT_ROUGH:case G.Z.ELLIPSE:case G.Z.ELLIPSE_ROUGH:case G.Z.SELECT_RECT:Ie.dispatch(k({type:e,options:n}));break;case null:Ie.dispatch(k({type:null}));break;default:throw new Error("Given shape type can't be added: ".concat(e))}},setImage:function(t){go(t)},setStrokeColorToActiveShape:function(t){Ie.dispatch(f(t))},setStrokeWidthToActiveShape:function(t){Ie.dispatch(d(t))},setFontSizeToActiveShape:function(t){Ie.dispatch(p(t))},exportCanvasToImage:function(t){var e=Ie.getState(),n=e.shapes,r=e.stage;if(!r.instance)throw new Error("Stage instance is not defined");Ie.dispatch(je({layer:n.shapesLayer,name:t,contentRect:r.instance.getContentBoundariesRect()}))},copyAllToClipboard:function(){var t=Ie.getState(),e=t.stage,n=t.shapes;if(!e.instance)throw new Error("Stage instance is not defined");Ie.dispatch(Le({layer:n.shapesLayer,contentRect:e.instance.getContentBoundariesRect()}))},blurShapes:function(){Ie.dispatch(w())},sketchifyActiveShape:function(){Ie.dispatch(O())},getShapesAmount:function(){return new Promise((function(t){requestAnimationFrame((function(){var e=Ie.getState().shapes;t(e.list.length)}))}))},changeOrderOfActiveShape:function(t){Ie.dispatch(x(t))},initBlankCanvas:function(t){if(!Ie.getState().stage.instance)throw new Error('"instance" is not defined on stage. It looks like stage is not initialized yet.');(function(t,e,n){var r=document.createElement("svg");return r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("width",String(t)),r.setAttribute("height",String(e)),r.setAttribute("style","background-color:".concat(n)),new Promise((function(t,e){var n=new Image,o=new Blob([r.outerHTML],{type:"image/svg+xml"}),i=URL.createObjectURL(o);n.onload=function(){URL.revokeObjectURL(i),t(this)},n.onerror=e,n.src=i}))})(t.width,t.height,"#cdcdcd").then((function(t){go({image:t,name:"Blank canvas"})}))},onShapeClicked:H("SHAPE_CLICKED"),onShapeDragStarted:H("SHAPE_DRAG_STARTED"),onShapeBlurred:H("SHAPES_BLURRED"),onShapeAdded:H("SHAPE_ADDED"),onShapeDeleted:H("SHAPE_DELETED")}};function Fo(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Go(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Yo(t){return(Yo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function No(t,e){return!e||"object"!==Xo(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ko(t,e){return(Ko=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Xo=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function Vo(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Yo(t);if(e){var o=Yo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}var qo=function(){var t=document.querySelector(".".concat(wo));if(t)return t;throw new Error("Shapes layer is not found")},$o=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ko(t,e)}(s,t);var e,n,r,o=Vo(s);function s(){var t;return Fo(this,s),(t=o.apply(this,arguments)).canvasRef=a.createRef(),t.state={mouseIsDown:!1,mouseStartPos:{x:0,y:0}},t.handleStageOnMouseDown=function(e){var n=Ie.getState(),r=n.shapes,o=n.stage;if(r.addingShapeRef&&o.instance){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY,u={x:s-i.x,y:c-i.y};t.setState({mouseIsDown:!0,mouseStartPos:u}),po(r.addingShapeRef),r.addingShapeRef.initDraw(u,u)}},t.handleStageOnMouseUp=function(e){t.setState({mouseIsDown:!1});var n=Ie.getState(),r=n.shapes,o=n.stage;if(r.addingShapeRef){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY,u=Sn({x:s-i.x,y:c-i.y},t.state.mouseStartPos);r.addingShapeRef.type===G.Z.TEXT||u>10?(r.addingShapeRef.focus(),Ie.dispatch(S(r.addingShapeRef))):Ie.dispatch(g(r.addingShapeRef)),requestAnimationFrame((function(){Ie.dispatch(k())}))}},t.handleStageOnMouseMove=function(e){var n=Ie.getState(),r=n.shapes,o=n.stage;if(t.state.mouseIsDown&&r.addingShapeRef&&o.instance){var i=o.instance.absolutePosition(),a=e.evt,s=a.layerX,c=a.layerY;zo({shape:r.addingShapeRef,startPos:t.state.mouseStartPos,currentPos:{x:s-i.x,y:c-i.y},ratioShiftIsActive:o.ratioShiftIsActive})}},t}return e=s,(n=[{key:"componentDidMount",value:function(){if(this.canvasRef.current){var t=new Co(this.canvasRef.current);t.on("mousedown",this.handleStageOnMouseDown),t.on("mouseup",this.handleStageOnMouseUp),t.on("mousemove",this.handleStageOnMouseMove),Ie.dispatch(T(t)),this.canvasRef.current.tabIndex=1,this.props.onReady(Uo())}}},{key:"render",value:function(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(Po,{children:[(0,i.jsx)(Oo,{}),(0,i.jsx)("div",{ref:this.canvasRef,className:"canvas-el"})]}),(0,i.jsx)(Ho,{})]})}}])&&Go(e.prototype,n),r&&Go(e,r),s}(a.PureComponent),Jo=n(8523),Qo=n(484),ti=n(27),ei=n(5968);function ni(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}function ri(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var oi=function(t){var e=t.children,n=(0,a.useContext)(ei.z).state,r=n.menu,s=n.canvas.canvasApi,c=function(){var t,e=(t=o().mark((function t(e,n,i){var a,c;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a=e[0])){t.next=7;break}return t.next=4,(0,Qo.Z)(a);case 4:c=t.sent,null===s||void 0===s||s.blurShapes(),null===s||void 0===s||s.setImage({image:c.image,name:c.name,pos:{x:i.clientX-c.image.width/2,y:i.clientY-r.menuHeight-c.image.height/2}});case 7:ti.qP({eventCategory:ti.Ak.GlobalInteraction,eventAction:ti.UZ.DropImage});case 8:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){ni(i,r,o,a,s,"next",t)}function s(t){ni(i,r,o,a,s,"throw",t)}a(void 0)}))});return function(t,n,r){return e.apply(this,arguments)}}();return(0,i.jsx)(Jo.ZP,{onDrop:c,children:function(t){var n=t.getRootProps;return(0,i.jsx)("div",function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){ri(t,e,n[e])}))}return t}({},n(),{children:e}))}})},ii=n(3425),ai=(n(47),function(){return(0,i.jsx)("div",{className:"HowToStart",children:(0,ii.t)("how-to-start")})}),si=n(4753);function ci(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(r,o)}var ui=function(){var t=(0,a.useState)(!1),e=t[0],n=t[1],r=(0,a.useContext)(ei.z),s=r.state.canvas.canvasApi,u=r.dispatch,l=function(t){var e=(t.clipboardData||t.originalEvent.clipboardData).items,n=Array.from(e).find((function(t){return 0===t.type.indexOf("image")}));if(n){var r=n.getAsFile(),o=new Image;if(!r)throw new Error("blob data is null");var i=URL.createObjectURL(r);o.onload=function(){URL.revokeObjectURL(i),null===s||void 0===s||s.setImage({image:this,name:""})},o.onerror=function(t){console.error(t)},o.src=i}},h=function(){var t,e=(t=o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s){t.next=5;break}return t.next=3,s.getShapesAmount();case 3:e=t.sent,n(e>0);case 5:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){ci(i,r,o,a,s,"next",t)}function s(t){ci(i,r,o,a,s,"throw",t)}a(void 0)}))});return function(){return e.apply(this,arguments)}}();return(0,a.useEffect)((function(){document.addEventListener("paste",l);var t=c().noop,e=c().noop;return s&&(t=s.onShapeAdded(h),e=s.onShapeDeleted(h),h()),function(){document.removeEventListener("paste",l),t(),e(),null===s||void 0===s||s.blurShapes()}}),[s]),(0,i.jsxs)(oi,{children:[!e&&(0,i.jsx)(ai,{}),(0,i.jsx)($o,{onReady:function(t){u((0,si.T)(t))}})]})}},47:function(){throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> .HowToStart {\n|   position: absolute;\n|   top: 10%;")},6331:function(){throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> .canvas-el {\n|   outline: none;\n|   width: 100%;")},6267:function(){throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> .CanvasWrapper {\n|   overflow: hidden;\n|   height: 100%;")},4893:function(){throw new Error("Module parse failed: Unexpected token (1:0)\nYou may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders\n> .SaveCanvasEl {\n|   position: absolute;\n|   top: 100%;")}}]);