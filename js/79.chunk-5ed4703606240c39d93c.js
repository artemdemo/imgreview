"use strict";(self.webpackChunkimgreview=self.webpackChunkimgreview||[]).push([[79],{1369:(t,e,s)=>{s.d(e,{Z:()=>n});var o=s(8081),i=s.n(o),r=s(3645),a=s.n(r)()(i());a.push([t.id,".drop-image {\n  min-height: 300px;\n  padding: 10px;\n  border: 2px dashed lightgray;\n  width: 80%;\n  margin: 10px auto 0;\n  position: relative;\n  outline: none;\n}\n.drop-image::before {\n  content: 'Drop image here';\n  top: 50%;\n  left: 50%;\n  position: absolute;\n  transform: translate(-50%, -50%);\n  color: gray;\n  font-family: Lato, Arial, serif;\n}\n.drop-image_has-image {\n  margin: 0;\n  width: auto;\n  border: none;\n  padding: initial;\n  min-height: auto;\n  position: initial;\n}\n.drop-image_has-image::before {\n  display: none;\n}\n.drop-image_active {\n  border-color: lightblue;\n}\n",""]);const n=a},5504:(t,e,s)=>{s.d(e,{Z:()=>n});var o=s(8081),i=s.n(o),r=s(3645),a=s.n(r)()(i());a.push([t.id,".canvas-container {\n  overflow: hidden;\n  margin: 0 auto;\n  background: rgba(0, 0, 0, 0.03);\n}\n.canvas-scroll {\n  width: 100%;\n  overflow: auto;\n}\n.canvas-el {\n  outline: none;\n}\n",""]);const n=a},9461:(t,e,s)=>{s.r(e),s.d(e,{default:()=>Ws});var o=s(7294),i=s(958),r=s(4920),a=s(2246);const n=(0,a.Z)("ADD_SHAPE"),h=(0,a.Z)("SET_CURSOR"),c=(0,a.Z)("SET_STROKE_COLOR_TO_ACTIVE_SHAPE"),d=(0,a.Z)("SET_STROKE_WIDTH_TO_ACTIVE_SHAPE"),f=(0,a.Z)("SET_FONT_SIZE_TO_ACTIVE_SHAPE"),l=(0,a.Z)("DELETE_ACTIVE_SHAPES"),p=(0,a.Z)("DELETE_ALL_SHAPES"),w=(0,a.Z)("DELETE_SHAPE"),g=(0,a.Z)("BLUR_SHAPES"),y=(0,a.Z)("SCALE_SHAPES"),u=(0,a.Z)("CROP_SHAPES"),m=(0,a.Z)("SET_ADDING_SHAPE"),v=(0,a.Z)("DRAW_LAYERS"),b=(0,a.Z)("SKETCHIFY_ACTIVE_SHAPE");var E=s(3141),x=s(6486),S=s.n(x),k=s(5857),T=s(3972);const P=(0,a.Z)("SET_IMAGE"),A=(0,a.Z)("UPDATE_IMAGE_SIZE"),C=(0,a.Z)("CROP_IMAGE"),L={width:0,height:0,layer:new r.Z.Layer,instance:null},R=(0,T.Z)({[`${P}`]:(t,e)=>{const s=e.payload.image.getSize();return E.rJ(s),{...t,width:s.width,height:s.height,instance:e.payload.image}},[`${A}`]:(t,e)=>{const{width:s,height:o}=e.payload;return E.rJ({width:s,height:o}),{...t,width:s,height:o}},[`${C}`]:(t,e)=>{const{x:s,y:o,width:i,height:r}=e.payload;return t.instance?.crop(s,o,i,r),t.layer.draw(),t}},L),M=(0,a.Z)("SET_STAGE"),W=(0,a.Z)("SET_STAGE_SIZE"),Z=(0,T.Z)({[`${M}`]:(t,e)=>({...t,instance:e.payload}),[`${W}`]:(t,e)=>{const{width:s,height:o}=e.payload;return t.instance?.setAttrs({width:s,height:o}),t}},{instance:null});var D,_;!function(t){t.AUTO="auto",t.MOVE="move",t.POINTER="pointer"}(D||(D={})),function(t){t.SHAPES_LAYER="shapes_layer",t.ANCHORS_LAYER="anchors_layer"}(_||(_={}));var O,H,I=s(736),z=s(4247),U=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},$=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};O=new WeakMap,H=new WeakMap;const F=class{constructor(){this.type=I.Z.SHAPE,O.set(this,!1),H.set(this,!1),this.onClick=t=>{E.QA(this),t.cancelBubble=!0,this.focus();const e=this.cbMap.get("click");e&&e(this)},this.onDragStart=()=>{E.QY(this),this.focus();const t=this.cbMap.get("dragstart");t&&t(this)},this.cbMap=new Map}blur(){U(this,O,!1,"f")}focus(){U(this,O,!0,"f")}isSelected(){return $(this,O,"f")}isConnected(){return $(this,H,"f")}on(t,e){this.cbMap.set(t,e)}addToLayer(t,e){U(this,H,!0,"f")}clone(){console.warn("clone() is not implemented"),console.warn(this)}crop(t){console.warn("crop() is not implemented"),console.warn(this)}draggable(t){console.warn("draggable() is not implemented"),console.warn(this)}attachBasicEvents(t){t.on("click",this.onClick),t.on("dragstart",this.onDragStart),t.on("mouseover",(()=>{const t=this.cbMap.get("mouseover");t&&t()})),t.on("mouseout",(()=>{const t=this.cbMap.get("mouseout");t&&t()}))}destroy(){const t=this.cbMap.get("_beforedestroy");t&&t()}};var j,G,B,N,K=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},Y=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};!function(t){t.left="left",t.top="top",t.right="right",t.bottom="bottom",t.leftTop="leftTop",t.leftBottom="leftBottom",t.rightTop="rightTop",t.rightBottom="rightBottom"}(N||(N={}));const X={width:10,height:10,stroke:"#2196f3",strokeWidth:1,fill:"#ffffff",draggable:!0};j=new WeakMap,G=new WeakMap,B=new WeakMap;const V=class{constructor(t){j.set(this,void 0),G.set(this,void 0),B.set(this,void 0),this.onDragMove=t=>{const e=Y(this,j,"f").get("dragmove");e&&e(Y(this,B,"f").type,t)},K(this,B,t,"f"),K(this,j,new Map,"f"),K(this,G,new r.Z.Rect({...X,x:t.x-X.width/2,y:t.y-X.height/2,dragBoundFunc:t=>({x:t.x,y:t.y})}),"f"),Y(this,G,"f").on("dragmove",this.onDragMove)}show(){Y(this,G,"f").visible(!0)}hide(){Y(this,G,"f").visible(!1)}on(t,e){Y(this,j,"f").set(t,e)}getCenterPosition(){const t=Y(this,G,"f").getAttrs();return{x:t.x+X.width/2,y:t.y+X.height/2}}setCenterPosition(t){const e=this.getCenterPosition(),s=t.x||e.x,o=t.y||e.y;Y(this,G,"f").setAttrs({x:s-X.width/2,y:o-X.height/2})}addToLayer(t){t.add(Y(this,G,"f"))}destroy(){Y(this,G,"f").destroy()}};var J,q,Q,tt=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},et=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class st{constructor(t,e){J.set(this,void 0),q.set(this,void 0),Q.set(this,void 0),this.onMoveAnchor=t=>{et(this,Q,"f")?this.moveCornerAnchor(t):this.moveMiddleAnchor(t)},tt(this,q,{left:new V({...st.calcAnchorPosition(e?N.leftTop:N.left,t),type:e?N.leftTop:N.left}),top:new V({...st.calcAnchorPosition(e?N.rightTop:N.top,t),type:e?N.rightTop:N.top}),right:new V({...st.calcAnchorPosition(e?N.rightBottom:N.right,t),type:e?N.rightBottom:N.right}),bottom:new V({...st.calcAnchorPosition(e?N.leftBottom:N.bottom,t),type:e?N.leftBottom:N.bottom})},"f"),tt(this,Q,e,"f"),tt(this,J,new Map,"f"),et(this,q,"f").left.on("dragmove",this.onMoveAnchor),et(this,q,"f").top.on("dragmove",this.onMoveAnchor),et(this,q,"f").right.on("dragmove",this.onMoveAnchor),et(this,q,"f").bottom.on("dragmove",this.onMoveAnchor)}static calcAnchorPosition(t,e){switch(t){case N.left:return{x:e.x,y:e.y+e.height/2};case N.top:return{x:e.x+e.width/2,y:e.y};case N.right:return{x:e.x+e.width,y:e.y+e.height/2};case N.bottom:return{x:e.x+e.width/2,y:e.y+e.height};case N.leftTop:return{x:e.x,y:e.y};case N.rightTop:return{x:e.x+e.width,y:e.y};case N.rightBottom:return{x:e.x+e.width,y:e.y+e.height};case N.leftBottom:return{x:e.x,y:e.y+e.height};default:throw new Error(`Position can't be calculated for given type: ${t}`)}}moveMiddleAnchor(t){const e=et(this,q,"f").left.getCenterPosition(),s=et(this,q,"f").top.getCenterPosition(),o=et(this,q,"f").right.getCenterPosition(),i=et(this,q,"f").bottom.getCenterPosition(),r=o.x-e.x,a=i.y-s.y,n=a<0?i:s,h=r<0?o:e;t===N.left||t===N.right?(et(this,q,"f").top.setCenterPosition({x:e.x+r/2}),et(this,q,"f").bottom.setCenterPosition({x:e.x+r/2})):t!==N.top&&t!==N.bottom||(et(this,q,"f").left.setCenterPosition({y:s.y+a/2}),et(this,q,"f").right.setCenterPosition({y:s.y+a/2}));const c=et(this,J,"f").get("dragmove");c&&c({x:h.x,y:n.y,width:Math.abs(r),height:Math.abs(a)})}moveCornerAnchor(t){const e=et(this,q,"f").left.getCenterPosition(),s=et(this,q,"f").top.getCenterPosition(),o=et(this,q,"f").right.getCenterPosition(),i=et(this,q,"f").bottom.getCenterPosition();let r,a=0,n=0;switch(t){case N.leftTop:a=s.x-e.x,n=i.y-e.y,et(this,q,"f").bottom.setCenterPosition({x:e.x}),et(this,q,"f").top.setCenterPosition({y:e.y});break;case N.leftBottom:a=o.x-i.x,n=i.y-e.y,et(this,q,"f").left.setCenterPosition({x:i.x}),et(this,q,"f").right.setCenterPosition({y:i.y});break;case N.rightTop:a=s.x-e.x,n=o.y-s.y,et(this,q,"f").left.setCenterPosition({y:s.y}),et(this,q,"f").right.setCenterPosition({x:s.x});break;case N.rightBottom:a=o.x-i.x,n=o.y-s.y,et(this,q,"f").top.setCenterPosition({x:o.x}),et(this,q,"f").bottom.setCenterPosition({y:o.y});break;default:throw new Error(`Width and height can't be calculated for the given type: ${t}`)}r=n<0?a<0?o:i:a<0?s:e;const h=et(this,J,"f").get("dragmove");h&&h({x:r.x,y:r.y,width:Math.abs(a),height:Math.abs(n)})}on(t,e){et(this,J,"f").set(t,e)}updatePosition(t){et(this,q,"f").left.setCenterPosition(st.calcAnchorPosition(et(this,Q,"f")?N.leftTop:N.left,t)),et(this,q,"f").top.setCenterPosition(st.calcAnchorPosition(et(this,Q,"f")?N.rightTop:N.top,t)),et(this,q,"f").right.setCenterPosition(st.calcAnchorPosition(et(this,Q,"f")?N.rightBottom:N.right,t)),et(this,q,"f").bottom.setCenterPosition(st.calcAnchorPosition(et(this,Q,"f")?N.leftBottom:N.bottom,t))}show(){et(this,q,"f").left.show(),et(this,q,"f").top.show(),et(this,q,"f").right.show(),et(this,q,"f").bottom.show()}hide(){et(this,q,"f").left.hide(),et(this,q,"f").top.hide(),et(this,q,"f").right.hide(),et(this,q,"f").bottom.hide()}addToLayer(t){et(this,q,"f").left.addToLayer(t),et(this,q,"f").top.addToLayer(t),et(this,q,"f").right.addToLayer(t),et(this,q,"f").bottom.addToLayer(t)}destroy(){et(this,q,"f").left.destroy(),et(this,q,"f").top.destroy(),et(this,q,"f").right.destroy(),et(this,q,"f").bottom.destroy()}}J=new WeakMap,q=new WeakMap,Q=new WeakMap;const ot=st;var it,rt,at=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},nt=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};it=new WeakMap,rt=new WeakMap;class ht extends F{constructor(t){super(),this.type=I.Z.RECT,this.onDragMove=t=>{const e=this.cbMap.get("dragmove");e&&e(t),this.sizeTransform?.update(this.getSizePos())},this.getSizePos=()=>{const{x:t,y:e,width:s,height:o}=this.getAttrs();return{x:t,y:e,width:s,height:o}},this.onDragMoveAnchor=t=>{this.setShapeAttrs(t)},this.props={...t}}defineShape(){this.shape=new r.Z.Rect({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,dash:this.props.dash,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth,fill:this.props.fill,draggable:!0})}addToLayer(t,e){super.addToLayer(t,e),this.defineShape(),this.shape.on("dragmove",this.onDragMove),super.attachBasicEvents(this.shape),this.sizeTransform=new class{constructor(t){it.set(this,void 0),rt.set(this,void 0),this.onDragMove=t=>{const e=nt(this,it,"f").get("_dragmoveanchor");if(!e)throw new Error('"_dragmoveanchor" should be defined');e(t)},at(this,it,new Map,"f"),at(this,rt,new ot(t,!0),"f"),nt(this,rt,"f").on("dragmove",this.onDragMove)}on(t,e){nt(this,it,"f").set(t,e)}update(t,e=!0){nt(this,rt,"f").updatePosition(t),e&&Rt.dispatch(v(_.ANCHORS_LAYER))}addToLayer(t){nt(this,rt,"f").addToLayer(t)}show(){nt(this,rt,"f").show()}hide(){nt(this,rt,"f").hide()}destroy(){nt(this,rt,"f").destroy()}}(this.getSizePos()),this.sizeTransform.on("_dragmoveanchor",this.onDragMoveAnchor),this.focus(),t.add(this.shape),this.sizeTransform.addToLayer(e)}blur(){super.blur(),this.sizeTransform?.hide()}focus(){super.focus(),this.sizeTransform?.show()}getFillColor(){return this.shape?.getAttr("fill")}setFillColor(t){this.shape?.setAttr("fill",t)}getStrokeColor(){return this.shape?.getAttr("stroke")}getAttrs(){return this.shape?.getAttrs()}hide(){this.shape?.setAttrs({stroke:"transparent"})}setShapeAttrs(t){this.shape?.setAttrs(t),Rt.dispatch(v(_.SHAPES_LAYER))}setAttrs(t){this.setShapeAttrs(t),this.sizeTransform?.update(this.getSizePos())}setStrokeColor(t){this.shape?.setAttr("stroke",t)}setStrokeWidth(t){this.shape?.setAttrs({strokeWidth:t})}getStrokeWidth(){return this.shape?.getAttr("strokeWidth")}draggable(t){return this.shape?.setAttr("draggable",t),this.shape?.getAttr("draggable")}scale(t){const{x:e,y:s,width:o,height:i}=this.getAttrs();this.shape?.setAttrs({x:e*t.wFactor,y:s*t.hFactor,width:o*t.wFactor,height:i*t.hFactor}),this.sizeTransform?.update(this.getSizePos(),!1)}getCloningProps(){const t=this.shape?.getAttrs();return{...this.props,...t&&{x:t.x,y:t.y,width:t.width,height:t.height,stroke:t.stroke,strokeWidth:t.strokeWidth}}}crop(t){const{x:e,y:s}=this.getAttrs();this.shape?.setAttrs({x:e-t.x,y:s-t.y}),this.sizeTransform?.update(this.getSizePos(),!1)}clone(){return new ht(this.getCloningProps())}initDraw(t,e){this.type===I.Z.RECT&&this.blur(),this.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y})}destroy(){super.destroy(),this.shape?.destroy(),this.sizeTransform?.destroy()}}const ct=ht,dt=(t,e,s="nonzero")=>{t.beginPath();for(const s of e.ops){const e=s.data;switch(s.op){case"move":t.moveTo(e[0],e[1]);break;case"bcurveTo":t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"lineTo":t.lineTo(e[0],e[1])}}"fillPath"===e.type?t.fill(s):t.stroke()},ft=(t,e,s)=>{let o=s.fillWeight;o<0&&(o=s.strokeWidth/2),t.save(),s.fillLineDash&&t.setLineDash(s.fillLineDash),s.fillLineDashOffset&&(t.lineDashOffset=s.fillLineDashOffset),t.strokeStyle=s.fill||"",t.lineWidth=o,dt(t,e),t.restore()},lt=(t,e)=>{const s=e.sets||[],o=e.options;for(const i of s)switch(i.type){case"path":t.save(),t.strokeStyle="none"===o.stroke?"transparent":o.stroke,t.lineWidth=o.strokeWidth,o.strokeLineDash&&t.setLineDash(o.strokeLineDash),o.strokeLineDashOffset&&(t.lineDashOffset=o.strokeLineDashOffset),dt(t,i),t.restore();break;case"fillPath":t.save(),t.fillStyle=o.fill||"";const s="curve"===e.shape||"polygon"===e.shape?"evenodd":"nonzero";dt(t,i,s),t.restore();break;case"fillSketch":ft(t,i,o)}};var pt,wt,gt,yt=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},ut=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class mt extends ct{constructor(t){super(t),this.type=I.Z.RECT_ROUGH,pt.set(this,void 0),wt.set(this,void 0),gt.set(this,!1),this.prevWidth=0,this.prevHeight=0,this.onDragMoveSubRect=t=>{const e=this.cbMap.get("dragmove");e&&e(t);const s=this.getSizePosSubRect();this.sizeTransform?.update(s),this.shape?.setAttrs(s)},this.onDragMoveAnchor=t=>{this.substrateKonvaShape?.setAttrs(t),this.setShapeAttrs(t)},this.getSizePosSubRect=()=>{const{x:t,y:e,width:s,height:o}=this.substrateKonvaShape?.getAttrs();return{x:t,y:e,width:s,height:o}},this.props={...t};const e=vs();yt(this,pt,z.Z.canvas(e),"f")}defineShape(){this.shape=new r.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:(t,e)=>{const s=e.getWidth(),o=e.getHeight(),i=e.getStroke(),r=e.getStrokeWidth();s===this.prevWidth&&o===this.prevHeight&&ut(this,wt,"f")?(ut(this,wt,"f").options.stroke=i,ut(this,wt,"f").options.strokeWidth=r):(this.prevWidth=s,this.prevHeight=o,yt(this,wt,ut(this,pt,"f").generator.rectangle(0,0,s,o,{roughness:2.5,stroke:i,strokeWidth:r}),"f")),lt(t,ut(this,wt,"f")),t.fillStrokeShape(e)}}),this.substrateKonvaShape=new r.Z.Rect({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:"transparent",fill:"transparent",draggable:!0}),this.shape.on("dragstart",(()=>{yt(this,gt,!0,"f")})),this.shape.on("dragend",(()=>{yt(this,gt,!1,"f")})),this.substrateKonvaShape.on("dragstart",(()=>{yt(this,gt,!0,"f")})),this.substrateKonvaShape.on("dragend",(()=>{yt(this,gt,!1,"f")})),this.substrateKonvaShape.on("click",(t=>{this.onClick(t)})),this.substrateKonvaShape.on("dragstart",(()=>{this.onDragStart()})),this.substrateKonvaShape.on("mouseover",(()=>{const t=this.cbMap.get("mouseover");t&&t()})),this.substrateKonvaShape.on("mouseout",(()=>{const t=this.cbMap.get("mouseout");t&&t()}))}setStrokeWidth(t){super.setStrokeWidth(t/2)}getStrokeWidth(){return 2*super.getStrokeWidth()}addToLayer(t,e){if(super.addToLayer(t,e),!this.substrateKonvaShape)throw new Error("`this.substrateKonvaShape` is not defined");this.substrateKonvaShape.on("dragmove",this.onDragMoveSubRect),t.add(this.substrateKonvaShape)}draggable(t){const e=super.draggable(t);return this.substrateKonvaShape?.setAttr("draggable",t),e}initDraw(t,e){this.substrateKonvaShape?.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y}),super.initDraw(t,e)}destroy(){super.destroy(),this.substrateKonvaShape?.destroy()}scale(t){super.scale(t);const{x:e,y:s,width:o,height:i}=this.getAttrs();this.substrateKonvaShape?.setAttrs({x:e,y:s,width:o,height:i})}crop(t){super.crop(t);const{x:e,y:s}=this.getAttrs();this.substrateKonvaShape?.setAttrs({x:e,y:s})}clone(){return new mt(this.getCloningProps())}}pt=new WeakMap,wt=new WeakMap,gt=new WeakMap;const vt=mt;var bt,Et,xt,St=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},kt=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class Tt extends ct{constructor(t){super(t),this.type=I.Z.ELLIPSE_ROUGH,bt.set(this,void 0),Et.set(this,void 0),xt.set(this,!1),this.prevWidth=0,this.prevHeight=0,this.props={...t};const e=vs();St(this,bt,z.Z.canvas(e),"f")}defineShape(){this.shape=new r.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:(t,e)=>{const s=e.getWidth(),o=e.getHeight();s===this.prevWidth&&o===this.prevHeight&&kt(this,Et,"f")?kt(this,Et,"f").options.stroke=e.getStroke():(this.prevWidth=s,this.prevHeight=o,St(this,Et,kt(this,bt,"f").generator.ellipse(s/2,o/2,s,o,{roughness:2.5,stroke:e.getStroke()}),"f")),lt(t,kt(this,Et,"f")),t.fillStrokeShape(e)}}),this.shape.on("dragstart",(()=>{St(this,xt,!0,"f")})),this.shape.on("dragend",(()=>{St(this,xt,!1,"f")}))}setStrokeWidth(t){super.setStrokeWidth(t/2)}getStrokeWidth(){return 2*super.getStrokeWidth()}scale(t){super.scale(t)}clone(){return new Tt(this.getCloningProps())}}bt=new WeakMap,Et=new WeakMap,xt=new WeakMap;const Pt=Tt,At={cursor:D.AUTO,shapesLayer:new r.Z.Layer,anchorsLayer:new r.Z.Layer,list:[],addingShapeRef:null},Ct=(0,T.Z)({[`${n}`]:(t,e)=>(e.payload.addToLayer(t.shapesLayer,t.anchorsLayer),t.shapesLayer.draw(),t.anchorsLayer.draw(),{...t,list:[...t.list,e.payload]}),[`${m}`]:(t,e)=>{t.addingShapeRef&&e.payload?.type&&t.addingShapeRef.type!==e.payload.type&&t.addingShapeRef.destroy();const s=S().get(e.payload,"type",null),o=S().get(e.payload,"options",null);let i=null;switch(s){case I.Z.ARROW:i=Ke(void 0,o);break;case I.Z.TEXT:i=Xe(void 0,o);break;case I.Z.RECT:case I.Z.RECT_ROUGH:case I.Z.ELLIPSE:case I.Z.ELLIPSE_ROUGH:case I.Z.SELECT_RECT:i=Je(void 0,o,s);break;case null:i=null;break;default:console.error(`Can't set adding shape for the selected shape type: ${s}`)}return{...t,addingShapeRef:i}},[`${p}`]:t=>(t.list.forEach((t=>t.destroy())),t.shapesLayer.draw(),t.anchorsLayer.draw(),{...t,list:[]}),[`${w}`]:(t,e)=>{const s=t.list.find((t=>t===e.payload));return s&&s.destroy(),E.Jt(e.payload),{...t,list:t.list.filter((t=>t!==e.payload))}},[`${g}`]:(t,e)=>(t.list.forEach((t=>{t!==e.payload&&t.blur()})),t.anchorsLayer.draw(),t.shapesLayer.draw(),E.Jt(e.payload),t),[`${u}`]:(t,e)=>(t.list.forEach((t=>{t.crop(e.payload)})),t.shapesLayer.draw(),t.anchorsLayer.draw(),t),[`${l}`]:t=>{const e=t.list.find((t=>t.isSelected()));return e&&e.destroy(),t.shapesLayer.draw(),t.anchorsLayer.draw(),E.Jt(),{...t,list:t.list.filter((t=>t!==e))}},[`${h}`]:(t,e)=>({...t,cursor:e.payload}),[`${c}`]:(t,e)=>{const s=t.list.find((t=>t.isSelected()));switch(s?.type){case I.Z.ARROW:case I.Z.RECT:case I.Z.RECT_ROUGH:case I.Z.ELLIPSE:case I.Z.ELLIPSE_ROUGH:s.setStrokeColor(e.payload);break;case I.Z.TEXT:s.setFillColor(e.payload);break;default:console.error("Can't set stroke color for the selected shape"),console.log(s)}return t.shapesLayer.draw(),t},[`${d}`]:(t,e)=>{const s=t.list.find((t=>t.isSelected()));switch(s?.type){case I.Z.ARROW:case I.Z.RECT:case I.Z.RECT_ROUGH:case I.Z.ELLIPSE:case I.Z.ELLIPSE_ROUGH:s.setStrokeWidth(e.payload);break;default:console.error("Can't set stroke width for the selected shape"),console.log(s)}return t.shapesLayer.draw(),t},[`${f}`]:(t,e)=>{const s=t.list.find((t=>t.isSelected()));return s?.type===I.Z.TEXT?s.setFontSize(e.payload):(console.error("Can't set font size for the selected shape"),console.log(s)),t.shapesLayer.draw(),t.anchorsLayer.draw(),t},[`${y}`]:(t,e)=>(e.payload&&t.list.forEach((t=>t.scale(e.payload))),t.shapesLayer.draw(),t),[`${v}`]:(t,e)=>{switch(e.payload){case _.SHAPES_LAYER:t.shapesLayer.draw();break;case _.ANCHORS_LAYER:t.anchorsLayer.draw();break;default:t.shapesLayer.draw(),t.anchorsLayer.draw()}return t},[`${b}`]:(t,e)=>{const s=t.list.find((t=>t.isSelected()));switch(s?.type){case I.Z.RECT:case I.Z.ELLIPSE:const e=s.getCloningProps(),o=s?.type===I.Z.RECT?vt:Pt,i=Je(new o(e));i.addToLayer(t.shapesLayer,t.anchorsLayer);const r=t.list.map((t=>t===s?(t.destroy(),i):t));return t.shapesLayer.draw(),t.anchorsLayer.draw(),E.f6(i),{...t,list:r};default:console.error("Can't sketchify the selected shape"),console.log(s)}return t}},At),Lt=(0,k.UY)({image:R,stage:Z,shapes:Ct}),Rt=(0,k.MT)(Lt,(0,k.md)()),Mt=(t,e)=>{const s=0-e.x,o=t.x-e.x,i=t.y-e.y,r=s*o+0*i,a=Math.sqrt(s**2+0)*Math.sqrt(o**2+i**2);if(0===a)return 0;const n=Math.acos(r/a);return t.y>e.y?2*Math.PI-n:n},Wt=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2);var Zt,Dt,_t,Ot,Ht,It=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},zt=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class Ut{constructor(t){Zt.set(this,void 0),Dt.set(this,void 0),_t.set(this,void 0),Ot.set(this,!1),Ht.set(this,{x:0,y:0}),It(this,Dt,{x:0,y:0},"f"),t instanceof r.Z.Image?It(this,Zt,t,"f"):It(this,Zt,new r.Z.Image({image:t}),"f")}static clickHandler(){E.Du()}addToLayer(t){It(this,_t,t,"f"),t.add(zt(this,Zt,"f")),this.bindClickEvent(),zt(this,_t,"f").draw()}bindClickEvent(){zt(this,_t,"f")?.on("mousedown",(t=>{It(this,Ot,!0,"f"),It(this,Ht,{x:t.evt.layerX,y:t.evt.layerY},"f")})),zt(this,_t,"f")?.on("mouseup",(t=>{const{x:e,y:s}=zt(this,Ht,"f");Wt({x:e,y:s},{x:t.evt.layerX,y:t.evt.layerY})<10&&Ut.clickHandler(),It(this,Ot,!1,"f")}))}crop(t,e,s,o){zt(this,Dt,"f").x+=t,zt(this,Dt,"f").y+=e,zt(this,Zt,"f").crop({x:zt(this,Dt,"f").x,y:zt(this,Dt,"f").y,width:s,height:o}),zt(this,Zt,"f").width(s),zt(this,Zt,"f").height(o)}destroy(){zt(this,_t,"f")?.off("click",Ut.clickHandler),zt(this,Zt,"f").destroy()}getSize(){return{width:zt(this,Zt,"f").width(),height:zt(this,Zt,"f").height()}}setSize(t,e){zt(this,Zt,"f").width(t),zt(this,Zt,"f").height(e),zt(this,_t,"f")?.draw()}}Zt=new WeakMap,Dt=new WeakMap,_t=new WeakMap,Ot=new WeakMap,Ht=new WeakMap;const $t=Ut;var Ft,jt,Gt,Bt,Nt,Kt=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},Yt=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};const Xt={radius:5,stroke:"#855824",fill:"#dddd45",strokeWidth:1},Vt={radius:6,stroke:"#666",fill:"#ddd",strokeWidth:1};var Jt;!function(t){t.START="start",t.CONTROL="control",t.END="end"}(Jt||(Jt={})),Ft=new WeakMap,jt=new WeakMap,Gt=new WeakMap,Bt=new WeakMap,Nt=new WeakMap;const qt=class{constructor(t,e,s){Ft.set(this,void 0),jt.set(this,void 0),Gt.set(this,void 0),Bt.set(this,void 0),Nt.set(this,void 0),this.on=(t,e)=>{Yt(this,jt,"f").set(t,e)};let o={x:t,y:e,draggable:!0,visible:!1,...Vt};s===Jt.CONTROL&&(o={...o,...Xt}),Kt(this,Ft,new r.Z.Circle(o),"f"),Kt(this,Nt,{x:t,y:e},"f"),Kt(this,Gt,{x:0,y:0},"f"),Kt(this,Bt,{x:0,y:0},"f"),Kt(this,jt,new Map,"f"),this.initEvents()}initEvents(){Yt(this,Ft,"f").on("mouseover",((...t)=>{const e=Yt(this,jt,"f").get("mouseover");e&&e(t)})),Yt(this,Ft,"f").on("mouseout",((...t)=>{const e=Yt(this,jt,"f").get("mouseout");e&&e(t)})),Yt(this,Ft,"f").on("mousedown",((...t)=>{const e=Yt(this,jt,"f").get("mousedown");e&&e(t)})),Yt(this,Ft,"f").on("mouseup",((...t)=>{const e=Yt(this,jt,"f").get("mouseup");e&&e(t)})),Yt(this,Ft,"f").on("dragend",((...t)=>{const e=Yt(this,jt,"f").get("dragend");e&&e(t);const s=this.getPosition();Yt(this,Nt,"f").x=s.x,Yt(this,Nt,"f").y=s.y,Yt(this,Bt,"f").x=Yt(this,Gt,"f").x,Yt(this,Bt,"f").y=Yt(this,Gt,"f").y})),Yt(this,Ft,"f").on("dragmove",S().throttle(((...t)=>{const e=Yt(this,jt,"f").get("dragmove");e&&e(t)}),50))}getAnchor(){return Yt(this,Ft,"f")}setPosition(t,e){Yt(this,Ft,"f").setAttr("x",t),Yt(this,Ft,"f").setAttr("y",e),Yt(this,Nt,"f").x=t,Yt(this,Nt,"f").y=e,Yt(this,Bt,"f").x=Yt(this,Gt,"f").x,Yt(this,Bt,"f").y=Yt(this,Gt,"f").y}getPosition(){const{x:t,y:e}=Yt(this,Ft,"f").getAttrs();return{x:t,y:e}}draw(){Yt(this,Ft,"f").draw()}setDelta(t=0,e=0){Yt(this,Ft,"f").setAttr("x",Yt(this,Nt,"f").x+(t-Yt(this,Bt,"f").x)),Yt(this,Ft,"f").setAttr("y",Yt(this,Nt,"f").y+(e-Yt(this,Bt,"f").y)),Yt(this,Gt,"f").x=t,Yt(this,Gt,"f").y=e}setAttr(t,e){Yt(this,Ft,"f").setAttr(t,e)}visible(t){Yt(this,Ft,"f").visible(t)}destroy(){Yt(this,Ft,"f").destroy()}};var Qt,te,ee,se,oe=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},ie=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class re{constructor(t){Qt.set(this,void 0),te.set(this,void 0),ee.set(this,void 0),se.set(this,void 0),this.moveStart=()=>{if(!ie(this,Qt,"f"))throw new Error("`this.#anchors` is not defined");const t=ie(this,Qt,"f").start.getPosition(),e=ie(this,Qt,"f").end.getPosition(),s=Mt(t,e),o=s-ie(this,ee,"f").angles.start,i=this.calculateMovedControlPos(this.calculateRotatedControlPos(o,e),"end");ie(this,Qt,"f").control.setPosition(i.x,i.y),this.moveControl(),ie(this,ee,"f").start=t,ie(this,ee,"f").control=i,ie(this,ee,"f").end=e,ie(this,ee,"f").angles.start=s,ie(this,ee,"f").angles.end=Math.PI+s},this.moveControl=()=>{const t=ie(this,se,"f").get("dragmove");t&&t()},this.moveEnd=()=>{if(!ie(this,Qt,"f"))throw new Error("`this.#anchors` is not defined");const t=ie(this,Qt,"f").start.getPosition(),e=ie(this,Qt,"f").end.getPosition(),s=Mt(e,t),o=s-ie(this,ee,"f").angles.end,i=this.calculateMovedControlPos(this.calculateRotatedControlPos(o,t),"start");ie(this,Qt,"f").control.setPosition(i.x,i.y),this.moveControl(),ie(this,ee,"f").start=t,ie(this,ee,"f").control=i,ie(this,ee,"f").end=e,ie(this,ee,"f").angles.start=Math.PI+s,ie(this,ee,"f").angles.end=s},this.onDragEnd=()=>{const t=ie(this,se,"f").get("dragend");t&&t()},this.visible=t=>{ie(this,Qt,"f")?.start.visible(t),ie(this,Qt,"f")?.control.visible(t),ie(this,Qt,"f")?.end.visible(t)},this.on=(t,e)=>{ie(this,se,"f").set(t,e)},oe(this,te,t,"f"),oe(this,ee,{start:{x:0,y:0},control:{x:0,y:0},end:{x:0,y:0},angles:{start:S().get(t,"angles.start",0),control:S().get(t,"angles.control",0),end:S().get(t,"angles.end",Math.PI)}},"f"),oe(this,se,new Map,"f")}static defineAnchors(t,e,s){let o,i,r,a,n,h;return s?(o=s.start.x,i=s.start.y,r=s.control.x,a=s.control.y,n=s.end.x,h=s.end.y):(o=t.width/4,i=t.height/2,r=t.width/2,a=i,n=3*o,h=i,Math.abs(n-o)>e&&(o=r-e/2,n=r+e/2)),{start:new qt(o,i,Jt.START),control:new qt(r,a,Jt.CONTROL),end:new qt(n,h,Jt.END)}}calculateRotatedControlPos(t,e){if(!ie(this,Qt,"f"))throw new Error("`this.#anchors` is not defined");const s=ie(this,Qt,"f").control.getPosition(),o=s.x-e.x,i=s.y-e.y,r=Math.cos(t),a=Math.sin(t),n=i*r+o*a;return{x:o*r-i*a+e.x,y:n+e.y}}calculateMovedControlPos(t,e){if(!ie(this,Qt,"f"))throw new Error("`this.#anchors` is not defined");const s=Wt(ie(this,ee,"f").start,ie(this,ee,"f").end),o=ie(this,Qt,"f").start.getPosition(),i=ie(this,Qt,"f").end.getPosition(),r=Wt(o,i)/s,a="start"===e?o:i,n=Wt(t,a),h=(a.x-t.x)/n,c=(a.y-t.y)/n,d=n-n*r;return{x:t.x+d*h,y:t.y+d*c}}draw(){ie(this,Qt,"f")?.start.draw(),ie(this,Qt,"f")?.control.draw(),ie(this,Qt,"f")?.end.draw(),Rt.dispatch(v(_.ANCHORS_LAYER))}setAnchors(t,e){oe(this,Qt,re.defineAnchors(t,e,ie(this,te,"f")),"f"),ie(this,ee,"f").start=ie(this,Qt,"f").start.getPosition(),ie(this,ee,"f").control=ie(this,Qt,"f").control.getPosition(),ie(this,ee,"f").end=ie(this,Qt,"f").end.getPosition(),ie(this,Qt,"f").start.on("dragmove",this.moveStart),ie(this,Qt,"f").control.on("dragmove",this.moveControl),ie(this,Qt,"f").end.on("dragmove",this.moveEnd),ie(this,Qt,"f").start.on("dragend",this.onDragEnd),ie(this,Qt,"f").control.on("dragend",this.onDragEnd),ie(this,Qt,"f").end.on("dragend",this.onDragEnd)}addToLayer(t){if(!ie(this,Qt,"f"))throw new Error("`this.#anchors` is not defined");t.add(ie(this,Qt,"f").start.getAnchor()),t.add(ie(this,Qt,"f").control.getAnchor()),t.add(ie(this,Qt,"f").end.getAnchor())}getPositions(){return!ie(this,Qt,"f")&&ie(this,te,"f")?ie(this,te,"f"):{start:ie(this,Qt,"f").start.getPosition(),control:ie(this,Qt,"f").control.getPosition(),end:ie(this,Qt,"f").end.getPosition(),angles:ie(this,ee,"f")?.angles}}setAnchorsCoordinates(t){ie(this,ee,"f").start=t.start,ie(this,ee,"f").control=t.control,ie(this,ee,"f").end=t.end,ie(this,Qt,"f")?.start.setPosition(t.start.x,t.start.y),ie(this,Qt,"f")?.control.setPosition(t.control.x,t.control.y),ie(this,Qt,"f")?.end.setPosition(t.end.x,t.end.y);const e=Mt(t.start,t.end);ie(this,ee,"f").angles.start=e,ie(this,ee,"f").angles.end=Math.PI+e}setDelta(t,e){ie(this,Qt,"f")?.start.setDelta(t,e),ie(this,Qt,"f")?.control.setDelta(t,e),ie(this,Qt,"f")?.end.setDelta(t,e)}destroy(){ie(this,Qt,"f")?.start?.destroy(),ie(this,Qt,"f")?.control?.destroy(),ie(this,Qt,"f")?.end?.destroy()}}Qt=new WeakMap,te=new WeakMap,ee=new WeakMap,se=new WeakMap;const ae=re;var ne,he,ce,de,fe=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},le=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};const pe=t=>t*(Math.PI/180);class we{constructor(t){ne.set(this,void 0),he.set(this,void 0),ce.set(this,void 0),de.set(this,void 0),this.on=(t,e)=>{le(this,he,"f").set(t,e)},fe(this,ne,new r.Z.Line({lineCap:"round",lineJoin:"round",stroke:t.stroke,strokeWidth:t.strokeWidth,points:we.calculateHeadPoints(t.start,t.control,t.strokeWidth)}),"f"),fe(this,he,new Map,"f"),le(this,ne,"f").on("click",(t=>{const e=le(this,he,"f").get("click");e&&e(t)})),le(this,ne,"f").on("mouseover",(t=>{const e=le(this,he,"f").get("mouseover");e&&e(t)})),le(this,ne,"f").on("mouseout",(t=>{const e=le(this,he,"f").get("mouseout");e&&e(t)})),fe(this,ce,{x:0,y:0},"f"),fe(this,de,{x:0,y:0},"f")}static calculateHeadPoints(t,e,s){const o={x:0,y:0},i={x:0,y:0};let r;const a=t.x-e.x,n=t.y-e.y;0===a?r=t.y<e.y?pe(90):pe(270):(r=Math.atan(n/a),a>0&&(r+=pe(180)));const h=10*s,c=pe(Math.min(40,h<20?20:h)),d=Math.min(14,4.5*s),f=c-r;o.x=t.x+d*Math.cos(f),o.y=t.y-d*Math.sin(f);const l=pe(90)-(r+c);return i.x=t.x+d*Math.sin(l),i.y=t.y+d*Math.cos(l),[i.x,i.y,t.x,t.y,o.x,o.y]}update(t,e,s){le(this,ne,"f").setPoints(we.calculateHeadPoints(t,e,s)),le(this,ne,"f").setAttrs({x:0,y:0,strokeWidth:s}),le(this,ne,"f").draw(),le(this,de,"f").x=le(this,ce,"f").x,le(this,de,"f").y=le(this,ce,"f").y}draw(){le(this,ne,"f").draw()}setDelta(t=0,e=0){le(this,ne,"f").setAttr("x",t-le(this,de,"f").x),le(this,ne,"f").setAttr("y",e-le(this,de,"f").y),le(this,ce,"f").x=t,le(this,ce,"f").y=e}setAttr(t,e){le(this,ne,"f").setAttr(t,e)}addToLayer(t){t.add(le(this,ne,"f"))}destroy(){le(this,ne,"f").destroy()}}ne=new WeakMap,he=new WeakMap,ce=new WeakMap,de=new WeakMap;const ge=we;var ye,ue,me,ve,be,Ee=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},xe=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class Se extends F{constructor(t){super(),this.type=I.Z.ARROW,ye.set(this,void 0),ue.set(this,void 0),me.set(this,void 0),ve.set(this,void 0),be.set(this,void 0),this.redrawArrow=(t=!1)=>{const e=xe(this,ue,"f").getPositions(),s=this.getPathString(e);xe(this,ve,"f")?.setData(s),xe(this,me,"f")?.setData(s),xe(this,be,"f")?.update(e.start,e.control,xe(this,ye,"f").strokeWidth),t&&Rt.dispatch(v())},this.pathMove=()=>{if(!xe(this,me,"f"))throw new Error("`this.#substratePath` is not defined");const t=xe(this,me,"f").attrs.x,e=xe(this,me,"f").attrs.y;xe(this,ue,"f").setDelta(t,e),xe(this,ve,"f")?.setAttrs({x:t,y:e}),xe(this,be,"f")?.setDelta(t,e),xe(this,be,"f")?.draw(),xe(this,ue,"f").draw()},this.blur=()=>{super.blur(),xe(this,ue,"f").visible(!1)},this.onAnchor=(t,e)=>{xe(this,ue,"f").on(t,e)},Ee(this,ye,{...t},"f"),Ee(this,ue,new ae(xe(this,ye,"f").anchorsPosition),"f")}initArrowDraw(t,e){Ee(this,me,new r.Z.Path({data:t,stroke:"transparent",strokeWidth:12,draggable:!0}),"f"),Ee(this,ve,new r.Z.Path({data:t,stroke:xe(this,ye,"f").stroke||"red",strokeWidth:xe(this,ye,"f").strokeWidth,lineCap:"round",lineJoin:"round"}),"f"),xe(this,me,"f").on("dragmove",this.pathMove),this.attachBasicEvents(xe(this,me,"f")),e.add(xe(this,ve,"f")),e.add(xe(this,me,"f"))}getPathString(t){const e=S().get(xe(this,ve,"f"),"attrs.x",0),s=S().get(xe(this,ve,"f"),"attrs.y",0);return`M${t.start.x-e},${t.start.y-s} Q${t.control.x-e},${t.control.y-s} ${t.end.x-e},${t.end.y-s}`}focus(){super.focus(),xe(this,ue,"f").visible(!0)}addToLayer(t,e){super.addToLayer(t,e),xe(this,ue,"f").setAnchors({width:t.parent.attrs.width,height:t.parent.attrs.height},300),xe(this,ue,"f").on("dragmove",(()=>this.redrawArrow(!0))),xe(this,ue,"f").on("dragend",(()=>this.redrawArrow(!0)));const s=xe(this,ue,"f").getPositions();Ee(this,be,new ge({start:s.start,control:s.control,stroke:xe(this,ye,"f").stroke||"red",strokeWidth:xe(this,ye,"f").strokeWidth}),"f"),xe(this,be,"f").on("click",this.onClick);const o=this.getPathString(s);this.initArrowDraw(o,t),xe(this,be,"f").addToLayer(t),xe(this,ue,"f").addToLayer(e),this.redrawArrow()}setStrokeColor(t){xe(this,ve,"f")?.setAttr("stroke",t),xe(this,be,"f")?.setAttr("stroke",t),xe(this,ye,"f").stroke=t,xe(this,ve,"f")?.draw(),xe(this,be,"f")?.draw()}getStrokeColor(){return xe(this,ye,"f").stroke}setStrokeWidth(t){xe(this,ve,"f")?.setAttr("strokeWidth",t),xe(this,ye,"f").strokeWidth=t,this.redrawArrow()}getStrokeWidth(){return xe(this,ve,"f")?.getAttr("strokeWidth")}draggable(t){return xe(this,me,"f")?.setAttr("draggable",t),xe(this,me,"f")?.getAttr("draggable")}scale(t){const e=xe(this,ue,"f").getPositions();xe(this,ue,"f").setAnchorsCoordinates({start:{x:e.start.x*t.wFactor,y:e.start.y*t.hFactor},control:{x:e.control.x*t.wFactor,y:e.control.y*t.hFactor},end:{x:e.end.x*t.wFactor,y:e.end.y*t.hFactor}}),this.redrawArrow()}initDraw(t,e){this.isSelected()&&this.blur(),xe(this,ue,"f").setAnchorsCoordinates({start:{x:e.x,y:e.y},control:{x:(t.x+e.x)/2,y:(t.y+e.y)/2},end:{x:t.x,y:t.y}}),this.redrawArrow(!0)}crop(t){const e=xe(this,ue,"f").getPositions();xe(this,ue,"f").setAnchorsCoordinates({start:{x:e.start.x-t.x,y:e.start.y-t.y},control:{x:e.control.x-t.x,y:e.control.y-t.y},end:{x:e.end.x-t.x,y:e.end.y-t.y}}),this.redrawArrow()}clone(){const t=xe(this,ue,"f")?xe(this,ue,"f").getPositions():xe(this,ye,"f").anchorsPosition;return new Se({...xe(this,ye,"f"),anchorsPosition:t})}destroy(){super.destroy(),xe(this,ve,"f")?.destroy(),xe(this,me,"f")?.destroy(),xe(this,be,"f")?.destroy(),xe(this,ue,"f")?.destroy()}}ye=new WeakMap,ue=new WeakMap,me=new WeakMap,ve=new WeakMap,be=new WeakMap;const ke=Se;var Te,Pe,Ae,Ce=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},Le=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};!function(t){t.fontSize="fontSize",t.color="color"}(Ae||(Ae={})),Te=new WeakMap,Pe=new WeakMap;var Re,Me,We,Ze=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},De=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};Re=new WeakMap,Me=new WeakMap,We=new WeakMap;var _e,Oe,He,Ie,ze=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},Ue=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class $e extends F{constructor(t){super(),this.type=I.Z.TEXT,_e.set(this,void 0),Oe.set(this,void 0),He.set(this,void 0),Ie.set(this,void 0),this.focus=()=>{super.focus(),Ue(this,He,"f")?.show()},ze(this,_e,{...t},"f")}addToLayer(t,e){super.addToLayer(t,e);const s=Ue(this,_e,"f").x||t.parent.attrs.width/2-100,o=Ue(this,_e,"f").y||t.parent.attrs.height/2-10;ze(this,Oe,new class{constructor(t){Re.set(this,void 0),Me.set(this,void 0),We.set(this,void 0),this.makeEditable=()=>{De(this,Re,"f").hide();const t=De(this,Re,"f").position();if(!De(this,We,"f"))throw new Error("`this.#stagePosition` is not defined");const e=De(this,We,"f").left+t.x,s=De(this,We,"f").top+t.y;De(this,Me,"f").update({value:De(this,Re,"f").text(),top:s,left:e,width:De(this,Re,"f").width()-2*De(this,Re,"f").padding(),height:De(this,Re,"f").height()-2*De(this,Re,"f").padding()+5,fontSize:De(this,Re,"f").fontSize(),lineHeight:De(this,Re,"f").lineHeight(),fontFamily:De(this,Re,"f").fontFamily(),textAlign:De(this,Re,"f").align(),color:De(this,Re,"f").fill(),rotation:De(this,Re,"f").rotation()}),De(this,Me,"f").focus()},Ze(this,Re,new r.Z.Text({...t,draggable:!0}),"f"),De(this,Re,"f").on("transform",(()=>{De(this,Re,"f").setAttrs({width:De(this,Re,"f").width()*De(this,Re,"f").scaleX(),scaleX:1})})),Ze(this,Me,new class{constructor(t,e=""){Te.set(this,void 0),Pe.set(this,void 0),this.onKeyDown=()=>{const t=Le(this,Pe,"f").getAbsoluteScale().x;this.setTextareaWidth(Le(this,Pe,"f").width()*t),Le(this,Te,"f").style.height="auto",Le(this,Te,"f").style.height=`${Le(this,Te,"f").scrollHeight+Le(this,Pe,"f").fontSize()}px`},Ce(this,Pe,t,"f"),Ce(this,Te,document.createElement("textarea"),"f"),Le(this,Te,"f").value=e,document.body.appendChild(Le(this,Te,"f")),Le(this,Te,"f").addEventListener("keydown",this.onKeyDown),Le(this,Te,"f").style.display="none"}setTextareaWidth(t){t||(t=Le(this,Pe,"f").placeholder.length*Le(this,Pe,"f").fontSize());const e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),s=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;(e||s)&&(t=Math.ceil(t)),(document.documentMode||/Edge/.test(navigator.userAgent))&&(t+=1),Le(this,Te,"f").style.width=`${t}px`}update(t){Le(this,Te,"f").style.display="initial",Le(this,Te,"f").value=t.value,Le(this,Te,"f").style.position="absolute",Le(this,Te,"f").style.top=`${t.top}px`,Le(this,Te,"f").style.left=`${t.left}px`,Le(this,Te,"f").style.width=`${t.width}px`,Le(this,Te,"f").style.height=`${t.height}px`,Le(this,Te,"f").style.fontSize=`${t.fontSize}px`,Le(this,Te,"f").style.fontFamily="Lato, Arial",Le(this,Te,"f").style.border="1px dashed #2196f3",Le(this,Te,"f").style.padding="0px",Le(this,Te,"f").style.margin="0px",Le(this,Te,"f").style.overflow="hidden",Le(this,Te,"f").style.background="none",Le(this,Te,"f").style.outline="none",Le(this,Te,"f").style.resize="none",Le(this,Te,"f").style.lineHeight=t.lineHeight,Le(this,Te,"f").style.fontFamily=t.fontFamily,Le(this,Te,"f").style.transformOrigin="left top",Le(this,Te,"f").style.textAlign=t.textAlign,Le(this,Te,"f").style.color=t.color;let e=`rotateZ(${t.rotation}deg)`;navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(e+=`translateY(-${2+Math.round(t.fontSize/20)}px)`),Le(this,Te,"f").style.transform=e,Le(this,Te,"f").style.height="auto",Le(this,Te,"f").style.height=Le(this,Te,"f").scrollHeight+3+"px"}setAttr(t,e){switch(t){case Ae.fontSize:Le(this,Te,"f").style.fontSize=`${e}px`;break;case Ae.color:Le(this,Te,"f").style.color=e}}focus(){Le(this,Te,"f").focus()}hide(){Le(this,Te,"f").style.display="none"}getValue(){return Le(this,Te,"f").value}destroy(){Le(this,Te,"f").removeEventListener("keydown",this.onKeyDown),Le(this,Te,"f").parentNode?.removeChild(Le(this,Te,"f"))}}(De(this,Re,"f"),t.text),"f")}blur(){De(this,Re,"f").text(De(this,Me,"f").getValue()),De(this,Me,"f").hide(),De(this,Re,"f").show()}setStagePosition(t){Ze(this,We,t,"f")}setAttr(t,e){switch(De(this,Re,"f").setAttr(t,e),t){case"fontSize":De(this,Me,"f").setAttr(Ae.fontSize,e);break;case"fill":De(this,Me,"f").setAttr(Ae.color,e)}}draggable(t){return De(this,Re,"f").setAttr("draggable",t),De(this,Re,"f").getAttr("draggable")}on(t,e){De(this,Re,"f").on(t,e)}addToLayer(t){t.add(De(this,Re,"f"))}setPosition(t,e){De(this,Re,"f").setAttrs({x:t,y:e})}getPosition(){return{x:De(this,Re,"f").attrs.x,y:De(this,Re,"f").attrs.y}}getText(){return De(this,Re,"f").attrs.text}getRotation(){return De(this,Re,"f").rotation()}getAttrs(){return De(this,Re,"f").getAttrs()}getNode(){return De(this,Re,"f")}destroy(){De(this,Re,"f")?.destroy(),De(this,Me,"f")?.destroy()}}({text:Ue(this,_e,"f").text||"Some text here",x:s,y:o,fontFamily:"Lato, Arial",fontSize:Ue(this,_e,"f").fontSize||20,width:Ue(this,_e,"f").width||200,fill:Ue(this,_e,"f").fill,rotation:Ue(this,_e,"f").rotation??0}),"f"),this.attachBasicEvents(Ue(this,Oe,"f")),Ue(this,Oe,"f").addToLayer(t),ze(this,He,new r.Z.Transformer({node:Ue(this,Oe,"f").getNode(),enabledAnchors:["middle-left","middle-right"],borderStroke:"#2196f3",anchorStroke:"#2196f3",anchorFill:"#ffffff",borderStrokeWidth:1,anchorStrokeWidth:1,boundBoxFunc:function(t,e){return e.width=Math.max(30,e.width),e}}),"f"),Ue(this,Oe,"f").on("dblclick",(()=>{Ue(this,Ie,"f")&&Ue(this,Oe,"f")?.setStagePosition(Ue(this,Ie,"f").call(this)),Ue(this,Oe,"f")?.makeEditable(),Ue(this,He,"f")?.hide(),Rt.dispatch(v(_.SHAPES_LAYER)),Rt.dispatch(v(_.ANCHORS_LAYER))})),Ue(this,Oe,"f").on("click",this.focus),Ue(this,Oe,"f").on("transform",(()=>{Rt.dispatch(v(_.SHAPES_LAYER))})),Ue(this,He,"f").hide(),e.add(Ue(this,He,"f"))}onDblClickGetStagePosition(t){ze(this,Ie,t,"f")}setFillColor(t){Ue(this,Oe,"f")?.setAttr("fill",t),Ue(this,_e,"f").fill=t}getFillColor(){return Ue(this,_e,"f").fill}setFontSize(t){Ue(this,Oe,"f")?.setAttr("fontSize",t),Ue(this,_e,"f").fontSize=t}blur(){super.blur(),Ue(this,Oe,"f")?.blur(),Ue(this,He,"f")?.hide()}scale(t){if(!Ue(this,Oe,"f"))throw new Error("`this.#textNode` is not defined");const e=Ue(this,Oe,"f").getPosition();Ue(this,Oe,"f").setPosition(e.x*t.wFactor,e.y*t.hFactor),Ue(this,Oe,"f").setStagePosition(t.stagePosition)}setAttrs(t){Object.keys(t).forEach((e=>{Ue(this,Oe,"f")?.setAttr(e,t[e])}))}crop(t){if(!Ue(this,Oe,"f"))throw new Error("`this.#textNode` is not defined");const e=Ue(this,Oe,"f").getPosition();Ue(this,Oe,"f").setPosition(e.x-t.x,e.y-t.y)}draggable(t){return Ue(this,Oe,"f")?.draggable(t)??!1}clone(){const t=Ue(this,Oe,"f")?.getText(),e=Ue(this,Oe,"f")?.getRotation(),s=S().get(Ue(this,Oe,"f")?.getAttrs(),"width");return new $e({...Ue(this,_e,"f"),...Ue(this,Oe,"f")?.getPosition(),...t&&{text:t},...e&&{rotation:e},...s&&{width:s}})}initDraw(t,e){this.setAttrs({x:t.x,y:t.y,rotation:Mt(t,e)*(180/Math.PI)}),Rt.dispatch(v(_.SHAPES_LAYER))}destroy(){super.destroy(),Ue(this,Oe,"f")?.destroy(),Ue(this,He,"f")?.destroy()}}_e=new WeakMap,Oe=new WeakMap,He=new WeakMap,Ie=new WeakMap;const Fe=$e,je=class extends ct{constructor(t){super({...t,stroke:"#0d87dc",fill:"transparent",strokeWidth:2,dash:[10,5]}),this.type=I.Z.SELECT_RECT}blur(){super.blur(),this.destroy()}scale(){this.destroy()}};class Ge extends ct{constructor(t){super(t),this.type=I.Z.ELLIPSE,this.getSizePos=()=>{const{x:t,y:e,radiusX:s,radiusY:o}=this.getAttrs();return{x:t-s,y:e-o,width:2*s,height:2*o}},this.onDragMoveAnchor=t=>{t.x=t.x+t.width/2,t.y=t.y+t.height/2,this.setShapeAttrs(t)},this.props={...t}}defineShape(){this.shape=new r.Z.Ellipse({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,dash:this.props.dash,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth,fill:this.props.fill,draggable:!0})}getCloningProps(){const t=this.shape?.getAttrs();return{...this.props,...t&&{x:t.x-t.radiusX,y:t.y-t.radiusY,width:2*t.radiusX,height:2*t.radiusY,stroke:t.stroke,strokeWidth:t.strokeWidth}}}clone(){const t=this.getCloningProps();return t.x+=t.width/4,t.y+=t.height/4,new Ge(t)}scale(t){const{x:e,y:s,radiusX:o,radiusY:i}=this.getAttrs();this.shape?.setAttrs({x:e*t.wFactor,y:s*t.hFactor,width:2*o*t.wFactor,height:2*i*t.hFactor}),this.sizeTransform?.update(this.getSizePos(),!1)}initDraw(t,e){this.blur();const s=e.x-t.x,o=e.y-t.y;this.setAttrs({x:t.x+s/2,y:t.y+o/2,width:Math.abs(s),height:Math.abs(o)})}}const Be=Ge,Ne=t=>{t.on("click",(t=>Rt.dispatch(g(t)))),t.on("dragstart",(t=>Rt.dispatch(g(t)))),t.on("mouseover",(()=>{const{shapes:e}=Rt.getState();t.draggable(!e.addingShapeRef);const s=e.addingShapeRef?D.AUTO:D.MOVE;Rt.dispatch(h(s))})),t.on("mouseout",(()=>Rt.dispatch(h(D.AUTO))));const e=E.f6.on((()=>{t.draggable(!0)}));t.on("_beforedestroy",(()=>{e()}))},Ke=(t,e)=>{const s=t||new ke({stroke:S().get(e,"strokeColor","green"),strokeWidth:S().get(e,"strokeWidth")});return s.onAnchor("mouseover",(()=>Rt.dispatch(h(D.POINTER)))),s.onAnchor("mouseout",(()=>Rt.dispatch(h(D.AUTO)))),Ne(s),s},Ye=t=>{Rt.dispatch(n(t))},Xe=(t,e)=>{const s=t||new Fe({fill:S().get(e,"fillColor","green"),fontSize:S().get(e,"fontSize")});return s.onDblClickGetStagePosition((()=>{const{stage:t}=Rt.getState(),e=t.instance?.container().getBoundingClientRect();return{left:e?e.left:0,top:e?e.top:0}})),Ne(s),s},Ve=t=>{Rt.dispatch(n(t))},Je=(t,e,s)=>{const o={stroke:S().get(e,"strokeColor","green"),fill:S().get(e,"fill","transparent"),strokeWidth:S().get(e,"strokeWidth",2)},i=(()=>{if(t)return t;switch(s){case I.Z.RECT:return new ct(o);case I.Z.RECT_ROUGH:return new vt(o);case I.Z.ELLIPSE:return new Be(o);case I.Z.ELLIPSE_ROUGH:return new Pt(o);case I.Z.SELECT_RECT:return new je}})();if(!i)throw new Error("rectNode is not defined");return Ne(i),i},qe=t=>{Rt.dispatch(n(t))},Qe=t=>{const{image:e}=Rt.getState();e.instance&&e.instance.destroy(),Rt.dispatch(W({width:t.image.width,height:t.image.height}));const s=new $t(t.image);s.addToLayer(e.layer),Rt.dispatch(p()),Rt.dispatch(P({image:s}))},ts=(t,e,s)=>{const o=document.createElement("svg");return o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o.setAttribute("width",String(t)),o.setAttribute("height",String(e)),o.setAttribute("style",`background-color:${s}`),new Promise(((t,e)=>{const s=new Image,i=new Blob([o.outerHTML],{type:"image/svg+xml"}),r=URL.createObjectURL(i);s.onload=function(){URL.revokeObjectURL(r),t(this)},s.onerror=e,s.src=r}))};E.rl.on((t=>{Rt.dispatch(g());const{type:e,options:s}=t;throw new Error(`Given shape type can't be created: ${e}`)})),E.UG.on((t=>{Rt.dispatch(g());const{type:e,options:s}=t;switch(e){case I.Z.TEXT:case I.Z.ARROW:case I.Z.RECT:case I.Z.RECT_ROUGH:case I.Z.ELLIPSE:case I.Z.ELLIPSE_ROUGH:case I.Z.SELECT_RECT:Rt.dispatch(m({type:e,options:s}));break;case null:Rt.dispatch(m({type:null}));break;default:throw new Error(`Given shape type can't be added: ${e}`)}})),E.QL.on((t=>{Qe(t)})),E.xd.on((t=>{Rt.dispatch(c(t))})),E.b8.on((t=>{Rt.dispatch(d(t))})),E.vw.on((t=>{Rt.dispatch(f(t))})),E.BV.on((t=>{const{stage:e}=Rt.getState();if(!e.instance)throw new Error("stage is not defined");((t,e)=>{const s=function(t){const e=t.split(",");if(e[0]){const t=e[0].match(/:(.*?);/);if(t){const s=t[1],o=atob(e[1]);let i=o.length;const r=new Uint8Array(i);for(;i--;)r[i]=o.charCodeAt(i);return new Blob([r],{type:s})}}return null}(t);if(!s)throw new Error("blob data is null");const o=document.createElement("a"),i=URL.createObjectURL(s);o.download=e.replace(/(\.[^.]+)$/gi,"")+".png",o.href=i,o.click()})(e.instance.toDataURL(),t)})),E.kb.on((()=>{const{stage:t}=Rt.getState();if(!t.instance)throw new Error("stage is not defined");(t=>{const e=document.createElement("img");e.src=t;const s=document.createElement("div");s.contentEditable="true",s.appendChild(e),document.body.appendChild(s),(t=>{if(!window.getSelection)throw new Error("Can't select text");{const e=window.getSelection(),s=document.createRange();s.selectNodeContents(t),e?.removeAllRanges(),e?.addRange(s)}})(s),document.execCommand("Copy"),document.body.removeChild(s)})(t.instance.toDataURL())})),E.Du.on((()=>{Rt.dispatch(g())})),E.On.on((()=>{const{shapes:t}=Rt.getState(),e=t.list.find((t=>t.isSelected()));if(e instanceof je){const{x:t,y:s,width:o,height:i}=e.getAttrs();Rt.dispatch(C({x:t,y:s,width:o,height:i})),Rt.dispatch(A({width:o,height:i})),Rt.dispatch(W({width:o,height:i})),Rt.dispatch(w(e)),Rt.dispatch(u({x:t,y:s})),Rt.dispatch(g())}else console.error("Selected shape is not instance of SelectRect"),console.error(e)})),E.Si.on((()=>{Rt.dispatch(b())})),E.UP.on((t=>{const{stage:e,image:s}=Rt.getState();if(!e.instance)throw new Error('"instance" is not defined on "stage".  It looks like "stage" is not initialized yet.');const{width:o,height:i}=e.instance.getAttrs(),a=o,n=i;if(Rt.dispatch(W({width:t.width,height:t.height})),s.instance){s.instance.setSize(t.width,t.height);const e=s.layer.toDataURL();s.instance.destroy(),r.Z.Image.fromURL(e,(t=>{const e=new $t(t);e.addToLayer(s.layer),Rt.dispatch(P({image:e}))}))}Rt.dispatch(y()),requestAnimationFrame((()=>{const s=e.instance?.container().getBoundingClientRect(),o={wFactor:t.width/a,hFactor:t.height/n,stagePosition:{left:s?s.left:0,top:s?s.top:0}};Rt.dispatch(y(o))}))})),E.Hy.on((t=>{const{stage:e}=Rt.getState();if(!e.instance)throw new Error('"instance" is not defined on stage. It looks like stage is not initialized yet.');ts(t.width,t.height,"#cdcdcd").then((t=>{Qe({image:t,name:"Blank canvas"})}))}));var es=s(3379),ss=s.n(es),os=s(7795),is=s.n(os),rs=s(569),as=s.n(rs),ns=s(3565),hs=s.n(ns),cs=s(9216),ds=s.n(cs),fs=s(4589),ls=s.n(fs),ps=s(5504),ws={};ws.styleTagTransform=ls(),ws.setAttributes=hs(),ws.insert=as().bind(null,"head"),ws.domAPI=is(),ws.insertStyleElement=ds(),ss()(ps.Z,ws),ps.Z&&ps.Z.locals&&ps.Z.locals;var gs=s(3274);const ys={delete:["backspace","delete","del"],copy:["ctrl+c","command+c"],paste:["ctrl+v","command+v"]},us=()=>{const t=(0,o.useRef)([]);return o.createElement(gs.GlobalHotKeys,{keyMap:ys,handlers:{delete:()=>{Rt.dispatch(l()),Rt.dispatch(h(D.AUTO))},copy:()=>{const{shapes:e}=Rt.getState();var s;s="[Shape]",navigator.clipboard?navigator.clipboard.writeText(s).then((()=>{}),(t=>{console.error("Async: Could not copy text: ",t)})):(t=>{const e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();try{document.execCommand("cut")}catch(t){return console.warn("Copy to clipboard failed.",t),!1}finally{document.body.removeChild(e)}})(s),t.current=e.list.reduce(((t,e)=>e.isSelected()?[...t,e.clone()]:t),[])},paste:()=>{E.Du(),t.current.forEach((t=>{((t,e)=>{switch(t.type){case I.Z.ARROW:((t,e)=>{const s=Ke(t,e);Ye(s)})(t.clone(),e);break;case I.Z.TEXT:((t,e)=>{const s=Xe(t,e);Ve(s)})(t.clone(),e);break;case I.Z.RECT:case I.Z.RECT_ROUGH:case I.Z.ELLIPSE:case I.Z.ELLIPSE_ROUGH:((t,e,s)=>{const o=Je(t,e,void 0);qe(o)})(t.clone(),e);break;default:console.error("Can't clone and connect given shape"),console.log(t)}})(t)})),t.current=[]}}})};var ms;const vs=()=>{const t=document.querySelector(".shapes-layer");if(t)return t;throw new Error("Shapes layer is not found")};class bs extends o.PureComponent{constructor(){super(...arguments),this.canvasRef=o.createRef(),ms.set(this,void 0),this.state={width:0,height:0,cursor:D.AUTO,mouseIsDown:!1,mouseStartPos:{x:0,y:0}},this.handleStageOnMouseDown=t=>{const{shapes:e}=Rt.getState();if(e.addingShapeRef){const{layerX:s,layerY:o}=t.evt,i={x:s,y:o};this.setState({mouseIsDown:!0,mouseStartPos:i}),(t=>{switch(t.type){case I.Z.ARROW:Ye(t);break;case I.Z.TEXT:Ve(t);break;case I.Z.RECT:case I.Z.RECT_ROUGH:case I.Z.ELLIPSE:case I.Z.ELLIPSE_ROUGH:case I.Z.SELECT_RECT:qe(t);break;default:console.error("Can't connect given shape"),console.log(t)}})(e.addingShapeRef),e.addingShapeRef.initDraw(i,i)}},this.handleStageOnMouseUp=()=>{this.setState({mouseIsDown:!1});const{shapes:t}=Rt.getState();t.addingShapeRef&&(E.f6(t.addingShapeRef),t.addingShapeRef.focus()),Rt.dispatch(m(null)),Rt.dispatch(v())},this.handleStageOnMouseMove=t=>{const{shapes:e}=Rt.getState();if(this.state.mouseIsDown&&e.addingShapeRef){const{layerX:s,layerY:o}=t.evt;e.addingShapeRef.initDraw(this.state.mouseStartPos,{x:s,y:o})}},this.handleStoreChange=()=>{const{shapes:t,stage:e}=Rt.getState();if(!e.instance)throw new Error('"instance" is not defined on stage. It looks like stage is not defined yet.');const{width:s,height:o}=e.instance.getAttrs();this.setState({width:s,height:o,cursor:t.cursor})},this.onClick=t=>{this.canvasRef.current===t.target&&Rt.dispatch(g())}}componentDidMount(){if(function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===o?i.call(t,s):i?i.value=s:e.set(t,s)}(this,ms,Rt.subscribe(this.handleStoreChange),"f"),this.canvasRef.current){const t=new r.Z.Stage({container:this.canvasRef.current}),{shapes:e,image:s}=Rt.getState();t.add(s.layer),t.add(e.shapesLayer),t.add(e.anchorsLayer);try{s.layer.getCanvas()._canvas.classList.add("image-layer"),e.shapesLayer.getCanvas()._canvas.classList.add("shapes-layer"),e.anchorsLayer.getCanvas()._canvas.classList.add("anchors-layer")}catch(t){console.error("Can't set className to the canvas"),console.error(t)}t.on("mousedown",this.handleStageOnMouseDown),t.on("mouseup",this.handleStageOnMouseUp),t.on("mousemove",this.handleStageOnMouseMove),Rt.dispatch(M(t)),this.canvasRef.current.tabIndex=1}}componentWillUnmount(){(function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)})(this,ms,"f").call(this)}render(){return o.createElement("div",{className:"canvas-scroll"},o.createElement(us,null),o.createElement("div",{className:"canvas-container",style:{width:this.state.width,height:this.state.height}},o.createElement("div",{ref:this.canvasRef,style:{cursor:this.state.cursor},className:"canvas-el",onClick:this.onClick})))}}ms=new WeakMap;const Es=bs;var xs=s(4184),Ss=s.n(xs),ks=s(463),Ts=s(8910),Ps=s(4709),As=s(8328),Cs=s(1369),Ls={};Ls.styleTagTransform=ls(),Ls.setAttributes=hs(),Ls.insert=as().bind(null,"head"),Ls.domAPI=is(),Ls.insertStyleElement=ds(),ss()(Cs.Z,Ls),Cs.Z&&Cs.Z.locals&&Cs.Z.locals;const Rs=t=>{const{children:e}=t,s=(0,i.I0)(),r=(0,i.v9)((t=>t.canvas));return o.createElement(ks.ZP,{onDrop:async t=>{const e=t[0];if(e){const t=await(0,Ts.Z)(e);s((0,Ps.m)({image:t.image,name:t.name}))}As.qP({eventCategory:As.Ak.GlobalInteraction,eventAction:As.UZ.DropImage})}},(t=>{const{getRootProps:s}=t,i=Ss()({"drop-image":!0,"drop-image_has-image":0!==r.height||0!==r.width,"drop-image_active":t.isDragActive});return o.createElement("div",{...s(),className:i},e)}))};class Ms extends o.PureComponent{constructor(){super(...arguments),this.onPaste=t=>{const e=(t.clipboardData||t.originalEvent.clipboardData).items,s=Array.from(e).find((t=>0===t.type.indexOf("image")));if(s){const t=s.getAsFile(),e=new Image;if(!t)throw new Error("blob data is null");const o=URL.createObjectURL(t),{addImage:i}=this.props;e.onload=function(){URL.revokeObjectURL(o),i({image:this,name:""})},e.onerror=t=>{console.error(t)},e.src=o}}}componentDidMount(){document.addEventListener("paste",this.onPaste)}componentWillUnmount(){document.removeEventListener("paste",this.onPaste)}render(){return o.createElement(Rs,null,o.createElement(Es,null))}}const Ws=(0,i.$j)((()=>({})),{addImage:Ps.m})(Ms)}}]);