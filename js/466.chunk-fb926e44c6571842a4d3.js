"use strict";(self.webpackChunkimgreview=self.webpackChunkimgreview||[]).push([[466],{8363:(t,e)=>{e.Z=function(t,e){if(t&&e){var n=Array.isArray(e)?e:e.split(","),i=t.name||"",r=(t.type||"").toLowerCase(),a=r.replace(/\/.*$/,"");return n.some((function(t){var e=t.trim().toLowerCase();return"."===e.charAt(0)?i.toLowerCase().endsWith(e):e.endsWith("/*")?a===e.replace(/\/.*$/,""):r===e}))}return!0}},463:(t,e,n)=>{n.d(e,{ZP:()=>tt});var i=n(7294),r=n(5697),a=n.n(r);function s(t,e,n,i){return new(n||(n=Promise))((function(r,a){function s(t){try{h(i.next(t))}catch(t){a(t)}}function o(t){try{h(i.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,o)}h((i=i.apply(t,e||[])).next())}))}function o(t,e){var n,i,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}}function h(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,a=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=a.next()).done;)s.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return s}Object.create,Object.create;var l=new Map([["avi","video/avi"],["gif","image/gif"],["ico","image/x-icon"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["mkv","video/x-matroska"],["mov","video/quicktime"],["mp4","video/mp4"],["pdf","application/pdf"],["png","image/png"],["zip","application/zip"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]]);function c(t,e){var n=function(t){var e=t.name;if(e&&-1!==e.lastIndexOf(".")&&!t.type){var n=e.split(".").pop().toLowerCase(),i=l.get(n);i&&Object.defineProperty(t,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return t}(t);if("string"!=typeof n.path){var i=t.webkitRelativePath;Object.defineProperty(n,"path",{value:"string"==typeof e?e:"string"==typeof i&&i.length>0?i:t.name,writable:!1,configurable:!1,enumerable:!0})}return n}var u=[".DS_Store","Thumbs.db"];function d(t){return(null!==t.target&&t.target.files?p(t.target.files):[]).map((function(t){return c(t)}))}function f(t,e){return s(this,void 0,void 0,(function(){var n;return o(this,(function(i){switch(i.label){case 0:return t.items?(n=p(t.items).filter((function(t){return"file"===t.kind})),"drop"!==e?[2,n]:[4,Promise.all(n.map(v))]):[3,2];case 1:return[2,g(y(i.sent()))];case 2:return[2,g(p(t.files).map((function(t){return c(t)})))]}}))}))}function g(t){return t.filter((function(t){return-1===u.indexOf(t.name)}))}function p(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];e.push(i)}return e}function v(t){if("function"!=typeof t.webkitGetAsEntry)return m(t);var e=t.webkitGetAsEntry();return e&&e.isDirectory?b(e):m(t)}function y(t){return t.reduce((function(t,e){return function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(h(arguments[e]));return t}(t,Array.isArray(e)?y(e):[e])}),[])}function m(t){var e=t.getAsFile();if(!e)return Promise.reject(t+" is not a File");var n=c(e);return Promise.resolve(n)}function _(t){return s(this,void 0,void 0,(function(){return o(this,(function(e){return[2,t.isDirectory?b(t):k(t)]}))}))}function b(t){var e=t.createReader();return new Promise((function(t,n){var i=[];!function r(){var a=this;e.readEntries((function(e){return s(a,void 0,void 0,(function(){var a,s,h;return o(this,(function(o){switch(o.label){case 0:if(e.length)return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Promise.all(i)];case 2:return a=o.sent(),t(a),[3,4];case 3:return s=o.sent(),n(s),[3,4];case 4:return[3,6];case 5:h=Promise.all(e.map(_)),i.push(h),r(),o.label=6;case 6:return[2]}}))}))}),(function(t){n(t)}))}()}))}function k(t){return s(this,void 0,void 0,(function(){return o(this,(function(e){return[2,new Promise((function(e,n){t.file((function(n){var i=c(n,t.fullPath);e(i)}),(function(t){n(t)}))}))]}))}))}var S=n(8363);function x(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,a=[],s=!0,o=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(a.push(i.value),!e||a.length!==e);s=!0);}catch(t){o=!0,r=t}finally{try{s||null==n.return||n.return()}finally{if(o)throw r}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return w(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var C=function(t){t=Array.isArray(t)&&1===t.length?t[0]:t;var e=Array.isArray(t)?"one of ".concat(t.join(", ")):t;return{code:"file-invalid-type",message:"File type must be ".concat(e)}},P=function(t){return{code:"file-too-large",message:"File is larger than ".concat(t," bytes")}},M=function(t){return{code:"file-too-small",message:"File is smaller than ".concat(t," bytes")}},E={code:"too-many-files",message:"Too many files"};function T(t,e){var n="application/x-moz-file"===t.type||(0,S.Z)(t,e);return[n,n?null:C(e)]}function A(t,e,n){if(O(t.size))if(O(e)&&O(n)){if(t.size>n)return[!1,P(n)];if(t.size<e)return[!1,M(e)]}else{if(O(e)&&t.size<e)return[!1,M(e)];if(O(n)&&t.size>n)return[!1,P(n)]}return[!0,null]}function O(t){return null!=t}function I(t){var e=t.files,n=t.accept,i=t.minSize,r=t.maxSize,a=t.multiple,s=t.maxFiles;return!(!a&&e.length>1||a&&s>=1&&e.length>s)&&e.every((function(t){var e=x(T(t,n),1)[0],a=x(A(t,i,r),1)[0];return e&&a}))}function D(t){return"function"==typeof t.isPropagationStopped?t.isPropagationStopped():void 0!==t.cancelBubble&&t.cancelBubble}function L(t){return t.dataTransfer?Array.prototype.some.call(t.dataTransfer.types,(function(t){return"Files"===t||"application/x-moz-file"===t})):!!t.target&&!!t.target.files}function R(t){t.preventDefault()}function G(t){return-1!==t.indexOf("MSIE")||-1!==t.indexOf("Trident/")}function K(t){return-1!==t.indexOf("Edge/")}function F(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent;return G(t)||K(t)}function H(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return e.some((function(e){return!D(t)&&e&&e.apply(void 0,[t].concat(i)),D(t)}))}}var N=["children"],j=["open"],B=["refKey","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],z=["refKey","onChange","onClick"];function W(t){return function(t){if(Array.isArray(t))return Y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||U(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function q(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,a=[],s=!0,o=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(a.push(i.value),!e||a.length!==e);s=!0);}catch(t){o=!0,r=t}finally{try{s||null==n.return||n.return()}finally{if(o)throw r}}return a}}(t,e)||U(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(t,e){if(t){if("string"==typeof t)return Y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Y(t,e):void 0}}function Y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function X(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function V(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?X(Object(n),!0).forEach((function(e){$(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function $(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Z(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n,i,r={},a=Object.keys(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var Q=(0,i.forwardRef)((function(t,e){var n=t.children,r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=V(V({},J),t),n=e.accept,r=e.disabled,a=e.getFilesFromEvent,s=e.maxSize,o=e.minSize,h=e.multiple,l=e.maxFiles,c=e.onDragEnter,u=e.onDragLeave,d=e.onDragOver,f=e.onDrop,g=e.onDropAccepted,p=e.onDropRejected,v=e.onFileDialogCancel,y=e.preventDropOnDocument,m=e.noClick,_=e.noKeyboard,b=e.noDrag,k=e.noDragEventsBubbling,S=e.validator,x=(0,i.useRef)(null),w=(0,i.useRef)(null),C=q((0,i.useReducer)(nt,et),2),P=C[0],M=C[1],O=P.isFocused,G=P.isFileDialogActive,K=P.draggedFiles,N=(0,i.useCallback)((function(){w.current&&(M({type:"openDialog"}),w.current.value=null,w.current.click())}),[M]),j=function(){G&&setTimeout((function(){w.current&&(w.current.files.length||(M({type:"closeDialog"}),"function"==typeof v&&v()))}),300)};(0,i.useEffect)((function(){return window.addEventListener("focus",j,!1),function(){window.removeEventListener("focus",j,!1)}}),[w,G,v]);var U=(0,i.useCallback)((function(t){x.current&&x.current.isEqualNode(t.target)&&(32!==t.keyCode&&13!==t.keyCode||(t.preventDefault(),N()))}),[x,w]),Y=(0,i.useCallback)((function(){M({type:"focus"})}),[]),X=(0,i.useCallback)((function(){M({type:"blur"})}),[]),Q=(0,i.useCallback)((function(){m||(F()?setTimeout(N,0):N())}),[w,m]),tt=(0,i.useRef)([]),it=function(t){x.current&&x.current.contains(t.target)||(t.preventDefault(),tt.current=[])};(0,i.useEffect)((function(){return y&&(document.addEventListener("dragover",R,!1),document.addEventListener("drop",it,!1)),function(){y&&(document.removeEventListener("dragover",R),document.removeEventListener("drop",it))}}),[x,y]);var rt=(0,i.useCallback)((function(t){t.preventDefault(),t.persist(),ut(t),tt.current=[].concat(W(tt.current),[t.target]),L(t)&&Promise.resolve(a(t)).then((function(e){D(t)&&!k||(M({draggedFiles:e,isDragActive:!0,type:"setDraggedFiles"}),c&&c(t))}))}),[a,c,k]),at=(0,i.useCallback)((function(t){t.preventDefault(),t.persist(),ut(t);var e=L(t);if(e&&t.dataTransfer)try{t.dataTransfer.dropEffect="copy"}catch(t){}return e&&d&&d(t),!1}),[d,k]),st=(0,i.useCallback)((function(t){t.preventDefault(),t.persist(),ut(t);var e=tt.current.filter((function(t){return x.current&&x.current.contains(t)})),n=e.indexOf(t.target);-1!==n&&e.splice(n,1),tt.current=e,e.length>0||(M({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),L(t)&&u&&u(t))}),[x,u,k]),ot=(0,i.useCallback)((function(t){t.preventDefault(),t.persist(),ut(t),tt.current=[],L(t)&&Promise.resolve(a(t)).then((function(e){if(!D(t)||k){var i=[],r=[];e.forEach((function(t){var e=q(T(t,n),2),a=e[0],h=e[1],l=q(A(t,o,s),2),c=l[0],u=l[1],d=S?S(t):null;if(a&&c&&!d)i.push(t);else{var f=[h,u];d&&(f=f.concat(d)),r.push({file:t,errors:f.filter((function(t){return t}))})}})),(!h&&i.length>1||h&&l>=1&&i.length>l)&&(i.forEach((function(t){r.push({file:t,errors:[E]})})),i.splice(0)),M({acceptedFiles:i,fileRejections:r,type:"setFiles"}),f&&f(i,r,t),r.length>0&&p&&p(r,t),i.length>0&&g&&g(i,t)}})),M({type:"reset"})}),[h,n,o,s,l,a,f,g,p,k,S]),ht=function(t){return r?null:t},lt=function(t){return _?null:ht(t)},ct=function(t){return b?null:ht(t)},ut=function(t){k&&t.stopPropagation()},dt=(0,i.useMemo)((function(){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.refKey,n=void 0===e?"ref":e,i=t.onKeyDown,a=t.onFocus,s=t.onBlur,o=t.onClick,h=t.onDragEnter,l=t.onDragOver,c=t.onDragLeave,u=t.onDrop,d=Z(t,B);return V(V($({onKeyDown:lt(H(i,U)),onFocus:lt(H(a,Y)),onBlur:lt(H(s,X)),onClick:ht(H(o,Q)),onDragEnter:ct(H(h,rt)),onDragOver:ct(H(l,at)),onDragLeave:ct(H(c,st)),onDrop:ct(H(u,ot))},n,x),r||_?{}:{tabIndex:0}),d)}}),[x,U,Y,X,Q,rt,at,st,ot,_,b,r]),ft=(0,i.useCallback)((function(t){t.stopPropagation()}),[]),gt=(0,i.useMemo)((function(){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.refKey,i=void 0===e?"ref":e,r=t.onChange,a=t.onClick,s=Z(t,z);return V(V({},$({accept:n,multiple:h,type:"file",style:{display:"none"},onChange:ht(H(r,ot)),onClick:ht(H(a,ft)),autoComplete:"off",tabIndex:-1},i,w)),s)}}),[w,n,h,ot,r]),pt=K.length,vt=pt>0&&I({files:K,accept:n,minSize:o,maxSize:s,multiple:h,maxFiles:l}),yt=pt>0&&!vt;return V(V({},P),{},{isDragAccept:vt,isDragReject:yt,isFocused:O&&!r,getRootProps:dt,getInputProps:gt,rootRef:x,inputRef:w,open:ht(N)})}(Z(t,N)),a=r.open,s=Z(r,j);return(0,i.useImperativeHandle)(e,(function(){return{open:a}}),[a]),i.createElement(i.Fragment,null,n(V(V({},s),{},{open:a})))}));Q.displayName="Dropzone";var J={disabled:!1,getFilesFromEvent:function(t){return s(this,void 0,void 0,(function(){return o(this,(function(e){return[2,(n=t,n.dataTransfer&&t.dataTransfer?f(t.dataTransfer,t.type):d(t))];var n}))}))},maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null};Q.defaultProps=J,Q.propTypes={children:a().func,accept:a().oneOfType([a().string,a().arrayOf(a().string)]),multiple:a().bool,preventDropOnDocument:a().bool,noClick:a().bool,noKeyboard:a().bool,noDrag:a().bool,noDragEventsBubbling:a().bool,minSize:a().number,maxSize:a().number,maxFiles:a().number,disabled:a().bool,getFilesFromEvent:a().func,onFileDialogCancel:a().func,onDragEnter:a().func,onDragLeave:a().func,onDragOver:a().func,onDrop:a().func,onDropAccepted:a().func,onDropRejected:a().func,validator:a().func};const tt=Q;var et={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function nt(t,e){switch(e.type){case"focus":return V(V({},t),{},{isFocused:!0});case"blur":return V(V({},t),{},{isFocused:!1});case"openDialog":return V(V({},t),{},{isFileDialogActive:!0});case"closeDialog":return V(V({},t),{},{isFileDialogActive:!1});case"setDraggedFiles":var n=e.isDragActive,i=e.draggedFiles;return V(V({},t),{},{draggedFiles:i,isDragActive:n});case"setFiles":return V(V({},t),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections});case"reset":return V({},et);default:return t}}},8506:(t,e,n)=>{n.d(e,{GlobalHotKeys:()=>zt});var i=n(5697),r=n.n(i),a=n(7294);function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e&&h(t.prototype,e),n&&h(t,n),t}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(){return u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},u.apply(this,arguments)}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),i.forEach((function(e){c(t,e,n[e])}))}return t}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},g(t)}function p(t,e){return p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},p(t,e)}function v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function y(t,e,n){return y=v()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&p(r,n.prototype),r},y.apply(null,arguments)}function m(t){var e="function"==typeof Map?new Map:void 0;return m=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return y(t,arguments,g(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),p(i,t)},m(t)}function _(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n,i,r={},a=Object.keys(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function b(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function k(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?b(t):e}function S(t,e,n){return S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}},S(t,e,n||t)}function x(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function w(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return t.reduce((function(t,n){return t[n]=e||{value:n},t}),{})}var C={logLevel:"warn",defaultKeyEvent:"keydown",defaultComponent:"div",defaultTabIndex:"-1",ignoreTags:["input","select","textarea"],enableHardSequences:!1,ignoreKeymapAndHandlerChangesByDefault:!0,ignoreEventsCondition:function(t){var e=t.target;if(e&&e.tagName){var n=e.tagName.toLowerCase();return M.option("_ignoreTagsDict")[n]||e.isContentEditable}return!1},ignoreRepeatedEventsWhenKeyHeldDown:!0,simulateMissingKeyPressEvents:!0,stopEventPropagationAfterHandling:!0,stopEventPropagationAfterIgnoring:!0,allowCombinationSubmatches:!1,customKeyCodes:{}},P=d({},C);P._ignoreTagsDict=w(P.ignoreTags,!0);var M=function(){function t(){o(this,t)}return l(t,null,[{key:"init",value:function(t){var e=this,n=t.ignoreTags,i=t.customKeyCodes;n&&(t._ignoreTagsDict=w(t.ignoreTags)),i&&(t._customKeyNamesDict=w(Object.values(t.customKeyCodes))),-1!==["verbose","debug","info"].indexOf(t.logLevel)&&console.warn("React HotKeys: You have requested log level '".concat(t.logLevel,"' but for performance reasons, logging below severity level 'warning' is disabled in production. Please use the development build for complete logs.")),Object.keys(t).forEach((function(n){e.set(n,t[n])}))}},{key:"set",value:function(t,e){P[t]=e}},{key:"reset",value:function(t){P[t]=C[t]}},{key:"option",value:function(t){return P[t]}}]),t}(),E=function(){function t(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"warn";o(this,t),c(this,"verbose",this.noop),c(this,"debug",this.noop),c(this,"info",this.noop),c(this,"warn",this.noop),c(this,"error",this.noop),this.logLevel=this.constructor.levels[n],this.logLevel>=this.constructor.levels.error&&(this.error=console.error,this.logLevel>=this.constructor.levels.warn&&(this.warn=console.warn,["info","debug","verbose"].some((function(t){return!(e.logLevel>=e.constructor.levels[t]&&(e[t]=console.log,1))}))))}return l(t,[{key:"noop",value:function(){}}]),t}();c(E,"logIcons",["📕","📗","📘","📙"]),c(E,"componentIcons",["🔺","⭐️","🔷","🔶","⬛️"]),c(E,"eventIcons",["❤️","💚","💙","💛","💜","🧡"]),c(E,"levels",{none:0,error:1,warn:2,info:3,debug:4,verbose:5});var T={keydown:0,keypress:1,keyup:2},A={Shift:["shiftKey"],Meta:["metaKey"],Control:["ctrlKey"],Alt:["altKey"]},O={"`":["~"],1:["!"],2:["@",'"'],3:["#","£"],4:["$"],5:["%"],6:["^"],7:["&"],8:["*"],9:["("],0:[")"],"-":["_"],"=":["plus"],";":[":"],"'":['"',"@"],",":["<"],".":[">"],"/":["?"],"\\":["|"],"[":["{"],"]":["}"],"#":["~"]};function I(t){return O[t]||[1===t.length?t.toUpperCase():t]}function D(t,e){return t.hasOwnProperty(e)}function L(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(t).reduce((function(n,i){var r=t[i];return r.forEach((function(t){D(n,t)||(n[t]=[]),n[t].push(i)})),e.includeOriginal&&(!D(n,i)&&(n[i]=[]),n[i]=[].concat(x(n[i]),x(r))),n}),{})}var R=L(O);function G(t){return R[t]||[1===t.length?t.toLowerCase():t]}var K=L({},{includeOriginal:!0});function F(t){return"string"==typeof t}function H(t){return F(t)?t.trim().replace(/\s+/g," "):t}var N={tab:"Tab",capslock:"CapsLock",shift:"Shift",meta:"Meta",alt:"Alt",ctrl:"Control",space:" ",spacebar:" ",escape:"Escape",esc:"Escape",left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown",return:"Enter",del:"Delete",command:"Meta",option:"Alt",enter:"Enter",backspace:"Backspace",ins:"Insert",pageup:"PageUp",pagedown:"PageDown",end:"End",home:"Home",contextmenu:"ContextMenu",numlock:"Clear"},j={cmd:"Meta"};function B(t){var e=t.toLowerCase();return N[e]||j[e]||(t.match(/^f\d+$/)?t.toUpperCase():t)}var z={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},W=w(Object.values(z),!0);function q(t){return!!W[t]}function U(t){return q(t)||String.fromCharCode(t.charCodeAt(0))===t||function(t){return M.option("_customKeyNamesDict")[t]}(t)}var Y=function(t){function e(){var t,n;o(this,e);for(var i=arguments.length,r=Array(i),a=0;a<i;a++)r[a]=arguments[a];return c(b(b(n=k(this,(t=g(e)).call.apply(t,[this].concat(r))))),"name","InvalidKeyNameError"),n}return f(e,t),e}(m(Error));function X(t){return t.sort().join("+")}var V=function(){function t(){o(this,t)}return l(t,null,[{key:"parse",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=H(t),i=n.split(" ");try{var r=i.slice(0,i.length-1),a=i[i.length-1],s=r.map((function(t){var n=$(t,e);return X(Object.keys(n))})).join(" "),o=$(a,e),h=X(Object.keys(o)),l={id:h,keyDictionary:o,keyEventType:e.keyEventType,size:Object.keys(o).length};return{sequence:{prefix:s,size:r.length+1},combination:l}}catch(t){return{sequence:null,combination:null}}}}]),t}();function $(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return t.replace(/^\+|(\s|[^+]\+)\+/,"$1plus").split("+").reduce((function(t,n){var i=B(n);if(e.ensureValidKeys&&!U(i))throw new Y;return t[i]=!0,t}),{})}var Z={"`":["`"],1:["¡"],2:["™"],3:["£"],4:["¢"],5:["∞"],6:["§"],7:["¶"],8:["•"],9:["ª"],0:["º"],"-":["–"],"=":["≠"],a:["å"],b:["∫"],c:["ç"],d:["∂"],e:["´"],f:["ƒ"],g:["©"],h:["˙"],i:["ˆ"],j:["∆"],k:["˚"],l:["¬"],m:["µ"],n:["˜"],o:["ø"],p:["π"],q:["œ"],r:["®"],s:["ß"],t:["†"],u:["¨"],v:["√"],w:["∑"],x:["≈"],y:["¥"],z:["Ω"],"[":["“"],"]":["‘"],"\\":["«"],"'":["æ"],";":["…"],",":["≤"],".":["≥"],"/":["÷"]},Q=L(Z);function J(t){return Q[t]||[t]}function tt(t){return Z[t]||[t]}var et={"`":["`"],1:["⁄"],2:["€"],3:["‹"],4:["›"],5:["ﬁ"],6:["ﬂ"],7:["‡"],8:["°"],9:["·"],0:["‚"],"-":["—"],"=":["±"],a:["Å"],b:["ı"],c:["Ç"],d:["Î"],e:["´"],f:["Ï"],g:["˝"],h:["Ó"],i:["ˆ"],j:["Ô"],k:[""],l:["Ò"],m:["Â"],n:["˜"],o:["Ø"],p:["π"],q:["Œ"],r:["‰"],s:["Í"],t:["Î"],u:["¨"],v:["◊"],w:["„"],x:["˛"],y:["Á"],z:["¸"],"[":["”"],"]":["’"],"\\":["»"],"'":["Æ"],";":["Ú"],",":["¯"],".":["˘"]},nt=L(et);function it(t){return nt[t]||G(t)}function rt(t){return et[t]||[t]}var at=function(){function t(){o(this,t)}return l(t,null,[{key:"serialize",value:function(t){var e=t.Shift,n=t.Alt,i={};return Object.keys(t).sort().forEach((function(t){var r=[];if(e)if(n){var a=it(t),s=rt(t);r=[].concat(x(r),[t],x(a),x(s))}else{var o=G(t),h=I(t);r=[].concat(x(r),[t],x(o),x(h))}else if(n){var l=J(t),u=tt(t);r=[].concat(x(r),[t],x(l),x(u))}else{r.push(t);var f=K[t];f&&(r=[].concat(x(r),x(f)))}var g=Object.keys(i);0<g.length?g.forEach((function(t){r.forEach((function(e){i[t+"+".concat(e)]=d({},i[t],c({},e,!0))})),delete i[t]})):r.forEach((function(t){i[t]=c({},t,!0)}))})),Object.values(i).map((function(t){return Object.keys(t).sort().join("+")}))}},{key:"isValidKeySerialization",value:function(t){return!!(0<t.length)&&!!V.parse(t,{ensureValidKeys:!0}).combination}}]),t}();function st(t){return void 0===t}var ot=function(){function t(){o(this,t)}return l(t,null,[{key:"newRecord",value:function(t,e){var n=[0,0,0];if(!st(t))for(var i=0;i<=t;i++)n[i]=e;return n}},{key:"setBit",value:function(t,e,n){return t[e]=n,t}},{key:"clone",value:function(t){for(var e=this.newRecord(),n=0;n<t.length;n++)e[n]=t[n];return e}}]),t}();function ht(t){return!Array.isArray(t)&&"object"===s(t)&&null!==t}function lt(t){return ht(t)?0===Object.keys(t).length:!t||0===t.length}function ct(t){return ht(t)?Object.keys(t).length:t.length}var ut=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,t),this._keys=e,this._includesKeyUp=!1,this._update()}return l(t,[{key:"getIds",value:function(){return this._ids}},{key:"getKeyAliases",value:function(){return this._keyAliases}},{key:"getNormalizedKeyName",value:function(t){return this._keys[t]?t:this._keyAliases[t]||t}},{key:"getNumberOfKeys",value:function(){return ct(this._keys)}},{key:"any",value:function(){return 0<Object.keys(this._getKeyStates()).length}},{key:"isEnding",value:function(){return this._includesKeyUp}},{key:"hasEnded",value:function(){return lt(this.keysStillPressedDict())}},{key:"addKey",value:function(t,e){this._setKeyState(t,[ot.newRecord(),ot.newRecord(T.keydown,e)])}},{key:"setKeyState",value:function(t,e,n){var i=this._getKeyState(t);if(this.isKeyIncluded(t)){var r=ot.clone(i[1]),a=ot.clone(r);ot.setBit(a,e,n),this._setKeyState(t,[r,a])}else this.addKey(t,n);e===T.keyup&&(this._includesKeyUp=!0)}},{key:"forEachKey",value:function(t){return Object.keys(this._keys).forEach(t)}},{key:"some",value:function(t){return Object.keys(this._keys).some(t)}},{key:"getKeyDictionary",value:function(){return w(Object.keys(this._getKeyStates()),!0)}},{key:"keysStillPressedDict",value:function(){var t=this;return Object.keys(this._keys).reduce((function(e,n){return t.isKeyStillPressed(n)&&(e[n]=t._getKeyState(n)),e}),{})}},{key:"isKeyIncluded",value:function(t){return!!this._getKeyState(t)}},{key:"isKeyStillPressed",value:function(t){return this.isEventTriggered(t,T.keypress)&&!this.isKeyReleased(t)}},{key:"isKeyReleased",value:function(t){return this.isEventTriggered(t,T.keyup)}},{key:"isEventTriggered",value:function(t,e){return this._getKeyStateType(t,1,e)}},{key:"wasEventPreviouslyTriggered",value:function(t,e){return this._getKeyStateType(t,0,e)}},{key:"isKeyPressSimulated",value:function(t){return this._isKeyEventSimulated(t,T.keypress)}},{key:"isKeyUpSimulated",value:function(t){return this._isKeyEventSimulated(t,T.keyup)}},{key:"describe",value:function(){return this.getIds()[0]}},{key:"toJSON",value:function(){return{keys:this._getKeyStates(),ids:this.getIds(),keyAliases:this.getKeyAliases()}}},{key:"_getKeyStateType",value:function(t,e,n){var i=this._getKeyState(t);return i&&i[e][n]}},{key:"_update",value:function(){this._ids=at.serialize(this._keys),this._keyAliases=function(t){return Object.keys(t).reduce((function(e,n){return function(t){return K[t]||[t]}(n).forEach((function(i){(function(t){if(t.Shift)return t.Alt?[rt,it]:[I,G];if(t.Alt)return[tt,J];var e=function(t){return[t]};return[e,e]})(t).forEach((function(t){t(i).forEach((function(t){(t!==n||n!==i)&&(e[t]=n)}))}))})),e}),{})}(this._keys)}},{key:"_isKeyEventSimulated",value:function(t,e){return 2===this.isEventTriggered(t,e)}},{key:"_getKeyStates",value:function(){return this._keys}},{key:"_getKeyState",value:function(t){var e=this._keys[t];if(e)return e;var n=this._keyAliases[t];return n?this._keys[n]:void 0}},{key:"_setKeyState",value:function(t,e){var n=this.getNormalizedKeyName(t);this._keys[n]=e,this._update()}}]),t}(),dt=function(){function t(e){var n=e.maxLength,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;o(this,t),this._records=[],this._maxLength=n,i?this._push(i):this._push(new ut)}return l(t,[{key:"getMostRecentCombinations",value:function(t){return this._records.slice(-t,-1)}},{key:"any",value:function(){return this._records.some((function(t){return t.any()}))}},{key:"getLength",value:function(){return this._records.length}},{key:"getCurrentCombination",value:function(){return this._records[this.getLength()-1]}},{key:"addKeyToCurrentCombination",value:function(t,e,n){this._ensureInitialKeyCombination(),this.getCurrentCombination().setKeyState(t,e,n)}},{key:"setMaxLength",value:function(t){this._maxLength=t,this._trimHistory()}},{key:"startNewKeyCombination",value:function(t,e){this._ensureInitialKeyCombination();var n=new ut(this.getCurrentCombination().keysStillPressedDict());n.addKey(t,e),this._push(n)}},{key:"toJSON",value:function(){return this._records.map((function(t){return t.toJSON()}))}},{key:"_ensureInitialKeyCombination",value:function(){0===this.getLength()&&this._push(new ut)}},{key:"_push",value:function(t){this._trimHistory(),this._records.push(t)}},{key:"_trimHistory",value:function(){for(;this.getLength()>this._maxLength;)this._shift()}},{key:"_shift",value:function(){this._records.shift()}}]),t}();function ft(t){return Array.isArray(t)?t:t?[t]:[]}var gt=function(t){function e(){return o(this,e),k(this,g(e).apply(this,arguments))}return f(e,t),l(e,[{key:"add",value:function(t,n){S(g(e.prototype),"set",this).call(this,t,{childIds:[],parentId:null,keyMap:n})}},{key:"update",value:function(t,n){var i=S(g(e.prototype),"get",this).call(this,t);S(g(e.prototype),"set",this).call(this,t,d({},i,{keyMap:n}))}},{key:"setParent",value:function(t,e){this.get(t).parentId=e,this._addChildId(e,t)}},{key:"remove",value:function(t){var n=this._getParentId(t);this._removeChildId(n,t),S(g(e.prototype),"remove",this).call(this,t)}},{key:"_getParentId",value:function(t){var e=this.get(t);return e&&e.parentId}},{key:"_addChildId",value:function(t,e){this.get(t).childIds.push(e)}},{key:"_removeChildId",value:function(t,e){var n=this.get(t);n&&(n.childIds=function(t){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=w(ft(1<arguments.length&&void 0!==arguments[1]?arguments[1]:[]));return Array.isArray(t)?t.reduce((function(t,i){return n[i]&&(e.stringifyFirst||n[i].value===i)||t.push(i),t}),[]):ht(t)?Object.keys(t).reduce((function(e,i){return n[i]||(e[i]=t[i]),e}),{}):t}(n.childIds,e))}}]),e}(function(){function t(){o(this,t),this._registry={}}return l(t,[{key:"get",value:function(t){return this._registry[t]}},{key:"set",value:function(t,e){this._registry[t]=e}},{key:"remove",value:function(t){delete this._registry[t]}},{key:"toJSON",value:function(){return this._registry}}]),t}()),pt=function(){function t(e){o(this,t),this._list=e,this._position=-1}return l(t,[{key:"getPosition",value:function(){return this._position}},{key:"getComponent",value:function(){return this._list.getAtPosition(this.getPosition())}},{key:"next",value:function(){return this.getPosition()+1<this._list.getLength()?(this._position++,this.getComponent()):null}}]),t}(),vt=function(){function t(){o(this,t),this._list=[],this._idToIndex={},this._longestSequence=1,this._longestSequenceComponentId=null,this._keyMapEventRecord=ot.newRecord()}return l(t,[{key:"getNewIterator",value:function(){return new pt(this)}},{key:"add",value:function(t,e,n,i){if(this.containsId(t))return this.update(t,e,n,i);var r=this._build(t,e,n,i);this._list.push(r);var a=this._getLastIndex();return this._idToIndex[t]=a}},{key:"containsId",value:function(t){return!!this.get(t)}},{key:"get",value:function(t){return this.getAtPosition(this.getIndexById(t))}},{key:"getIndexById",value:function(t){return this._idToIndex[t]}},{key:"update",value:function(t,e,n,i){var r=this._isUpdatingComponentWithLongestSequence(t),a=this.getLongestSequence(),s=this._build(t,e,n,i);r&&s.sequenceLength!==a&&(s.sequenceLength>a?this._longestSequence=s.sequenceLength:this._recalculateLongestSequence()),this._list[this.getIndexById(t)]=s}},{key:"remove",value:function(t){var e=this._isUpdatingComponentWithLongestSequence(t);this.removeAtPosition(this.getIndexById(t)),e&&this._recalculateLongestSequence()}},{key:"any",value:function(){return 0!==this.getLength()}},{key:"isRoot",value:function(t){return this.getIndexById(t)>=this.getLength()-1}},{key:"getLongestSequence",value:function(){return this._longestSequence}},{key:"anyActionsForEventType",value:function(t){return!!this._keyMapEventRecord[t]}},{key:"getLength",value:function(){return this._list.length}},{key:"getAtPosition",value:function(t){return this._list[t]}},{key:"removeAtPosition",value:function(t){this._list=function(t,e){return[].concat(x(t.slice(0,e)),x(t.slice(e+1)))}(this._list,t);for(var e=t;e<this.getLength();)this._idToIndex[this.getAtPosition(e).componentId]=e,e++}},{key:"toJSON",value:function(){return this._list}},{key:"_getLastIndex",value:function(){return this.getLength()-1}},{key:"_build",value:function(t,e,n,i){var r=this._applyHardSequences(e,n),a=r.keyMap,s=r.handlers;return{actions:this._buildActionDictionary(d({},e,a),i,t),handlers:s,componentId:t,options:i}}},{key:"_isUpdatingComponentWithLongestSequence",value:function(t){return t===this._getLongestSequenceComponentId()}},{key:"_getLongestSequenceComponentId",value:function(){return this._longestSequenceComponentId}},{key:"_recalculateLongestSequence",value:function(){for(var t=this.getNewIterator();t.next();){var e=t.getComponent(),n=e.longestSequence,i=e.componentId;n>this.getLongestSequence()&&(this._longestSequenceComponentId=i,this._longestSequence=n)}}},{key:"_applyHardSequences",value:function(t,e){return M.option("enableHardSequences")?Object.keys(e).reduce((function(n,i){return!t[i]&&at.isValidKeySerialization(i)&&(n.keyMap[i]=i),n.handlers[i]=e[i],n}),{keyMap:{},handlers:{}}):{keyMap:t,handlers:e}}},{key:"_buildActionDictionary",value:function(t,e,n){var i=this;return Object.keys(t).reduce((function(r,a){var s=t[a];return(ht(s)&&D(s,"sequences")?ft(s.sequences):ft(s)).forEach((function(t){var s=function(t,e){if(ht(t)){var n=t.sequence,i=t.action;return{keySequence:n,keyEventType:st(i)?T[e.defaultKeyEvent]:T[i]}}return{keySequence:t,keyEventType:T[e.defaultKeyEvent]}}(t,e),o=s.keySequence,h=s.keyEventType;i._addActionOptions(r,n,a,o,h)})),r}),{})}},{key:"_addActionOptions",value:function(t,e,n,i,r){var a=V.parse(i,{keyEventType:r}),s=a.sequence,o=a.combination;s.size>this.getLongestSequence()&&(this._longestSequence=s.size,this._longestSequenceComponentId=e),this._keyMapEventRecord[r]=1,t[n]||(t[n]=[]),t[n].push(d({prefix:s.prefix,actionName:n,sequenceLength:s.size},o))}}]),t}();function yt(t,e){return t[t.length-(e+1)]}for(var mt={Enter:!0,Backspace:!0,ArrowRight:!0,ArrowLeft:!0,ArrowUp:!0,ArrowDown:!0,CapsLock:!0},_t=1;13>_t;_t++)mt["F".concat(_t)]=!0;function bt(t){return 1===t.length||D(mt,t)}var kt=function(){function t(){o(this,t),this._actionConfigs={},this._order=null}return l(t,[{key:"addMatch",value:function(t,e){if(this._includesMatcherForCombination(t.id)){var n=t.keyEventType,i=t.actionName,r=t.id;this._addHandlerToActionConfig(r,{keyEventType:n,actionName:i,handler:e})}else this._addNewActionConfig(t,e)}},{key:"findMatch",value:function(t,e,n){this._order||this._setOrder();var i=!0,r=!1,a=void 0;try{for(var s,o=this._order[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var h=s.value,l=this._actionConfigs[h];if(this._matchesActionConfig(t,e,n,l))return l}}catch(t){r=!0,a=t}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}return null}},{key:"toJSON",value:function(){return{actionConfigs:this._actionConfigs,order:this._order}}},{key:"_matchesActionConfig",value:function(t,e,n,i){if(!function(t,e){var n=ct(e.keyDictionary);return M.option("allowCombinationSubmatches")||function(t){return!!t.isKeyStillPressed("Meta")&&t.some((function(t){return bt(t)}))}(t)?t.getNumberOfKeys()>=n:t.getNumberOfKeys()===n}(t,i))return!1;if(!i.events[n])return!1;var r=!1;return Object.keys(i.keyDictionary).every((function(i){return!!t.isEventTriggered(i,n)&&(e&&e===t.getNormalizedKeyName(i)&&(r=!t.wasEventPreviouslyTriggered(i,n)),!0)}))&&r}},{key:"_setOrder",value:function(){var t=Object.values(this._actionConfigs).reduce((function(t,e){var n=e.id,i=e.size;return t[i]||(t[i]=[]),t[i].push(n),t}),{});this._order=Object.keys(t).sort((function(t,e){return e-t})).reduce((function(e,n){return e.concat(t[n])}),[])}},{key:"_addNewActionConfig",value:function(t,e){var n=t.prefix,i=t.sequenceLength,r=t.id,a=t.keyDictionary,s=t.size,o=t.keyEventType,h=t.actionName;this._setCombinationMatcher(r,{prefix:n,sequenceLength:i,id:r,keyDictionary:a,size:s,events:{}}),this._addHandlerToActionConfig(r,{keyEventType:o,actionName:h,handler:e})}},{key:"_addHandlerToActionConfig",value:function(t,e){var n=e.keyEventType,i=e.actionName,r=e.handler,a=this._getCombinationMatcher(t);this._setCombinationMatcher(t,d({},a,{events:d({},a.events,c({},n,{actionName:i,handler:r}))}))}},{key:"_setCombinationMatcher",value:function(t,e){this._actionConfigs[t]=e}},{key:"_getCombinationMatcher",value:function(t){return this._actionConfigs[t]}},{key:"_includesMatcherForCombination",value:function(t){return!!this._getCombinationMatcher(t)}}]),t}(),St=function(){function t(){o(this,t),this._combinationMatchers={},this._eventRecord=ot.newRecord()}return l(t,[{key:"addMatch",value:function(t,e){this._getOrCreateCombinationMatcher(t.prefix).addMatch(t,e),ot.setBit(this._eventRecord,t.keyEventType,1),(!this._longestSequence||this._longestSequence<t.sequenceLength)&&(this._longestSequence=t.sequenceLength)}},{key:"findMatch",value:function(t,e,n){var i=this._findCombinationMatcher(t);return i?i.findMatch(t.getCurrentCombination(),t.getCurrentCombination().getNormalizedKeyName(e),n):null}},{key:"hasMatchesForEventType",value:function(t){return!!this._eventRecord[t]}},{key:"getLongestSequence",value:function(){return this._longestSequence}},{key:"toJSON",value:function(){var t=this;return Object.keys(this._combinationMatchers).reduce((function(e,n){var i=t._combinationMatchers[n];return e[n]=i.toJSON(),e}),{})}},{key:"_getOrCreateCombinationMatcher",value:function(t){return this._combinationMatchers[t]||(this._combinationMatchers[t]=new kt),this._combinationMatchers[t]}},{key:"_findCombinationMatcher",value:function(t){var e=t.getMostRecentCombinations(this.getLongestSequence());if(0===e.length)return this._combinationMatchers[""];for(var n=e.map((function(t){return t.getIds()})),i=n.map((function(t){return t.length})),r=Array(n.length).fill(0),a=!1;!a;){var s=r.map((function(t,e){return n[e][t]})),o=s.join(" ");if(this._combinationMatchers[o])return this._combinationMatchers[o];for(var h=0,l=!0;l&&h<r.length;){var c=(yt(r,h)+1)%(yt(i,h)||1);r[r.length-(h+1)]=c,(l=0==c)&&h++}a=h===r.length}}}]),t}(),xt=function(){function t(e){o(this,t),this._keyMapMatchers=[],this._unmatchedHandlerStatus=[],this._handlersDictionary={},this._keySequencesDictionary={};for(var n=e.getNewIterator();n.next();){var i=n.getComponent().handlers;this._unmatchedHandlerStatus.push([Object.keys(i).length,{}]),this._keyMapMatchers.push(new St)}this._componentList=e,this._componentListIterator=e.getNewIterator()}return l(t,[{key:"getKeyHistoryMatcher",value:function(t){if(this._componentHasUnmatchedHandlers(t))for(;this._componentListIterator.next();)this._addHandlersFromComponent(),this._addActionsFromComponent();return this._getKeyHistoryMatcher(t)}},{key:"componentHasActionsBoundToEventType",value:function(t,e){return this.getKeyHistoryMatcher(t).hasMatchesForEventType(e)}},{key:"findMatchingKeySequenceInComponent",value:function(t,e,n,i){return this.componentHasActionsBoundToEventType(t,i)?this.getKeyHistoryMatcher(t).findMatch(e,n,i):null}},{key:"_getKeyHistoryMatcher",value:function(t){return this._keyMapMatchers[t]}},{key:"_addActionsFromComponent",value:function(){var t=this,e=this._componentListIterator.getComponent().actions;Object.keys(e).forEach((function(n){var i=t._getHandlers(n);if(i){var r=i[0],a=t._componentList.getAtPosition(r).handlers[n],s=t._getKeyHistoryMatcher(r);e[n].forEach((function(e){var n=[e.prefix,e.id].join(" ");t._isClosestHandlerFound(n,e)||(s.addMatch(e,a),t._addKeySequence(n,[r,e.keyEventType]))})),i.forEach((function(e){var i=t._getUnmatchedHandlerStatus(e);i[1][n]||(i[1][n]=!0,i[0]--)}))}}))}},{key:"_getHandlers",value:function(t){return this._handlersDictionary[t]}},{key:"_addHandlersFromComponent",value:function(){var t=this,e=this._componentListIterator.getComponent().handlers;Object.keys(e).forEach((function(e){t._addHandler(e)}))}},{key:"_addHandler",value:function(t){this._handlersDictionary[t]||(this._handlersDictionary[t]=[]),this._handlersDictionary[t].push(this._componentListIterator.getPosition())}},{key:"_addKeySequence",value:function(t,e){this._keySequencesDictionary[t]||(this._keySequencesDictionary[t]=[]),this._keySequencesDictionary[t].push(e)}},{key:"_componentHasUnmatchedHandlers",value:function(t){return 0<this._getUnmatchedHandlerStatus(t)[0]}},{key:"_getUnmatchedHandlerStatus",value:function(t){return this._unmatchedHandlerStatus[t]}},{key:"_isClosestHandlerFound",value:function(t,e){return this._keySequencesDictionary[t]&&this._keySequencesDictionary[t].some((function(t){return t[1]===e.keyEventType}))}}]),t}();function wt(t,e,n){return n.forEach((function(n){D(t,n)&&(e[n]=t[n])})),e}function Ct(t){switch(parseInt(t,10)){case 0:return"keydown";case 1:return"keypress";default:return"keyup"}}function Pt(t){return t.simulated?2:1}var Mt=["sequence","action"],Et=["name","description","group"],Tt=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0;o(this,t),this.logger=e.logger||new E("warn"),this.componentId=-1,this.keyEventManager=n,this._componentTree=new gt,this.rootComponentId=null,this._reset(),this.resetKeyHistory()}return l(t,[{key:"_reset",value:function(){this.componentList=new vt,this._initHandlerResolutionState()}},{key:"_newKeyHistory",value:function(){return new dt({maxLength:this.componentList.getLongestSequence()})}},{key:"getKeyHistory",value:function(){return this._keyHistory||(this._keyHistory=this._newKeyHistory()),this._keyHistory}},{key:"_initHandlerResolutionState",value:function(){this._actionResolver=null}},{key:"resetKeyHistory",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.keypressEventsToSimulate=[],this.keyupEventsToSimulate=[],this._keyHistory=this.getKeyHistory().any()&&!t.force?new dt({maxLength:this.componentList.getLongestSequence()},new ut(this.getCurrentCombination().keysStillPressedDict())):this._newKeyHistory()}},{key:"getApplicationKeyMap",value:function(){return null===this.rootComponentId?{}:this._buildApplicationKeyMap([this.rootComponentId],{})}},{key:"_buildApplicationKeyMap",value:function(t,e){var n=this;return t.forEach((function(t){var i=n._componentTree.get(t),r=i.childIds,a=i.keyMap;a&&Object.keys(a).forEach((function(t){var i=a[t];e[t]={},ht(i)?D(i,"sequences")?(wt(i,e[t],Et),e[t].sequences=n._createSequenceFromConfig(i.sequences)):(wt(i,e[t],Et),e[t].sequences=[wt(i,{},Mt)]):e[t].sequences=n._createSequenceFromConfig(i)})),n._buildApplicationKeyMap(r,e)})),e}},{key:"_createSequenceFromConfig",value:function(t){return ft(t).map((function(t){return ht(t)?wt(t,{},Mt):{sequence:t}}))}},{key:"registerKeyMap",value:function(t){return this.componentId+=1,this._componentTree.add(this.componentId,t),this.componentId}},{key:"reregisterKeyMap",value:function(t,e){this._componentTree.update(t,e)}},{key:"registerComponentMount",value:function(t,e){st(e)?this.rootComponentId=t:this._componentTree.setParent(t,e)}},{key:"deregisterKeyMap",value:function(t){this._componentTree.remove(t),t===this.rootComponentId&&(this.rootComponentId=null)}},{key:"_addComponent",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0;this.componentList.add(t,e,n,i),this.getKeyHistory().setMaxLength(this.componentList.getLongestSequence())}},{key:"_allKeysAreReleased",value:function(){return this.getCurrentCombination().hasEnded()}},{key:"getCurrentCombination",value:function(){return this.getKeyHistory().getCurrentCombination()}},{key:"_shouldSimulate",value:function(t,e){var n=function(t){return!q(t)}(e),i=this.getCurrentCombination();return t===T.keypress?!n||n&&i.isKeyStillPressed("Meta"):t===T.keyup&&bt(e)&&i.isKeyReleased("Meta")}},{key:"_cloneAndMergeEvent",value:function(t,e){var n=Object.keys(A).reduce((function(e,n){return e[n]=t[n],e}),{});return d({},n,e)}},{key:"_callClosestMatchingHandler",value:function(t,e,n,i,r){for(this._actionResolver||(this._actionResolver=new xt(this.componentList));r<=i;){this._actionResolver.getKeyHistoryMatcher(r);var a=this._actionResolver.findMatchingKeySequenceInComponent(r,this.getKeyHistory(),e,n);if(this.getCurrentCombination(),a){var s=a.events[n];return M.option("allowCombinationSubmatches")&&at.serialize(a.keyDictionary),s.handler(t),this._stopEventPropagationAfterHandlingIfEnabled(t,r),!0}this._actionResolver.componentHasActionsBoundToEventType(r,n),r++}}},{key:"_stopEventPropagationAfterHandlingIfEnabled",value:function(t,e){return!!M.option("stopEventPropagationAfterHandling")&&(this._stopEventPropagation(t,e),!0)}},{key:"_stopEventPropagation",value:function(){throw new Error("_stopEventPropagation must be overridden by a subclass")}},{key:"_checkForModifierFlagDiscrepancies",value:function(t,e,n){var i=this;Object.keys(A).forEach((function(r){if(e!==r||n!==T.keyup){var a=i.getCurrentCombination(),s=a.isKeyStillPressed(r);A[r].forEach((function(e){!1===t[e]&&s&&a.setKeyState(r,T.keyup,Pt(t))}))}}))}},{key:"_logPrefix",value:function(){}}]),t}(),At=function(){function t(){o(this,t)}return l(t,null,[{key:"getId",value:function(){return st(this._id)&&(this._id=0),this._id}},{key:"incrementId",value:function(){this._id=this.getId()+1}}]),t}(),Ot={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"};function It(t){var e=function(){var e=M.option("customKeyCodes"),n=t.keyCode||t.charCode;return D(e,n)?e[n]:t.nativeEvent?t.key:function(t){if(t.key){var e=Ot[t.key]||t.key;if("Unidentified"!==e)return e}if("keypress"===t.type){var n=function(t){var e,n=t.keyCode;return"charCode"in t?0===(e=t.charCode)&&13===n&&(e=13):e=n,10===e&&(e=13),32<=e||13===e?e:0}(t);return 13===n?"Enter":String.fromCharCode(n)}return"keydown"===t.type||"keyup"===t.type?z[t.keyCode]||"Unidentified":""}(t)}();return"+"===e?"plus":e}function Dt(t){return"Meta"===t}var Lt=function(){function t(e,n){var i=n.logger,r=n.logPrefix;o(this,t),this._componentList=e,this._previousPropagation=null,this.logger=i,this._logPrefix=r,this._reset()}return l(t,[{key:"_reset",value:function(){this._previousPosition=-1,this._position=-1,this._actionHandled=!1,this._ignoreEvent=!1,this._observeIgnoredEvents=!1,this._stopping=!1,this._componentId=null,this._key=null,this._type=null}},{key:"isFirstPropagationStep",value:function(){var t=this.getPreviousPosition();return-1===t||t>=this._position}},{key:"isForKey",value:function(t){return this._key===t}},{key:"isForEventType",value:function(t){return this._type===t}},{key:"startNewPropagationStep",value:function(t,e,n,i){return this._position=this._componentList.getIndexById(t),this._componentId=t,this.isFirstPropagationStep()&&(At.incrementId(),this._key=e.key,this._type=i),!(e.repeat&&M.option("ignoreRepeatedEventsWhenKeyHeldDown")&&(this.ignoreEvent(e),1))}},{key:"finishPropagationStep",value:function(){this.isStopped()||this._componentList.isRoot(this._componentId)?(this._previousPropagation=this._clone(),this._reset()):this._previousPosition=this._position}},{key:"getPreviousPropagation",value:function(){return this._previousPropagation||(this._previousPropagation=this._clone({copyState:!1})),this._previousPropagation}},{key:"getPreviousPosition",value:function(){return this._previousPosition}},{key:"observeIgnoredEvents",value:function(){this._observeIgnoredEvents=!0}},{key:"ignoreEvent",value:function(t){return this.setIgnoreEvent(!0),!(!this.isIgnoringEvent()||!M.option("stopEventPropagationAfterIgnoring")||(this.stop(t),this.finishPropagationStep(),0))}},{key:"setIgnoreEvent",value:function(t){this._ignoreEvent=t}},{key:"isIgnoringEvent",value:function(){return!this._observeIgnoredEvents&&this._ignoreEvent}},{key:"isStopped",value:function(){return this._stopping}},{key:"stop",value:function(t){return!this.isStopped()&&(this._stopping=!0,t.simulated||t.stopPropagation(),!0)}},{key:"isPendingPropagation",value:function(){var t=this.getPreviousPosition();return-1!==t&&t+1<this._position}},{key:"isHandled",value:function(){return this._actionHandled}},{key:"setHandled",value:function(){this._actionHandled=!0}},{key:"_clone",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.copyState,i=new t(this._componentList,{logger:this.logger,logPrefix:this._logPrefix});return(void 0===n||n)&&Object.assign(i,this),i}}]),t}(),Rt=function(t){function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length?arguments[1]:void 0;return o(this,e),(t=k(this,g(e).call(this,n,i))).focusTreeId=0,t}return f(e,t),l(e,[{key:"_reset",value:function(){S(g(e.prototype),"_reset",this).call(this),this.keypressEventsToSimulate=[],this.focusTreeId+=1,this.eventPropagator=new Lt(this.componentList,{logger:this.logger,logPrefix:this._logPrefix.bind(this)})}},{key:"enableHotKeys",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0;if(this.resetOnNextFocus&&(this._reset(),this.resetOnNextFocus=!1),!this.componentList.containsId(t))return this._addComponent(t,e,n,i),this.focusTreeId}},{key:"updateEnabledHotKeys",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},r=4<arguments.length?arguments[4]:void 0;t===this.focusTreeId&&this.componentList.containsId(e)&&(this.componentList.update(e,n,i,r),this.getKeyHistory().setMaxLength(this.componentList.getLongestSequence()),this._initHandlerResolutionState())}},{key:"disableHotKeys",value:function(t,e){return this.resetOnNextFocus||(this.resetOnNextFocus=!0),this.eventPropagator.isPendingPropagation()}},{key:"handleKeydown",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},r=It(t);if(e!==this.focusTreeId)return this.eventPropagator.ignoreEvent(t),!0;var a=this.eventPropagator.startNewPropagationStep(n,t,r,T.keydown);if(a){var s=this._howToHandleKeyEvent(t,e,n,r,i,T.keydown);if(4===s){var o=Pt(t),h=this.getCurrentCombination();h.isKeyIncluded(r)||h.isEnding()?this._startAndLogNewKeyCombination(r,e,n,o):this._addToAndLogCurrentKeyCombination(r,T.keydown,e,n,o),this._callHandlerIfActionNotHandled(t,r,T.keydown,n,e)}return this._simulateKeyPressForNonPrintableKeys(t,r,e,n,i),this.eventPropagator.finishPropagationStep(),!1}}},{key:"_howToHandleKeyEvent",value:function(t,e,n,i,r,a){if(this.eventPropagator.isFirstPropagationStep()){if(r.ignoreEventsCondition(t)&&this.eventPropagator.ignoreEvent(t))return this._eventIsToBeIgnored(t,n,i,a);this._checkForModifierFlagDiscrepancies(t,i,a)}else if(this.eventPropagator.isIgnoringEvent())return this._eventIsToBeIgnored(t,n,i,a);return 4}},{key:"_eventIsToBeIgnored",value:function(t,e,n,i){return 1}},{key:"handleKeyPress",value:function(t,e,n,i){var r=It(t),a=this.getCurrentCombination();if(a.isKeyPressSimulated(r))return this.eventPropagator.ignoreEvent(t),!0;if(this.eventPropagator.startNewPropagationStep(n,t,r,T.keypress)){var s=e!==this.focusTreeId,o=this._howToHandleKeyEvent(t,e,n,r,i,T.keypress);return this.eventPropagator.isFirstPropagationStep(n)&&a.isKeyIncluded(r)&&this._addToAndLogCurrentKeyCombination(r,T.keypress,e,n,Pt(t)),4===o&&this._callHandlerIfActionNotHandled(t,r,T.keypress,n,e),this.eventPropagator.finishPropagationStep(),s}}},{key:"handleKeyUp",value:function(t,e,n,i){var r=It(t),a=this.getCurrentCombination();if(a.isKeyUpSimulated(r))return this.eventPropagator.ignoreEvent(t),!0;if(this.eventPropagator.startNewPropagationStep(n,t,r,T.keyup)){var s=e!==this.focusTreeId,o=this._howToHandleKeyEvent(t,e,n,r,i,T.keyup);return this.eventPropagator.isFirstPropagationStep(n)&&a.isKeyIncluded(r)&&this._addToAndLogCurrentKeyCombination(r,T.keyup,e,n,Pt(t)),4===o&&this._callHandlerIfActionNotHandled(t,r,T.keyup,n,e),this._simulateKeyUpEventsHiddenByCmd(t,r,e,n,i),this.eventPropagator.finishPropagationStep(),s}}},{key:"closeHangingKeyCombination",value:function(t,e){var n=this.getCurrentCombination();n.isKeyIncluded(t)&&!n.isEventTriggered(t,e)&&n.setKeyState(t,e,2)}},{key:"_simulateKeyPressForNonPrintableKeys",value:function(t,e,n,i,r){this._handleEventSimulation("keypressEventsToSimulate","simulatePendingKeyPressEvents",this._shouldSimulate(T.keypress,e),{event:t,key:e,focusTreeId:n,componentId:i,options:r})}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e,n,i,r){var a=this;Dt(e)&&this.getCurrentCombination().forEachKey((function(e){Dt(e)||a._handleEventSimulation("keyupEventsToSimulate","simulatePendingKeyUpEvents",a._shouldSimulate(T.keyup,e),{event:t,key:e,focusTreeId:n,componentId:i,options:r})}))}},{key:"_stopEventPropagation",value:function(t,e){this.eventPropagator.stop(t)}},{key:"getEventPropagator",value:function(){return this.eventPropagator}},{key:"_startAndLogNewKeyCombination",value:function(t,e,n,i){this.getKeyHistory().startNewKeyCombination(t,i)}},{key:"_addToAndLogCurrentKeyCombination",value:function(t,e,n,i,r){this.getKeyHistory().addKeyToCurrentCombination(t,e,r)}},{key:"_handleEventSimulation",value:function(t,e,n,i){var r=i.event,a=i.key,s=i.focusTreeId,o=i.componentId,h=i.options;if(n&&M.option("simulateMissingKeyPressEvents")){var l=this._cloneAndMergeEvent(r,{key:a,simulated:!0});this[t].push({event:l,focusTreeId:s,componentId:o,options:h})}(this.componentList.isRoot(o)||this.eventPropagator.isStopped())&&!this.keyEventManager.isGlobalListenersBound()&&this[e]()}},{key:"simulatePendingKeyPressEvents",value:function(){this._simulatePendingKeyEvents("keypressEventsToSimulate","handleKeyPress")}},{key:"simulatePendingKeyUpEvents",value:function(){this._simulatePendingKeyEvents("keyupEventsToSimulate","handleKeyUp")}},{key:"_simulatePendingKeyEvents",value:function(t,e){var n=this;0<this[t].length&&At.incrementId(),this[t].forEach((function(t){var i=t.event,r=t.focusTreeId,a=t.componentId,s=t.options;n[e](i,r,a,s)})),this[t]=[]}},{key:"_callHandlerIfActionNotHandled",value:function(t,e,n,i,r){if(this.getCurrentCombination().describe(),this.componentList.anyActionsForEventType(n))if(this.eventPropagator.isHandled());else{var a=this.eventPropagator.getPreviousPosition(),s=this.componentList.getIndexById(i);this._callClosestMatchingHandler(t,e,n,s,-1===a?0:a)&&this.eventPropagator.setHandled()}}},{key:"_logPrefix",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=E.logIcons,i=E.eventIcons,r=E.componentIcons,a="HotKeys (";if(!1!==e.focusTreeId){var s=st(e.focusTreeId)?this.focusTreeId:e.focusTreeId;a+="F".concat(s).concat(n[s%n.length],"-")}if(!1!==e.eventId){var o=st(e.eventId)?At.getId():e.eventId;a+="E".concat(o).concat(i[o%i.length],"-")}a+="C".concat(t).concat(r[t%r.length]);var h=this.componentList.getIndexById(t);return st(h)||(a+="-P".concat(h).concat(r[h%r.length],":")),"".concat(a,")")}}]),e}(Tt);function Gt(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return Array.isArray(t)||F(t)?n.stringifyFirst?!st(t.find((function(t){return t.toString()===e.toString()}))):-1!==t.indexOf(e):ht(t)?D(t,e):n.stringifyFirst?t.toString()===e.toString():t===e}function Kt(t){return t.replace(/\b\w/g,(function(t){return t.toUpperCase()}))}var Ft=function(t){function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length?arguments[1]:void 0;return o(this,e),(t=k(this,g(e).call(this,n,i))).listenersBound=!1,t.eventOptions={ignoreEventsCondition:M.option("ignoreEventsCondition")},t.listeners={},t}return f(e,t),l(e,[{key:"enableHotKeys",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0,r=4<arguments.length?arguments[4]:void 0;this.eventOptions=r,this._addComponent(t,e,n,i),this._updateDocumentHandlers(),this._initHandlerResolutionState()}},{key:"updateEnabledHotKeys",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0,r=4<arguments.length?arguments[4]:void 0;this.eventOptions=r,this.componentList.update(t,e,n,i),this.getKeyHistory().setMaxLength(this.componentList.getLongestSequence()),this._updateDocumentHandlers(),this._initHandlerResolutionState()}},{key:"disableHotKeys",value:function(t){this.componentList.remove(t),this.getKeyHistory().setMaxLength(this.componentList.getLongestSequence()),this._updateDocumentHandlers(),this._initHandlerResolutionState()}},{key:"_updateDocumentHandlers",value:function(){var t=this,e=this._listenersShouldBeBound();!this.listenersBound&&e?(Object.values(T).forEach((function(e){var n=Ct(e);document["on".concat(n)]=function(e){t.keyEventManager["handleGlobal".concat(function(t){return"".concat(Kt(t.slice(0,3))).concat(Kt(t.slice(3)))}(n))](e)}})),this.listenersBound=!0):this.listenersBound&&!e&&(Object.values(T).forEach((function(t){var e=Ct(t);delete document["on".concat(e)]})),this.listenersBound=!1)}},{key:"_listenersShouldBeBound",value:function(){return this.componentList.any()||this.listeners.keyCombination}},{key:"handleKeydown",value:function(t){var e=It(t);if(t.repeat&&M.option("ignoreRepeatedEventsWhenKeyHeldDown"))return!0;this._checkForModifierFlagDiscrepancies(t,e,T.keydown);var n=this._howReactAppRespondedTo(t,e,T.keydown);if(0!==n||!this.eventOptions.ignoreEventsCondition(t)){if(1!==n){var i=Pt(t),r=this.getCurrentCombination();r.isKeyIncluded(e)||r.isEnding()?this._startAndLogNewKeyCombination(e,i):this._addToAndLogCurrentKeyCombination(e,T.keydown,i)}Gt([1,4],n)||this._callHandlerIfExists(t,e,T.keydown),this._simulateKeyPressForNonPrintableKeys(t,e)}}},{key:"_howReactAppRespondedTo",value:function(t,e,n){var i=this.keyEventManager.reactAppHistoryWithEvent(e,n);return 4===i||1===i||2===i||At.incrementId(),i}},{key:"handleKeyPress",value:function(t){var e=It(t);if(t.repeat&&M.option("ignoreRepeatedEventsWhenKeyHeldDown"))return!0;var n=this.getCurrentCombination();if(n.isKeyPressSimulated(e))return!0;var i=this._howReactAppRespondedTo(t,e,T.keypress);return n.isKeyIncluded(e)&&this._addToAndLogCurrentKeyCombination(e,T.keypress,Pt(t)),0===i&&(this.keyEventManager.closeHangingKeyCombination(e,T.keypress),this.eventOptions.ignoreEventsCondition(t))?void 0:void(!Gt([1,4],i)&&this._callHandlerIfExists(t,e,T.keypress))}},{key:"handleKeyUp",value:function(t){var e=It(t),n=this.getCurrentCombination();if(n.isKeyUpSimulated(e))return!0;var i=this._howReactAppRespondedTo(t,e,T.keyup);n.isKeyIncluded(e)&&this._addToAndLogCurrentKeyCombination(e,T.keyup,Pt(t)),0===i?(this.keyEventManager.closeHangingKeyCombination(e,T.keyup),this.eventOptions.ignoreEventsCondition(t)||!Gt([1,4],i)&&this._callHandlerIfExists(t,e,T.keyup)):!Gt([1,4],i)&&this._callHandlerIfExists(t,e,T.keyup),this._simulateKeyUpEventsHiddenByCmd(t,e),this.listeners.keyCombination&&this._allKeysAreReleased()&&this.listeners.keyCombination({keys:n.getKeyDictionary(),id:n.describe()})}},{key:"_simulateKeyPressForNonPrintableKeys",value:function(t,e){this.keyEventManager.simulatePendingKeyPressEvents(),this._handleEventSimulation("handleKeyPress",this._shouldSimulate(T.keypress,e),{event:t,key:e})}},{key:"_simulateKeyUpEventsHiddenByCmd",value:function(t,e){var n=this;Dt(e)&&(this.keyEventManager.simulatePendingKeyUpEvents(),this.getCurrentCombination().forEachKey((function(e){Dt(e)||n._handleEventSimulation("handleKeyUp",n._shouldSimulate(T.keyup,e),{event:t,key:e})})))}},{key:"_startAndLogNewKeyCombination",value:function(t,e){this.getKeyHistory().startNewKeyCombination(t,e)}},{key:"_addToAndLogCurrentKeyCombination",value:function(t,e,n){this.getKeyHistory().addKeyToCurrentCombination(t,e,n)}},{key:"_handleEventSimulation",value:function(t,e,n){var i=n.event,r=n.key;if(e&&M.option("simulateMissingKeyPressEvents")){var a=this._cloneAndMergeEvent(i,{key:r,simulated:!0});this[t](a)}}},{key:"_callHandlerIfExists",value:function(t,e,n){return this.getCurrentCombination().describe(),this.componentList.anyActionsForEventType(n)?void this._callClosestMatchingHandler(t,e,n):void 0}},{key:"_callClosestMatchingHandler",value:function(t,n,i){for(var r=this.componentList.getNewIterator();r.next();)if(S(g(e.prototype),"_callClosestMatchingHandler",this).call(this,t,n,i,r.getPosition(),0))return}},{key:"_stopEventPropagation",value:function(t,e){t.simulated||t.stopPropagation()}},{key:"addKeyCombinationListener",value:function(t){var e=this,n=function(){delete e.listeners.keyCombination};return this.listeners.keyCombination=function(e){t(e),n()},this._updateDocumentHandlers(),n}},{key:"_logPrefix",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=E.eventIcons,i=E.componentIcons,r="HotKeys (GLOBAL";if(!1!==e.eventId){var a=st(e.eventId)?At.getId():e.eventId;r="".concat(r,"-E").concat(a).concat(n[a%n.length])}return st(t)?"".concat(r,"):"):"".concat(r,"-C").concat(t).concat(i[t%i.length],"):")}}]),e}(Tt);function Ht(t){return!st(t)}var Nt=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,t),this.logger=e.logger||new E(M.option("logLevel")),this._focusOnlyEventStrategy=new Rt({configuration:e,logger:this.logger},this),this._globalEventStrategy=new Ft({configuration:e,logger:this.logger},this),this.mountedComponentsCount=0}return l(t,null,[{key:"getInstance",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.instance||(this.instance=new t(e)),this.instance}},{key:"clear",value:function(){delete this.instance}}]),l(t,[{key:"getApplicationKeyMap",value:function(){return Object.assign(this._globalEventStrategy.getApplicationKeyMap(),this._focusOnlyEventStrategy.getApplicationKeyMap())}},{key:"registerKeyMap",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._focusOnlyEventStrategy.registerKeyMap(t)}},{key:"reregisterKeyMap",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this._focusOnlyEventStrategy.reregisterKeyMap(t,e)}},{key:"deregisterKeyMap",value:function(t){this._focusOnlyEventStrategy.deregisterKeyMap(t)}},{key:"registerComponentMount",value:function(t,e){return this._incrementComponentCount(),this._focusOnlyEventStrategy.registerComponentMount(t,e)}},{key:"registerComponentUnmount",value:function(){this._decrementComponentCount()}},{key:"_incrementComponentCount",value:function(){var t=this,e=this.mountedComponentsCount;this.mountedComponentsCount+=1,0===e&&1===this.mountedComponentsCount&&(window.onblur=function(){return t._clearKeyHistory()})}},{key:"_decrementComponentCount",value:function(){var t=this.mountedComponentsCount;this.mountedComponentsCount-=1,1===t&&0===this.mountedComponentsCount&&delete window.onblur}},{key:"_clearKeyHistory",value:function(){this._focusOnlyEventStrategy.resetKeyHistory({force:!0}),this._globalEventStrategy.resetKeyHistory({force:!0})}},{key:"registerGlobalKeyMap",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._globalEventStrategy.registerKeyMap(t)}},{key:"registerGlobalComponentUnmount",value:function(){this._decrementComponentCount()}},{key:"registerGlobalComponentMount",value:function(t,e){return this._incrementComponentCount(),this._globalEventStrategy.registerComponentMount(t,e)}},{key:"reregisterGlobalKeyMap",value:function(t,e){this._globalEventStrategy.reregisterKeyMap(t,e)}},{key:"deregisterGlobalKeyMap",value:function(t){this._globalEventStrategy.deregisterKeyMap(t)}},{key:"addKeyCombinationListener",value:function(t){return this._globalEventStrategy.addKeyCombinationListener(t)}},{key:"enableHotKeys",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0;return this._focusOnlyEventStrategy.enableHotKeys(t,e,n,i)}},{key:"updateEnabledHotKeys",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},r=4<arguments.length?arguments[4]:void 0;return this._focusOnlyEventStrategy.updateEnabledHotKeys(t,e,n,i,r)}},{key:"disableHotKeys",value:function(t,e){return this._focusOnlyEventStrategy.disableHotKeys(t,e)}},{key:"handleKeydown",value:function(t,e,n,i){if(Ht(e))return this._focusOnlyEventStrategy.handleKeydown(t,e,n,i)}},{key:"handleKeyPress",value:function(t,e,n,i){if(Ht(e))return this._focusOnlyEventStrategy.handleKeyPress(t,e,n,i)}},{key:"handleKeyUp",value:function(t,e,n,i){if(Ht(e))return this._focusOnlyEventStrategy.handleKeyUp(t,e,n,i)}},{key:"enableGlobalHotKeys",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0,r=4<arguments.length?arguments[4]:void 0;return this._globalEventStrategy.enableHotKeys(t,e,n,i,r)}},{key:"updateEnabledGlobalHotKeys",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length?arguments[3]:void 0,r=4<arguments.length?arguments[4]:void 0;return this._globalEventStrategy.updateEnabledHotKeys(t,e,n,i,r)}},{key:"disableGlobalHotKeys",value:function(t){return this._globalEventStrategy.disableHotKeys(t)}},{key:"handleGlobalKeyDown",value:function(t){return this._globalEventStrategy.handleKeydown(t)}},{key:"handleGlobalKeyPress",value:function(t){return this._globalEventStrategy.handleKeyPress(t)}},{key:"handleGlobalKeyUp",value:function(t){return this._globalEventStrategy.handleKeyUp(t)}},{key:"ignoreEvent",value:function(t){this._focusOnlyEventStrategy.getEventPropagator().ignoreEvent(t)}},{key:"observeIgnoredEvents",value:function(t){this._focusOnlyEventStrategy.getEventPropagator().observeIgnoredEvents(t)}},{key:"closeHangingKeyCombination",value:function(t,e){this._focusOnlyEventStrategy.closeHangingKeyCombination(t,e)}},{key:"reactAppHistoryWithEvent",value:function(t,e){var n=this._focusOnlyEventStrategy.eventPropagator.getPreviousPropagation();return n.isForKey(t)&&n.isForEventType(e)?n.isHandled()?4:n.isIgnoringEvent()?1:2:0}},{key:"simulatePendingKeyPressEvents",value:function(){this._focusOnlyEventStrategy.simulatePendingKeyPressEvents()}},{key:"simulatePendingKeyUpEvents",value:function(){this._focusOnlyEventStrategy.simulatePendingKeyUpEvents()}},{key:"isGlobalListenersBound",value:function(){return this._globalEventStrategy.listenersBound}}]),t}();function jt(t,e){var n=e.deprecatedAPI,i=n.contextTypes,r=n.childContextTypes,s=e.newAPI.contextType;if(void 0===a.createContext)t.contextTypes=i,t.childContextTypes=r,t.prototype.getChildContext=function(){return this._childContext};else{var o=a.createContext(s);t.contextType=o,t.prototype._originalRender=t.prototype.render,t.prototype.render=function(){var t=this._originalRender();return t?a.createElement(o.Provider,{value:this._childContext},t):null}}return t}(function(t){function e(t,e){return d({},s[t]||{},e[t]||{})}function n(t){return e("handlers",t)}function i(t){return e("keyMap",t)}var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},h=function(e){function r(t){var e;return o(this,r),(e=k(this,g(r).call(this,t)))._handleFocus=e._handleFocus.bind(b(b(e))),e._handleBlur=e._handleBlur.bind(b(b(e))),e._handleKeyDown=e._handleKeyDown.bind(b(b(e))),e._handleKeyPress=e._handleKeyPress.bind(b(b(e))),e._handleKeyUp=e._handleKeyUp.bind(b(b(e))),e._componentIsFocused=e._componentIsFocused.bind(b(b(e))),e._id=Nt.getInstance().registerKeyMap(t.keyMap),e._childContext={hotKeysParentId:e._id},e}return f(r,e),l(r,[{key:"render",value:function(){var e=this.props,n=(e.keyMap,e.handlers,e.allowChanges,e.root,_(e,["keyMap","handlers","allowChanges","root"])),i={onFocus:this._wrapFunction("onFocus",this._handleFocus),onBlur:this._wrapFunction("onBlur",this._handleBlur),tabIndex:M.option("defaultTabIndex")};return this._shouldBindKeyListeners()&&(i.onKeyDown=this._handleKeyDown,i.onKeyPress=this._handleKeyPress,i.onKeyUp=this._handleKeyUp),a.createElement(t,u({hotKeys:i},n))}},{key:"_shouldBindKeyListeners",value:function(){var t=i(this.props);return!lt(t)||this.props.root||M.option("enableHardSequences")&&this._handlersIncludeHardSequences(t,n(this.props))}},{key:"_handlersIncludeHardSequences",value:function(t,e){return Object.keys(e).some((function(e){return!t[e]&&at.isValidKeySerialization(e)}))}},{key:"_wrapFunction",value:function(t,e){var n=this;return"function"==typeof this.props[t]?function(i){n.props[t](i),e(i)}:e}},{key:"_focusTreeIdsPush",value:function(t){this._focusTreeIds||(this._focusTreeIds=[]),this._focusTreeIds.push(t)}},{key:"_focusTreeIdsShift",value:function(){this._focusTreeIds&&this._focusTreeIds.shift()}},{key:"_getFocusTreeId",value:function(){if(this._focusTreeIds)return this._focusTreeIds[0]}},{key:"componentDidUpdate",value:function(){var t=Nt.getInstance();if(t.reregisterKeyMap(this._id,this.props.keyMap),this._componentIsFocused()&&(this.props.allowChanges||!M.option("ignoreKeymapAndHandlerChangesByDefault"))){var e=this.props,n=e.keyMap,i=e.handlers;t.updateEnabledHotKeys(this._getFocusTreeId(),this._id,n,i,this._getComponentOptions())}}},{key:"_componentIsFocused",value:function(){return!0===this._focused}},{key:"componentDidMount",value:function(){var t=Nt.getInstance(),e=this.context.hotKeysParentId;t.registerComponentMount(this._id,e)}},{key:"_handleFocus",value:function(){var t;this.props.onFocus&&(t=this.props).onFocus.apply(t,arguments);var e=Nt.getInstance().enableHotKeys(this._id,i(this.props),n(this.props),this._getComponentOptions());st(e)||this._focusTreeIdsPush(e),this._focused=!0}},{key:"componentWillUnmount",value:function(){var t=Nt.getInstance();t.deregisterKeyMap(this._id),t.registerComponentUnmount(),this._handleBlur()}},{key:"_handleBlur",value:function(){var t;this.props.onBlur&&(t=this.props).onBlur.apply(t,arguments);var e=Nt.getInstance().disableHotKeys(this._getFocusTreeId(),this._id);e||this._focusTreeIdsShift(),this._focused=!1}},{key:"_handleKeyDown",value:function(t){Nt.getInstance().handleKeydown(t,this._getFocusTreeId(),this._id,this._getEventOptions())&&this._focusTreeIdsShift()}},{key:"_handleKeyPress",value:function(t){Nt.getInstance().handleKeyPress(t,this._getFocusTreeId(),this._id,this._getEventOptions())&&this._focusTreeIdsShift()}},{key:"_handleKeyUp",value:function(t){Nt.getInstance().handleKeyUp(t,this._getFocusTreeId(),this._id,this._getEventOptions())&&this._focusTreeIdsShift()}},{key:"_getComponentOptions",value:function(){return{defaultKeyEvent:M.option("defaultKeyEvent")}}},{key:"_getEventOptions",value:function(){return{ignoreEventsCondition:M.option("ignoreEventsCondition")}}}]),r}(a.PureComponent);return c(h,"propTypes",{keyMap:r().object,handlers:r().object,onFocus:r().func,onBlur:r().func,allowChanges:r().bool,root:r().bool}),jt(h,{deprecatedAPI:{contextTypes:{hotKeysParentId:r().number},childContextTypes:{hotKeysParentId:r().number}},newAPI:{contextType:{hotKeysParentId:void 0}}})}(function(t){function e(){return o(this,e),k(this,g(e).apply(this,arguments))}return f(e,t),l(e,[{key:"render",value:function(){var t=this.props,e=t.hotKeys,n=t.innerRef,i=t.component,r=_(t,["hotKeys","innerRef","component"]),s=i||M.option("defaultComponent");return a.createElement(s,d({},e,{ref:n},r))}}]),e}(a.Component))).propTypes={innerRef:r().oneOfType([r().object,r().func])};var Bt=function(t){function e(t){var n;return o(this,e),(n=k(this,g(e).call(this,t)))._id=Nt.getInstance().registerGlobalKeyMap(t.keyMap),n._childContext={globalHotKeysParentId:n._id},n}return f(e,t),l(e,[{key:"render",value:function(){return this.props.children||null}},{key:"componentDidUpdate",value:function(){var t=Nt.getInstance();if(t.reregisterGlobalKeyMap(this._id,this.props.keyMap),this.props.allowChanges||!M.option("ignoreKeymapAndHandlerChangesByDefault")){var e=this.props,n=e.keyMap,i=e.handlers;t.updateEnabledGlobalHotKeys(this._id,n,i,this._getComponentOptions(),this._getEventOptions())}}},{key:"componentDidMount",value:function(){var t=this.props,e=t.keyMap,n=t.handlers,i=this.context.globalHotKeysParentId,r=Nt.getInstance();r.registerGlobalComponentMount(this._id,i),r.enableGlobalHotKeys(this._id,e,n,this._getComponentOptions(),this._getEventOptions())}},{key:"componentWillUnmount",value:function(){var t=Nt.getInstance();t.deregisterGlobalKeyMap(this._id),t.disableGlobalHotKeys(this._id),t.registerGlobalComponentUnmount()}},{key:"_getComponentOptions",value:function(){return{defaultKeyEvent:M.option("defaultKeyEvent")}}},{key:"_getEventOptions",value:function(){return{ignoreEventsCondition:M.option("ignoreEventsCondition")}}}]),e}(a.Component);c(Bt,"propTypes",{keyMap:r().object,handlers:r().object,allowChanges:r().bool});var zt=jt(Bt,{deprecatedAPI:{contextTypes:{globalHotKeysParentId:r().number},childContextTypes:{globalHotKeysParentId:r().number}},newAPI:{contextType:{globalHotKeysParentId:void 0}}});function Wt(t){var e,n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{only:[],except:[]},s=2<arguments.length?arguments[2]:void 0;return n=e=function(e){function n(t){var e;return o(this,n),(e=k(this,g(n).call(this,t)))._handleKeyEvent=e._handleKeyEvent.bind(b(b(e))),e._reloadDictionaries=e._reloadDictionaries.bind(b(b(e))),e}return f(n,e),l(n,[{key:"render",value:function(){var e=this.props,n=(e.only,e.except,_(e,["only","except"])),i={onKeyDown:this._handleKeyEvent,onKeyPress:this._handleKeyEvent,onKeyUp:this._handleKeyEvent,onFocus:this._reloadDictionaries};return a.createElement(t,u({hotKeys:i},n))}},{key:"_reloadDictionaries",value:function(){var t=this.props,e=t.only,n=t.except;this._onlyDict=qt(e),this._exceptDict=qt(n)}},{key:"_shouldIgnoreEvent",value:function(t){var e=t.key;return lt(this._onlyDict)?!!lt(this._exceptDict)||!D(this._exceptDict,e):lt(this._exceptDict)?D(this._onlyDict,e):D(this._onlyDict,e)&&!D(this._exceptDict,e)}},{key:"_handleKeyEvent",value:function(t){this._shouldIgnoreEvent(t)&&Nt.getInstance()[s](t)}}]),n}(a.PureComponent),c(e,"propTypes",{only:r().oneOfType([r().string,r().arrayOf(r().string)]),except:r().oneOfType([r().string,r().arrayOf(r().string)])}),c(e,"defaultProps",i),n}function qt(t){return ft(t).reduce((function(t,e){var n=B(e);if(!U(n))throw new Y(e);return[rt,it,I,G,tt,J].forEach((function(e){t[e(n)]=!0})),t}),{})}Wt(function(t){function e(){return o(this,e),k(this,g(e).apply(this,arguments))}return f(e,t),l(e,[{key:"render",value:function(){var t=this.props,e=t.hotKeys,n=_(t,["hotKeys"]),i=n.component||M.option("defaultComponent");return a.createElement(i,d({},e,n))}}]),e}(a.Component),{},"ignoreEvent"),Wt(function(t){function e(){return o(this,e),k(this,g(e).apply(this,arguments))}return f(e,t),l(e,[{key:"render",value:function(){var t=this.props,e=t.hotKeys,n=_(t,["hotKeys"]),i=n.component||M.option("defaultComponent");return a.createElement(i,d({},e,n))}}]),e}(a.Component),{},"observeIgnoredEvents")},3274:(t,e,n)=>{t.exports=n(8506)},3972:(t,e,n)=>{n.d(e,{Z:()=>v});const i=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i="function"!=typeof e[e.length-1]&&e.pop(),r=e;if(void 0===i)throw new TypeError("The initial state may not be undefined. If you do not want to set a value for this reducer, you can use null instead of undefined.");return function(t,e){for(var n=arguments.length,a=Array(n>2?n-2:0),s=2;s<n;s++)a[s-2]=arguments[s];var o=void 0===t,h=void 0===e;return o&&h&&i?i:r.reduce((function(t,n){return n.apply(void 0,[t,e].concat(a))}),o&&!h&&i?i:t)}};var r=n(1143),a=n.n(r);const s=function(t){if("object"!=typeof t||null===t)return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},o=function(t){return"undefined"!=typeof Map&&t instanceof Map};function h(t){if(o(t))return Array.from(t.keys());if("undefined"!=typeof Reflect&&"function"==typeof Reflect.ownKeys)return Reflect.ownKeys(t);var e=Object.getOwnPropertyNames(t);return"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(t))),e}var l="||";function c(t,e){return o(e)?e.get(t):e[t]}const u=(d=function(t){return(s(t)||o(t))&&(n=(e=h(t)).every((function(t){return"next"===t||"throw"===t})),!(e.length&&e.length<=2&&n));var e,n},function t(e,n,i,r){var a=void 0===n?{}:n,s=a.namespace,o=void 0===s?"/":s,u=a.prefix;return void 0===i&&(i={}),void 0===r&&(r=""),h(e).forEach((function(n){var a=function(t){return r||!u||u&&new RegExp("^"+u+o).test(t)?t:""+u+o+t}(function(t){var e;if(!r)return t;var n=t.toString().split(l),i=r.split(l);return(e=[]).concat.apply(e,i.map((function(t){return n.map((function(e){return""+t+o+e}))}))).join(l)}(n)),s=c(n,e);d(s)?t(s,{namespace:o,prefix:u},i,a):i[a]=s})),i});var d,f=n(8928),g=n(5546);const p=function(t){return t.toString()};function v(t,e,n){void 0===n&&(n={}),a()(s(t)||o(t),"Expected handlers to be a plain object.");var r=u(t,n),d=h(r).map((function(t){return function(t,e,n){void 0===e&&(e=g.Z);var i=p(t).split(l);a()(!(void 0===n),"defaultState for reducer handling "+i.join(", ")+" should be defined"),a()((0,f.Z)(e)||s(e),"Expected reducer to be a function or object with next and throw reducers");var r=(0,f.Z)(e)?[e,e]:[e.next,e.throw].map((function(t){return null==t?g.Z:t})),o=r[0],h=r[1];return function(t,e){void 0===t&&(t=n);var r=e.type;return r&&-1!==i.indexOf(p(r))?(!0===e.error?h:o)(t,e):t}}(t,c(t,r),e)})),v=i.apply(void 0,d.concat([e]));return function(t,n){return void 0===t&&(t=e),v(t,n)}}},5857:(t,e,n)=>{function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t){return"Minified Redux error #"+t+"; visit https://redux.js.org/Errors?code="+t+" for the full message or use the non-minified dev environment for full errors. "}n.d(e,{md:()=>g,UY:()=>d,MT:()=>u});var o="function"==typeof Symbol&&Symbol.observable||"@@observable",h=function(){return Math.random().toString(36).substring(7).split("").join(".")},l={INIT:"@@redux/INIT"+h(),REPLACE:"@@redux/REPLACE"+h(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+h()}};function c(t){if("object"!=typeof t||null===t)return!1;for(var e=t;null!==Object.getPrototypeOf(e);)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function u(t,e,n){var i;if("function"==typeof e&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(s(0));if("function"==typeof e&&void 0===n&&(n=e,e=void 0),void 0!==n){if("function"!=typeof n)throw new Error(s(1));return n(u)(t,e)}if("function"!=typeof t)throw new Error(s(2));var r=t,a=e,h=[],d=h,f=!1;function g(){d===h&&(d=h.slice())}function p(){if(f)throw new Error(s(3));return a}function v(t){if("function"!=typeof t)throw new Error(s(4));if(f)throw new Error(s(5));var e=!0;return g(),d.push(t),function(){if(e){if(f)throw new Error(s(6));e=!1,g();var n=d.indexOf(t);d.splice(n,1),h=null}}}function y(t){if(!c(t))throw new Error(s(7));if(void 0===t.type)throw new Error(s(8));if(f)throw new Error(s(9));try{f=!0,a=r(a,t)}finally{f=!1}for(var e=h=d,n=0;n<e.length;n++)(0,e[n])();return t}function m(t){if("function"!=typeof t)throw new Error(s(10));r=t,y({type:l.REPLACE})}function _(){var t,e=v;return(t={subscribe:function(t){if("object"!=typeof t||null===t)throw new Error(s(11));function n(){t.next&&t.next(p())}return n(),{unsubscribe:e(n)}}})[o]=function(){return this},t}return y({type:l.INIT}),(i={dispatch:y,subscribe:v,getState:p,replaceReducer:m})[o]=_,i}function d(t){for(var e=Object.keys(t),n={},i=0;i<e.length;i++){var r=e[i];"function"==typeof t[r]&&(n[r]=t[r])}var a,o=Object.keys(n);try{!function(t){Object.keys(t).forEach((function(e){var n=t[e];if(void 0===n(void 0,{type:l.INIT}))throw new Error(s(12));if(void 0===n(void 0,{type:l.PROBE_UNKNOWN_ACTION()}))throw new Error(s(13))}))}(n)}catch(t){a=t}return function(t,e){if(void 0===t&&(t={}),a)throw a;for(var i=!1,r={},h=0;h<o.length;h++){var l=o[h],c=n[l],u=t[l],d=c(u,e);if(void 0===d)throw e&&e.type,new Error(s(14));r[l]=d,i=i||d!==u}return(i=i||o.length!==Object.keys(t).length)?r:t}}function f(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return 0===e.length?function(t){return t}:1===e.length?e[0]:e.reduce((function(t,e){return function(){return t(e.apply(void 0,arguments))}}))}function g(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return function(){var n=t.apply(void 0,arguments),i=function(){throw new Error(s(15))},r={getState:n.getState,dispatch:function(){return i.apply(void 0,arguments)}},o=e.map((function(t){return t(r)}));return i=f.apply(void 0,o)(n.dispatch),a(a({},n),{},{dispatch:i})}}}},4247:(t,e,n)=>{function i(t,e,n){if(t&&t.length){const[i,r]=e,a=Math.PI/180*n,s=Math.cos(a),o=Math.sin(a);t.forEach((t=>{const[e,n]=t;t[0]=(e-i)*s-(n-r)*o+i,t[1]=(e-i)*o+(n-r)*s+r}))}}function r(t){const e=t[0],n=t[1];return Math.sqrt(Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2))}function a(t,e){const n=e.hachureAngle+90;let r=e.hachureGap;r<0&&(r=4*e.strokeWidth),r=Math.max(r,.1);const a=[0,0];if(n)for(const e of t)i(e,a,n);const s=function(t,e){const n=[];for(const e of t){const t=[...e];t[0].join(",")!==t[t.length-1].join(",")&&t.push([t[0][0],t[0][1]]),t.length>2&&n.push(t)}const i=[];e=Math.max(e,.1);const r=[];for(const t of n)for(let e=0;e<t.length-1;e++){const n=t[e],i=t[e+1];if(n[1]!==i[1]){const t=Math.min(n[1],i[1]);r.push({ymin:t,ymax:Math.max(n[1],i[1]),x:t===n[1]?n[0]:i[0],islope:(i[0]-n[0])/(i[1]-n[1])})}}if(r.sort(((t,e)=>t.ymin<e.ymin?-1:t.ymin>e.ymin?1:t.x<e.x?-1:t.x>e.x?1:t.ymax===e.ymax?0:(t.ymax-e.ymax)/Math.abs(t.ymax-e.ymax))),!r.length)return i;let a=[],s=r[0].ymin;for(;a.length||r.length;){if(r.length){let t=-1;for(let e=0;e<r.length&&!(r[e].ymin>s);e++)t=e;r.splice(0,t+1).forEach((t=>{a.push({s,edge:t})}))}if(a=a.filter((t=>!(t.edge.ymax<=s))),a.sort(((t,e)=>t.edge.x===e.edge.x?0:(t.edge.x-e.edge.x)/Math.abs(t.edge.x-e.edge.x))),a.length>1)for(let t=0;t<a.length;t+=2){const e=t+1;if(e>=a.length)break;const n=a[t].edge,r=a[e].edge;i.push([[Math.round(n.x),s],[Math.round(r.x),s]])}s+=e,a.forEach((t=>{t.edge.x=t.edge.x+e*t.edge.islope}))}return i}(t,r);if(n){for(const e of t)i(e,a,-n);!function(t,e,n){const r=[];t.forEach((t=>r.push(...t))),i(r,e,n)}(s,a,-n)}return s}n.d(e,{Z:()=>Q});class s{constructor(t){this.helper=t}fillPolygons(t,e){return this._fillPolygons(t,e)}_fillPolygons(t,e){const n=a(t,e);return{type:"fillSketch",ops:this.renderLines(n,e)}}renderLines(t,e){const n=[];for(const i of t)n.push(...this.helper.doubleLineOps(i[0][0],i[0][1],i[1][0],i[1][1],e));return n}}class o extends s{fillPolygons(t,e){let n=e.hachureGap;n<0&&(n=4*e.strokeWidth),n=Math.max(n,.1);const i=a(t,Object.assign({},e,{hachureGap:n})),s=Math.PI/180*e.hachureAngle,o=[],h=.5*n*Math.cos(s),l=.5*n*Math.sin(s);for(const[t,e]of i)r([t,e])&&o.push([[t[0]-h,t[1]+l],[...e]],[[t[0]+h,t[1]-l],[...e]]);return{type:"fillSketch",ops:this.renderLines(o,e)}}}class h extends s{fillPolygons(t,e){const n=this._fillPolygons(t,e),i=Object.assign({},e,{hachureAngle:e.hachureAngle+90}),r=this._fillPolygons(t,i);return n.ops=n.ops.concat(r.ops),n}}class l{constructor(t){this.helper=t}fillPolygons(t,e){const n=a(t,e=Object.assign({},e,{hachureAngle:0}));return this.dotsOnLines(n,e)}dotsOnLines(t,e){const n=[];let i=e.hachureGap;i<0&&(i=4*e.strokeWidth),i=Math.max(i,.1);let a=e.fillWeight;a<0&&(a=e.strokeWidth/2);const s=i/4;for(const o of t){const t=r(o),h=t/i,l=Math.ceil(h)-1,c=t-l*i,u=(o[0][0]+o[1][0])/2-i/4,d=Math.min(o[0][1],o[1][1]);for(let t=0;t<l;t++){const r=d+c+t*i,o=u-s+2*Math.random()*s,h=r-s+2*Math.random()*s,l=this.helper.ellipse(o,h,a,a,e);n.push(...l.ops)}}return{type:"fillSketch",ops:n}}}class c{constructor(t){this.helper=t}fillPolygons(t,e){const n=a(t,e);return{type:"fillSketch",ops:this.dashedLine(n,e)}}dashedLine(t,e){const n=e.dashOffset<0?e.hachureGap<0?4*e.strokeWidth:e.hachureGap:e.dashOffset,i=e.dashGap<0?e.hachureGap<0?4*e.strokeWidth:e.hachureGap:e.dashGap,a=[];return t.forEach((t=>{const s=r(t),o=Math.floor(s/(n+i)),h=(s+i-o*(n+i))/2;let l=t[0],c=t[1];l[0]>c[0]&&(l=t[1],c=t[0]);const u=Math.atan((c[1]-l[1])/(c[0]-l[0]));for(let t=0;t<o;t++){const r=t*(n+i),s=r+n,o=[l[0]+r*Math.cos(u)+h*Math.cos(u),l[1]+r*Math.sin(u)+h*Math.sin(u)],c=[l[0]+s*Math.cos(u)+h*Math.cos(u),l[1]+s*Math.sin(u)+h*Math.sin(u)];a.push(...this.helper.doubleLineOps(o[0],o[1],c[0],c[1],e))}})),a}}class u{constructor(t){this.helper=t}fillPolygons(t,e){const n=e.hachureGap<0?4*e.strokeWidth:e.hachureGap,i=e.zigzagOffset<0?n:e.zigzagOffset,r=a(t,e=Object.assign({},e,{hachureGap:n+i}));return{type:"fillSketch",ops:this.zigzagLines(r,i,e)}}zigzagLines(t,e,n){const i=[];return t.forEach((t=>{const a=r(t),s=Math.round(a/(2*e));let o=t[0],h=t[1];o[0]>h[0]&&(o=t[1],h=t[0]);const l=Math.atan((h[1]-o[1])/(h[0]-o[0]));for(let t=0;t<s;t++){const r=2*t*e,a=2*(t+1)*e,s=Math.sqrt(2*Math.pow(e,2)),h=[o[0]+r*Math.cos(l),o[1]+r*Math.sin(l)],c=[o[0]+a*Math.cos(l),o[1]+a*Math.sin(l)],u=[h[0]+s*Math.cos(l+Math.PI/4),h[1]+s*Math.sin(l+Math.PI/4)];i.push(...this.helper.doubleLineOps(h[0],h[1],u[0],u[1],n),...this.helper.doubleLineOps(u[0],u[1],c[0],c[1],n))}})),i}}const d={};class f{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const g={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function p(t,e){return t.type===e}function v(t){const e=[],n=function(t){const e=new Array;for(;""!==t;)if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([aAcChHlLmMqQsStTvVzZ])/))e[e.length]={type:0,text:RegExp.$1},t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];e[e.length]={type:1,text:`${parseFloat(RegExp.$1)}`},t=t.substr(RegExp.$1.length)}return e[e.length]={type:2,text:""},e}(t);let i="BOD",r=0,a=n[r];for(;!p(a,2);){let s=0;const o=[];if("BOD"===i){if("M"!==a.text&&"m"!==a.text)return v("M0,0"+t);r++,s=g[a.text],i=a.text}else p(a,1)?s=g[i]:(r++,s=g[a.text],i=a.text);if(!(r+s<n.length))throw new Error("Path data ended short");for(let t=r;t<r+s;t++){const e=n[t];if(!p(e,1))throw new Error("Param not a number: "+i+","+e.text);o[o.length]=+e.text}if("number"!=typeof g[i])throw new Error("Bad segment: "+i);{const t={key:i,data:o};e.push(t),r+=s,a=n[r],"M"===i&&(i="L"),"m"===i&&(i="l")}}return e}function y(t){let e=0,n=0,i=0,r=0;const a=[];for(const{key:s,data:o}of t)switch(s){case"M":a.push({key:"M",data:[...o]}),[e,n]=o,[i,r]=o;break;case"m":e+=o[0],n+=o[1],a.push({key:"M",data:[e,n]}),i=e,r=n;break;case"L":a.push({key:"L",data:[...o]}),[e,n]=o;break;case"l":e+=o[0],n+=o[1],a.push({key:"L",data:[e,n]});break;case"C":a.push({key:"C",data:[...o]}),e=o[4],n=o[5];break;case"c":{const t=o.map(((t,i)=>i%2?t+n:t+e));a.push({key:"C",data:t}),e=t[4],n=t[5];break}case"Q":a.push({key:"Q",data:[...o]}),e=o[2],n=o[3];break;case"q":{const t=o.map(((t,i)=>i%2?t+n:t+e));a.push({key:"Q",data:t}),e=t[2],n=t[3];break}case"A":a.push({key:"A",data:[...o]}),e=o[5],n=o[6];break;case"a":e+=o[5],n+=o[6],a.push({key:"A",data:[o[0],o[1],o[2],o[3],o[4],e,n]});break;case"H":a.push({key:"H",data:[...o]}),e=o[0];break;case"h":e+=o[0],a.push({key:"H",data:[e]});break;case"V":a.push({key:"V",data:[...o]}),n=o[0];break;case"v":n+=o[0],a.push({key:"V",data:[n]});break;case"S":a.push({key:"S",data:[...o]}),e=o[2],n=o[3];break;case"s":{const t=o.map(((t,i)=>i%2?t+n:t+e));a.push({key:"S",data:t}),e=t[2],n=t[3];break}case"T":a.push({key:"T",data:[...o]}),e=o[0],n=o[1];break;case"t":e+=o[0],n+=o[1],a.push({key:"T",data:[e,n]});break;case"Z":case"z":a.push({key:"Z",data:[]}),e=i,n=r}return a}function m(t){const e=[];let n="",i=0,r=0,a=0,s=0,o=0,h=0;for(const{key:l,data:c}of t){switch(l){case"M":e.push({key:"M",data:[...c]}),[i,r]=c,[a,s]=c;break;case"C":e.push({key:"C",data:[...c]}),i=c[4],r=c[5],o=c[2],h=c[3];break;case"L":e.push({key:"L",data:[...c]}),[i,r]=c;break;case"H":i=c[0],e.push({key:"L",data:[i,r]});break;case"V":r=c[0],e.push({key:"L",data:[i,r]});break;case"S":{let t=0,a=0;"C"===n||"S"===n?(t=i+(i-o),a=r+(r-h)):(t=i,a=r),e.push({key:"C",data:[t,a,...c]}),o=c[0],h=c[1],i=c[2],r=c[3];break}case"T":{const[t,a]=c;let s=0,l=0;"Q"===n||"T"===n?(s=i+(i-o),l=r+(r-h)):(s=i,l=r);const u=i+2*(s-i)/3,d=r+2*(l-r)/3,f=t+2*(s-t)/3,g=a+2*(l-a)/3;e.push({key:"C",data:[u,d,f,g,t,a]}),o=s,h=l,i=t,r=a;break}case"Q":{const[t,n,a,s]=c,l=i+2*(t-i)/3,u=r+2*(n-r)/3,d=a+2*(t-a)/3,f=s+2*(n-s)/3;e.push({key:"C",data:[l,u,d,f,a,s]}),o=t,h=n,i=a,r=s;break}case"A":{const t=Math.abs(c[0]),n=Math.abs(c[1]),a=c[2],s=c[3],o=c[4],h=c[5],l=c[6];0===t||0===n?(e.push({key:"C",data:[i,r,h,l,h,l]}),i=h,r=l):i===h&&r===l||(b(i,r,h,l,t,n,a,s,o).forEach((function(t){e.push({key:"C",data:t})})),i=h,r=l);break}case"Z":e.push({key:"Z",data:[]}),i=a,r=s}n=l}return e}function _(t,e,n){return[t*Math.cos(n)-e*Math.sin(n),t*Math.sin(n)+e*Math.cos(n)]}function b(t,e,n,i,r,a,s,o,h,l){const c=(u=s,Math.PI*u/180);var u;let d=[],f=0,g=0,p=0,v=0;if(l)[f,g,p,v]=l;else{[t,e]=_(t,e,-c),[n,i]=_(n,i,-c);const s=(t-n)/2,l=(e-i)/2;let u=s*s/(r*r)+l*l/(a*a);u>1&&(u=Math.sqrt(u),r*=u,a*=u);const d=r*r,y=a*a,m=d*y-d*l*l-y*s*s,b=d*l*l+y*s*s,k=(o===h?-1:1)*Math.sqrt(Math.abs(m/b));p=k*r*l/a+(t+n)/2,v=k*-a*s/r+(e+i)/2,f=Math.asin(parseFloat(((e-v)/a).toFixed(9))),g=Math.asin(parseFloat(((i-v)/a).toFixed(9))),t<p&&(f=Math.PI-f),n<p&&(g=Math.PI-g),f<0&&(f=2*Math.PI+f),g<0&&(g=2*Math.PI+g),h&&f>g&&(f-=2*Math.PI),!h&&g>f&&(g-=2*Math.PI)}let y=g-f;if(Math.abs(y)>120*Math.PI/180){const t=g,e=n,o=i;g=h&&g>f?f+120*Math.PI/180*1:f+120*Math.PI/180*-1,d=b(n=p+r*Math.cos(g),i=v+a*Math.sin(g),e,o,r,a,s,0,h,[g,t,p,v])}y=g-f;const m=Math.cos(f),k=Math.sin(f),S=Math.cos(g),x=Math.sin(g),w=Math.tan(y/4),C=4/3*r*w,P=4/3*a*w,M=[t,e],E=[t+C*k,e-P*m],T=[n+C*x,i-P*S],A=[n,i];if(E[0]=2*M[0]-E[0],E[1]=2*M[1]-E[1],l)return[E,T,A].concat(d);{d=[E,T,A].concat(d);const t=[];for(let e=0;e<d.length;e+=3){const n=_(d[e][0],d[e][1],c),i=_(d[e+1][0],d[e+1][1],c),r=_(d[e+2][0],d[e+2][1],c);t.push([n[0],n[1],i[0],i[1],r[0],r[1]])}return t}}const k={randOffset:function(t,e){return O(t,e)},randOffsetWithRange:function(t,e,n){return A(t,e,n)},ellipse:function(t,e,n,i,r){return C(t,e,r,w(n,i,r)).opset},doubleLineOps:function(t,e,n,i,r){return I(t,e,n,i,r,!0)}};function S(t,e,n,i,r){return{type:"path",ops:I(t,e,n,i,r)}}function x(t,e,n){const i=(t||[]).length;if(i>2){const r=[];for(let e=0;e<i-1;e++)r.push(...I(t[e][0],t[e][1],t[e+1][0],t[e+1][1],n));return e&&r.push(...I(t[i-1][0],t[i-1][1],t[0][0],t[0][1],n)),{type:"path",ops:r}}return 2===i?S(t[0][0],t[0][1],t[1][0],t[1][1],n):{type:"path",ops:[]}}function w(t,e,n){const i=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(t/2,2)+Math.pow(e/2,2))/2)),r=Math.ceil(Math.max(n.curveStepCount,n.curveStepCount/Math.sqrt(200)*i)),a=2*Math.PI/r;let s=Math.abs(t/2),o=Math.abs(e/2);const h=1-n.curveFitting;return s+=O(s*h,n),o+=O(o*h,n),{increment:a,rx:s,ry:o}}function C(t,e,n,i){const[r,a]=G(i.increment,t,e,i.rx,i.ry,1,i.increment*A(.1,A(.4,1,n),n),n);let s=R(r,null,n);if(!n.disableMultiStroke&&0!==n.roughness){const[r]=G(i.increment,t,e,i.rx,i.ry,1.5,0,n),a=R(r,null,n);s=s.concat(a)}return{estimatedPoints:a,opset:{type:"path",ops:s}}}function P(t,e,n,i,r,a,s,o,h){const l=t,c=e;let u=Math.abs(n/2),d=Math.abs(i/2);u+=O(.01*u,h),d+=O(.01*d,h);let f=r,g=a;for(;f<0;)f+=2*Math.PI,g+=2*Math.PI;g-f>2*Math.PI&&(f=0,g=2*Math.PI);const p=2*Math.PI/h.curveStepCount,v=Math.min(p/2,(g-f)/2),y=K(v,l,c,u,d,f,g,1,h);if(!h.disableMultiStroke){const t=K(v,l,c,u,d,f,g,1.5,h);y.push(...t)}return s&&(o?y.push(...I(l,c,l+u*Math.cos(f),c+d*Math.sin(f),h),...I(l,c,l+u*Math.cos(g),c+d*Math.sin(g),h)):y.push({op:"lineTo",data:[l,c]},{op:"lineTo",data:[l+u*Math.cos(f),c+d*Math.sin(f)]})),{type:"path",ops:y}}function M(t,e){const n=[];for(const i of t)if(i.length){const t=e.maxRandomnessOffset||0,r=i.length;if(r>2){n.push({op:"move",data:[i[0][0]+O(t,e),i[0][1]+O(t,e)]});for(let a=1;a<r;a++)n.push({op:"lineTo",data:[i[a][0]+O(t,e),i[a][1]+O(t,e)]})}}return{type:"fillPath",ops:n}}function E(t,e){return function(t,e){let n=t.fillStyle||"hachure";if(!d[n])switch(n){case"zigzag":d[n]||(d[n]=new o(e));break;case"cross-hatch":d[n]||(d[n]=new h(e));break;case"dots":d[n]||(d[n]=new l(e));break;case"dashed":d[n]||(d[n]=new c(e));break;case"zigzag-line":d[n]||(d[n]=new u(e));break;default:n="hachure",d[n]||(d[n]=new s(e))}return d[n]}(e,k).fillPolygons(t,e)}function T(t){return t.randomizer||(t.randomizer=new f(t.seed||0)),t.randomizer.next()}function A(t,e,n,i=1){return n.roughness*i*(T(n)*(e-t)+t)}function O(t,e,n=1){return A(-t,t,e,n)}function I(t,e,n,i,r,a=!1){const s=a?r.disableMultiStrokeFill:r.disableMultiStroke,o=D(t,e,n,i,r,!0,!1);if(s)return o;const h=D(t,e,n,i,r,!0,!0);return o.concat(h)}function D(t,e,n,i,r,a,s){const o=Math.pow(t-n,2)+Math.pow(e-i,2),h=Math.sqrt(o);let l=1;l=h<200?1:h>500?.4:-.0016668*h+1.233334;let c=r.maxRandomnessOffset||0;c*c*100>o&&(c=h/10);const u=c/2,d=.2+.2*T(r);let f=r.bowing*r.maxRandomnessOffset*(i-e)/200,g=r.bowing*r.maxRandomnessOffset*(t-n)/200;f=O(f,r,l),g=O(g,r,l);const p=[],v=()=>O(u,r,l),y=()=>O(c,r,l),m=r.preserveVertices;return a&&(s?p.push({op:"move",data:[t+(m?0:v()),e+(m?0:v())]}):p.push({op:"move",data:[t+(m?0:O(c,r,l)),e+(m?0:O(c,r,l))]})),s?p.push({op:"bcurveTo",data:[f+t+(n-t)*d+v(),g+e+(i-e)*d+v(),f+t+2*(n-t)*d+v(),g+e+2*(i-e)*d+v(),n+(m?0:v()),i+(m?0:v())]}):p.push({op:"bcurveTo",data:[f+t+(n-t)*d+y(),g+e+(i-e)*d+y(),f+t+2*(n-t)*d+y(),g+e+2*(i-e)*d+y(),n+(m?0:y()),i+(m?0:y())]}),p}function L(t,e,n){const i=[];i.push([t[0][0]+O(e,n),t[0][1]+O(e,n)]),i.push([t[0][0]+O(e,n),t[0][1]+O(e,n)]);for(let r=1;r<t.length;r++)i.push([t[r][0]+O(e,n),t[r][1]+O(e,n)]),r===t.length-1&&i.push([t[r][0]+O(e,n),t[r][1]+O(e,n)]);return R(i,null,n)}function R(t,e,n){const i=t.length,r=[];if(i>3){const a=[],s=1-n.curveTightness;r.push({op:"move",data:[t[1][0],t[1][1]]});for(let e=1;e+2<i;e++){const n=t[e];a[0]=[n[0],n[1]],a[1]=[n[0]+(s*t[e+1][0]-s*t[e-1][0])/6,n[1]+(s*t[e+1][1]-s*t[e-1][1])/6],a[2]=[t[e+1][0]+(s*t[e][0]-s*t[e+2][0])/6,t[e+1][1]+(s*t[e][1]-s*t[e+2][1])/6],a[3]=[t[e+1][0],t[e+1][1]],r.push({op:"bcurveTo",data:[a[1][0],a[1][1],a[2][0],a[2][1],a[3][0],a[3][1]]})}if(e&&2===e.length){const t=n.maxRandomnessOffset;r.push({op:"lineTo",data:[e[0]+O(t,n),e[1]+O(t,n)]})}}else 3===i?(r.push({op:"move",data:[t[1][0],t[1][1]]}),r.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):2===i&&r.push(...I(t[0][0],t[0][1],t[1][0],t[1][1],n));return r}function G(t,e,n,i,r,a,s,o){const h=[],l=[];if(0===o.roughness){t/=4,l.push([e+i*Math.cos(-t),n+r*Math.sin(-t)]);for(let a=0;a<=2*Math.PI;a+=t){const t=[e+i*Math.cos(a),n+r*Math.sin(a)];h.push(t),l.push(t)}l.push([e+i*Math.cos(0),n+r*Math.sin(0)]),l.push([e+i*Math.cos(t),n+r*Math.sin(t)])}else{const c=O(.5,o)-Math.PI/2;l.push([O(a,o)+e+.9*i*Math.cos(c-t),O(a,o)+n+.9*r*Math.sin(c-t)]);const u=2*Math.PI+c-.01;for(let s=c;s<u;s+=t){const t=[O(a,o)+e+i*Math.cos(s),O(a,o)+n+r*Math.sin(s)];h.push(t),l.push(t)}l.push([O(a,o)+e+i*Math.cos(c+2*Math.PI+.5*s),O(a,o)+n+r*Math.sin(c+2*Math.PI+.5*s)]),l.push([O(a,o)+e+.98*i*Math.cos(c+s),O(a,o)+n+.98*r*Math.sin(c+s)]),l.push([O(a,o)+e+.9*i*Math.cos(c+.5*s),O(a,o)+n+.9*r*Math.sin(c+.5*s)])}return[l,h]}function K(t,e,n,i,r,a,s,o,h){const l=a+O(.1,h),c=[];c.push([O(o,h)+e+.9*i*Math.cos(l-t),O(o,h)+n+.9*r*Math.sin(l-t)]);for(let a=l;a<=s;a+=t)c.push([O(o,h)+e+i*Math.cos(a),O(o,h)+n+r*Math.sin(a)]);return c.push([e+i*Math.cos(s),n+r*Math.sin(s)]),c.push([e+i*Math.cos(s),n+r*Math.sin(s)]),R(c,null,h)}function F(t,e,n,i,r,a,s,o){const h=[],l=[o.maxRandomnessOffset||1,(o.maxRandomnessOffset||1)+.3];let c=[0,0];const u=o.disableMultiStroke?1:2,d=o.preserveVertices;for(let f=0;f<u;f++)0===f?h.push({op:"move",data:[s[0],s[1]]}):h.push({op:"move",data:[s[0]+(d?0:O(l[0],o)),s[1]+(d?0:O(l[0],o))]}),c=d?[r,a]:[r+O(l[f],o),a+O(l[f],o)],h.push({op:"bcurveTo",data:[t+O(l[f],o),e+O(l[f],o),n+O(l[f],o),i+O(l[f],o),c[0],c[1]]});return h}function H(t){return[...t]}function N(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function j(t,e,n){const i=N(e,n);if(0===i)return N(t,e);let r=((t[0]-e[0])*(n[0]-e[0])+(t[1]-e[1])*(n[1]-e[1]))/i;return r=Math.max(0,Math.min(1,r)),N(t,B(e,n,r))}function B(t,e,n){return[t[0]+(e[0]-t[0])*n,t[1]+(e[1]-t[1])*n]}function z(t,e,n,i){const r=i||[];if(function(t,e){const n=t[e+0],i=t[e+1],r=t[e+2],a=t[e+3];let s=3*i[0]-2*n[0]-a[0];s*=s;let o=3*i[1]-2*n[1]-a[1];o*=o;let h=3*r[0]-2*a[0]-n[0];h*=h;let l=3*r[1]-2*a[1]-n[1];return l*=l,s<h&&(s=h),o<l&&(o=l),s+o}(t,e)<n){const n=t[e+0];r.length?(a=r[r.length-1],s=n,Math.sqrt(N(a,s))>1&&r.push(n)):r.push(n),r.push(t[e+3])}else{const i=.5,a=t[e+0],s=t[e+1],o=t[e+2],h=t[e+3],l=B(a,s,i),c=B(s,o,i),u=B(o,h,i),d=B(l,c,i),f=B(c,u,i),g=B(d,f,i);z([a,l,d,g],0,n,r),z([g,f,u,h],0,n,r)}var a,s;return r}function W(t,e){return q(t,0,t.length,e)}function q(t,e,n,i,r){const a=r||[],s=t[e],o=t[n-1];let h=0,l=1;for(let i=e+1;i<n-1;++i){const e=j(t[i],s,o);e>h&&(h=e,l=i)}return Math.sqrt(h)>i?(q(t,e,l+1,i,a),q(t,l,n,i,a)):(a.length||a.push(s),a.push(o)),a}function U(t,e=.15,n){const i=[],r=(t.length-1)/3;for(let n=0;n<r;n++)z(t,3*n,e,i);return n&&n>0?q(i,0,i.length,n):i}const Y="none";class X{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,e,n){return{shape:t,sets:e||[],options:n||this.defaultOptions}}line(t,e,n,i,r){const a=this._o(r);return this._d("line",[S(t,e,n,i,a)],a)}rectangle(t,e,n,i,r){const a=this._o(r),s=[],o=function(t,e,n,i,r){return function(t,e){return x(t,!0,e)}([[t,e],[t+n,e],[t+n,e+i],[t,e+i]],r)}(t,e,n,i,a);if(a.fill){const r=[[t,e],[t+n,e],[t+n,e+i],[t,e+i]];"solid"===a.fillStyle?s.push(M([r],a)):s.push(E([r],a))}return a.stroke!==Y&&s.push(o),this._d("rectangle",s,a)}ellipse(t,e,n,i,r){const a=this._o(r),s=[],o=w(n,i,a),h=C(t,e,a,o);if(a.fill)if("solid"===a.fillStyle){const n=C(t,e,a,o).opset;n.type="fillPath",s.push(n)}else s.push(E([h.estimatedPoints],a));return a.stroke!==Y&&s.push(h.opset),this._d("ellipse",s,a)}circle(t,e,n,i){const r=this.ellipse(t,e,n,n,i);return r.shape="circle",r}linearPath(t,e){const n=this._o(e);return this._d("linearPath",[x(t,!1,n)],n)}arc(t,e,n,i,r,a,s=!1,o){const h=this._o(o),l=[],c=P(t,e,n,i,r,a,s,!0,h);if(s&&h.fill)if("solid"===h.fillStyle){const s=Object.assign({},h);s.disableMultiStroke=!0;const o=P(t,e,n,i,r,a,!0,!1,s);o.type="fillPath",l.push(o)}else l.push(function(t,e,n,i,r,a,s){const o=t,h=e;let l=Math.abs(n/2),c=Math.abs(i/2);l+=O(.01*l,s),c+=O(.01*c,s);let u=r,d=a;for(;u<0;)u+=2*Math.PI,d+=2*Math.PI;d-u>2*Math.PI&&(u=0,d=2*Math.PI);const f=(d-u)/s.curveStepCount,g=[];for(let t=u;t<=d;t+=f)g.push([o+l*Math.cos(t),h+c*Math.sin(t)]);return g.push([o+l*Math.cos(d),h+c*Math.sin(d)]),g.push([o,h]),E([g],s)}(t,e,n,i,r,a,h));return h.stroke!==Y&&l.push(c),this._d("arc",l,h)}curve(t,e){const n=this._o(e),i=[],r=function(t,e){let n=L(t,1*(1+.2*e.roughness),e);if(!e.disableMultiStroke){const i=L(t,1.5*(1+.22*e.roughness),function(t){const e=Object.assign({},t);return e.randomizer=void 0,t.seed&&(e.seed=t.seed+1),e}(e));n=n.concat(i)}return{type:"path",ops:n}}(t,n);if(n.fill&&n.fill!==Y&&t.length>=3){const e=U(function(t,e=0){const n=t.length;if(n<3)throw new Error("A curve must have at least three points.");const i=[];if(3===n)i.push(H(t[0]),H(t[1]),H(t[2]),H(t[2]));else{const n=[];n.push(t[0],t[0]);for(let e=1;e<t.length;e++)n.push(t[e]),e===t.length-1&&n.push(t[e]);const r=[],a=1-e;i.push(H(n[0]));for(let t=1;t+2<n.length;t++){const e=n[t];r[0]=[e[0],e[1]],r[1]=[e[0]+(a*n[t+1][0]-a*n[t-1][0])/6,e[1]+(a*n[t+1][1]-a*n[t-1][1])/6],r[2]=[n[t+1][0]+(a*n[t][0]-a*n[t+2][0])/6,n[t+1][1]+(a*n[t][1]-a*n[t+2][1])/6],r[3]=[n[t+1][0],n[t+1][1]],i.push(r[1],r[2],r[3])}}return i}(t),10,(1+n.roughness)/2);"solid"===n.fillStyle?i.push(M([e],n)):i.push(E([e],n))}return n.stroke!==Y&&i.push(r),this._d("curve",i,n)}polygon(t,e){const n=this._o(e),i=[],r=x(t,!0,n);return n.fill&&("solid"===n.fillStyle?i.push(M([t],n)):i.push(E([t],n))),n.stroke!==Y&&i.push(r),this._d("polygon",i,n)}path(t,e){const n=this._o(e),i=[];if(!t)return this._d("path",i,n);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const r=n.fill&&"transparent"!==n.fill&&n.fill!==Y,a=n.stroke!==Y,s=!!(n.simplification&&n.simplification<1),o=function(t,e,n){const i=m(y(v(t))),r=[];let a=[],s=[0,0],o=[];const h=()=>{o.length>=4&&a.push(...U(o,1)),o=[]},l=()=>{h(),a.length&&(r.push(a),a=[])};for(const{key:t,data:e}of i)switch(t){case"M":l(),s=[e[0],e[1]],a.push(s);break;case"L":h(),a.push([e[0],e[1]]);break;case"C":if(!o.length){const t=a.length?a[a.length-1]:s;o.push([t[0],t[1]])}o.push([e[0],e[1]]),o.push([e[2],e[3]]),o.push([e[4],e[5]]);break;case"Z":h(),a.push([s[0],s[1]])}if(l(),!n)return r;const c=[];for(const t of r){const e=W(t,n);e.length&&c.push(e)}return c}(t,0,s?4-4*n.simplification:(1+n.roughness)/2);return r&&("solid"===n.fillStyle?i.push(M(o,n)):i.push(E(o,n))),a&&(s?o.forEach((t=>{i.push(x(t,!1,n))})):i.push(function(t,e){const n=m(y(v(t))),i=[];let r=[0,0],a=[0,0];for(const{key:t,data:s}of n)switch(t){case"M":{const t=1*(e.maxRandomnessOffset||0),n=e.preserveVertices;i.push({op:"move",data:s.map((i=>i+(n?0:O(t,e))))}),a=[s[0],s[1]],r=[s[0],s[1]];break}case"L":i.push(...I(a[0],a[1],s[0],s[1],e)),a=[s[0],s[1]];break;case"C":{const[t,n,r,o,h,l]=s;i.push(...F(t,n,r,o,h,l,a,e)),a=[h,l];break}case"Z":i.push(...I(a[0],a[1],r[0],r[1],e)),a=[r[0],r[1]]}return{type:"path",ops:i}}(t,n))),this._d("path",i,n)}opsToPath(t,e){let n="";for(const i of t.ops){const t="number"==typeof e&&e>=0?i.data.map((t=>+t.toFixed(e))):i.data;switch(i.op){case"move":n+=`M${t[0]} ${t[1]} `;break;case"bcurveTo":n+=`C${t[0]} ${t[1]}, ${t[2]} ${t[3]}, ${t[4]} ${t[5]} `;break;case"lineTo":n+=`L${t[0]} ${t[1]} `}}return n.trim()}toPaths(t){const e=t.sets||[],n=t.options||this.defaultOptions,i=[];for(const t of e){let e=null;switch(t.type){case"path":e={d:this.opsToPath(t),stroke:n.stroke,strokeWidth:n.strokeWidth,fill:Y};break;case"fillPath":e={d:this.opsToPath(t),stroke:Y,strokeWidth:0,fill:n.fill||Y};break;case"fillSketch":e=this.fillSketch(t,n)}e&&i.push(e)}return i}fillSketch(t,e){let n=e.fillWeight;return n<0&&(n=e.strokeWidth/2),{d:this.opsToPath(t),stroke:e.fill||Y,strokeWidth:n,fill:Y}}}class V{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new X(e)}draw(t){const e=t.sets||[],n=t.options||this.getDefaultOptions(),i=this.ctx,r=t.options.fixedDecimalPlaceDigits;for(const a of e)switch(a.type){case"path":i.save(),i.strokeStyle="none"===n.stroke?"transparent":n.stroke,i.lineWidth=n.strokeWidth,n.strokeLineDash&&i.setLineDash(n.strokeLineDash),n.strokeLineDashOffset&&(i.lineDashOffset=n.strokeLineDashOffset),this._drawToContext(i,a,r),i.restore();break;case"fillPath":{i.save(),i.fillStyle=n.fill||"";const e="curve"===t.shape||"polygon"===t.shape||"path"===t.shape?"evenodd":"nonzero";this._drawToContext(i,a,r,e),i.restore();break}case"fillSketch":this.fillSketch(i,a,n)}}fillSketch(t,e,n){let i=n.fillWeight;i<0&&(i=n.strokeWidth/2),t.save(),n.fillLineDash&&t.setLineDash(n.fillLineDash),n.fillLineDashOffset&&(t.lineDashOffset=n.fillLineDashOffset),t.strokeStyle=n.fill||"",t.lineWidth=i,this._drawToContext(t,e,n.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,e,n,i="nonzero"){t.beginPath();for(const i of e.ops){const e="number"==typeof n&&n>=0?i.data.map((t=>+t.toFixed(n))):i.data;switch(i.op){case"move":t.moveTo(e[0],e[1]);break;case"bcurveTo":t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"lineTo":t.lineTo(e[0],e[1])}}"fillPath"===e.type?t.fill(i):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,e,n,i,r){const a=this.gen.line(t,e,n,i,r);return this.draw(a),a}rectangle(t,e,n,i,r){const a=this.gen.rectangle(t,e,n,i,r);return this.draw(a),a}ellipse(t,e,n,i,r){const a=this.gen.ellipse(t,e,n,i,r);return this.draw(a),a}circle(t,e,n,i){const r=this.gen.circle(t,e,n,i);return this.draw(r),r}linearPath(t,e){const n=this.gen.linearPath(t,e);return this.draw(n),n}polygon(t,e){const n=this.gen.polygon(t,e);return this.draw(n),n}arc(t,e,n,i,r,a,s=!1,o){const h=this.gen.arc(t,e,n,i,r,a,s,o);return this.draw(h),h}curve(t,e){const n=this.gen.curve(t,e);return this.draw(n),n}path(t,e){const n=this.gen.path(t,e);return this.draw(n),n}}const $="http://www.w3.org/2000/svg";class Z{constructor(t,e){this.svg=t,this.gen=new X(e)}draw(t){const e=t.sets||[],n=t.options||this.getDefaultOptions(),i=this.svg.ownerDocument||window.document,r=i.createElementNS($,"g"),a=t.options.fixedDecimalPlaceDigits;for(const s of e){let e=null;switch(s.type){case"path":e=i.createElementNS($,"path"),e.setAttribute("d",this.opsToPath(s,a)),e.setAttribute("stroke",n.stroke),e.setAttribute("stroke-width",n.strokeWidth+""),e.setAttribute("fill","none"),n.strokeLineDash&&e.setAttribute("stroke-dasharray",n.strokeLineDash.join(" ").trim()),n.strokeLineDashOffset&&e.setAttribute("stroke-dashoffset",`${n.strokeLineDashOffset}`);break;case"fillPath":e=i.createElementNS($,"path"),e.setAttribute("d",this.opsToPath(s,a)),e.setAttribute("stroke","none"),e.setAttribute("stroke-width","0"),e.setAttribute("fill",n.fill||""),"curve"!==t.shape&&"polygon"!==t.shape||e.setAttribute("fill-rule","evenodd");break;case"fillSketch":e=this.fillSketch(i,s,n)}e&&r.appendChild(e)}return r}fillSketch(t,e,n){let i=n.fillWeight;i<0&&(i=n.strokeWidth/2);const r=t.createElementNS($,"path");return r.setAttribute("d",this.opsToPath(e,n.fixedDecimalPlaceDigits)),r.setAttribute("stroke",n.fill||""),r.setAttribute("stroke-width",i+""),r.setAttribute("fill","none"),n.fillLineDash&&r.setAttribute("stroke-dasharray",n.fillLineDash.join(" ").trim()),n.fillLineDashOffset&&r.setAttribute("stroke-dashoffset",`${n.fillLineDashOffset}`),r}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,e){return this.gen.opsToPath(t,e)}line(t,e,n,i,r){const a=this.gen.line(t,e,n,i,r);return this.draw(a)}rectangle(t,e,n,i,r){const a=this.gen.rectangle(t,e,n,i,r);return this.draw(a)}ellipse(t,e,n,i,r){const a=this.gen.ellipse(t,e,n,i,r);return this.draw(a)}circle(t,e,n,i){const r=this.gen.circle(t,e,n,i);return this.draw(r)}linearPath(t,e){const n=this.gen.linearPath(t,e);return this.draw(n)}polygon(t,e){const n=this.gen.polygon(t,e);return this.draw(n)}arc(t,e,n,i,r,a,s=!1,o){const h=this.gen.arc(t,e,n,i,r,a,s,o);return this.draw(h)}curve(t,e){const n=this.gen.curve(t,e);return this.draw(n)}path(t,e){const n=this.gen.path(t,e);return this.draw(n)}}var Q={canvas:(t,e)=>new V(t,e),svg:(t,e)=>new Z(t,e),generator:t=>new X(t),newSeed:()=>X.newSeed()}},4920:(t,e,n)=>{n.d(e,{Z:()=>an});var i=Math.PI/180;const r="undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},a={_global:r,version:"8.3.1",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle:t=>a.angleDeg?t*i:t,enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:()=>a.DD.isDragging,isDragReady:()=>!!a.DD.node,document:r.document,_injectGlobal(t){r.Konva=t}},s=t=>{a[t.prototype.getClassName()]=t};a._injectGlobal(a);class o{constructor(t=[1,0,0,1,0,0]){this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new o(this.m)}copyInto(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]}point(t){var e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}translate(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this}scale(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this}rotate(t){var e=Math.cos(t),n=Math.sin(t),i=this.m[0]*e+this.m[2]*n,r=this.m[1]*e+this.m[3]*n,a=this.m[0]*-n+this.m[2]*e,s=this.m[1]*-n+this.m[3]*e;return this.m[0]=i,this.m[1]=r,this.m[2]=a,this.m[3]=s,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(t,e){var n=this.m[0]+this.m[2]*e,i=this.m[1]+this.m[3]*e,r=this.m[2]+this.m[0]*t,a=this.m[3]+this.m[1]*t;return this.m[0]=n,this.m[1]=i,this.m[2]=r,this.m[3]=a,this}multiply(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],n=this.m[1]*t.m[0]+this.m[3]*t.m[1],i=this.m[0]*t.m[2]+this.m[2]*t.m[3],r=this.m[1]*t.m[2]+this.m[3]*t.m[3],a=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=n,this.m[2]=i,this.m[3]=r,this.m[4]=a,this.m[5]=s,this}invert(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,n=-this.m[1]*t,i=-this.m[2]*t,r=this.m[0]*t,a=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=n,this.m[2]=i,this.m[3]=r,this.m[4]=a,this.m[5]=s,this}getMatrix(){return this.m}setAbsolutePosition(t,e){var n=this.m[0],i=this.m[1],r=this.m[2],a=this.m[3],s=this.m[4],o=(n*(e-this.m[5])-i*(t-s))/(n*a-i*r),h=(t-s-r*o)/n;return this.translate(h,o)}decompose(){var t=this.m[0],e=this.m[1],n=this.m[2],i=this.m[3],r=t*i-e*n;let a={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=t||0!=e){var s=Math.sqrt(t*t+e*e);a.rotation=e>0?Math.acos(t/s):-Math.acos(t/s),a.scaleX=s,a.scaleY=r/s,a.skewX=(t*n+e*i)/r,a.skewY=0}else if(0!=n||0!=i){var o=Math.sqrt(n*n+i*i);a.rotation=Math.PI/2-(i>0?Math.acos(-n/o):-Math.acos(n/o)),a.scaleX=r/o,a.scaleY=o,a.skewX=0,a.skewY=(t*n+e*i)/r}return a.rotation=p._getRotation(a.rotation),a}}var h=Math.PI/180,l=180/Math.PI,c="Konva error: ",u={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},d=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,f=[];const g="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||function(t){setTimeout(t,60)},p={_isElement:t=>!(!t||1!=t.nodeType),_isFunction:t=>!!(t&&t.constructor&&t.call&&t.apply),_isPlainObject:t=>!!t&&t.constructor===Object,_isArray:t=>"[object Array]"===Object.prototype.toString.call(t),_isNumber:t=>"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)&&isFinite(t),_isString:t=>"[object String]"===Object.prototype.toString.call(t),_isBoolean:t=>"[object Boolean]"===Object.prototype.toString.call(t),isObject:t=>t instanceof Object,isValidSelector(t){if("string"!=typeof t)return!1;var e=t[0];return"#"===e||"."===e||e===e.toUpperCase()},_sign:t=>0===t||t>0?1:-1,requestAnimFrame(t){f.push(t),1===f.length&&g((function(){const t=f;f=[],t.forEach((function(t){t()}))}))},createCanvasElement(){var t=document.createElement("canvas");try{t.style=t.style||{}}catch(t){}return t},createImageElement:()=>document.createElement("img"),_isInDocument(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_urlToImage(t,e){var n=p.createImageElement();n.onload=function(){e(n)},n.src=t},_rgbToHex:(t,e,n)=>((1<<24)+(t<<16)+(e<<8)+n).toString(16).slice(1),_hexToRgb(t){t=t.replace("#","");var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor(){for(var t=(16777215*Math.random()<<0).toString(16);t.length<6;)t="0"+t;return"#"+t},getRGB(t){var e;return t in u?{r:(e=u[t])[0],g:e[1],b:e[2]}:"#"===t[0]?this._hexToRgb(t.substring(1)):"rgb("===t.substr(0,4)?(e=d.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:t=>(t=t||"black",p._namedColorToRBA(t)||p._hex3ColorToRGBA(t)||p._hex6ColorToRGBA(t)||p._rgbColorToRGBA(t)||p._rgbaColorToRGBA(t)||p._hslColorToRGBA(t)),_namedColorToRBA(t){var e=u[t.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(t){if(0===t.indexOf("rgb(")){var e=(t=t.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(t){if(0===t.indexOf("rgba(")){var e=(t=t.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex6ColorToRGBA(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex3ColorToRGBA(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){const[e,...n]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),i=Number(n[0])/360,r=Number(n[1])/100,a=Number(n[2])/100;let s,o,h;if(0===r)return h=255*a,{r:Math.round(h),g:Math.round(h),b:Math.round(h),a:1};s=a<.5?a*(1+r):a+r-a*r;const l=2*a-s,c=[0,0,0];for(let t=0;t<3;t++)o=i+1/3*-(t-1),o<0&&o++,o>1&&o--,h=6*o<1?l+6*(s-l)*o:2*o<1?s:3*o<2?l+(s-l)*(2/3-o)*6:l,c[t]=255*h;return{r:Math.round(c[0]),g:Math.round(c[1]),b:Math.round(c[2]),a:1}}},haveIntersection:(t,e)=>!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y),cloneObject(t){var e={};for(var n in t)this._isPlainObject(t[n])?e[n]=this.cloneObject(t[n]):this._isArray(t[n])?e[n]=this.cloneArray(t[n]):e[n]=t[n];return e},cloneArray:t=>t.slice(0),degToRad:t=>t*h,radToDeg:t=>t*l,_degToRad:t=>(p.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),p.degToRad(t)),_radToDeg:t=>(p.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),p.radToDeg(t)),_getRotation:t=>a.angleDeg?p.radToDeg(t):t,_capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),throw(t){throw new Error(c+t)},error(t){console.error(c+t)},warn(t){a.showWarnings&&console.warn("Konva warning: "+t)},each(t,e){for(var n in t)e(n,t[n])},_inRange:(t,e,n)=>e<=t&&t<n,_getProjectionToSegment(t,e,n,i,r,a){var s,o,h,l=(t-n)*(t-n)+(e-i)*(e-i);if(0==l)s=t,o=e,h=(r-n)*(r-n)+(a-i)*(a-i);else{var c=((r-t)*(n-t)+(a-e)*(i-e))/l;c<0?(s=t,o=e,h=(t-r)*(t-r)+(e-a)*(e-a)):c>1?(s=n,o=i,h=(n-r)*(n-r)+(i-a)*(i-a)):h=((s=t+c*(n-t))-r)*(s-r)+((o=e+c*(i-e))-a)*(o-a)}return[s,o,h]},_getProjectionToLine(t,e,n){var i=p.cloneObject(t),r=Number.MAX_VALUE;return e.forEach((function(a,s){if(n||s!==e.length-1){var o=e[(s+1)%e.length],h=p._getProjectionToSegment(a.x,a.y,o.x,o.y,t.x,t.y),l=h[0],c=h[1],u=h[2];u<r&&(i.x=l,i.y=c,r=u)}})),i},_prepareArrayForTween(t,e,n){var i,r=[],a=[];if(t.length>e.length){var s=e;e=t,t=s}for(i=0;i<t.length;i+=2)r.push({x:t[i],y:t[i+1]});for(i=0;i<e.length;i+=2)a.push({x:e[i],y:e[i+1]});var o=[];return a.forEach((function(t){var e=p._getProjectionToLine(t,r,n);o.push(e.x),o.push(e.y)})),o},_prepareToStringify(t){var e;for(var n in t.visitedByCircularReferenceRemoval=!0,t)if(t.hasOwnProperty(n)&&t[n]&&"object"==typeof t[n])if(e=Object.getOwnPropertyDescriptor(t,n),t[n].visitedByCircularReferenceRemoval||p._isElement(t[n])){if(!e.configurable)return null;delete t[n]}else if(null===p._prepareToStringify(t[n])){if(!e.configurable)return null;delete t[n]}return delete t.visitedByCircularReferenceRemoval,t},_assign(t,e){for(var n in e)t[n]=e[n];return t},_getFirstPointerId:t=>t.touches?t.changedTouches[0].identifier:t.pointerId||999};function v(t){return p._isString(t)?'"'+t+'"':"[object Number]"===Object.prototype.toString.call(t)||p._isBoolean(t)?t:Object.prototype.toString.call(t)}function y(t){return t>255?255:t<0?0:Math.round(t)}function m(){if(a.isUnminified)return function(t,e){return p._isNumber(t)||p.warn(v(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function _(t){if(a.isUnminified)return function(e,n){let i=p._isNumber(e),r=p._isArray(e)&&e.length==t;return i||r||p.warn(v(e)+' is a not valid value for "'+n+'" attribute. The value should be a number or Array<number>('+t+")"),e}}function b(){if(a.isUnminified)return function(t,e){return p._isNumber(t)||"auto"===t||p.warn(v(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function k(){if(a.isUnminified)return function(t,e){return p._isString(t)||p.warn(v(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function S(){if(a.isUnminified)return function(t,e){const n=p._isString(t),i="[object CanvasGradient]"===Object.prototype.toString.call(t)||t&&t.addColorStop;return n||i||p.warn(v(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}function x(){if(a.isUnminified)return function(t,e){return!0===t||!1===t||p.warn(v(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}var w="get",C="set";const P={addGetterSetter(t,e,n,i,r){P.addGetter(t,e,n),P.addSetter(t,e,i,r),P.addOverloadedGetterSetter(t,e)},addGetter(t,e,n){var i=w+p._capitalize(e);t.prototype[i]=t.prototype[i]||function(){var t=this.attrs[e];return void 0===t?n:t}},addSetter(t,e,n,i){var r=C+p._capitalize(e);t.prototype[r]||P.overWriteSetter(t,e,n,i)},overWriteSetter(t,e,n,i){var r=C+p._capitalize(e);t.prototype[r]=function(t){return n&&null!=t&&(t=n.call(this,t,e)),this._setAttr(e,t),i&&i.call(this),this}},addComponentsGetterSetter(t,e,n,i,r){var s,o,h=n.length,l=p._capitalize,c=w+l(e),u=C+l(e);t.prototype[c]=function(){var t={};for(s=0;s<h;s++)t[o=n[s]]=this.getAttr(e+l(o));return t};var d=function(t){if(a.isUnminified)return function(e,n){return p.isObject(e)||p.warn(v(e)+' is a not valid value for "'+n+'" attribute. The value should be an object with properties '+t),e}}(n);t.prototype[u]=function(t){var n,a=this.attrs[e];for(n in i&&(t=i.call(this,t)),d&&d.call(this,t,e),t)t.hasOwnProperty(n)&&this._setAttr(e+l(n),t[n]);return this._fireChangeEvent(e,a,t),r&&r.call(this),this},P.addOverloadedGetterSetter(t,e)},addOverloadedGetterSetter(t,e){var n=p._capitalize(e),i=C+n,r=w+n;t.prototype[e]=function(){return arguments.length?(this[i](arguments[0]),this):this[r]()}},addDeprecatedGetterSetter(t,e,n,i){p.error("Adding deprecated "+e);var r=w+p._capitalize(e),a=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[r]=function(){p.error(a);var t=this.attrs[e];return void 0===t?n:t},P.addSetter(t,e,i,(function(){p.error(a)})),P.addOverloadedGetterSetter(t,e)},backCompat(t,e){p.each(e,(function(e,n){var i=t.prototype[n],r=w+p._capitalize(e),a=C+p._capitalize(e);function s(){i.apply(this,arguments),p.error('"'+e+'" method is deprecated and will be removed soon. Use ""'+n+'" instead.')}t.prototype[e]=s,t.prototype[r]=s,t.prototype[a]=s}))},afterSetFilter(){this._filterUpToDate=!1}};function M(t){var e,n,i=[],r=t.length,a=p;for(e=0;e<r;e++)n=t[e],a._isNumber(n)?n=Math.round(1e3*n)/1e3:a._isString(n)||(n+=""),i.push(n);return i}var E,T=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];class A{constructor(t){this.canvas=t,this._context=t._canvas.getContext("2d"),a.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){var n,i,r,a,s=this.traceArr,o=s.length,h="";for(n=0;n<o;n++)(r=(i=s[n]).method)?(a=i.args,h+=r,t?h+="()":p._isArray(a[0])?h+="(["+a.join(",")+"])":(e&&(a=a.map((t=>"number"==typeof t?Math.floor(t):t))),h+="("+a.join(",")+")")):(h+=i.property,t||(h+="="+i.val)),h+=";";return h}clearTrace(){this.traceArr=[]}_trace(t){var e=this.traceArr;e.push(t),e.length>=100&&e.shift()}reset(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){var e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){var e=t.getLineCap();e&&this.setAttr("lineCap",e)}_applyOpacity(t){var e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){var e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}setAttr(t,e){this._context[t]=e}arc(t,e,n,i,r,a){this._context.arc(t,e,n,i,r,a)}arcTo(t,e,n,i,r){this._context.arcTo(t,e,n,i,r)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,n,i,r,a){this._context.bezierCurveTo(t,e,n,i,r,a)}clearRect(t,e,n,i){this._context.clearRect(t,e,n,i)}clip(){this._context.clip()}closePath(){this._context.closePath()}createImageData(t,e){var n=arguments;return 2===n.length?this._context.createImageData(t,e):1===n.length?this._context.createImageData(t):void 0}createLinearGradient(t,e,n,i){return this._context.createLinearGradient(t,e,n,i)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,n,i,r,a){return this._context.createRadialGradient(t,e,n,i,r,a)}drawImage(t,e,n,i,r,a,s,o,h){var l=arguments,c=this._context;3===l.length?c.drawImage(t,e,n):5===l.length?c.drawImage(t,e,n,i,r):9===l.length&&c.drawImage(t,e,n,i,r,a,s,o,h)}ellipse(t,e,n,i,r,a,s,o){this._context.ellipse(t,e,n,i,r,a,s,o)}isPointInPath(t,e){return this._context.isPointInPath(t,e)}fill(t){t?this._context.fill(t):this._context.fill()}fillRect(t,e,n,i){this._context.fillRect(t,e,n,i)}strokeRect(t,e,n,i){this._context.strokeRect(t,e,n,i)}fillText(t,e,n,i){i?this._context.fillText(t,e,n,i):this._context.fillText(t,e,n)}measureText(t){return this._context.measureText(t)}getImageData(t,e,n,i){return this._context.getImageData(t,e,n,i)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,n,i){this._context.rect(t,e,n,i)}putImageData(t,e,n){this._context.putImageData(t,e,n)}quadraticCurveTo(t,e,n,i){this._context.quadraticCurveTo(t,e,n,i)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,n,i,r,a){this._context.setTransform(t,e,n,i,r,a)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,n,i){this._context.strokeText(t,e,n,i)}transform(t,e,n,i,r,a){this._context.transform(t,e,n,i,r,a)}translate(t,e){this._context.translate(t,e)}_enableTrace(){var t,e,n=this,i=T.length,r=this.setAttr,a=function(t){var i,r=n[t];n[t]=function(){return e=M(Array.prototype.slice.call(arguments,0)),i=r.apply(n,arguments),n._trace({method:t,args:e}),i}};for(t=0;t<i;t++)a(T[t]);n.setAttr=function(){r.apply(n,arguments);var t=arguments[0],e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),n._trace({property:t,val:e})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;!e||"source-over"===e||this.setAttr("globalCompositeOperation",e)}}["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"].forEach((function(t){Object.defineProperty(A.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})}));class O extends A{_fillColor(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){var e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){var e=t.fill(),n=t.getFillPriority();if(e&&"color"===n)this._fillColor(t);else{var i=t.getFillPatternImage();if(i&&"pattern"===n)this._fillPattern(t);else{var r=t.getFillLinearGradientColorStops();if(r&&"linear-gradient"===n)this._fillLinearGradient(t);else{var a=t.getFillRadialGradientColorStops();a&&"radial-gradient"===n?this._fillRadialGradient(t):e?this._fillColor(t):i?this._fillPattern(t):r?this._fillLinearGradient(t):a&&this._fillRadialGradient(t)}}}}_strokeLinearGradient(t){var e=t.getStrokeLinearGradientStartPoint(),n=t.getStrokeLinearGradientEndPoint(),i=t.getStrokeLinearGradientColorStops(),r=this.createLinearGradient(e.x,e.y,n.x,n.y);if(i){for(var a=0;a<i.length;a+=2)r.addColorStop(i[a],i[a+1]);this.setAttr("strokeStyle",r)}}_stroke(t){var e=t.dash(),n=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!n){this.save();var i=this.getCanvas().getPixelRatio();this.setTransform(i,0,0,i,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),n||this.restore()}}_applyShadow(t){var e,n,i,r=null!==(e=t.getShadowRGBA())&&void 0!==e?e:"black",a=null!==(n=t.getShadowBlur())&&void 0!==n?n:5,s=null!==(i=t.getShadowOffset())&&void 0!==i?i:{x:0,y:0},o=t.getAbsoluteScale(),h=this.canvas.getPixelRatio(),l=o.x*h,c=o.y*h;this.setAttr("shadowColor",r),this.setAttr("shadowBlur",a*Math.min(Math.abs(l),Math.abs(c))),this.setAttr("shadowOffsetX",s.x*l),this.setAttr("shadowOffsetY",s.y*c)}}class I extends A{_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){var e=t.getStrokeScaleEnabled();if(!e){this.save();var n=this.getCanvas().getPixelRatio();this.setTransform(n,0,0,n,0,0)}this._applyLineCap(t);var i=t.hitStrokeWidth(),r="auto"===i?t.strokeWidth():i;this.setAttr("lineWidth",r),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}}}class D{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=(t||{}).pixelRatio||a.pixelRatio||function(){if(E)return E;var t=p.createCanvasElement().getContext("2d");return E=(a._global.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}();this.pixelRatio=e,this._canvas=p.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio;this.getContext()._context.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch(t){try{return this._canvas.toDataURL()}catch(t){return p.error("Unable to get data URL. "+t.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}P.addGetterSetter(D,"pixelRatio",void 0,m());class L extends D{constructor(t={width:0,height:0}){super(t),this.context=new O(this),this.setSize(t.width,t.height)}}class R extends D{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new I(this),this.setSize(t.width,t.height)}}const G={get isDragging(){var t=!1;return G._dragElements.forEach((e=>{"dragging"===e.dragStatus&&(t=!0)})),t},justDragged:!1,get node(){var t;return G._dragElements.forEach((e=>{t=e.node})),t},_dragElements:new Map,_drag(t){const e=[];G._dragElements.forEach(((n,i)=>{const{node:r}=n,a=r.getStage();a.setPointersPositions(t),void 0===n.pointerId&&(n.pointerId=p._getFirstPointerId(t));const s=a._changedPointerPositions.find((t=>t.id===n.pointerId));if(s){if("dragging"!==n.dragStatus){var o=r.dragDistance();if(Math.max(Math.abs(s.x-n.startPointerPos.x),Math.abs(s.y-n.startPointerPos.y))<o)return;if(r.startDrag({evt:t}),!r.isDragging())return}r._setDragPosition(t,n),e.push(r)}})),e.forEach((e=>{e.fire("dragmove",{type:"dragmove",target:e,evt:t},!0)}))},_endDragBefore(t){G._dragElements.forEach((e=>{const{node:n}=e,i=n.getStage();if(t&&i.setPointersPositions(t),!i._changedPointerPositions.find((t=>t.id===e.pointerId)))return;"dragging"!==e.dragStatus&&"stopped"!==e.dragStatus||(G.justDragged=!0,a._mouseListenClick=!1,a._touchListenClick=!1,a._pointerListenClick=!1,e.dragStatus="stopped");const r=e.node.getLayer()||e.node instanceof a.Stage&&e.node;r&&r.batchDraw()}))},_endDragAfter(t){G._dragElements.forEach(((e,n)=>{"stopped"===e.dragStatus&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:t},!0),"dragging"!==e.dragStatus&&G._dragElements.delete(n)}))}};a.isBrowser&&(window.addEventListener("mouseup",G._endDragBefore,!0),window.addEventListener("touchend",G._endDragBefore,!0),window.addEventListener("mousemove",G._drag),window.addEventListener("touchmove",G._drag),window.addEventListener("mouseup",G._endDragAfter,!1),window.addEventListener("touchend",G._endDragAfter,!1));var K="absoluteOpacity",F="allEventListeners",H="absoluteTransform",N="absoluteScale",j="canvas",B="listening",z="mouseenter",W="mouseleave",q="Shape",U=" ",Y="stage",X="transform",V="visible",$=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(U);let Z=1;class Q{constructor(t){this._id=Z++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){t!==X&&t!==H||!this._cache.get(t)?t?this._cache.delete(t):this._cache.clear():this._cache.get(t).dirty=!0}_getCache(t,e){var n=this._cache.get(t);return(void 0===n||(t===X||t===H)&&!0===n.dirty)&&(n=e.call(this),this._cache.set(t,n)),n}_calculate(t,e,n){if(!this._attachedDepsListeners.get(t)){const n=e.map((t=>t+"Change.konva")).join(U);this.on(n,(()=>{this._clearCache(t)})),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,n)}_getCanvasCache(){return this._cache.get(j)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===H&&this.fire("absoluteTransformChange")}clearCache(){return this._cache.delete(j),this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){var e=t||{},n={};void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height||(n=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var i=Math.ceil(e.width||n.width),r=Math.ceil(e.height||n.height),a=e.pixelRatio,s=void 0===e.x?n.x:e.x,o=void 0===e.y?n.y:e.y,h=e.offset||0,l=e.drawBorder||!1,c=e.hitCanvasPixelRatio||1;if(i&&r){s-=h,o-=h;var u=new L({pixelRatio:a,width:i+=2*h,height:r+=2*h}),d=new L({pixelRatio:a,width:0,height:0}),f=new R({pixelRatio:c,width:i,height:r}),g=u.getContext(),v=f.getContext();return f.isCache=!0,u.isCache=!0,this._cache.delete(j),this._filterUpToDate=!1,!1===e.imageSmoothingEnabled&&(u.getContext()._context.imageSmoothingEnabled=!1,d.getContext()._context.imageSmoothingEnabled=!1),g.save(),v.save(),g.translate(-s,-o),v.translate(-s,-o),this._isUnderCache=!0,this._clearSelfAndDescendantCache(K),this._clearSelfAndDescendantCache(N),this.drawScene(u,this),this.drawHit(f,this),this._isUnderCache=!1,g.restore(),v.restore(),l&&(g.save(),g.beginPath(),g.rect(0,0,i,r),g.closePath(),g.setAttr("strokeStyle","red"),g.setAttr("lineWidth",5),g.stroke(),g.restore()),this._cache.set(j,{scene:u,filter:d,hit:f,x:s,y:o}),this._requestDraw(),this}p.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.")}isCached(){return this._cache.has(j)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){var n,i,r,a,s=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],o=this.getAbsoluteTransform(e);return s.forEach((function(t){var e=o.point(t);void 0===n&&(n=r=e.x,i=a=e.y),n=Math.min(n,e.x),i=Math.min(i,e.y),r=Math.max(r,e.x),a=Math.max(a,e.y)})),{x:n,y:i,width:r-n,height:a-i}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);var n=this._getCachedSceneCanvas(),i=n.pixelRatio;t.drawImage(n._canvas,0,0,n.width/i,n.height/i),t.restore()}_drawCachedHitCanvas(t){var e=this._getCanvasCache(),n=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(n._canvas,0,0,n.width/n.pixelRatio,n.height/n.pixelRatio),t.restore()}_getCachedSceneCanvas(){var t,e,n,i,r=this.filters(),a=this._getCanvasCache(),s=a.scene,o=a.filter,h=o.getContext();if(r){if(!this._filterUpToDate){var l=s.pixelRatio;o.setSize(s.width/s.pixelRatio,s.height/s.pixelRatio);try{for(t=r.length,h.clear(),h.drawImage(s._canvas,0,0,s.getWidth()/l,s.getHeight()/l),e=h.getImageData(0,0,o.getWidth(),o.getHeight()),n=0;n<t;n++)"function"==typeof(i=r[n])?(i.call(this,e),h.putImageData(e,0,0)):p.error("Filter should be type of function, but got "+typeof i+" instead. Please check correct filters")}catch(t){p.error("Unable to apply filter. "+t.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return o}return s}on(t,e){if(this._cache&&this._cache.delete(F),3===arguments.length)return this._delegate.apply(this,arguments);var n,i,r,a,s=t.split(U),o=s.length;for(n=0;n<o;n++)r=(i=s[n].split("."))[0],a=i[1]||"",this.eventListeners[r]||(this.eventListeners[r]=[]),this.eventListeners[r].push({name:a,handler:e});return this}off(t,e){var n,i,r,a,s,o=(t||"").split(U),h=o.length;if(this._cache&&this._cache.delete(F),!t)for(i in this.eventListeners)this._off(i);for(n=0;n<h;n++)if(a=(r=o[n].split("."))[0],s=r[1],a)this.eventListeners[a]&&this._off(a,s,e);else for(i in this.eventListeners)this._off(i,s,e);return this}dispatchEvent(t){var e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,(function(t){e.call(this,t.evt)})),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,n){var i=this;this.on(t,(function(t){for(var r=t.target.findAncestors(e,!0,i),a=0;a<r.length;a++)(t=p.cloneObject(t)).currentTarget=r[a],n.call(r[a],t)}))}remove(){return this.isDragging()&&this.stopDrag(),G._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(H),this._clearSelfAndDescendantCache(K),this._clearSelfAndDescendantCache(N),this._clearSelfAndDescendantCache(Y),this._clearSelfAndDescendantCache(V),this._clearSelfAndDescendantCache(B)}_remove(){this._clearCaches();var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this}getAttr(t){var e="get"+p._capitalize(t);return p._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){for(var t=this.getParent(),e=[];t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges((()=>{var e,n;if(!t)return this;for(e in t)"children"!==e&&(n="set"+p._capitalize(e),p._isFunction(this[n])?this[n](t[e]):this._setAttr(e,t[e]))})),this}isListening(){return this._getCache(B,this._isListening)}_isListening(t){if(!this.listening())return!1;const e=this.getParent();return!e||e===t||this===t||e._isListening(t)}isVisible(){return this._getCache(V,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const e=this.getParent();return!e||e===t||this===t||e._isVisible(t)}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);var n=this.getLayer(),i=!1;G._dragElements.forEach((t=>{"dragging"===t.dragStatus&&("Stage"===t.node.nodeType||t.node.getLayer()===n)&&(i=!0)}));var r=!e&&!a.hitOnDragEnabled&&i;return this.isListening()&&this.isVisible()&&!r}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var t,e,n,i,r=this.getDepth(),a=this,s=0;return"Stage"!==a.nodeType&&function o(h){for(t=[],e=h.length,n=0;n<e;n++)i=h[n],s++,i.nodeType!==q&&(t=t.concat(i.getChildren().slice())),i._id===a._id&&(n=e);t.length>0&&t[0].getDepth()<=r&&o(t)}(a.getStage().getChildren()),s}getDepth(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(X),this._clearSelfAndDescendantCache(H)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges((()=>{this.x(t.x),this.y(t.y)})),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){if(!this.getStage())return null;var t=this.getStage().getPointerPosition();if(!t)return null;var e=this.getAbsoluteTransform().copy();return e.invert(),e.point(t)}getAbsolutePosition(t){let e=!1,n=this.parent;for(;n;){if(n.isCached()){e=!0;break}n=n.parent}e&&!t&&(t=!0);var i=this.getAbsoluteTransform(t).getMatrix(),r=new o,a=this.offset();return r.m=i.slice(),r.translate(a.x,a.y),r.getTranslation()}setAbsolutePosition(t){var e=this._clearTransform();this.attrs.x=e.x,this.attrs.y=e.y,delete e.x,delete e.y,this._clearCache(X);var n=this._getAbsoluteTransform().copy();return n.invert(),n.translate(t.x,t.y),t={x:this.attrs.x+n.getTranslation().x,y:this.attrs.y+n.getTranslation().y},this._setTransform(e),this.setPosition({x:t.x,y:t.y}),this._clearCache(X),this._clearSelfAndDescendantCache(H),this}_setTransform(t){var e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){var t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){var e=t.x,n=t.y,i=this.x(),r=this.y();return void 0!==e&&(i+=e),void 0!==n&&(r+=n),this.setPosition({x:i,y:r}),this}_eachAncestorReverse(t,e){var n,i,r=[],a=this.getParent();if(!e||e._id!==this._id){for(r.unshift(this);a&&(!e||a._id!==e._id);)r.unshift(a),a=a.parent;for(n=r.length,i=0;i<n;i++)t(r[i])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return p.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0)}moveUp(){if(!this.parent)return p.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)}moveDown(){if(!this.parent)return p.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)}moveToBottom(){if(!this.parent)return p.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}setZIndex(t){if(!this.parent)return p.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&p.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(K,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var t=this.opacity(),e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){var t,e,n,i,r={},a=this.getAttrs();for(t in r.attrs={},a)e=a[t],p.isObject(e)&&!p._isPlainObject(e)&&!p._isArray(e)||(n="function"==typeof this[t]&&this[t],delete a[t],i=n?n.call(this):null,a[t]=e,i!==e&&(r.attrs[t]=e));return r.className=this.getClassName(),p._prepareToStringify(r)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,n){var i=[];e&&this._isMatch(t)&&i.push(this);for(var r=this.parent;r;){if(r===n)return i;r._isMatch(t)&&i.push(r),r=r.parent}return i}isAncestorOf(t){return!1}findAncestor(t,e,n){return this.findAncestors(t,e,n)[0]}_isMatch(t){if(!t)return!1;if("function"==typeof t)return t(this);var e,n,i=t.replace(/ /g,"").split(","),r=i.length;for(e=0;e<r;e++)if(n=i[e],p.isValidSelector(n)||(p.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),p.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),p.warn("Konva is awesome, right?")),"#"===n.charAt(0)){if(this.id()===n.slice(1))return!0}else if("."===n.charAt(0)){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1}getLayer(){var t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(Y,this._getStage)}_getStage(){var t=this.getParent();return t?t.getStage():void 0}fire(t,e={},n){return e.target=e.target||this,n?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(H,this._getAbsoluteTransform)}_getAbsoluteTransform(t){var e;if(t)return e=new o,this._eachAncestorReverse((function(t){var n=t.transformsEnabled();"all"===n?e.multiply(t.getTransform()):"position"===n&&e.translate(t.x()-t.offsetX(),t.y()-t.offsetY())}),t),e;e=this._cache.get(H)||new o,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();var n=this.transformsEnabled();if("all"===n)e.multiply(this.getTransform());else if("position"===n){const t=this.attrs.x||0,n=this.attrs.y||0,i=this.attrs.offsetX||0,r=this.attrs.offsetY||0;e.translate(t-i,n-r)}return e.dirty=!1,e}getAbsoluteScale(t){for(var e=this;e;)e._isUnderCache&&(t=e),e=e.getParent();const n=this.getAbsoluteTransform(t).decompose();return{x:n.scaleX,y:n.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(X,this._getTransform)}_getTransform(){var t,e,n=this._cache.get(X)||new o;n.reset();var i=this.x(),r=this.y(),s=a.getAngle(this.rotation()),h=null!==(t=this.attrs.scaleX)&&void 0!==t?t:1,l=null!==(e=this.attrs.scaleY)&&void 0!==e?e:1,c=this.attrs.skewX||0,u=this.attrs.skewY||0,d=this.attrs.offsetX||0,f=this.attrs.offsetY||0;return 0===i&&0===r||n.translate(i,r),0!==s&&n.rotate(s),0===c&&0===u||n.skew(c,u),1===h&&1===l||n.scale(h,l),0===d&&0===f||n.translate(-1*d,-1*f),n.dirty=!1,n}clone(t){var e,n,i,r,a,s=p.cloneObject(this.attrs);for(e in t)s[e]=t[e];var o=new this.constructor(s);for(e in this.eventListeners)for(i=(n=this.eventListeners[e]).length,r=0;r<i;r++)(a=n[r]).name.indexOf("konva")<0&&(o.eventListeners[e]||(o.eventListeners[e]=[]),o.eventListeners[e].push(a));return o}_toKonvaCanvas(t){t=t||{};var e=this.getClientRect(),n=this.getStage(),i=void 0!==t.x?t.x:e.x,r=void 0!==t.y?t.y:e.y,a=t.pixelRatio||1,s=new L({width:t.width||e.width||(n?n.width():0),height:t.height||e.height||(n?n.height():0),pixelRatio:a}),o=s.getContext();return o.save(),(i||r)&&o.translate(-1*i,-1*r),this.drawScene(s),o.restore(),s}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){var e=(t=t||{}).mimeType||null,n=t.quality||null,i=this._toKonvaCanvas(t).toDataURL(e,n);return t.callback&&t.callback(i),i}toImage(t){if(!t||!t.callback)throw"callback required for toImage method config argument";var e=t.callback;delete t.callback,p._urlToImage(this.toDataURL(t),(function(t){e(t)}))}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():a.dragDistance}_off(t,e,n){var i,r,a,s=this.eventListeners[t];for(i=0;i<s.length;i++)if(r=s[i].name,a=s[i].handler,!("konva"===r&&"konva"!==e||e&&r!==e||n&&n!==a)){if(s.splice(i,1),0===s.length){delete this.eventListeners[t];break}i--}}_fireChangeEvent(t,e,n){this._fire(t+"Change",{oldVal:e,newVal:n})}addName(t){if(!this.hasName(t)){var e=this.name(),n=e?e+" "+t:t;this.name(n)}return this}hasName(t){if(!t)return!1;const e=this.name();return!!e&&-1!==(e||"").split(/\s/g).indexOf(t)}removeName(t){var e=(this.name()||"").split(/\s/g),n=e.indexOf(t);return-1!==n&&(e.splice(n,1),this.name(e.join(" "))),this}setAttr(t,e){var n=this["set"+p._capitalize(t)];return p._isFunction(n)?n.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(a.autoDrawEnabled){const t=this.getLayer()||this.getStage();null==t||t.batchDraw()}}_setAttr(t,e){var n=this.attrs[t];(n!==e||p.isObject(e))&&(null==e?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,n,e),this._requestDraw())}_setComponentAttr(t,e,n){var i;void 0!==n&&((i=this.attrs[t])||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=n,this._fireChangeEvent(t,i,n))}_fireAndBubble(t,e,n){if(e&&this.nodeType===q&&(e.target=this),t!==z&&t!==W||!(n&&(this===n||this.isAncestorOf&&this.isAncestorOf(n))||"Stage"===this.nodeType&&!n)){this._fire(t,e);var i=(t===z||t===W)&&n&&n.isAncestorOf&&n.isAncestorOf(this)&&!n.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!i&&(n&&n.parent?this._fireAndBubble.call(this.parent,t,e,n):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){let e=this._cache.get(F);if(!e){e={};let t=Object.getPrototypeOf(this);for(;t;)if(t.eventListeners){for(var n in t.eventListeners){const i=t.eventListeners[n],r=e[n]||[];e[n]=i.concat(r)}t=Object.getPrototypeOf(t)}else t=Object.getPrototypeOf(t);this._cache.set(F,e)}return e[t]}_fire(t,e){(e=e||{}).currentTarget=this,e.type=t;const n=this._getProtoListeners(t);if(n)for(var i=0;i<n.length;i++)n[i].handler.call(this,e);const r=this.eventListeners[t];if(r)for(i=0;i<r.length;i++)r[i].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){var e=t?t.pointerId:void 0,n=this.getStage(),i=this.getAbsolutePosition(),r=n._getPointerById(e)||n._changedPointerPositions[0]||i;G._dragElements.set(this._id,{node:this,startPointerPos:r,offset:{x:r.x-i.x,y:r.y-i.y},dragStatus:"ready",pointerId:e})}startDrag(t,e=!0){G._dragElements.has(this._id)||this._createDragElement(t),G._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const n=this.getStage()._getPointerById(e.pointerId);if(n){var i={x:n.x-e.offset.x,y:n.y-e.offset.y},r=this.dragBoundFunc();if(void 0!==r){const e=r.call(this,i,t);e?i=e:p.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===i.x&&this._lastPos.y===i.y||(this.setAbsolutePosition(i),this._requestDraw()),this._lastPos=i}}stopDrag(t){const e=G._dragElements.get(this._id);e&&(e.dragStatus="stopped"),G._endDragBefore(t),G._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=G._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",(function(t){if((void 0===t.evt.button||a.dragButtons.indexOf(t.evt.button)>=0)&&!this.isDragging()){var e=!1;G._dragElements.forEach((t=>{this.isAncestorOf(t.node)&&(e=!0)})),e||this._createDragElement(t)}}))}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const t=G._dragElements.get(this._id),e=t&&"dragging"===t.dragStatus,n=t&&"ready"===t.dragStatus;e?this.stopDrag():n&&G._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const n={x:-t.x,y:-t.y,width:e.width()+t.x,height:e.height()+t.y};return p.haveIntersection(n,this.getClientRect())}static create(t,e){return p._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){var n,i,r,s=Q.prototype.getClassName.call(t),o=t.children;if(e&&(t.attrs.container=e),a[s]||(p.warn('Can not find a node with class name "'+s+'". Fallback to "Shape".'),s="Shape"),n=new(0,a[s])(t.attrs),o)for(i=o.length,r=0;r<i;r++)n.add(Q._createNode(o[r]));return n}}Q.prototype.nodeType="Node",Q.prototype._attrsAffectingSize=[],Q.prototype.eventListeners={},Q.prototype.on.call(Q.prototype,$,(function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache(X),this._clearSelfAndDescendantCache(H))})),Q.prototype.on.call(Q.prototype,"visibleChange.konva",(function(){this._clearSelfAndDescendantCache(V)})),Q.prototype.on.call(Q.prototype,"listeningChange.konva",(function(){this._clearSelfAndDescendantCache(B)})),Q.prototype.on.call(Q.prototype,"opacityChange.konva",(function(){this._clearSelfAndDescendantCache(K)}));const J=P.addGetterSetter;J(Q,"zIndex"),J(Q,"absolutePosition"),J(Q,"position"),J(Q,"x",0,m()),J(Q,"y",0,m()),J(Q,"globalCompositeOperation","source-over",k()),J(Q,"opacity",1,m()),J(Q,"name","",k()),J(Q,"id","",k()),J(Q,"rotation",0,m()),P.addComponentsGetterSetter(Q,"scale",["x","y"]),J(Q,"scaleX",1,m()),J(Q,"scaleY",1,m()),P.addComponentsGetterSetter(Q,"skew",["x","y"]),J(Q,"skewX",0,m()),J(Q,"skewY",0,m()),P.addComponentsGetterSetter(Q,"offset",["x","y"]),J(Q,"offsetX",0,m()),J(Q,"offsetY",0,m()),J(Q,"dragDistance",null,m()),J(Q,"width",0,m()),J(Q,"height",0,m()),J(Q,"listening",!0,x()),J(Q,"preventDefault",!0,x()),J(Q,"filters",null,(function(t){return this._filterUpToDate=!1,t})),J(Q,"visible",!0,x()),J(Q,"transformsEnabled","all",k()),J(Q,"size"),J(Q,"dragBoundFunc"),J(Q,"draggable",!1,x()),P.backCompat(Q,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class tt extends Q{constructor(){super(...arguments),this.children=[]}getChildren(t){if(!t)return this.children||[];const e=this.children||[];var n=[];return e.forEach((function(e){t(e)&&n.push(e)})),n}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach((t=>{t.parent=null,t.index=0,t.remove()})),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach((t=>{t.parent=null,t.index=0,t.destroy()})),this.children=[],this._requestDraw(),this}add(...t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}var n=t[0];return n.getParent()?(n.moveTo(this),this):(this._validateAdd(n),n.index=this.getChildren().length,n.parent=this,n._clearCaches(),this.getChildren().push(n),this._fire("add",{child:n}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){var n=[];return this._descendants((i=>{const r=i._isMatch(t);return r&&n.push(i),!(!r||!e)})),n}_descendants(t){let e=!1;const n=this.getChildren();for(const i of n){if(e=t(i),e)return!0;if(i.hasChildren()&&(e=i._descendants(t),e))return!0}return!1}toObject(){var t=Q.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach((e=>{t.children.push(e.toObject())})),t}isAncestorOf(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){var e=Q.prototype.clone.call(this,t);return this.getChildren().forEach((function(t){e.add(t.clone())})),e}getAllIntersections(t){var e=[];return this.find("Shape").forEach((function(n){n.isVisible()&&n.intersects(t)&&e.push(n)})),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),this.isCached()||null===(e=this.children)||void 0===e||e.forEach((function(e){e._clearSelfAndDescendantCache(t)}))}_setChildrenIndices(){var t;null===(t=this.children)||void 0===t||t.forEach((function(t,e){t.index=e})),this._requestDraw()}drawScene(t,e){var n=this.getLayer(),i=t||n&&n.getCanvas(),r=i&&i.getContext(),a=this._getCanvasCache(),s=a&&a.scene,o=i&&i.isCache;if(!this.isVisible()&&!o)return this;if(s){r.save();var h=this.getAbsoluteTransform(e).getMatrix();r.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedSceneCanvas(r),r.restore()}else this._drawChildren("drawScene",i,e);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;var n=this.getLayer(),i=t||n&&n.hitCanvas,r=i&&i.getContext(),a=this._getCanvasCache();if(a&&a.hit){r.save();var s=this.getAbsoluteTransform(e).getMatrix();r.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._drawCachedHitCanvas(r),r.restore()}else this._drawChildren("drawHit",i,e);return this}_drawChildren(t,e,n){var i,r=e&&e.getContext(),a=this.clipWidth(),s=this.clipHeight(),o=this.clipFunc(),h=a&&s||o;const l=n===this;if(h){r.save();var c=this.getAbsoluteTransform(n),u=c.getMatrix();if(r.transform(u[0],u[1],u[2],u[3],u[4],u[5]),r.beginPath(),o)o.call(this,r,this);else{var d=this.clipX(),f=this.clipY();r.rect(d,f,a,s)}r.clip(),u=c.copy().invert().getMatrix(),r.transform(u[0],u[1],u[2],u[3],u[4],u[5])}var g=!l&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===t;g&&(r.save(),r._applyGlobalCompositeOperation(this)),null===(i=this.children)||void 0===i||i.forEach((function(i){i[t](e,n)})),g&&r.restore(),h&&r.restore()}getClientRect(t){var e,n,i,r,a,s,o=(t=t||{}).skipTransform,h=t.relativeTo,l=this;null===(e=this.children)||void 0===e||e.forEach((function(e){if(e.visible()){var s=e.getClientRect({relativeTo:l,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===s.width&&0===s.height||(void 0===n?(n=s.x,i=s.y,r=s.x+s.width,a=s.y+s.height):(n=Math.min(n,s.x),i=Math.min(i,s.y),r=Math.max(r,s.x+s.width),a=Math.max(a,s.y+s.height)))}}));for(var c=this.find("Shape"),u=!1,d=0;d<c.length;d++)if(c[d]._isVisible(this)){u=!0;break}return s=u&&void 0!==n?{x:n,y:i,width:r-n,height:a-i}:{x:0,y:0,width:0,height:0},o?s:this._transformedRect(s,h)}}P.addComponentsGetterSetter(tt,"clip",["x","y","width","height"]),P.addGetterSetter(tt,"clipX",void 0,m()),P.addGetterSetter(tt,"clipY",void 0,m()),P.addGetterSetter(tt,"clipWidth",void 0,m()),P.addGetterSetter(tt,"clipHeight",void 0,m()),P.addGetterSetter(tt,"clipFunc");const et=new Map,nt=void 0!==a._global.PointerEvent;function it(t){return et.get(t)}function rt(t){return{evt:t,pointerId:t.pointerId}}function at(t,e){return et.get(t)===e}function st(t,e){ot(t),e.getStage()&&(et.set(t,e),nt&&e._fire("gotpointercapture",rt(new PointerEvent("gotpointercapture"))))}function ot(t,e){const n=et.get(t);if(!n)return;const i=n.getStage();i&&i.content,et.delete(t),nt&&n._fire("lostpointercapture",rt(new PointerEvent("lostpointercapture")))}var ht="mouseleave",lt="mouseover",ct="mouseenter",ut="mousemove",dt="mousedown",ft="mouseup",gt="pointermove",pt="pointerdown",vt="pointerup",yt="pointercancel",mt="pointerout",_t="pointerleave",bt="pointerover",kt="pointerenter",St="contextmenu",xt="touchstart",wt="touchend",Ct="touchmove",Pt="touchcancel",Mt="wheel",Et=[[ct,"_pointerenter"],[dt,"_pointerdown"],[ut,"_pointermove"],[ft,"_pointerup"],[ht,"_pointerleave"],[xt,"_pointerdown"],[Ct,"_pointermove"],[wt,"_pointerup"],[Pt,"_pointercancel"],[lt,"_pointerover"],[Mt,"_wheel"],[St,"_contextmenu"],[pt,"_pointerdown"],[gt,"_pointermove"],[vt,"_pointerup"],[yt,"_pointercancel"],["lostpointercapture","_lostpointercapture"]];const Tt={mouse:{[mt]:"mouseout",[_t]:ht,[bt]:lt,[kt]:ct,[gt]:ut,[pt]:dt,[vt]:ft,[yt]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[mt]:"touchout",[_t]:"touchleave",[bt]:"touchover",[kt]:"touchenter",[gt]:Ct,[pt]:xt,[vt]:wt,[yt]:Pt,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[mt]:mt,[_t]:_t,[bt]:bt,[kt]:kt,[gt]:gt,[pt]:pt,[vt]:vt,[yt]:yt,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},At=t=>t.indexOf("pointer")>=0?"pointer":t.indexOf("touch")>=0?"touch":"mouse",Ot=t=>{const e=At(t);return"pointer"===e?a.pointerEventsEnabled&&Tt.pointer:"touch"===e?Tt.touch:"mouse"===e?Tt.mouse:void 0};function It(t={}){return(t.clipFunc||t.clipWidth||t.clipHeight)&&p.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}const Dt=[];class Lt extends tt{constructor(t){super(It(t)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),Dt.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",(()=>{It(this.attrs)})),this._checkVisibility()}_validateAdd(t){const e="Layer"===t.getType(),n="FastLayer"===t.getType();e||n||p.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if("string"==typeof t){if("."===t.charAt(0)){var e=t.slice(1);t=document.getElementsByClassName(e)[0]}else{var n;n="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(n)}if(!t)throw"Can not find container in document with id "+n}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var t,e=this.children,n=e.length;for(t=0;t<n;t++)e[t].clear();return this}clone(t){return t||(t={}),t.container="undefined"!=typeof document&&document.createElement("div"),tt.prototype.clone.call(this,t)}destroy(){super.destroy();var t=this.content;t&&p._isInDocument(t)&&this.container().removeChild(t);var e=Dt.indexOf(this);return e>-1&&Dt.splice(e,1),this}getPointerPosition(){const t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(p.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}_getPointerById(t){return this._pointerPositions.find((e=>e.id===t))}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){(t=t||{}).x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();var e=new L({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),n=e.getContext()._context,i=this.children;return(t.x||t.y)&&n.translate(-1*t.x,-1*t.y),i.forEach((function(e){if(e.isVisible()){var i=e._toKonvaCanvas(t);n.drawImage(i._canvas,t.x,t.y,i.getWidth()/i.getPixelRatio(),i.getHeight()/i.getPixelRatio())}})),e}getIntersection(t){if(!t)return null;var e,n=this.children;for(e=n.length-1;e>=0;e--){const i=n[e].getIntersection(t);if(i)return i}return null}_resizeDOM(){var t=this.width(),e=this.height();this.content&&(this.content.style.width=t+"px",this.content.style.height=e+"px"),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.forEach((n=>{n.setSize({width:t,height:e}),n.draw()}))}add(t,...e){if(arguments.length>1){for(var n=0;n<arguments.length;n++)this.add(arguments[n]);return this}super.add(t);var i=this.children.length;return i>5&&p.warn("The stage has "+i+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),t.setSize({width:this.width(),height:this.height()}),t.draw(),a.isBrowser&&this.content.appendChild(t.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return at(t,this)}setPointerCapture(t){st(t,this)}releaseCapture(t){ot(t)}getLayers(){return this.children}_bindContentEvents(){a.isBrowser&&Et.forEach((([t,e])=>{this.content.addEventListener(t,(t=>{this[e](t)}))}))}_pointerenter(t){this.setPointersPositions(t);const e=Ot(t.type);this._fire(e.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);const e=Ot(t.type);this._fire(e.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let e=this[t+"targetShape"];return e&&!e.getStage()&&(e=null),e}_pointerleave(t){const e=Ot(t.type),n=At(t.type);if(e){this.setPointersPositions(t);var i=this._getTargetShape(n),r=!G.isDragging||a.hitOnDragEnabled;i&&r?(i._fireAndBubble(e.pointerout,{evt:t}),i._fireAndBubble(e.pointerleave,{evt:t}),this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this[n+"targetShape"]=null):r&&(this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(e.pointerout,{evt:t,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[]}}_pointerdown(t){const e=Ot(t.type),n=At(t.type);if(e){this.setPointersPositions(t);var i=!1;this._changedPointerPositions.forEach((r=>{var s=this.getIntersection(r);if(G.justDragged=!1,a["_"+n+"ListenClick"]=!0,!s||!s.isListening())return;a.capturePointerEventsEnabled&&s.setPointerCapture(r.id),this[n+"ClickStartShape"]=s,s._fireAndBubble(e.pointerdown,{evt:t,pointerId:r.id}),i=!0;const o=t.type.indexOf("touch")>=0;s.preventDefault()&&t.cancelable&&o&&t.preventDefault()})),i||this._fire(e.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(t){const e=Ot(t.type),n=At(t.type);if(!e)return;if(G.isDragging&&G.node.preventDefault()&&t.cancelable&&t.preventDefault(),this.setPointersPositions(t),G.isDragging&&!a.hitOnDragEnabled)return;var i={};let r=!1;var s=this._getTargetShape(n);this._changedPointerPositions.forEach((a=>{const o=it(a.id)||this.getIntersection(a),h=a.id,l={evt:t,pointerId:h};var c=s!==o;if(c&&s&&(s._fireAndBubble(e.pointerout,Object.assign({},l),o),s._fireAndBubble(e.pointerleave,Object.assign({},l),o)),o){if(i[o._id])return;i[o._id]=!0}o&&o.isListening()?(r=!0,c&&(o._fireAndBubble(e.pointerover,Object.assign({},l),s),o._fireAndBubble(e.pointerenter,Object.assign({},l),s),this[n+"targetShape"]=o),o._fireAndBubble(e.pointermove,Object.assign({},l))):s&&(this._fire(e.pointerover,{evt:t,target:this,currentTarget:this,pointerId:h}),this[n+"targetShape"]=null)})),r||this._fire(e.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){const e=Ot(t.type),n=At(t.type);if(!e)return;this.setPointersPositions(t);const i=this[n+"ClickStartShape"],r=this[n+"ClickEndShape"];var s={};let o=!1;this._changedPointerPositions.forEach((h=>{const l=it(h.id)||this.getIntersection(h);if(l){if(l.releaseCapture(h.id),s[l._id])return;s[l._id]=!0}const c=h.id,u={evt:t,pointerId:c};let d=!1;a["_"+n+"InDblClickWindow"]?(d=!0,clearTimeout(this[n+"DblTimeout"])):G.justDragged||(a["_"+n+"InDblClickWindow"]=!0,clearTimeout(this[n+"DblTimeout"])),this[n+"DblTimeout"]=setTimeout((function(){a["_"+n+"InDblClickWindow"]=!1}),a.dblClickWindow),l&&l.isListening()?(o=!0,this[n+"ClickEndShape"]=l,l._fireAndBubble(e.pointerup,Object.assign({},u)),a["_"+n+"ListenClick"]&&i&&i===l&&(l._fireAndBubble(e.pointerclick,Object.assign({},u)),d&&r&&r===l&&l._fireAndBubble(e.pointerdblclick,Object.assign({},u)))):(this[n+"ClickEndShape"]=null,a["_"+n+"ListenClick"]&&this._fire(e.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:c}),d&&this._fire(e.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:c}))})),o||this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),a["_"+n+"ListenClick"]=!1,t.cancelable&&t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(St,{evt:t}):this._fire(St,{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);var e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(Mt,{evt:t}):this._fire(Mt,{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);const e=it(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(vt,rt(t)),ot(t.pointerId)}_lostpointercapture(t){ot(t.pointerId)}setPointersPositions(t){var e=this._getContentPosition(),n=null,i=null;void 0!==(t=t||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,(t=>{this._pointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})})),Array.prototype.forEach.call(t.changedTouches||t.touches,(t=>{this._changedPointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})}))):(n=(t.clientX-e.left)/e.scaleX,i=(t.clientY-e.top)/e.scaleY,this.pointerPos={x:n,y:i},this._pointerPositions=[{x:n,y:i,id:p._getFirstPointerId(t)}],this._changedPointerPositions=[{x:n,y:i,id:p._getFirstPointerId(t)}])}_setPointerPosition(t){p.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new L({width:this.width(),height:this.height()}),this.bufferHitCanvas=new R({pixelRatio:1,width:this.width(),height:this.height()}),a.isBrowser){var t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}}cache(){return p.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach((function(t){t.batchDraw()})),this}}Lt.prototype.nodeType="Stage",s(Lt),P.addGetterSetter(Lt,"container");var Rt="hasShadow",Gt="shadowRGBA",Kt="patternImage",Ft="linearGradient",Ht="radialGradient";let Nt;function jt(){return Nt||(Nt=p.createCanvasElement().getContext("2d"),Nt)}const Bt={};class zt extends Q{constructor(t){let e;for(super(t);e=p.getRandomColor(),!e||e in Bt;);this.colorKey=e,Bt[e]=this}getContext(){return p.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return p.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(Rt,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(Kt,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const t=jt().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const e=new o;e.translate(this.fillPatternX(),this.fillPatternY()),e.rotate(a.getAngle(this.fillPatternRotation())),e.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),e.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const n=e.getMatrix();t.setTransform({a:n[0],b:n[1],c:n[2],d:n[3],e:n[4],f:n[5]})}return t}}_getLinearGradient(){return this._getCache(Ft,this.__getLinearGradient)}__getLinearGradient(){var t=this.fillLinearGradientColorStops();if(t){for(var e=jt(),n=this.fillLinearGradientStartPoint(),i=this.fillLinearGradientEndPoint(),r=e.createLinearGradient(n.x,n.y,i.x,i.y),a=0;a<t.length;a+=2)r.addColorStop(t[a],t[a+1]);return r}}_getRadialGradient(){return this._getCache(Ht,this.__getRadialGradient)}__getRadialGradient(){var t=this.fillRadialGradientColorStops();if(t){for(var e=jt(),n=this.fillRadialGradientStartPoint(),i=this.fillRadialGradientEndPoint(),r=e.createRadialGradient(n.x,n.y,this.fillRadialGradientStartRadius(),i.x,i.y,this.fillRadialGradientEndRadius()),a=0;a<t.length;a+=2)r.addColorStop(t[a],t[a+1]);return r}}getShadowRGBA(){return this._getCache(Gt,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var t=p.colorToRGBA(this.shadowColor());return"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],(()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops())))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],(()=>this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops())))}hasHitStroke(){const t=this.hitStrokeWidth();return"auto"===t?this.hasStroke():this.strokeEnabled()&&!!t}intersects(t){var e=this.getStage().bufferHitCanvas;return e.getContext().clear(),this.drawHit(e,null,!0),e.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0}destroy(){return Q.prototype.destroy.call(this),delete Bt[this.colorKey],delete this.colorKey,this}_useBufferCanvas(t){var e;if(!this.getStage())return!1;if(null!==(e=this.attrs.perfectDrawEnabled)&&void 0!==e&&!e)return!1;const n=t||this.hasFill(),i=this.hasStroke(),r=1!==this.getAbsoluteOpacity();if(n&&i&&r)return!0;const a=this.hasShadow(),s=this.shadowForStrokeEnabled();return!!(n&&i&&a&&s)}setStrokeHitEnabled(t){p.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return 0!==this.hitStrokeWidth()}getSelfRect(){var t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}}getClientRect(t={}){const e=t.skipTransform,n=t.relativeTo,i=this.getSelfRect(),r=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,a=i.width+r,s=i.height+r,o=!t.skipShadow&&this.hasShadow(),h=o?this.shadowOffsetX():0,l=o?this.shadowOffsetY():0,c=a+Math.abs(h),u=s+Math.abs(l),d=o&&this.shadowBlur()||0,f=c+2*d,g=u+2*d;let p=0;Math.round(r/2)!==r/2&&(p=1);const v={width:f+p,height:g+p,x:-Math.round(r/2+d)+Math.min(h,0)+i.x,y:-Math.round(r/2+d)+Math.min(l,0)+i.y};return e?v:this._transformedRect(v,n)}drawScene(t,e){var n,i,r=this.getLayer(),a=t||r.getCanvas(),s=a.getContext(),o=this._getCanvasCache(),h=this.getSceneFunc(),l=this.hasShadow(),c=a.isCache,u=e===this;if(!this.isVisible()&&!u)return this;if(o){s.save();var d=this.getAbsoluteTransform(e).getMatrix();return s.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this._drawCachedSceneCanvas(s),s.restore(),this}if(!h)return this;if(s.save(),this._useBufferCanvas()&&!c){(i=(n=this.getStage().bufferCanvas).getContext()).clear(),i.save(),i._applyLineJoin(this);var f=this.getAbsoluteTransform(e).getMatrix();i.transform(f[0],f[1],f[2],f[3],f[4],f[5]),h.call(this,i,this),i.restore();var g=n.pixelRatio;l&&s._applyShadow(this),s._applyOpacity(this),s._applyGlobalCompositeOperation(this),s.drawImage(n._canvas,0,0,n.width/g,n.height/g)}else s._applyLineJoin(this),u||(f=this.getAbsoluteTransform(e).getMatrix(),s.transform(f[0],f[1],f[2],f[3],f[4],f[5]),s._applyOpacity(this),s._applyGlobalCompositeOperation(this)),l&&s._applyShadow(this),h.call(this,s,this);return s.restore(),this}drawHit(t,e,n=!1){if(!this.shouldDrawHit(e,n))return this;var i=this.getLayer(),r=t||i.hitCanvas,a=r&&r.getContext(),s=this.hitFunc()||this.sceneFunc(),o=this._getCanvasCache(),h=o&&o.hit;if(this.colorKey||p.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),h){a.save();var l=this.getAbsoluteTransform(e).getMatrix();return a.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(a),a.restore(),this}if(!s)return this;if(a.save(),a._applyLineJoin(this),this!==e){var c=this.getAbsoluteTransform(e).getMatrix();a.transform(c[0],c[1],c[2],c[3],c[4],c[5])}return s.call(this,a,this),a.restore(),this}drawHitFromCache(t=0){var e,n,i,r,a,s=this._getCanvasCache(),o=this._getCachedSceneCanvas(),h=s.hit,l=h.getContext(),c=h.getWidth(),u=h.getHeight();l.clear(),l.drawImage(o._canvas,0,0,c,u);try{for(i=(n=(e=l.getImageData(0,0,c,u)).data).length,r=p._hexToRgb(this.colorKey),a=0;a<i;a+=4)n[a+3]>t?(n[a]=r.r,n[a+1]=r.g,n[a+2]=r.b,n[a+3]=255):n[a+3]=0;l.putImageData(e,0,0)}catch(t){p.error("Unable to draw hit graph from cached scene canvas. "+t.message)}return this}hasPointerCapture(t){return at(t,this)}setPointerCapture(t){st(t,this)}releaseCapture(t){ot(t)}}zt.prototype._fillFunc=function(t){t.fill()},zt.prototype._strokeFunc=function(t){t.stroke()},zt.prototype._fillFuncHit=function(t){t.fill()},zt.prototype._strokeFuncHit=function(t){t.stroke()},zt.prototype._centroid=!1,zt.prototype.nodeType="Shape",s(zt),zt.prototype.eventListeners={},zt.prototype.on.call(zt.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache(Rt)})),zt.prototype.on.call(zt.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",(function(){this._clearCache(Gt)})),zt.prototype.on.call(zt.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",(function(){this._clearCache(Kt)})),zt.prototype.on.call(zt.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",(function(){this._clearCache(Ft)})),zt.prototype.on.call(zt.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",(function(){this._clearCache(Ht)})),P.addGetterSetter(zt,"stroke",void 0,S()),P.addGetterSetter(zt,"strokeWidth",2,m()),P.addGetterSetter(zt,"fillAfterStrokeEnabled",!1),P.addGetterSetter(zt,"hitStrokeWidth","auto",b()),P.addGetterSetter(zt,"strokeHitEnabled",!0,x()),P.addGetterSetter(zt,"perfectDrawEnabled",!0,x()),P.addGetterSetter(zt,"shadowForStrokeEnabled",!0,x()),P.addGetterSetter(zt,"lineJoin"),P.addGetterSetter(zt,"lineCap"),P.addGetterSetter(zt,"sceneFunc"),P.addGetterSetter(zt,"hitFunc"),P.addGetterSetter(zt,"dash"),P.addGetterSetter(zt,"dashOffset",0,m()),P.addGetterSetter(zt,"shadowColor",void 0,k()),P.addGetterSetter(zt,"shadowBlur",0,m()),P.addGetterSetter(zt,"shadowOpacity",1,m()),P.addComponentsGetterSetter(zt,"shadowOffset",["x","y"]),P.addGetterSetter(zt,"shadowOffsetX",0,m()),P.addGetterSetter(zt,"shadowOffsetY",0,m()),P.addGetterSetter(zt,"fillPatternImage"),P.addGetterSetter(zt,"fill",void 0,S()),P.addGetterSetter(zt,"fillPatternX",0,m()),P.addGetterSetter(zt,"fillPatternY",0,m()),P.addGetterSetter(zt,"fillLinearGradientColorStops"),P.addGetterSetter(zt,"strokeLinearGradientColorStops"),P.addGetterSetter(zt,"fillRadialGradientStartRadius",0),P.addGetterSetter(zt,"fillRadialGradientEndRadius",0),P.addGetterSetter(zt,"fillRadialGradientColorStops"),P.addGetterSetter(zt,"fillPatternRepeat","repeat"),P.addGetterSetter(zt,"fillEnabled",!0),P.addGetterSetter(zt,"strokeEnabled",!0),P.addGetterSetter(zt,"shadowEnabled",!0),P.addGetterSetter(zt,"dashEnabled",!0),P.addGetterSetter(zt,"strokeScaleEnabled",!0),P.addGetterSetter(zt,"fillPriority","color"),P.addComponentsGetterSetter(zt,"fillPatternOffset",["x","y"]),P.addGetterSetter(zt,"fillPatternOffsetX",0,m()),P.addGetterSetter(zt,"fillPatternOffsetY",0,m()),P.addComponentsGetterSetter(zt,"fillPatternScale",["x","y"]),P.addGetterSetter(zt,"fillPatternScaleX",1,m()),P.addGetterSetter(zt,"fillPatternScaleY",1,m()),P.addComponentsGetterSetter(zt,"fillLinearGradientStartPoint",["x","y"]),P.addComponentsGetterSetter(zt,"strokeLinearGradientStartPoint",["x","y"]),P.addGetterSetter(zt,"fillLinearGradientStartPointX",0),P.addGetterSetter(zt,"strokeLinearGradientStartPointX",0),P.addGetterSetter(zt,"fillLinearGradientStartPointY",0),P.addGetterSetter(zt,"strokeLinearGradientStartPointY",0),P.addComponentsGetterSetter(zt,"fillLinearGradientEndPoint",["x","y"]),P.addComponentsGetterSetter(zt,"strokeLinearGradientEndPoint",["x","y"]),P.addGetterSetter(zt,"fillLinearGradientEndPointX",0),P.addGetterSetter(zt,"strokeLinearGradientEndPointX",0),P.addGetterSetter(zt,"fillLinearGradientEndPointY",0),P.addGetterSetter(zt,"strokeLinearGradientEndPointY",0),P.addComponentsGetterSetter(zt,"fillRadialGradientStartPoint",["x","y"]),P.addGetterSetter(zt,"fillRadialGradientStartPointX",0),P.addGetterSetter(zt,"fillRadialGradientStartPointY",0),P.addComponentsGetterSetter(zt,"fillRadialGradientEndPoint",["x","y"]),P.addGetterSetter(zt,"fillRadialGradientEndPointX",0),P.addGetterSetter(zt,"fillRadialGradientEndPointY",0),P.addGetterSetter(zt,"fillPatternRotation",0),P.backCompat(zt,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});var Wt=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],qt=Wt.length;class Ut extends tt{constructor(t){super(t),this.canvas=new L,this.hitCanvas=new R({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);var e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){Q.prototype.moveToTop.call(this);var t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!Q.prototype.moveUp.call(this))return!1;var t=this.getStage();return!(!t||!t.content||(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),0))}moveDown(){if(Q.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(Q.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var t=this.getNativeCanvasElement();return Q.prototype.remove.call(this),t&&t.parentNode&&p._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&p.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return(t=t||{}).width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),Q.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){const t=this.visible();this.canvas._canvas.style.display=t?"block":"none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){p.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){p.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,p.requestAnimFrame((()=>{this.draw(),this._waitingForDraw=!1}))),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;for(var e=1,n=!1;;){for(let i=0;i<qt;i++){const r=Wt[i],a=this._getIntersection({x:t.x+r.x*e,y:t.y+r.y*e}),s=a.shape;if(s)return s;if(n=!!a.antialiased,!a.antialiased)break}if(!n)return null;e+=1}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,n=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,i=n[3];if(255===i){const t=p._rgbToHex(n[0],n[1],n[2]),e=Bt["#"+t];return e?{shape:e}:{antialiased:!0}}return i>0?{antialiased:!0}:{}}drawScene(t,e){var n=this.getLayer(),i=t||n&&n.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&i.getContext().clear(),tt.prototype.drawScene.call(this,i,e),this._fire("draw",{node:this}),this}drawHit(t,e){var n=this.getLayer(),i=t||n&&n.hitCanvas;return n&&n.clearBeforeDraw()&&n.getHitCanvas().getContext().clear(),tt.prototype.drawHit.call(this,i,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){p.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return p.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(this.parent&&this.parent.content){var t=this.parent;this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}}}Ut.prototype.nodeType="Layer",s(Ut),P.addGetterSetter(Ut,"imageSmoothingEnabled",!0),P.addGetterSetter(Ut,"clearBeforeDraw",!0),P.addGetterSetter(Ut,"hitGraphEnabled",!0,x());class Yt extends Ut{constructor(t){super(t),this.listening(!1),p.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}Yt.prototype.nodeType="FastLayer",s(Yt);class Xt extends tt{_validateAdd(t){var e=t.getType();"Group"!==e&&"Shape"!==e&&p.throw("You may only add groups and shapes to groups.")}}Xt.prototype.nodeType="Group",s(Xt);var Vt=r.performance&&r.performance.now?function(){return r.performance.now()}:function(){return(new Date).getTime()};class $t{constructor(t,e){this.id=$t.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:Vt(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){var e;return e=t?t.length>0?t:[t]:[],this.layers=e,this}getLayers(){return this.layers}addLayer(t){var e,n=this.layers,i=n.length;for(e=0;e<i;e++)if(n[e]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){var t,e=$t.animations,n=e.length;for(t=0;t<n;t++)if(e[t].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Vt(),$t._addAnimation(this),this}stop(){return $t._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){var e,n=t.id,i=this.animations,r=i.length;for(e=0;e<r;e++)if(i[e].id===n){this.animations.splice(e,1);break}}static _runFrames(){var t,e,n,i,r,a,s,o,h={},l=this.animations;for(i=0;i<l.length;i++)if(e=(t=l[i]).layers,n=t.func,t._updateFrameObject(Vt()),a=e.length,!n||!1!==n.call(t,t.frame))for(r=0;r<a;r++)void 0!==(s=e[r])._id&&(h[s._id]=s);for(o in h)h.hasOwnProperty(o)&&h[o].batchDraw()}static _animationLoop(){var t=$t;t.animations.length?(t._runFrames(),p.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,p.requestAnimFrame(this._animationLoop))}}$t.animations=[],$t.animIdCounter=0,$t.animRunning=!1;var Zt={node:1,duration:1,easing:1,onFinish:1,yoyo:1},Qt=0,Jt=["fill","stroke","shadowColor"];class te{constructor(t,e,n,i,r,a,s){this.prop=t,this.propFunc=e,this.begin=i,this._pos=i,this.duration=a,this._change=0,this.prevPos=0,this.yoyo=s,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=n,this._change=r-this.begin,this.pause()}fire(t){var e=this[t];e&&e()}setTime(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())}getTime(){return this._time}setPosition(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t}getPosition(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)}play(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var t=this.getTimer()-this._startTime;2===this.state?this.setTime(t):3===this.state&&this.setTime(this.duration-t)}pause(){this.state=1,this.fire("onPause")}getTimer(){return(new Date).getTime()}}class ee{constructor(t){var e,n,i=this,r=t.node,s=r._id,o=t.easing||ne.Linear,h=!!t.yoyo;e=void 0===t.duration?.3:0===t.duration?.001:t.duration,this.node=r,this._id=Qt++;var l=r.getLayer()||(r instanceof a.Stage?r.getLayers():null);for(n in l||p.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new $t((function(){i.tween.onEnterFrame()}),l),this.tween=new te(n,(function(t){i._tweenFunc(t)}),o,0,1,1e3*e,h),this._addListeners(),ee.attrs[s]||(ee.attrs[s]={}),ee.attrs[s][this._id]||(ee.attrs[s][this._id]={}),ee.tweens[s]||(ee.tweens[s]={}),t)void 0===Zt[n]&&this._addAttr(n,t[n]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset,this.onUpdate=t.onUpdate}_addAttr(t,e){var n,i,r,a,s,o,h,l,c=this.node,u=c._id;if((r=ee.tweens[u][t])&&delete ee.attrs[u][r][t],n=c.getAttr(t),p._isArray(e))if(i=[],s=Math.max(e.length,n.length),"points"===t&&e.length!==n.length&&(e.length>n.length?(h=n,n=p._prepareArrayForTween(n,e,c.closed())):(o=e,e=p._prepareArrayForTween(e,n,c.closed()))),0===t.indexOf("fill"))for(a=0;a<s;a++)if(a%2==0)i.push(e[a]-n[a]);else{var d=p.colorToRGBA(n[a]);l=p.colorToRGBA(e[a]),n[a]=d,i.push({r:l.r-d.r,g:l.g-d.g,b:l.b-d.b,a:l.a-d.a})}else for(a=0;a<s;a++)i.push(e[a]-n[a]);else-1!==Jt.indexOf(t)?(n=p.colorToRGBA(n),i={r:(l=p.colorToRGBA(e)).r-n.r,g:l.g-n.g,b:l.b-n.b,a:l.a-n.a}):i=e-n;ee.attrs[u][this._id][t]={start:n,diff:i,end:e,trueEnd:o,trueStart:h},ee.tweens[u][t]=this._id}_tweenFunc(t){var e,n,i,r,a,s,o,h,l=this.node,c=ee.attrs[l._id][this._id];for(e in c){if(i=(n=c[e]).start,r=n.diff,h=n.end,p._isArray(i))if(a=[],o=Math.max(i.length,h.length),0===e.indexOf("fill"))for(s=0;s<o;s++)s%2==0?a.push((i[s]||0)+r[s]*t):a.push("rgba("+Math.round(i[s].r+r[s].r*t)+","+Math.round(i[s].g+r[s].g*t)+","+Math.round(i[s].b+r[s].b*t)+","+(i[s].a+r[s].a*t)+")");else for(s=0;s<o;s++)a.push((i[s]||0)+r[s]*t);else a=-1!==Jt.indexOf(e)?"rgba("+Math.round(i.r+r.r*t)+","+Math.round(i.g+r.g*t)+","+Math.round(i.b+r.b*t)+","+(i.a+r.a*t)+")":i+r*t;l.setAttr(e,a)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var t=this.node,e=ee.attrs[t._id][this._id];e.points&&e.points.trueEnd&&t.setAttr("points",e.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var t=this.node,e=ee.attrs[t._id][this._id];e.points&&e.points.trueStart&&t.points(e.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(t){return this.tween.seek(1e3*t),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var t,e=this.node._id,n=this._id,i=ee.tweens[e];for(t in this.pause(),i)delete ee.tweens[e][t];delete ee.attrs[e][n]}}ee.attrs={},ee.tweens={},Q.prototype.to=function(t){var e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()},new ee(t).play()};const ne={BackEaseIn(t,e,n,i){var r=1.70158;return n*(t/=i)*t*((r+1)*t-r)+e},BackEaseOut(t,e,n,i){var r=1.70158;return n*((t=t/i-1)*t*((r+1)*t+r)+1)+e},BackEaseInOut(t,e,n,i){var r=1.70158;return(t/=i/2)<1?n/2*(t*t*((1+(r*=1.525))*t-r))+e:n/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},ElasticEaseIn(t,e,n,i,r,a){var s=0;return 0===t?e:1==(t/=i)?e+n:(a||(a=.3*i),!r||r<Math.abs(n)?(r=n,s=a/4):s=a/(2*Math.PI)*Math.asin(n/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*(2*Math.PI)/a)+e)},ElasticEaseOut(t,e,n,i,r,a){var s=0;return 0===t?e:1==(t/=i)?e+n:(a||(a=.3*i),!r||r<Math.abs(n)?(r=n,s=a/4):s=a/(2*Math.PI)*Math.asin(n/r),r*Math.pow(2,-10*t)*Math.sin((t*i-s)*(2*Math.PI)/a)+n+e)},ElasticEaseInOut(t,e,n,i,r,a){var s=0;return 0===t?e:2==(t/=i/2)?e+n:(a||(a=i*(.3*1.5)),!r||r<Math.abs(n)?(r=n,s=a/4):s=a/(2*Math.PI)*Math.asin(n/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*(2*Math.PI)/a)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*(2*Math.PI)/a)*.5+n+e)},BounceEaseOut:(t,e,n,i)=>(t/=i)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e,BounceEaseIn:(t,e,n,i)=>n-ne.BounceEaseOut(i-t,0,n,i)+e,BounceEaseInOut:(t,e,n,i)=>t<i/2?.5*ne.BounceEaseIn(2*t,0,n,i)+e:.5*ne.BounceEaseOut(2*t-i,0,n,i)+.5*n+e,EaseIn:(t,e,n,i)=>n*(t/=i)*t+e,EaseOut:(t,e,n,i)=>-n*(t/=i)*(t-2)+e,EaseInOut:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e,StrongEaseIn:(t,e,n,i)=>n*(t/=i)*t*t*t*t+e,StrongEaseOut:(t,e,n,i)=>n*((t=t/i-1)*t*t*t*t+1)+e,StrongEaseInOut:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e,Linear:(t,e,n,i)=>n*t/i+e},ie=p._assign(a,{Util:p,Transform:o,Node:Q,Container:tt,Stage:Lt,stages:Dt,Layer:Ut,FastLayer:Yt,Group:Xt,DD:G,Shape:zt,shapes:Bt,Animation:$t,Tween:ee,Easings:ne,Context:A,Canvas:D});class re extends zt{_sceneFunc(t){var e=a.getAngle(this.angle()),n=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,n),t.arc(0,0,this.innerRadius(),e,0,!n),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}getSelfRect(){const t=this.outerRadius(),e=Math.PI/180,n=1*e;let i=0,r=this.angle()*e+n;this.clockwise()&&(r,r=360);const a=[],s=[];for(let t=0;t<r;t+=n)a.push(Math.cos(t)),s.push(Math.sin(t));const o=Math.round(t*Math.min(...a)),h=Math.round(t*Math.max(...a)),l=Math.round(t*Math.min(...s));return{x:o||0,y:l||0,width:h-o,height:Math.round(t*Math.max(...s))-l}}}function ae(t,e,n,i,r,a,s){var o=Math.sqrt(Math.pow(n-t,2)+Math.pow(i-e,2)),h=Math.sqrt(Math.pow(r-n,2)+Math.pow(a-i,2)),l=s*o/(o+h),c=s*h/(o+h);return[n-l*(r-t),i-l*(a-e),n+c*(r-t),i+c*(a-e)]}function se(t,e){var n,i,r=t.length,a=[];for(n=2;n<r-2;n+=2)i=ae(t[n-2],t[n-1],t[n],t[n+1],t[n+2],t[n+3],e),isNaN(i[0])||(a.push(i[0]),a.push(i[1]),a.push(t[n]),a.push(t[n+1]),a.push(i[2]),a.push(i[3]));return a}re.prototype._centroid=!0,re.prototype.className="Arc",re.prototype._attrsAffectingSize=["innerRadius","outerRadius"],s(re),P.addGetterSetter(re,"innerRadius",0,m()),P.addGetterSetter(re,"outerRadius",0,m()),P.addGetterSetter(re,"angle",0,m()),P.addGetterSetter(re,"clockwise",!1,x());class oe extends zt{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",(function(){this._clearCache("tensionPoints")}))}_sceneFunc(t){var e,n,i,r=this.points(),a=r.length,s=this.tension(),o=this.closed(),h=this.bezier();if(a){if(t.beginPath(),t.moveTo(r[0],r[1]),0!==s&&a>4){for(n=(e=this.getTensionPoints()).length,i=o?0:4,o||t.quadraticCurveTo(e[0],e[1],e[2],e[3]);i<n-2;)t.bezierCurveTo(e[i++],e[i++],e[i++],e[i++],e[i++],e[i++]);o||t.quadraticCurveTo(e[n-2],e[n-1],r[a-2],r[a-1])}else if(h)for(i=2;i<a;)t.bezierCurveTo(r[i++],r[i++],r[i++],r[i++],r[i++],r[i++]);else for(i=2;i<a;i+=2)t.lineTo(r[i],r[i+1]);o?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():se(this.points(),this.tension())}_getTensionPointsClosed(){var t=this.points(),e=t.length,n=this.tension(),i=ae(t[e-2],t[e-1],t[0],t[1],t[2],t[3],n),r=ae(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],n),a=se(t,n);return[i[2],i[3]].concat(a).concat([r[0],r[1],t[e-2],t[e-1],r[2],r[3],i[0],i[1],t[0],t[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};for(var e,n,i=(t=0!==this.tension()?[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:this.points())[0],r=t[0],a=t[1],s=t[1],o=0;o<t.length/2;o++)e=t[2*o],n=t[2*o+1],i=Math.min(i,e),r=Math.max(r,e),a=Math.min(a,n),s=Math.max(s,n);return{x:i,y:a,width:r-i,height:s-a}}}oe.prototype.className="Line",oe.prototype._attrsAffectingSize=["points","bezier","tension"],s(oe),P.addGetterSetter(oe,"closed",!1),P.addGetterSetter(oe,"bezier",!1),P.addGetterSetter(oe,"tension",0,m()),P.addGetterSetter(oe,"points",[],function(){if(a.isUnminified)return function(t,e){return p._isArray(t)?t.forEach((function(t){p._isNumber(t)||p.warn('"'+e+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")})):p.warn(v(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.'),t}}());class he extends zt{constructor(t){super(t),this.dataArray=[],this.pathLength=0,this.dataArray=he.parsePathData(this.data()),this.pathLength=0;for(var e=0;e<this.dataArray.length;++e)this.pathLength+=this.dataArray[e].pathLength;this.on("dataChange.konva",(function(){this.dataArray=he.parsePathData(this.data()),this.pathLength=0;for(var t=0;t<this.dataArray.length;++t)this.pathLength+=this.dataArray[t].pathLength}))}_sceneFunc(t){var e=this.dataArray;t.beginPath();for(var n=!1,i=0;i<e.length;i++){var r=e[i].command,a=e[i].points;switch(r){case"L":t.lineTo(a[0],a[1]);break;case"M":t.moveTo(a[0],a[1]);break;case"C":t.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5]);break;case"Q":t.quadraticCurveTo(a[0],a[1],a[2],a[3]);break;case"A":var s=a[0],o=a[1],h=a[2],l=a[3],c=a[4],u=a[5],d=a[6],f=a[7],g=h>l?h:l,p=h>l?1:h/l,v=h>l?l/h:1;t.translate(s,o),t.rotate(d),t.scale(p,v),t.arc(0,0,g,c,c+u,1-f),t.scale(1/p,1/v),t.rotate(-d),t.translate(-s,-o);break;case"z":n=!0,t.closePath()}}n||this.hasFill()?t.fillStrokeShape(this):t.strokeShape(this)}getSelfRect(){var t=[];this.dataArray.forEach((function(e){if("A"===e.command){var n=e.points[4],i=e.points[5],r=e.points[4]+i,a=Math.PI/180;if(Math.abs(n-r)<a&&(a=Math.abs(n-r)),i<0)for(let i=n-a;i>r;i-=a){const n=he.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],i,0);t.push(n.x,n.y)}else for(let i=n+a;i<r;i+=a){const n=he.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],i,0);t.push(n.x,n.y)}}else if("C"===e.command)for(let n=0;n<=1;n+=.01){const i=he.getPointOnCubicBezier(n,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3],e.points[4],e.points[5]);t.push(i.x,i.y)}else t=t.concat(e.points)}));for(var e,n,i=t[0],r=t[0],a=t[1],s=t[1],o=0;o<t.length/2;o++)e=t[2*o],n=t[2*o+1],isNaN(e)||(i=Math.min(i,e),r=Math.max(r,e)),isNaN(n)||(a=Math.min(a,n),s=Math.max(s,n));return{x:Math.round(i),y:Math.round(a),width:Math.round(r-i),height:Math.round(s-a)}}getLength(){return this.pathLength}getPointAtLength(t){var e,n=0,i=this.dataArray.length;if(!i)return null;for(;n<i&&t>this.dataArray[n].pathLength;)t-=this.dataArray[n].pathLength,++n;if(n===i)return{x:(e=this.dataArray[n-1].points.slice(-2))[0],y:e[1]};if(t<.01)return{x:(e=this.dataArray[n].points.slice(0,2))[0],y:e[1]};var r=this.dataArray[n],a=r.points;switch(r.command){case"L":return he.getPointOnLine(t,r.start.x,r.start.y,a[0],a[1]);case"C":return he.getPointOnCubicBezier(t/r.pathLength,r.start.x,r.start.y,a[0],a[1],a[2],a[3],a[4],a[5]);case"Q":return he.getPointOnQuadraticBezier(t/r.pathLength,r.start.x,r.start.y,a[0],a[1],a[2],a[3]);case"A":var s=a[0],o=a[1],h=a[2],l=a[3],c=a[4],u=a[5],d=a[6];return c+=u*t/r.pathLength,he.getPointOnEllipticalArc(s,o,h,l,c,d)}return null}static getLineLength(t,e,n,i){return Math.sqrt((n-t)*(n-t)+(i-e)*(i-e))}static getPointOnLine(t,e,n,i,r,a,s){void 0===a&&(a=e),void 0===s&&(s=n);var o=(r-n)/(i-e+1e-8),h=Math.sqrt(t*t/(1+o*o));i<e&&(h*=-1);var l,c=o*h;if(i===e)l={x:a,y:s+c};else if((s-n)/(a-e+1e-8)===o)l={x:a+h,y:s+c};else{var u,d,f=this.getLineLength(e,n,i,r),g=(a-e)*(i-e)+(s-n)*(r-n);u=e+(g/=f*f)*(i-e),d=n+g*(r-n);var p=this.getLineLength(a,s,u,d),v=Math.sqrt(t*t-p*p);h=Math.sqrt(v*v/(1+o*o)),i<e&&(h*=-1),l={x:u+h,y:d+(c=o*h)}}return l}static getPointOnCubicBezier(t,e,n,i,r,a,s,o,h){function l(t){return t*t*t}function c(t){return 3*t*t*(1-t)}function u(t){return 3*t*(1-t)*(1-t)}function d(t){return(1-t)*(1-t)*(1-t)}return{x:o*l(t)+a*c(t)+i*u(t)+e*d(t),y:h*l(t)+s*c(t)+r*u(t)+n*d(t)}}static getPointOnQuadraticBezier(t,e,n,i,r,a,s){function o(t){return t*t}function h(t){return 2*t*(1-t)}function l(t){return(1-t)*(1-t)}return{x:a*o(t)+i*h(t)+e*l(t),y:s*o(t)+r*h(t)+n*l(t)}}static getPointOnEllipticalArc(t,e,n,i,r,a){var s=Math.cos(a),o=Math.sin(a),h=n*Math.cos(r),l=i*Math.sin(r);return{x:t+(h*s-l*o),y:e+(h*o+l*s)}}static parsePathData(t){if(!t)return[];var e=t,n=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var i=0;i<n.length;i++)e=e.replace(new RegExp(n[i],"g"),"|"+n[i]);var r,a=e.split("|"),s=[],o=[],h=0,l=0,c=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;for(i=1;i<a.length;i++){var u=a[i],d=u.charAt(0);for(u=u.slice(1),o.length=0;r=c.exec(u);)o.push(r[0]);for(var f=[],g=0,p=o.length;g<p;g++)if("00"!==o[g]){var v=parseFloat(o[g]);isNaN(v)?f.push(0):f.push(v)}else f.push(0,0);for(;f.length>0&&!isNaN(f[0]);){var y,m,_,b,k,S,x,w,C,P,M=null,E=[],T=h,A=l;switch(d){case"l":h+=f.shift(),l+=f.shift(),M="L",E.push(h,l);break;case"L":h=f.shift(),l=f.shift(),E.push(h,l);break;case"m":var O=f.shift(),I=f.shift();if(h+=O,l+=I,M="M",s.length>2&&"z"===s[s.length-1].command)for(var D=s.length-2;D>=0;D--)if("M"===s[D].command){h=s[D].points[0]+O,l=s[D].points[1]+I;break}E.push(h,l),d="l";break;case"M":h=f.shift(),l=f.shift(),M="M",E.push(h,l),d="L";break;case"h":h+=f.shift(),M="L",E.push(h,l);break;case"H":h=f.shift(),M="L",E.push(h,l);break;case"v":l+=f.shift(),M="L",E.push(h,l);break;case"V":l=f.shift(),M="L",E.push(h,l);break;case"C":E.push(f.shift(),f.shift(),f.shift(),f.shift()),h=f.shift(),l=f.shift(),E.push(h,l);break;case"c":E.push(h+f.shift(),l+f.shift(),h+f.shift(),l+f.shift()),h+=f.shift(),l+=f.shift(),M="C",E.push(h,l);break;case"S":m=h,_=l,"C"===(y=s[s.length-1]).command&&(m=h+(h-y.points[2]),_=l+(l-y.points[3])),E.push(m,_,f.shift(),f.shift()),h=f.shift(),l=f.shift(),M="C",E.push(h,l);break;case"s":m=h,_=l,"C"===(y=s[s.length-1]).command&&(m=h+(h-y.points[2]),_=l+(l-y.points[3])),E.push(m,_,h+f.shift(),l+f.shift()),h+=f.shift(),l+=f.shift(),M="C",E.push(h,l);break;case"Q":E.push(f.shift(),f.shift()),h=f.shift(),l=f.shift(),E.push(h,l);break;case"q":E.push(h+f.shift(),l+f.shift()),h+=f.shift(),l+=f.shift(),M="Q",E.push(h,l);break;case"T":m=h,_=l,"Q"===(y=s[s.length-1]).command&&(m=h+(h-y.points[0]),_=l+(l-y.points[1])),h=f.shift(),l=f.shift(),M="Q",E.push(m,_,h,l);break;case"t":m=h,_=l,"Q"===(y=s[s.length-1]).command&&(m=h+(h-y.points[0]),_=l+(l-y.points[1])),h+=f.shift(),l+=f.shift(),M="Q",E.push(m,_,h,l);break;case"A":b=f.shift(),k=f.shift(),S=f.shift(),x=f.shift(),w=f.shift(),C=h,P=l,h=f.shift(),l=f.shift(),M="A",E=this.convertEndpointToCenterParameterization(C,P,h,l,x,w,b,k,S);break;case"a":b=f.shift(),k=f.shift(),S=f.shift(),x=f.shift(),w=f.shift(),C=h,P=l,h+=f.shift(),l+=f.shift(),M="A",E=this.convertEndpointToCenterParameterization(C,P,h,l,x,w,b,k,S)}s.push({command:M||d,points:E,start:{x:T,y:A},pathLength:this.calcLength(T,A,M||d,E)})}"z"!==d&&"Z"!==d||s.push({command:"z",points:[],start:void 0,pathLength:0})}return s}static calcLength(t,e,n,i){var r,a,s,o,h=he;switch(n){case"L":return h.getLineLength(t,e,i[0],i[1]);case"C":for(r=0,a=h.getPointOnCubicBezier(0,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),o=.01;o<=1;o+=.01)s=h.getPointOnCubicBezier(o,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),r+=h.getLineLength(a.x,a.y,s.x,s.y),a=s;return r;case"Q":for(r=0,a=h.getPointOnQuadraticBezier(0,t,e,i[0],i[1],i[2],i[3]),o=.01;o<=1;o+=.01)s=h.getPointOnQuadraticBezier(o,t,e,i[0],i[1],i[2],i[3]),r+=h.getLineLength(a.x,a.y,s.x,s.y),a=s;return r;case"A":r=0;var l=i[4],c=i[5],u=i[4]+c,d=Math.PI/180;if(Math.abs(l-u)<d&&(d=Math.abs(l-u)),a=h.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],l,0),c<0)for(o=l-d;o>u;o-=d)s=h.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],o,0),r+=h.getLineLength(a.x,a.y,s.x,s.y),a=s;else for(o=l+d;o<u;o+=d)s=h.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],o,0),r+=h.getLineLength(a.x,a.y,s.x,s.y),a=s;return s=h.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),r+h.getLineLength(a.x,a.y,s.x,s.y)}return 0}static convertEndpointToCenterParameterization(t,e,n,i,r,a,s,o,h){var l=h*(Math.PI/180),c=Math.cos(l)*(t-n)/2+Math.sin(l)*(e-i)/2,u=-1*Math.sin(l)*(t-n)/2+Math.cos(l)*(e-i)/2,d=c*c/(s*s)+u*u/(o*o);d>1&&(s*=Math.sqrt(d),o*=Math.sqrt(d));var f=Math.sqrt((s*s*(o*o)-s*s*(u*u)-o*o*(c*c))/(s*s*(u*u)+o*o*(c*c)));r===a&&(f*=-1),isNaN(f)&&(f=0);var g=f*s*u/o,p=f*-o*c/s,v=(t+n)/2+Math.cos(l)*g-Math.sin(l)*p,y=(e+i)/2+Math.sin(l)*g+Math.cos(l)*p,m=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},_=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(m(t)*m(e))},b=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(_(t,e))},k=b([1,0],[(c-g)/s,(u-p)/o]),S=[(c-g)/s,(u-p)/o],x=[(-1*c-g)/s,(-1*u-p)/o],w=b(S,x);return _(S,x)<=-1&&(w=Math.PI),_(S,x)>=1&&(w=0),0===a&&w>0&&(w-=2*Math.PI),1===a&&w<0&&(w+=2*Math.PI),[v,y,s,o,k,w,l,a]}}he.prototype.className="Path",he.prototype._attrsAffectingSize=["data"],s(he),P.addGetterSetter(he,"data");class le extends oe{_sceneFunc(t){super._sceneFunc(t);var e=2*Math.PI,n=this.points(),i=n,r=0!==this.tension()&&n.length>4;r&&(i=this.getTensionPoints());var a,s,o=this.pointerLength(),h=n.length;if(r){const t=[i[i.length-4],i[i.length-3],i[i.length-2],i[i.length-1],n[h-2],n[h-1]],e=he.calcLength(i[i.length-4],i[i.length-3],"C",t),r=he.getPointOnQuadraticBezier(Math.min(1,1-o/e),t[0],t[1],t[2],t[3],t[4],t[5]);a=n[h-2]-r.x,s=n[h-1]-r.y}else a=n[h-2]-n[h-4],s=n[h-1]-n[h-3];var l=(Math.atan2(s,a)+e)%e,c=this.pointerWidth();this.pointerAtEnding()&&(t.save(),t.beginPath(),t.translate(n[h-2],n[h-1]),t.rotate(l),t.moveTo(0,0),t.lineTo(-o,c/2),t.lineTo(-o,-c/2),t.closePath(),t.restore(),this.__fillStroke(t)),this.pointerAtBeginning()&&(t.save(),t.beginPath(),t.translate(n[0],n[1]),r?(a=(i[0]+i[2])/2-n[0],s=(i[1]+i[3])/2-n[1]):(a=n[2]-n[0],s=n[3]-n[1]),t.rotate((Math.atan2(-s,-a)+e)%e),t.moveTo(0,0),t.lineTo(-o,c/2),t.lineTo(-o,-c/2),t.closePath(),t.restore(),this.__fillStroke(t))}__fillStroke(t){var e=this.dashEnabled();e&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),e&&(this.attrs.dashEnabled=!0)}getSelfRect(){const t=super.getSelfRect(),e=this.pointerWidth()/2;return{x:t.x-e,y:t.y-e,width:t.width+2*e,height:t.height+2*e}}}le.prototype.className="Arrow",s(le),P.addGetterSetter(le,"pointerLength",10,m()),P.addGetterSetter(le,"pointerWidth",10,m()),P.addGetterSetter(le,"pointerAtBeginning",!1),P.addGetterSetter(le,"pointerAtEnding",!0);class ce extends zt{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.attrs.radius||0,0,2*Math.PI,!1),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius()!==t/2&&this.radius(t/2)}setHeight(t){this.radius()!==t/2&&this.radius(t/2)}}ce.prototype._centroid=!0,ce.prototype.className="Circle",ce.prototype._attrsAffectingSize=["radius"],s(ce),P.addGetterSetter(ce,"radius",0,m());class ue extends zt{_sceneFunc(t){var e=this.radiusX(),n=this.radiusY();t.beginPath(),t.save(),e!==n&&t.scale(1,n/e),t.arc(0,0,e,0,2*Math.PI,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radiusX()}getHeight(){return 2*this.radiusY()}setWidth(t){this.radiusX(t/2)}setHeight(t){this.radiusY(t/2)}}ue.prototype.className="Ellipse",ue.prototype._centroid=!0,ue.prototype._attrsAffectingSize=["radiusX","radiusY"],s(ue),P.addComponentsGetterSetter(ue,"radius",["x","y"]),P.addGetterSetter(ue,"radiusX",0,m()),P.addGetterSetter(ue,"radiusY",0,m());class de extends zt{constructor(t){super(t),this.on("imageChange.konva",(()=>{this._setImageLoad()})),this._setImageLoad()}_setImageLoad(){const t=this.image();t&&t.complete||t&&4===t.readyState||t&&t.addEventListener&&t.addEventListener("load",(()=>{this._requestDraw()}))}_useBufferCanvas(){return super._useBufferCanvas(!0)}_sceneFunc(t){const e=this.getWidth(),n=this.getHeight(),i=this.attrs.image;let r;if(i){const t=this.attrs.cropWidth,a=this.attrs.cropHeight;r=t&&a?[i,this.cropX(),this.cropY(),t,a,0,0,e,n]:[i,0,0,e,n]}(this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)),i&&t.drawImage.apply(t,r)}_hitFunc(t){var e=this.width(),n=this.height();t.beginPath(),t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return null!==(t=this.attrs.width)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.width}getHeight(){var t,e;return null!==(t=this.attrs.height)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.height}static fromURL(t,e){var n=p.createImageElement();n.onload=function(){var t=new de({image:n});e(t)},n.crossOrigin="Anonymous",n.src=t}}de.prototype.className="Image",s(de),P.addGetterSetter(de,"image"),P.addComponentsGetterSetter(de,"crop",["x","y","width","height"]),P.addGetterSetter(de,"cropX",0,m()),P.addGetterSetter(de,"cropY",0,m()),P.addGetterSetter(de,"cropWidth",0,m()),P.addGetterSetter(de,"cropHeight",0,m());var fe=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height"],ge="up",pe="right",ve="down",ye="left",me=fe.length;class _e extends Xt{constructor(t){super(t),this.on("add.konva",(function(t){this._addListeners(t.child),this._sync()}))}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(t){var e,n=this,i=function(){n._sync()};for(e=0;e<me;e++)t.on(fe[e]+"Change.konva",i)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var t,e,n,i,r,a,s,o=this.getText(),h=this.getTag();if(o&&h){switch(t=o.width(),e=o.height(),n=h.pointerDirection(),i=h.pointerWidth(),s=h.pointerHeight(),r=0,a=0,n){case ge:r=t/2,a=-1*s;break;case pe:r=t+i,a=e/2;break;case ve:r=t/2,a=e+s;break;case ye:r=-1*i,a=e/2}h.setAttrs({x:-1*r,y:-1*a,width:t,height:e}),o.setAttrs({x:-1*r,y:-1*a})}}}_e.prototype.className="Label",s(_e);class be extends zt{_sceneFunc(t){var e=this.width(),n=this.height(),i=this.pointerDirection(),r=this.pointerWidth(),a=this.pointerHeight(),s=this.cornerRadius();let o=0,h=0,l=0,c=0;"number"==typeof s?o=h=l=c=Math.min(s,e/2,n/2):(o=Math.min(s[0]||0,e/2,n/2),h=Math.min(s[1]||0,e/2,n/2),c=Math.min(s[2]||0,e/2,n/2),l=Math.min(s[3]||0,e/2,n/2)),t.beginPath(),t.moveTo(o,0),i===ge&&(t.lineTo((e-r)/2,0),t.lineTo(e/2,-1*a),t.lineTo((e+r)/2,0)),t.lineTo(e-h,0),t.arc(e-h,h,h,3*Math.PI/2,0,!1),i===pe&&(t.lineTo(e,(n-a)/2),t.lineTo(e+r,n/2),t.lineTo(e,(n+a)/2)),t.lineTo(e,n-c),t.arc(e-c,n-c,c,0,Math.PI/2,!1),i===ve&&(t.lineTo((e+r)/2,n),t.lineTo(e/2,n+a),t.lineTo((e-r)/2,n)),t.lineTo(l,n),t.arc(l,n-l,l,Math.PI/2,Math.PI,!1),i===ye&&(t.lineTo(0,(n+a)/2),t.lineTo(-1*r,n/2),t.lineTo(0,(n-a)/2)),t.lineTo(0,o),t.arc(o,o,o,Math.PI,3*Math.PI/2,!1),t.closePath(),t.fillStrokeShape(this)}getSelfRect(){var t=0,e=0,n=this.pointerWidth(),i=this.pointerHeight(),r=this.pointerDirection(),a=this.width(),s=this.height();return r===ge?(e-=i,s+=i):r===ve?s+=i:r===ye?(t-=1.5*n,a+=n):r===pe&&(a+=1.5*n),{x:t,y:e,width:a,height:s}}}be.prototype.className="Tag",s(be),P.addGetterSetter(be,"pointerDirection","none"),P.addGetterSetter(be,"pointerWidth",0,m()),P.addGetterSetter(be,"pointerHeight",0,m()),P.addGetterSetter(be,"cornerRadius",0,_(4));class ke extends zt{_sceneFunc(t){var e=this.cornerRadius(),n=this.width(),i=this.height();if(t.beginPath(),e){let r=0,a=0,s=0,o=0;"number"==typeof e?r=a=s=o=Math.min(e,n/2,i/2):(r=Math.min(e[0]||0,n/2,i/2),a=Math.min(e[1]||0,n/2,i/2),o=Math.min(e[2]||0,n/2,i/2),s=Math.min(e[3]||0,n/2,i/2)),t.moveTo(r,0),t.lineTo(n-a,0),t.arc(n-a,a,a,3*Math.PI/2,0,!1),t.lineTo(n,i-o),t.arc(n-o,i-o,o,0,Math.PI/2,!1),t.lineTo(s,i),t.arc(s,i-s,s,Math.PI/2,Math.PI,!1),t.lineTo(0,r),t.arc(r,r,r,Math.PI,3*Math.PI/2,!1)}else t.rect(0,0,n,i);t.closePath(),t.fillStrokeShape(this)}}ke.prototype.className="Rect",s(ke),P.addGetterSetter(ke,"cornerRadius",0,_(4));class Se extends zt{_sceneFunc(t){const e=this._getPoints();t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)t.lineTo(e[n].x,e[n].y);t.closePath(),t.fillStrokeShape(this)}_getPoints(){const t=this.attrs.sides,e=this.attrs.radius||0,n=[];for(var i=0;i<t;i++)n.push({x:e*Math.sin(2*i*Math.PI/t),y:-1*e*Math.cos(2*i*Math.PI/t)});return n}getSelfRect(){const t=this._getPoints();var e=t[0].x,n=t[0].y,i=t[0].x,r=t[0].y;return t.forEach((t=>{e=Math.min(e,t.x),n=Math.max(n,t.x),i=Math.min(i,t.y),r=Math.max(r,t.y)})),{x:e,y:i,width:n-e,height:r-i}}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}Se.prototype.className="RegularPolygon",Se.prototype._centroid=!0,Se.prototype._attrsAffectingSize=["radius"],s(Se),P.addGetterSetter(Se,"radius",0,m()),P.addGetterSetter(Se,"sides",0,m());var xe=2*Math.PI;class we extends zt{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,xe,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),xe,0,!0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}we.prototype.className="Ring",we.prototype._centroid=!0,we.prototype._attrsAffectingSize=["innerRadius","outerRadius"],s(we),P.addGetterSetter(we,"innerRadius",0,m()),P.addGetterSetter(we,"outerRadius",0,m());class Ce extends zt{constructor(t){super(t),this._updated=!0,this.anim=new $t((()=>{var t=this._updated;return this._updated=!1,t})),this.on("animationChange.konva",(function(){this.frameIndex(0)})),this.on("frameIndexChange.konva",(function(){this._updated=!0})),this.on("frameRateChange.konva",(function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}))}_sceneFunc(t){var e=this.animation(),n=this.frameIndex(),i=4*n,r=this.animations()[e],a=this.frameOffsets(),s=r[i+0],o=r[i+1],h=r[i+2],l=r[i+3],c=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,h,l),t.closePath(),t.fillStrokeShape(this)),c)if(a){var u=a[e],d=2*n;t.drawImage(c,s,o,h,l,u[d+0],u[d+1],h,l)}else t.drawImage(c,s,o,h,l,0,0,h,l)}_hitFunc(t){var e=this.animation(),n=this.frameIndex(),i=4*n,r=this.animations()[e],a=this.frameOffsets(),s=r[i+2],o=r[i+3];if(t.beginPath(),a){var h=a[e],l=2*n;t.rect(h[l+0],h[l+1],s,o)}else t.rect(0,0,s,o);t.closePath(),t.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){var t=this;this.interval=setInterval((function(){t._updateIndex()}),1e3/this.frameRate())}start(){if(!this.isRunning()){var t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){var t=this.frameIndex(),e=this.animation();t<this.animations()[e].length/4-1?this.frameIndex(t+1):this.frameIndex(0)}}Ce.prototype.className="Sprite",s(Ce),P.addGetterSetter(Ce,"animation"),P.addGetterSetter(Ce,"animations"),P.addGetterSetter(Ce,"frameOffsets"),P.addGetterSetter(Ce,"image"),P.addGetterSetter(Ce,"frameIndex",0,m()),P.addGetterSetter(Ce,"frameRate",17,m()),P.backCompat(Ce,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});class Pe extends zt{_sceneFunc(t){var e=this.innerRadius(),n=this.outerRadius(),i=this.numPoints();t.beginPath(),t.moveTo(0,0-n);for(var r=1;r<2*i;r++){var a=r%2==0?n:e,s=a*Math.sin(r*Math.PI/i),o=-1*a*Math.cos(r*Math.PI/i);t.lineTo(s,o)}t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}function Me(t){return Array.from(t)}Pe.prototype.className="Star",Pe.prototype._centroid=!0,Pe.prototype._attrsAffectingSize=["innerRadius","outerRadius"],s(Pe),P.addGetterSetter(Pe,"numPoints",5,m()),P.addGetterSetter(Pe,"innerRadius",0,m()),P.addGetterSetter(Pe,"outerRadius",0,m());var Ee,Te="auto",Ae="justify",Oe="left",Ie="middle",De="normal",Le=" ",Re=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Ge=Re.length;function Ke(){return Ee||(Ee=p.createCanvasElement().getContext("2d"))}class Fe extends zt{constructor(t){super(function(t){return(t=t||{}).fillLinearGradientColorStops||t.fillRadialGradientColorStops||t.fillPatternImage||(t.fill=t.fill||"black"),t}(t)),this._partialTextX=0,this._partialTextY=0;for(var e=0;e<Ge;e++)this.on(Re[e]+"Change.konva",this._setTextData);this._setTextData()}_sceneFunc(t){var e=this.textArr,n=e.length;if(this.text()){var i,r=this.padding(),a=this.fontSize(),s=this.lineHeight()*a,o=this.verticalAlign(),h=0,l=this.align(),c=this.getWidth(),u=this.letterSpacing(),d=this.fill(),f=this.textDecoration(),g=-1!==f.indexOf("underline"),p=-1!==f.indexOf("line-through"),v=0,y=(v=s/2,0),m=0;for(t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",Ie),t.setAttr("textAlign",Oe),o===Ie?h=(this.getHeight()-n*s-2*r)/2:"bottom"===o&&(h=this.getHeight()-n*s-2*r),t.translate(r,h+r),i=0;i<n;i++){y=0,m=0;var _,b,k,S=e[i],x=S.text,w=S.width,C=i!==n-1;if(t.save(),"right"===l?y+=c-w-2*r:"center"===l&&(y+=(c-w-2*r)/2),g&&(t.save(),t.beginPath(),t.moveTo(y,v+m+Math.round(a/2)),b=0==(_=x.split(" ").length-1),k=l===Ae&&C&&!b?c-2*r:w,t.lineTo(y+Math.round(k),v+m+Math.round(a/2)),t.lineWidth=a/15,t.strokeStyle=d,t.stroke(),t.restore()),p&&(t.save(),t.beginPath(),t.moveTo(y,v+m),b=0==(_=x.split(" ").length-1),k=l===Ae&&C&&!b?c-2*r:w,t.lineTo(y+Math.round(k),v+m),t.lineWidth=a/15,t.strokeStyle=d,t.stroke(),t.restore()),0!==u||l===Ae){_=x.split(" ").length-1;for(var P=Me(x),M=0;M<P.length;M++){var E=P[M];" "===E&&i!==n-1&&l===Ae&&(y+=(c-2*r-w)/_),this._partialTextX=y,this._partialTextY=v+m,this._partialText=E,t.fillStrokeShape(this),y+=this.measureSize(E).width+u}}else this._partialTextX=y,this._partialTextY=v+m,this._partialText=x,t.fillStrokeShape(this);t.restore(),n>1&&(v+=s)}}}_hitFunc(t){var e=this.getWidth(),n=this.getHeight();t.beginPath(),t.rect(0,0,e,n),t.closePath(),t.fillStrokeShape(this)}setText(t){var e=p._isString(t)?t:null==t?"":t+"";return this._setAttr("text",e),this}getWidth(){return this.attrs.width===Te||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width}getHeight(){return this.attrs.height===Te||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return p.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e,n=Ke(),i=this.fontSize();return n.save(),n.font=this._getContextFont(),e=n.measureText(t),n.restore(),{width:e.width,height:i}}_getContextFont(){return this.fontStyle()+Le+this.fontVariant()+Le+(this.fontSize()+"px ")+this.fontFamily().split(",").map((t=>{const e=(t=t.trim()).indexOf(" ")>=0,n=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!n&&(t=`"${t}"`),t})).join(", ")}_addTextLine(t){this.align()===Ae&&(t=t.trim());var e=this._getTextWidth(t);return this.textArr.push({text:t,width:e})}_getTextWidth(t){var e=this.letterSpacing(),n=t.length;return Ke().measureText(t).width+(n?e*(n-1):0)}_setTextData(){var t=this.text().split("\n"),e=+this.fontSize(),n=0,i=this.lineHeight()*e,r=this.attrs.width,a=this.attrs.height,s=r!==Te&&void 0!==r,o=a!==Te&&void 0!==a,h=this.padding(),l=r-2*h,c=a-2*h,u=0,d=this.wrap(),f="none"!==d,g="char"!==d&&f,p=this.ellipsis();this.textArr=[],Ke().font=this._getContextFont();for(var v=p?this._getTextWidth("…"):0,y=0,m=t.length;y<m;++y){var _=t[y],b=this._getTextWidth(_);if(s&&b>l)for(;_.length>0;){for(var k=0,S=_.length,x="",w=0;k<S;){var C=k+S>>>1,P=_.slice(0,C+1),M=this._getTextWidth(P)+v;M<=l?(k=C+1,x=P,w=M):S=C}if(!x)break;if(g){var E,T=_[x.length];(E=(T===Le||"-"===T)&&w<=l?x.length:Math.max(x.lastIndexOf(Le),x.lastIndexOf("-"))+1)>0&&(k=E,x=x.slice(0,k),w=this._getTextWidth(x))}if(x=x.trimRight(),this._addTextLine(x),n=Math.max(n,w),u+=i,!f||o&&u+i>c){var A=this.textArr[this.textArr.length-1];A&&p&&(this._getTextWidth(A.text+"…")<l||(A.text=A.text.slice(0,A.text.length-3)),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(A.text+"…"));break}if((_=(_=_.slice(k)).trimLeft()).length>0&&(b=this._getTextWidth(_))<=l){this._addTextLine(_),u+=i,n=Math.max(n,b);break}}else this._addTextLine(_),u+=i,n=Math.max(n,b);if(o&&u+i>c)break}this.textHeight=e,this.textWidth=n}getStrokeScaleEnabled(){return!0}}Fe.prototype._fillFunc=function(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)},Fe.prototype._strokeFunc=function(t){t.strokeText(this._partialText,this._partialTextX,this._partialTextY)},Fe.prototype.className="Text",Fe.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],s(Fe),P.overWriteSetter(Fe,"width",b()),P.overWriteSetter(Fe,"height",b()),P.addGetterSetter(Fe,"fontFamily","Arial"),P.addGetterSetter(Fe,"fontSize",12,m()),P.addGetterSetter(Fe,"fontStyle",De),P.addGetterSetter(Fe,"fontVariant",De),P.addGetterSetter(Fe,"padding",0,m()),P.addGetterSetter(Fe,"align",Oe),P.addGetterSetter(Fe,"verticalAlign","top"),P.addGetterSetter(Fe,"lineHeight",1,m()),P.addGetterSetter(Fe,"wrap","word"),P.addGetterSetter(Fe,"ellipsis",!1,x()),P.addGetterSetter(Fe,"letterSpacing",0,m()),P.addGetterSetter(Fe,"text","",k()),P.addGetterSetter(Fe,"textDecoration","");var He="normal";function Ne(t){t.fillText(this.partialText,0,0)}function je(t){t.strokeText(this.partialText,0,0)}class Be extends zt{constructor(t){super(t),this.dummyCanvas=p.createCanvasElement(),this.dataArray=[],this.dataArray=he.parsePathData(this.attrs.data),this.on("dataChange.konva",(function(){this.dataArray=he.parsePathData(this.attrs.data),this._setTextData()})),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva",this._setTextData),this._setTextData()}_sceneFunc(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();var e=this.textDecoration(),n=this.fill(),i=this.fontSize(),r=this.glyphInfo;"underline"===e&&t.beginPath();for(var a=0;a<r.length;a++){t.save();var s=r[a].p0;t.translate(s.x,s.y),t.rotate(r[a].rotation),this.partialText=r[a].text,t.fillStrokeShape(this),"underline"===e&&(0===a&&t.moveTo(0,i/2+1),t.lineTo(i,i/2+1)),t.restore()}"underline"===e&&(t.strokeStyle=n,t.lineWidth=i/20,t.stroke()),t.restore()}_hitFunc(t){t.beginPath();var e=this.glyphInfo;if(e.length>=1){var n=e[0].p0;t.moveTo(n.x,n.y)}for(var i=0;i<e.length;i++){var r=e[i].p1;t.lineTo(r.x,r.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return p.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(t){return Fe.prototype.setText.call(this,t)}_getContextFont(){return Fe.prototype._getContextFont.call(this)}_getTextSize(t){var e=this.dummyCanvas.getContext("2d");e.save(),e.font=this._getContextFont();var n=e.measureText(t);return e.restore(),{width:n.width,height:parseInt(this.attrs.fontSize,10)}}_setTextData(){var t=this,e=this._getTextSize(this.attrs.text),n=this.letterSpacing(),i=this.align(),r=this.kerningFunc();this.textWidth=e.width,this.textHeight=e.height;var a=Math.max(this.textWidth+((this.attrs.text||"").length-1)*n,0);this.glyphInfo=[];for(var s=0,o=0;o<t.dataArray.length;o++)t.dataArray[o].pathLength>0&&(s+=t.dataArray[o].pathLength);var h=0;"center"===i&&(h=Math.max(0,s/2-a/2)),"right"===i&&(h=Math.max(0,s-a));for(var l,c,u,d=Me(this.text()),f=this.text().split(" ").length-1,g=-1,p=0,v=function(){p=0;for(var e=t.dataArray,n=g+1;n<e.length;n++){if(e[n].pathLength>0)return g=n,e[n];"M"===e[n].command&&(l={x:e[n].points[0],y:e[n].points[1]})}return{}},y=function(e){var r=t._getTextSize(e).width+n;" "===e&&"justify"===i&&(r+=(s-a)/f);var o=0,h=0;for(c=void 0;Math.abs(r-o)/r>.01&&h<20;){h++;for(var d=o;void 0===u;)(u=v())&&d+u.pathLength<r&&(d+=u.pathLength,u=void 0);if(u==={}||void 0===l)return;var g=!1;switch(u.command){case"L":he.getLineLength(l.x,l.y,u.points[0],u.points[1])>r?c=he.getPointOnLine(r,l.x,l.y,u.points[0],u.points[1],l.x,l.y):u=void 0;break;case"A":var y=u.points[4],m=u.points[5],_=u.points[4]+m;0===p?p=y+1e-8:r>o?p+=Math.PI/180*m/Math.abs(m):p-=Math.PI/360*m/Math.abs(m),(m<0&&p<_||m>=0&&p>_)&&(p=_,g=!0),c=he.getPointOnEllipticalArc(u.points[0],u.points[1],u.points[2],u.points[3],p,u.points[6]);break;case"C":0===p?p=r>u.pathLength?1e-8:r/u.pathLength:r>o?p+=(r-o)/u.pathLength/2:p=Math.max(p-(o-r)/u.pathLength/2,0),p>1&&(p=1,g=!0),c=he.getPointOnCubicBezier(p,u.start.x,u.start.y,u.points[0],u.points[1],u.points[2],u.points[3],u.points[4],u.points[5]);break;case"Q":0===p?p=r/u.pathLength:r>o?p+=(r-o)/u.pathLength:p-=(o-r)/u.pathLength,p>1&&(p=1,g=!0),c=he.getPointOnQuadraticBezier(p,u.start.x,u.start.y,u.points[0],u.points[1],u.points[2],u.points[3])}void 0!==c&&(o=he.getLineLength(l.x,l.y,c.x,c.y)),g&&(g=!1,u=void 0)}},m=h/(t._getTextSize("C").width+n)-1,_=0;_<m&&(y("C"),void 0!==l&&void 0!==c);_++)l=c;for(var b=0;b<d.length&&(y(d[b]),void 0!==l&&void 0!==c);b++){var k=he.getLineLength(l.x,l.y,c.x,c.y),S=0;if(r)try{S=r(d[b-1],d[b])*this.fontSize()}catch(t){S=0}l.x+=S,c.x+=S,this.textWidth+=S;var x=he.getPointOnLine(S+k/2,l.x,l.y,c.x,c.y),w=Math.atan2(c.y-l.y,c.x-l.x);this.glyphInfo.push({transposeX:x.x,transposeY:x.y,text:d[b],rotation:w,p0:l,p1:c}),l=c}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var t=[];this.glyphInfo.forEach((function(e){t.push(e.p0.x),t.push(e.p0.y),t.push(e.p1.x),t.push(e.p1.y)}));for(var e,n,i=t[0]||0,r=t[0]||0,a=t[1]||0,s=t[1]||0,o=0;o<t.length/2;o++)e=t[2*o],n=t[2*o+1],i=Math.min(i,e),r=Math.max(r,e),a=Math.min(a,n),s=Math.max(s,n);var h=this.fontSize();return{x:i-h/2,y:a-h/2,width:r-i+h,height:s-a+h}}}Be.prototype._fillFunc=Ne,Be.prototype._strokeFunc=je,Be.prototype._fillFuncHit=Ne,Be.prototype._strokeFuncHit=je,Be.prototype.className="TextPath",Be.prototype._attrsAffectingSize=["text","fontSize","data"],s(Be),P.addGetterSetter(Be,"data"),P.addGetterSetter(Be,"fontFamily","Arial"),P.addGetterSetter(Be,"fontSize",12,m()),P.addGetterSetter(Be,"fontStyle",He),P.addGetterSetter(Be,"align","left"),P.addGetterSetter(Be,"letterSpacing",0,m()),P.addGetterSetter(Be,"textBaseline","middle"),P.addGetterSetter(Be,"fontVariant",He),P.addGetterSetter(Be,"text",""),P.addGetterSetter(Be,"textDecoration",null),P.addGetterSetter(Be,"kerningFunc",null);var ze=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange"].map((t=>t+".tr-konva")).join(" "),We="nodesRect",qe=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],Ue={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135};const Ye="ontouchstart"in a._global;var Xe=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function Ve(t,e,n){const i=n.x+(t.x-n.x)*Math.cos(e)-(t.y-n.y)*Math.sin(e),r=n.y+(t.x-n.x)*Math.sin(e)+(t.y-n.y)*Math.cos(e);return Object.assign(Object.assign({},t),{rotation:t.rotation+e,x:i,y:r})}class $e extends Xt{constructor(t){super(t),this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(ze,this.update),this.getNode()&&this.update()}attachTo(t){return this.setNode(t),this}setNode(t){return p.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return"tr-konva"+this._id}setNodes(t=[]){return this._nodes&&this._nodes.length&&this.detach(),this._nodes=t,1===t.length&&this.useSingleNodeRotation()?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach((t=>{const e=()=>{1===this.nodes().length&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),this._transforming||this.isDragging()||this.update()},n=t._attrsAffectingSize.map((t=>t+"Change."+this._getEventNamespace())).join(" ");t.on(n,e),t.on(qe.map((t=>t+`.${this._getEventNamespace()}`)).join(" "),e),t.on(`absoluteTransformChange.${this._getEventNamespace()}`,e),this._proxyDrag(t)})),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(t){let e;t.on(`dragstart.${this._getEventNamespace()}`,(n=>{e=t.getAbsolutePosition(),this.isDragging()||t===this.findOne(".back")||this.startDrag(n,!1)})),t.on(`dragmove.${this._getEventNamespace()}`,(n=>{if(!e)return;const i=t.getAbsolutePosition(),r=i.x-e.x,a=i.y-e.y;this.nodes().forEach((e=>{if(e===t)return;if(e.isDragging())return;const i=e.getAbsolutePosition();e.setAbsolutePosition({x:i.x+r,y:i.y+a}),e.startDrag(n)})),e=null}))}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach((t=>{t.off("."+this._getEventNamespace())})),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(We),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(We,this.__getNodeRect)}__getNodeShape(t,e=this.rotation(),n){var i=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),r=t.getAbsoluteScale(n),s=t.getAbsolutePosition(n),o=i.x*r.x-t.offsetX()*r.x,h=i.y*r.y-t.offsetY()*r.y;const l=(a.getAngle(t.getAbsoluteRotation())+2*Math.PI)%(2*Math.PI);return Ve({x:s.x+o*Math.cos(l)+h*Math.sin(-l),y:s.y+h*Math.cos(l)+o*Math.sin(l),width:i.width*r.x,height:i.height*r.y,rotation:l},-a.getAngle(e),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const t=[];this.nodes().map((e=>{const n=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var i=[{x:n.x,y:n.y},{x:n.x+n.width,y:n.y},{x:n.x+n.width,y:n.y+n.height},{x:n.x,y:n.y+n.height}],r=e.getAbsoluteTransform();i.forEach((function(e){var n=r.point(e);t.push(n)}))}));const e=new o;var n,i,r,s;e.rotate(-a.getAngle(this.rotation())),t.forEach((function(t){var a=e.point(t);void 0===n&&(n=r=a.x,i=s=a.y),n=Math.min(n,a.x),i=Math.min(i,a.y),r=Math.max(r,a.x),s=Math.max(s,a.y)})),e.invert();const h=e.point({x:n,y:i});return{x:h.x,y:h.y,width:r-n,height:s-i,rotation:a.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Xe.forEach(function(t){this._createAnchor(t)}.bind(this)),this._createAnchor("rotater")}_createAnchor(t){var e=new ke({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:Ye?10:"auto"}),n=this;e.on("mousedown touchstart",(function(t){n._handleMouseDown(t)})),e.on("dragstart",(t=>{e.stopDrag(),t.cancelBubble=!0})),e.on("dragend",(t=>{t.cancelBubble=!0})),e.on("mouseenter",(()=>{var n=a.getAngle(this.rotation()),i=function(t,e){if("rotater"===t)return"crosshair";e+=p.degToRad(Ue[t]||0);var n=(p.radToDeg(e)%360+360)%360;return p._inRange(n,337.5,360)||p._inRange(n,0,22.5)?"ns-resize":p._inRange(n,22.5,67.5)?"nesw-resize":p._inRange(n,67.5,112.5)?"ew-resize":p._inRange(n,112.5,157.5)?"nwse-resize":p._inRange(n,157.5,202.5)?"ns-resize":p._inRange(n,202.5,247.5)?"nesw-resize":p._inRange(n,247.5,292.5)?"ew-resize":p._inRange(n,292.5,337.5)?"nwse-resize":(p.error("Transformer has unknown angle for cursor detection: "+n),"pointer")}(t,n);e.getStage().content&&(e.getStage().content.style.cursor=i),this._cursorChange=!0})),e.on("mouseout",(()=>{e.getStage().content&&(e.getStage().content.style.cursor=""),this._cursorChange=!1})),this.add(e)}_createBack(){var t=new zt({name:"back",width:0,height:0,draggable:!0,sceneFunc(t){var e=this.getParent(),n=e.padding();t.beginPath(),t.rect(-n,-n,this.width()+2*n,this.height()+2*n),t.moveTo(this.width()/2,-n),e.rotateEnabled()&&t.lineTo(this.width()/2,-e.rotateAnchorOffset()*p._sign(this.height())-n),t.fillStrokeShape(this)},hitFunc:(t,e)=>{if(this.shouldOverdrawWholeArea()){var n=this.padding();t.beginPath(),t.rect(-n,-n,e.width()+2*n,e.height()+2*n),t.fillStrokeShape(e)}}});this.add(t),this._proxyDrag(t),t.on("dragstart",(t=>{t.cancelBubble=!0})),t.on("dragmove",(t=>{t.cancelBubble=!0})),t.on("dragend",(t=>{t.cancelBubble=!0})),this.on("dragmove",(t=>{this.update()}))}_handleMouseDown(t){this._movingAnchorName=t.target.name().split(" ")[0];var e=this._getNodeRect(),n=e.width,i=e.height,r=Math.sqrt(Math.pow(n,2)+Math.pow(i,2));this.sin=Math.abs(i/r),this.cos=Math.abs(n/r),"undefined"!=typeof window&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var a=t.target.getAbsolutePosition(),s=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:s.x-a.x,y:s.y-a.y},this._fire("transformstart",{evt:t,target:this.getNode()}),this._nodes.forEach((e=>{e._fire("transformstart",{evt:t,target:e})}))}_handleMouseMove(t){var e,n,i,r=this.findOne("."+this._movingAnchorName),s=r.getStage();s.setPointersPositions(t);const o=s.getPointerPosition();let h={x:o.x-this._anchorDragOffset.x,y:o.y-this._anchorDragOffset.y};const l=r.getAbsolutePosition();this.anchorDragBoundFunc()&&(h=this.anchorDragBoundFunc()(l,h,t)),r.setAbsolutePosition(h);const c=r.getAbsolutePosition();if(l.x!==c.x||l.y!==c.y)if("rotater"!==this._movingAnchorName){var u=this.keepRatio()||t.shiftKey,d=this.centeredScaling()||t.altKey;if("top-left"===this._movingAnchorName){if(u){var f=d?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};i=Math.sqrt(Math.pow(f.x-r.x(),2)+Math.pow(f.y-r.y(),2));var g=this.findOne(".top-left").x()>f.x?-1:1,p=this.findOne(".top-left").y()>f.y?-1:1;e=i*this.cos*g,n=i*this.sin*p,this.findOne(".top-left").x(f.x-e),this.findOne(".top-left").y(f.y-n)}}else if("top-center"===this._movingAnchorName)this.findOne(".top-left").y(r.y());else if("top-right"===this._movingAnchorName){u&&(f=d?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()},i=Math.sqrt(Math.pow(r.x()-f.x,2)+Math.pow(f.y-r.y(),2)),g=this.findOne(".top-right").x()<f.x?-1:1,p=this.findOne(".top-right").y()>f.y?-1:1,e=i*this.cos*g,n=i*this.sin*p,this.findOne(".top-right").x(f.x+e),this.findOne(".top-right").y(f.y-n));var v=r.position();this.findOne(".top-left").y(v.y),this.findOne(".bottom-right").x(v.x)}else"middle-left"===this._movingAnchorName?this.findOne(".top-left").x(r.x()):"middle-right"===this._movingAnchorName?this.findOne(".bottom-right").x(r.x()):"bottom-left"===this._movingAnchorName?(u&&(f=d?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()},i=Math.sqrt(Math.pow(f.x-r.x(),2)+Math.pow(r.y()-f.y,2)),g=f.x<r.x()?-1:1,p=r.y()<f.y?-1:1,e=i*this.cos*g,n=i*this.sin*p,r.x(f.x-e),r.y(f.y+n)),v=r.position(),this.findOne(".top-left").x(v.x),this.findOne(".bottom-right").y(v.y)):"bottom-center"===this._movingAnchorName?this.findOne(".bottom-right").y(r.y()):"bottom-right"===this._movingAnchorName?u&&(f=d?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()},i=Math.sqrt(Math.pow(r.x()-f.x,2)+Math.pow(r.y()-f.y,2)),g=this.findOne(".bottom-right").x()<f.x?-1:1,p=this.findOne(".bottom-right").y()<f.y?-1:1,e=i*this.cos*g,n=i*this.sin*p,this.findOne(".bottom-right").x(f.x+e),this.findOne(".bottom-right").y(f.y+n)):console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(d=this.centeredScaling()||t.altKey){var y=this.findOne(".top-left"),m=this.findOne(".bottom-right"),_=y.x(),b=y.y(),k=this.getWidth()-m.x(),S=this.getHeight()-m.y();m.move({x:-_,y:-b}),y.move({x:k,y:S})}var x=this.findOne(".top-left").getAbsolutePosition();e=x.x,n=x.y;var w=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),C=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:n,width:w,height:C,rotation:a.getAngle(this.rotation())},t)}else{var P=this._getNodeRect();e=r.x()-P.width/2,n=-r.y()+P.height/2;let i=Math.atan2(-n,e)+Math.PI/2;P.height<0&&(i-=Math.PI);const s=a.getAngle(this.rotation())+i,o=a.getAngle(this.rotationSnapTolerance()),h=function(t,e,n){let i=e;for(let r=0;r<t.length;r++){const s=a.getAngle(t[r]),o=Math.abs(s-e)%(2*Math.PI);Math.min(o,2*Math.PI-o)<n&&(i=s)}return i}(this.rotationSnaps(),s,o),l=function(t,e){const n=function(t){return{x:t.x+t.width/2*Math.cos(t.rotation)+t.height/2*Math.sin(-t.rotation),y:t.y+t.height/2*Math.cos(t.rotation)+t.width/2*Math.sin(t.rotation)}}(t);return Ve(t,e,n)}(P,h-P.rotation);this._fitNodesInto(l,t)}}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){if(this._transforming){this._transforming=!1,"undefined"!=typeof window&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var e=this.getNode();this._fire("transformend",{evt:t,target:e}),e&&this._nodes.forEach((e=>{e._fire("transformend",{evt:t,target:e})})),this._movingAnchorName=null}}_fitNodesInto(t,e){var n=this._getNodeRect();if(p._inRange(t.width,2*-this.padding()-1,1))return void this.update();if(p._inRange(t.height,2*-this.padding()-1,1))return void this.update();const i=this.flipEnabled();var r=new o;if(r.rotate(a.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){const e=r.point({x:2*-this.padding(),y:0});if(t.x+=e.x,t.y+=e.y,t.width+=2*this.padding(),this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,!i)return void this.update()}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){const e=r.point({x:2*this.padding(),y:0});if(this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.width+=2*this.padding(),!i)return void this.update()}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){const e=r.point({x:0,y:2*-this.padding()});if(t.x+=e.x,t.y+=e.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding(),!i)return void this.update()}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const e=r.point({x:0,y:2*this.padding()});if(this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding(),!i)return void this.update()}if(this.boundBoxFunc()){const e=this.boundBoxFunc()(n,t);e?t=e:p.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const s=1e7,h=new o;h.translate(n.x,n.y),h.rotate(n.rotation),h.scale(n.width/s,n.height/s);const l=new o;l.translate(t.x,t.y),l.rotate(t.rotation),l.scale(t.width/s,t.height/s);const c=l.multiply(h.invert());this._nodes.forEach((t=>{var n;const i=t.getParent().getAbsoluteTransform(),r=t.getTransform().copy();r.translate(t.offsetX(),t.offsetY());const a=new o;a.multiply(i.copy().invert()).multiply(c).multiply(i).multiply(r);const s=a.decompose();t.setAttrs(s),this._fire("transform",{evt:e,target:t}),t._fire("transform",{evt:e,target:t}),null===(n=t.getLayer())||void 0===n||n.batchDraw()})),this.rotation(p._getRotation(t.rotation)),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,e){this.findOne(t).setAttrs(e)}update(){var t,e=this._getNodeRect();this.rotation(p._getRotation(e.rotation));var n=e.width,i=e.height,r=this.enabledAnchors(),a=this.resizeEnabled(),s=this.padding(),o=this.anchorSize();this.find("._anchor").forEach((t=>{t.setAttrs({width:o,height:o,offsetX:o/2,offsetY:o/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})})),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:o/2+s,offsetY:o/2+s,visible:a&&r.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:n/2,y:0,offsetY:o/2+s,visible:a&&r.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:n,y:0,offsetX:o/2-s,offsetY:o/2+s,visible:a&&r.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:i/2,offsetX:o/2+s,visible:a&&r.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:n,y:i/2,offsetX:o/2-s,visible:a&&r.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:i,offsetX:o/2+s,offsetY:o/2-s,visible:a&&r.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:n/2,y:i,offsetY:o/2-s,visible:a&&r.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:n,y:i,offsetX:o/2-s,offsetY:o/2-s,visible:a&&r.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:n/2,y:-this.rotateAnchorOffset()*p._sign(i)-s,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:n,height:i,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0}),null===(t=this.getLayer())||void 0===t||t.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),Xt.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return Q.prototype.toObject.call(this)}}$e.prototype.className="Transformer",s($e),P.addGetterSetter($e,"enabledAnchors",Xe,(function(t){return t instanceof Array||p.warn("enabledAnchors value should be an array"),t instanceof Array&&t.forEach((function(t){-1===Xe.indexOf(t)&&p.warn("Unknown anchor name: "+t+". Available names are: "+Xe.join(", "))})),t||[]})),P.addGetterSetter($e,"flipEnabled",!0,x()),P.addGetterSetter($e,"resizeEnabled",!0),P.addGetterSetter($e,"anchorSize",10,m()),P.addGetterSetter($e,"rotateEnabled",!0),P.addGetterSetter($e,"rotationSnaps",[]),P.addGetterSetter($e,"rotateAnchorOffset",50,m()),P.addGetterSetter($e,"rotationSnapTolerance",5,m()),P.addGetterSetter($e,"borderEnabled",!0),P.addGetterSetter($e,"anchorStroke","rgb(0, 161, 255)"),P.addGetterSetter($e,"anchorStrokeWidth",1,m()),P.addGetterSetter($e,"anchorFill","white"),P.addGetterSetter($e,"anchorCornerRadius",0,m()),P.addGetterSetter($e,"borderStroke","rgb(0, 161, 255)"),P.addGetterSetter($e,"borderStrokeWidth",1,m()),P.addGetterSetter($e,"borderDash"),P.addGetterSetter($e,"keepRatio",!0),P.addGetterSetter($e,"centeredScaling",!1),P.addGetterSetter($e,"ignoreStroke",!1),P.addGetterSetter($e,"padding",0,m()),P.addGetterSetter($e,"node"),P.addGetterSetter($e,"nodes"),P.addGetterSetter($e,"boundBoxFunc"),P.addGetterSetter($e,"anchorDragBoundFunc"),P.addGetterSetter($e,"shouldOverdrawWholeArea",!1),P.addGetterSetter($e,"useSingleNodeRotation",!0),P.backCompat($e,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});class Ze extends zt{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.radius(),0,a.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}function Qe(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}Ze.prototype.className="Wedge",Ze.prototype._centroid=!0,Ze.prototype._attrsAffectingSize=["radius"],s(Ze),P.addGetterSetter(Ze,"radius",0,m()),P.addGetterSetter(Ze,"angle",0,m()),P.addGetterSetter(Ze,"clockwise",!1),P.backCompat(Ze,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});var Je=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],tn=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function en(t,e,n,i,r){var a=n-e,s=r-i;return 0===a?i+s/2:0===s?i:s*((t-e)/a)+i}function nn(t,e,n){var i=4*(n*t.width+e),r=[];return r.push(t.data[i++],t.data[i++],t.data[i++],t.data[i++]),r}function rn(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}P.addGetterSetter(Q,"blurRadius",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"brightness",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"contrast",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"embossStrength",.5,m(),P.afterSetFilter),P.addGetterSetter(Q,"embossWhiteLevel",.5,m(),P.afterSetFilter),P.addGetterSetter(Q,"embossDirection","top-left",null,P.afterSetFilter),P.addGetterSetter(Q,"embossBlend",!1,null,P.afterSetFilter),P.addGetterSetter(Q,"enhance",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"hue",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"saturation",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"luminance",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"hue",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"saturation",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"value",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"kaleidoscopePower",2,m(),P.afterSetFilter),P.addGetterSetter(Q,"kaleidoscopeAngle",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"threshold",0,m(),P.afterSetFilter),P.addGetterSetter(Q,"noise",.2,m(),P.afterSetFilter),P.addGetterSetter(Q,"pixelSize",8,m(),P.afterSetFilter),P.addGetterSetter(Q,"levels",.5,m(),P.afterSetFilter),P.addGetterSetter(Q,"red",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),P.addGetterSetter(Q,"green",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),P.addGetterSetter(Q,"blue",0,y,P.afterSetFilter),P.addGetterSetter(Q,"red",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),P.addGetterSetter(Q,"green",0,(function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)})),P.addGetterSetter(Q,"blue",0,y,P.afterSetFilter),P.addGetterSetter(Q,"alpha",1,(function(t){return this._filterUpToDate=!1,t>1?1:t<0?0:t})),P.addGetterSetter(Q,"threshold",.5,m(),P.afterSetFilter);const an=ie.Util._assign(ie,{Arc:re,Arrow:le,Circle:ce,Ellipse:ue,Image:de,Label:_e,Tag:be,Line:oe,Path:he,Rect:ke,RegularPolygon:Se,Ring:we,Sprite:Ce,Star:Pe,Text:Fe,TextPath:Be,Transformer:$e,Wedge:Ze,Filters:{Blur:function(t){var e=Math.round(this.blurRadius());e>0&&function(t,e){var n,i,r,a,s,o,h,l,c,u,d,f,g,p,v,y,m,_,b,k,S,x,w,C,P=t.data,M=t.width,E=t.height,T=e+e+1,A=M-1,O=E-1,I=e+1,D=I*(I+1)/2,L=new Qe,R=null,G=L,K=null,F=null,H=Je[e],N=tn[e];for(r=1;r<T;r++)G=G.next=new Qe,r===I&&(R=G);for(G.next=L,h=o=0,i=0;i<E;i++){for(y=m=_=b=l=c=u=d=0,f=I*(k=P[o]),g=I*(S=P[o+1]),p=I*(x=P[o+2]),v=I*(w=P[o+3]),l+=D*k,c+=D*S,u+=D*x,d+=D*w,G=L,r=0;r<I;r++)G.r=k,G.g=S,G.b=x,G.a=w,G=G.next;for(r=1;r<I;r++)a=o+((A<r?A:r)<<2),l+=(G.r=k=P[a])*(C=I-r),c+=(G.g=S=P[a+1])*C,u+=(G.b=x=P[a+2])*C,d+=(G.a=w=P[a+3])*C,y+=k,m+=S,_+=x,b+=w,G=G.next;for(K=L,F=R,n=0;n<M;n++)P[o+3]=w=d*H>>N,0!==w?(w=255/w,P[o]=(l*H>>N)*w,P[o+1]=(c*H>>N)*w,P[o+2]=(u*H>>N)*w):P[o]=P[o+1]=P[o+2]=0,l-=f,c-=g,u-=p,d-=v,f-=K.r,g-=K.g,p-=K.b,v-=K.a,a=h+((a=n+e+1)<A?a:A)<<2,l+=y+=K.r=P[a],c+=m+=K.g=P[a+1],u+=_+=K.b=P[a+2],d+=b+=K.a=P[a+3],K=K.next,f+=k=F.r,g+=S=F.g,p+=x=F.b,v+=w=F.a,y-=k,m-=S,_-=x,b-=w,F=F.next,o+=4;h+=M}for(n=0;n<M;n++){for(m=_=b=y=c=u=d=l=0,f=I*(k=P[o=n<<2]),g=I*(S=P[o+1]),p=I*(x=P[o+2]),v=I*(w=P[o+3]),l+=D*k,c+=D*S,u+=D*x,d+=D*w,G=L,r=0;r<I;r++)G.r=k,G.g=S,G.b=x,G.a=w,G=G.next;for(s=M,r=1;r<=e;r++)o=s+n<<2,l+=(G.r=k=P[o])*(C=I-r),c+=(G.g=S=P[o+1])*C,u+=(G.b=x=P[o+2])*C,d+=(G.a=w=P[o+3])*C,y+=k,m+=S,_+=x,b+=w,G=G.next,r<O&&(s+=M);for(o=n,K=L,F=R,i=0;i<E;i++)P[3+(a=o<<2)]=w=d*H>>N,w>0?(w=255/w,P[a]=(l*H>>N)*w,P[a+1]=(c*H>>N)*w,P[a+2]=(u*H>>N)*w):P[a]=P[a+1]=P[a+2]=0,l-=f,c-=g,u-=p,d-=v,f-=K.r,g-=K.g,p-=K.b,v-=K.a,a=n+((a=i+I)<O?a:O)*M<<2,l+=y+=K.r=P[a],c+=m+=K.g=P[a+1],u+=_+=K.b=P[a+2],d+=b+=K.a=P[a+3],K=K.next,f+=k=F.r,g+=S=F.g,p+=x=F.b,v+=w=F.a,y-=k,m-=S,_-=x,b-=w,F=F.next,o+=M}}(t,e)},Brighten:function(t){var e,n=255*this.brightness(),i=t.data,r=i.length;for(e=0;e<r;e+=4)i[e]+=n,i[e+1]+=n,i[e+2]+=n},Contrast:function(t){var e,n=Math.pow((this.contrast()+100)/100,2),i=t.data,r=i.length,a=150,s=150,o=150;for(e=0;e<r;e+=4)a=i[e],s=i[e+1],o=i[e+2],a/=255,a-=.5,a*=n,a+=.5,s/=255,s-=.5,s*=n,s+=.5,o/=255,o-=.5,o*=n,o+=.5,a=(a*=255)<0?0:a>255?255:a,s=(s*=255)<0?0:s>255?255:s,o=(o*=255)<0?0:o>255?255:o,i[e]=a,i[e+1]=s,i[e+2]=o},Emboss:function(t){var e=10*this.embossStrength(),n=255*this.embossWhiteLevel(),i=this.embossDirection(),r=this.embossBlend(),a=0,s=0,o=t.data,h=t.width,l=t.height,c=4*h,u=l;switch(i){case"top-left":a=-1,s=-1;break;case"top":a=-1,s=0;break;case"top-right":a=-1,s=1;break;case"right":a=0,s=1;break;case"bottom-right":a=1,s=1;break;case"bottom":a=1,s=0;break;case"bottom-left":a=1,s=-1;break;case"left":a=0,s=-1;break;default:p.error("Unknown emboss direction: "+i)}do{var d=(u-1)*c,f=a;u+f<1&&(f=0),u+f>l&&(f=0);var g=(u-1+f)*h*4,v=h;do{var y=d+4*(v-1),m=s;v+m<1&&(m=0),v+m>h&&(m=0);var _=g+4*(v-1+m),b=o[y]-o[_],k=o[y+1]-o[_+1],S=o[y+2]-o[_+2],x=b,w=x>0?x:-x;if((k>0?k:-k)>w&&(x=k),(S>0?S:-S)>w&&(x=S),x*=e,r){var C=o[y]+x,P=o[y+1]+x,M=o[y+2]+x;o[y]=C>255?255:C<0?0:C,o[y+1]=P>255?255:P<0?0:P,o[y+2]=M>255?255:M<0?0:M}else{var E=n-x;E<0?E=0:E>255&&(E=255),o[y]=o[y+1]=o[y+2]=E}}while(--v)}while(--u)},Enhance:function(t){var e,n,i,r,a=t.data,s=a.length,o=a[0],h=o,l=a[1],c=l,u=a[2],d=u,f=this.enhance();if(0!==f){for(r=0;r<s;r+=4)(e=a[r+0])<o?o=e:e>h&&(h=e),(n=a[r+1])<l?l=n:n>c&&(c=n),(i=a[r+2])<u?u=i:i>d&&(d=i);var g,p,v,y,m,_,b,k,S;for(h===o&&(h=255,o=0),c===l&&(c=255,l=0),d===u&&(d=255,u=0),f>0?(p=h+f*(255-h),v=o-f*(o-0),m=c+f*(255-c),_=l-f*(l-0),k=d+f*(255-d),S=u-f*(u-0)):(p=h+f*(h-(g=.5*(h+o))),v=o+f*(o-g),m=c+f*(c-(y=.5*(c+l))),_=l+f*(l-y),k=d+f*(d-(b=.5*(d+u))),S=u+f*(u-b)),r=0;r<s;r+=4)a[r+0]=en(a[r+0],o,h,v,p),a[r+1]=en(a[r+1],l,c,_,m),a[r+2]=en(a[r+2],u,d,S,k)}},Grayscale:function(t){var e,n,i=t.data,r=i.length;for(e=0;e<r;e+=4)n=.34*i[e]+.5*i[e+1]+.16*i[e+2],i[e]=n,i[e+1]=n,i[e+2]=n},HSL:function(t){var e,n,i,r,a,s=t.data,o=s.length,h=Math.pow(2,this.saturation()),l=Math.abs(this.hue()+360)%360,c=127*this.luminance(),u=1*h*Math.cos(l*Math.PI/180),d=1*h*Math.sin(l*Math.PI/180),f=.299+.701*u+.167*d,g=.587-.587*u+.33*d,p=.114-.114*u-.497*d,v=.299-.299*u-.328*d,y=.587+.413*u+.035*d,m=.114-.114*u+.293*d,_=.299-.3*u+1.25*d,b=.587-.586*u-1.05*d,k=.114+.886*u-.2*d;for(e=0;e<o;e+=4)n=s[e+0],i=s[e+1],r=s[e+2],a=s[e+3],s[e+0]=f*n+g*i+p*r+c,s[e+1]=v*n+y*i+m*r+c,s[e+2]=_*n+b*i+k*r+c,s[e+3]=a},HSV:function(t){var e,n,i,r,a,s=t.data,o=s.length,h=Math.pow(2,this.value()),l=Math.pow(2,this.saturation()),c=Math.abs(this.hue()+360)%360,u=h*l*Math.cos(c*Math.PI/180),d=h*l*Math.sin(c*Math.PI/180),f=.299*h+.701*u+.167*d,g=.587*h-.587*u+.33*d,p=.114*h-.114*u-.497*d,v=.299*h-.299*u-.328*d,y=.587*h+.413*u+.035*d,m=.114*h-.114*u+.293*d,_=.299*h-.3*u+1.25*d,b=.587*h-.586*u-1.05*d,k=.114*h+.886*u-.2*d;for(e=0;e<o;e+=4)n=s[e+0],i=s[e+1],r=s[e+2],a=s[e+3],s[e+0]=f*n+g*i+p*r,s[e+1]=v*n+y*i+m*r,s[e+2]=_*n+b*i+k*r,s[e+3]=a},Invert:function(t){var e,n=t.data,i=n.length;for(e=0;e<i;e+=4)n[e]=255-n[e],n[e+1]=255-n[e+1],n[e+2]=255-n[e+2]},Kaleidoscope:function(t){var e,n,i,r,a,s,o,h,l,c=t.width,u=t.height,d=Math.round(this.kaleidoscopePower()),f=Math.round(this.kaleidoscopeAngle()),g=Math.floor(c*(f%360)/360);if(!(d<1)){var v=p.createCanvasElement();v.width=c,v.height=u;var y=v.getContext("2d").getImageData(0,0,c,u);!function(t,e,n){var i,r,a,s,o=t.data,h=e.data,l=t.width,c=t.height,u=n.polarCenterX||l/2,d=n.polarCenterY||c/2,f=0,g=0,p=0,v=0,y=Math.sqrt(u*u+d*d);r=l-u,a=c-d,y=(s=Math.sqrt(r*r+a*a))>y?s:y;var m,_,b,k,S=c,x=l,w=360/x*Math.PI/180;for(_=0;_<x;_+=1)for(b=Math.sin(_*w),k=Math.cos(_*w),m=0;m<S;m+=1)r=Math.floor(u+y*m/S*k),f=o[0+(i=4*((a=Math.floor(d+y*m/S*b))*l+r))],g=o[i+1],p=o[i+2],v=o[i+3],h[0+(i=4*(_+m*l))]=f,h[i+1]=g,h[i+2]=p,h[i+3]=v}(t,y,{polarCenterX:c/2,polarCenterY:u/2});for(var m=c/Math.pow(2,d);m<=8;)m*=2,d-=1;var _=m=Math.ceil(m),b=0,k=_,S=1;for(g+m>c&&(b=_,k=0,S=-1),n=0;n<u;n+=1)for(e=b;e!==k;e+=S)h=4*(c*n+Math.round(e+g)%c),r=y.data[h+0],a=y.data[h+1],s=y.data[h+2],o=y.data[h+3],l=4*(c*n+e),y.data[l+0]=r,y.data[l+1]=a,y.data[l+2]=s,y.data[l+3]=o;for(n=0;n<u;n+=1)for(_=Math.floor(m),i=0;i<d;i+=1){for(e=0;e<_+1;e+=1)h=4*(c*n+e),r=y.data[h+0],a=y.data[h+1],s=y.data[h+2],o=y.data[h+3],l=4*(c*n+2*_-e-1),y.data[l+0]=r,y.data[l+1]=a,y.data[l+2]=s,y.data[l+3]=o;_*=2}!function(t,e,n){var i,r,a,s,o,h,l=t.data,c=e.data,u=t.width,d=t.height,f=n.polarCenterX||u/2,g=n.polarCenterY||d/2,p=0,v=0,y=0,m=0,_=Math.sqrt(f*f+g*g);r=u-f,a=d-g,_=(h=Math.sqrt(r*r+a*a))>_?h:_;var b,k,S,x=d,w=u,C=n.polarRotation||0;for(r=0;r<u;r+=1)for(a=0;a<d;a+=1)s=r-f,o=a-g,b=Math.sqrt(s*s+o*o)*x/_,k=(k=(180*Math.atan2(o,s)/Math.PI+360+C)%360)*w/360,S=Math.floor(k),p=l[0+(i=4*(Math.floor(b)*u+S))],v=l[i+1],y=l[i+2],m=l[i+3],c[0+(i=4*(a*u+r))]=p,c[i+1]=v,c[i+2]=y,c[i+3]=m}(y,t,{polarRotation:0})}},Mask:function(t){var e=function(t,e){var n=nn(t,0,0),i=nn(t,t.width-1,0),r=nn(t,0,t.height-1),a=nn(t,t.width-1,t.height-1),s=e||10;if(rn(n,i)<s&&rn(i,a)<s&&rn(a,r)<s&&rn(r,n)<s){for(var o=function(t){for(var e=[0,0,0],n=0;n<t.length;n++)e[0]+=t[n][0],e[1]+=t[n][1],e[2]+=t[n][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}([i,n,a,r]),h=[],l=0;l<t.width*t.height;l++){var c=rn(o,[t.data[4*l],t.data[4*l+1],t.data[4*l+2]]);h[l]=c<s?0:255}return h}}(t,this.threshold());return e&&function(t,e){for(var n=0;n<t.width*t.height;n++)t.data[4*n+3]=e[n]}(t,e=function(t,e,n){for(var i=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],r=Math.round(Math.sqrt(i.length)),a=Math.floor(r/2),s=[],o=0;o<n;o++)for(var h=0;h<e;h++){for(var l=o*e+h,c=0,u=0;u<r;u++)for(var d=0;d<r;d++){var f=o+u-a,g=h+d-a;if(f>=0&&f<n&&g>=0&&g<e){var p=i[u*r+d];c+=t[f*e+g]*p}}s[l]=c}return s}(e=function(t,e,n){for(var i=[1,1,1,1,1,1,1,1,1],r=Math.round(Math.sqrt(i.length)),a=Math.floor(r/2),s=[],o=0;o<n;o++)for(var h=0;h<e;h++){for(var l=o*e+h,c=0,u=0;u<r;u++)for(var d=0;d<r;d++){var f=o+u-a,g=h+d-a;if(f>=0&&f<n&&g>=0&&g<e){var p=i[u*r+d];c+=t[f*e+g]*p}}s[l]=c>=1020?255:0}return s}(e=function(t,e,n){for(var i=[1,1,1,1,0,1,1,1,1],r=Math.round(Math.sqrt(i.length)),a=Math.floor(r/2),s=[],o=0;o<n;o++)for(var h=0;h<e;h++){for(var l=o*e+h,c=0,u=0;u<r;u++)for(var d=0;d<r;d++){var f=o+u-a,g=h+d-a;if(f>=0&&f<n&&g>=0&&g<e){var p=i[u*r+d];c+=t[f*e+g]*p}}s[l]=2040===c?255:0}return s}(e,t.width,t.height),t.width,t.height),t.width,t.height)),t},Noise:function(t){var e,n=255*this.noise(),i=t.data,r=i.length,a=n/2;for(e=0;e<r;e+=4)i[e+0]+=a-2*a*Math.random(),i[e+1]+=a-2*a*Math.random(),i[e+2]+=a-2*a*Math.random()},Pixelate:function(t){var e,n,i,r,a,s,o,h,l,c,u,d,f,g,v=Math.ceil(this.pixelSize()),y=t.width,m=t.height,_=Math.ceil(y/v),b=Math.ceil(m/v),k=t.data;if(v<=0)p.error("pixelSize value can not be <= 0");else for(d=0;d<_;d+=1)for(f=0;f<b;f+=1){for(r=0,a=0,s=0,o=0,l=(h=d*v)+v,u=(c=f*v)+v,g=0,e=h;e<l;e+=1)if(!(e>=y))for(n=c;n<u;n+=1)n>=m||(r+=k[0+(i=4*(y*n+e))],a+=k[i+1],s+=k[i+2],o+=k[i+3],g+=1);for(r/=g,a/=g,s/=g,o/=g,e=h;e<l;e+=1)if(!(e>=y))for(n=c;n<u;n+=1)n>=m||(k[0+(i=4*(y*n+e))]=r,k[i+1]=a,k[i+2]=s,k[i+3]=o)}},Posterize:function(t){var e,n=Math.round(254*this.levels())+1,i=t.data,r=i.length,a=255/n;for(e=0;e<r;e+=1)i[e]=Math.floor(i[e]/a)*a},RGB:function(t){var e,n,i=t.data,r=i.length,a=this.red(),s=this.green(),o=this.blue();for(e=0;e<r;e+=4)n=(.34*i[e]+.5*i[e+1]+.16*i[e+2])/255,i[e]=n*a,i[e+1]=n*s,i[e+2]=n*o,i[e+3]=i[e+3]},RGBA:function(t){var e,n,i=t.data,r=i.length,a=this.red(),s=this.green(),o=this.blue(),h=this.alpha();for(e=0;e<r;e+=4)n=1-h,i[e]=a*h+i[e]*n,i[e+1]=s*h+i[e+1]*n,i[e+2]=o*h+i[e+2]*n},Sepia:function(t){var e,n,i,r,a=t.data,s=a.length;for(e=0;e<s;e+=4)n=a[e+0],i=a[e+1],r=a[e+2],a[e+0]=Math.min(255,.393*n+.769*i+.189*r),a[e+1]=Math.min(255,.349*n+.686*i+.168*r),a[e+2]=Math.min(255,.272*n+.534*i+.131*r)},Solarize:function(t){var e=t.data,n=t.width,i=4*n,r=t.height;do{var a=(r-1)*i,s=n;do{var o=a+4*(s-1),h=e[o],l=e[o+1],c=e[o+2];h>127&&(h=255-h),l>127&&(l=255-l),c>127&&(c=255-c),e[o]=h,e[o+1]=l,e[o+2]=c}while(--s)}while(--r)},Threshold:function(t){var e,n=255*this.threshold(),i=t.data,r=i.length;for(e=0;e<r;e+=1)i[e]=i[e]<n?0:255}}})}}]);