"use strict";(self.webpackChunkimgreview=self.webpackChunkimgreview||[]).push([[79],{6984:(t,e,s)=>{s.d(e,{Z:()=>n});var o=s(8081),i=s.n(o),r=s(3645),a=s.n(r)()(i());a.push([t.id,".HowToStart {\n  position: absolute;\n  top: 10%;\n  left: 5%;\n  color: gray;\n  font-family: Lato, Arial, serif;\n  user-select: none;\n  pointer-events: none;\n}\n",""]);const n=a},5504:(t,e,s)=>{s.d(e,{Z:()=>n});var o=s(8081),i=s.n(o),r=s(3645),a=s.n(r)()(i());a.push([t.id,".canvas-el {\n  outline: none;\n  width: 100%;\n  height: 100%;\n}\n",""]);const n=a},4087:(t,e,s)=>{s.d(e,{Z:()=>n});var o=s(8081),i=s.n(o),r=s(3645),a=s.n(r)()(i());a.push([t.id,".CanvasWrapper {\n  overflow: hidden;\n  height: 100%;\n  width: 100%;\n  background: rgba(0, 0, 0, 0.03);\n  position: absolute;\n}\n",""]);const n=a},9320:(t,e,s)=>{s.d(e,{Z:()=>n});var o=s(8081),i=s.n(o),r=s(3645),a=s.n(r)()(i());a.push([t.id,".SaveCanvasEl {\n  position: absolute;\n  top: 100%;\n}\n",""]);const n=a},9289:(t,e,s)=>{s.r(e),s.d(e,{default:()=>Ks});var o=s(7294),i=s(6486),r=s.n(i),a=s(2246);const n=(0,a.Z)("ADD_SHAPE"),h=(0,a.Z)("SET_CURSOR"),c=(0,a.Z)("SET_STROKE_COLOR_TO_ACTIVE_SHAPE"),d=(0,a.Z)("SET_STROKE_WIDTH_TO_ACTIVE_SHAPE"),f=(0,a.Z)("SET_FONT_SIZE_TO_ACTIVE_SHAPE"),l=(0,a.Z)("DELETE_ACTIVE_SHAPES"),p=(0,a.Z)("DELETE_ALL_SHAPES"),w=(0,a.Z)("DELETE_SHAPE"),g=(0,a.Z)("BLUR_SHAPES"),u=(0,a.Z)("SCALE_SHAPES"),y=(0,a.Z)("CROP_SHAPES"),m=(0,a.Z)("SET_ADDING_SHAPE"),v=(0,a.Z)("SHAPE_ADDED"),E=(0,a.Z)("DRAW_LAYERS"),S=(0,a.Z)("CHANGE_ORDER_OF_ACTIVE_SHAPE"),b=(0,a.Z)("SKETCHIFY_ACTIVE_SHAPE");var x=s(5857),T=s(3972);const A=(0,a.Z)("SET_STAGE"),P=(0,a.Z)("SET_STAGE_SIZE"),k=(0,a.Z)("SET_STAGE_DRAGGABLE"),R=(0,a.Z)("SET_RATIO_SHIFT"),L=(0,T.Z)({[`${A}`]:(t,e)=>({...t,instance:e.payload}),[`${P}`]:(t,e)=>{const{width:s,height:o}=e.payload;return t.instance?.setAttrs({width:s,height:o}),t},[`${k}`]:(t,e)=>{const s=e.payload;return t.instance?.draggable(s),{...t,isDraggable:s}},[`${R}`]:(t,e)=>{const s=e.payload;return t.instance?.draggable(s),{...t,ratioShiftIsActive:s}}},{instance:null,isDraggable:!1,ratioShiftIsActive:!1});var C,M,Z=s(4920);!function(t){t.AUTO="auto",t.MOVE="move",t.POINTER="pointer",t.GRAB="grab"}(C||(C={})),function(t){t.SHAPES_LAYER="shapes_layer",t.ANCHORS_LAYER="anchors_layer"}(M||(M={}));const D=(0,s(8111).i)(),W=t=>e=>D.on(t,e),_=t=>{D.emit("SHAPES_BLURRED",t)},I=t=>{D.emit("SHAPE_ADDED",t)},O=t=>{D.emit("SHAPE_DELETED",t)};var H,z=s(5822),B=s(4247),U=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class F{constructor(){H.set(this,new Map)}set(t,e){U(this,H,"f").set(t,e)}call(t,...e){const s=U(this,H,"f").get(t);s&&s(...e)}get(t){return U(this,H,"f").get(t)??r().noop}has(t){return U(this,H,"f").has(t)}}H=new WeakMap;var $,j=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s};$=new WeakMap;const G=class{constructor(){this.type=z.Z.SHAPE,this.cbMap=new F,$.set(this,!1),this.onClick=t=>{const{shapes:e}=Ht.getState();e.addingShapeRef||(this,D.emit("SHAPE_CLICKED",this),t.cancelBubble=!0,this.focus(),this.cbMap.call("click",this))},this.onDragStart=()=>{D.emit("SHAPE_DRAG_STARTED",this),this.focus(),this.cbMap.call("dragstart",this)}}blur(){j(this,$,!1,"f")}focus(){j(this,$,!0,"f")}isSelected(){return function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)}(this,$,"f")}on(t,e){this.cbMap.set(t,e)}addToLayer(t,e){this.focus()}clone(){console.warn("clone() is not implemented"),console.warn(this)}crop(t){console.warn("crop() is not implemented"),console.warn(this)}draggable(t){console.warn("draggable() is not implemented"),console.warn(this)}attachBasicEvents(t){t.on("click",this.onClick),t.on("dragstart",this.onDragStart),t.on("mouseover",(()=>{this.cbMap.call("mouseover",this)})),t.on("mouseout",(()=>{this.cbMap.call("mouseout",this)}))}destroy(){this.cbMap.call("_beforedestroy",this)}};var N,Y,K,X,V=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},q=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};!function(t){t.left="left",t.top="top",t.right="right",t.bottom="bottom",t.leftTop="leftTop",t.leftBottom="leftBottom",t.rightTop="rightTop",t.rightBottom="rightBottom"}(X||(X={}));const J={width:10,height:10,stroke:"#2196f3",strokeWidth:1,fill:"#ffffff",draggable:!0};N=new WeakMap,Y=new WeakMap,K=new WeakMap;const Q=class{constructor(t){N.set(this,new F),Y.set(this,void 0),K.set(this,void 0),this.onDragMove=t=>{q(this,N,"f").call("dragmove",q(this,K,"f").type,t)},V(this,K,t,"f"),V(this,Y,new Z.Z.Rect({...J,x:t.x-J.width/2,y:t.y-J.height/2,dragBoundFunc:t=>({x:t.x,y:t.y})}),"f"),q(this,Y,"f").on("dragmove",this.onDragMove)}show(){q(this,Y,"f").visible(!0)}hide(){q(this,Y,"f").visible(!1)}on(t,e){q(this,N,"f").set(t,e)}getPos(){const t=q(this,Y,"f").getAttrs();return{x:t.x+J.width/2,y:t.y+J.height/2}}setPos(t){const e=this.getPos(),s=t.x||e.x,o=t.y||e.y;q(this,Y,"f").setAttrs({x:s-J.width/2,y:o-J.height/2})}addToLayer(t){t.add(q(this,Y,"f"))}destroy(){q(this,Y,"f").destroy()}};var tt,et,st,ot=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},it=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class rt{constructor(t){tt.set(this,new F),et.set(this,void 0),st.set(this,1),this.onMoveAnchor=(t,e)=>{const{stage:{ratioShiftIsActive:s}}=Ht.getState(),{layerX:o,layerY:i}=e.evt,r=this.getCurrentAnchor(t);let a=s?{x:o,y:i}:r.getPos();const n=this.getOppositeAnchor(t).getPos(),h=a.x-n.x,c=a.y-n.y,d=Math.min(Math.abs(h/it(this,st,"f")),Math.abs(c));s&&(a={x:n.x+Math.sign(h)*d*it(this,st,"f"),y:n.y+Math.sign(c)*d},r.setPos(a));const f=this.getNeighborAnchors(t);f.neighborX.setPos({x:a.x}),f.neighborY.setPos({y:a.y});const l=this.getLeftTopPos();it(this,tt,"f").call("dragmove",{x:l.x,y:l.y,width:Math.abs(s?d*it(this,st,"f"):h),height:Math.abs(s?d:c)})},ot(this,et,{leftTop:new Q({...rt.calcAnchorPosition(X.leftTop,t),type:X.leftTop}),rightTop:new Q({...rt.calcAnchorPosition(X.rightTop,t),type:X.rightTop}),rightBottom:new Q({...rt.calcAnchorPosition(X.rightBottom,t),type:X.rightBottom}),leftBottom:new Q({...rt.calcAnchorPosition(X.leftBottom,t),type:X.leftBottom})},"f"),it(this,et,"f").leftTop.on("dragmove",this.onMoveAnchor),it(this,et,"f").rightTop.on("dragmove",this.onMoveAnchor),it(this,et,"f").rightBottom.on("dragmove",this.onMoveAnchor),it(this,et,"f").leftBottom.on("dragmove",this.onMoveAnchor)}static calcAnchorPosition(t,e){switch(t){case X.left:return{x:e.x,y:e.y+e.height/2};case X.top:return{x:e.x+e.width/2,y:e.y};case X.right:return{x:e.x+e.width,y:e.y+e.height/2};case X.bottom:return{x:e.x+e.width/2,y:e.y+e.height};case X.leftTop:return{x:e.x,y:e.y};case X.rightTop:return{x:e.x+e.width,y:e.y};case X.rightBottom:return{x:e.x+e.width,y:e.y+e.height};case X.leftBottom:return{x:e.x,y:e.y+e.height};default:throw new Error(`Position can't be calculated for given type: ${t}`)}}getCurrentAnchor(t){switch(t){case X.leftTop:return it(this,et,"f").leftTop;case X.leftBottom:return it(this,et,"f").leftBottom;case X.rightTop:return it(this,et,"f").rightTop;case X.rightBottom:return it(this,et,"f").rightBottom;default:throw new Error(`Can't find anchor for provided type. Given ${t}`)}}getOppositeAnchor(t){switch(t){case X.leftTop:return it(this,et,"f").rightBottom;case X.leftBottom:return it(this,et,"f").rightTop;case X.rightTop:return it(this,et,"f").leftBottom;case X.rightBottom:return it(this,et,"f").leftTop;default:throw new Error(`Can't find anchor for provided type. Given ${t}`)}}getNeighborAnchors(t){switch(t){case X.leftTop:return{neighborX:it(this,et,"f").leftBottom,neighborY:it(this,et,"f").rightTop};case X.leftBottom:return{neighborX:it(this,et,"f").leftTop,neighborY:it(this,et,"f").rightBottom};case X.rightTop:return{neighborX:it(this,et,"f").rightBottom,neighborY:it(this,et,"f").leftTop};case X.rightBottom:return{neighborX:it(this,et,"f").rightTop,neighborY:it(this,et,"f").leftBottom};default:throw new Error(`Width and height can't be calculated for the given type: ${t}`)}}getLeftTopPos(){return Object.keys(it(this,et,"f")).reduce(((t,e)=>{const s=it(this,et,"f")[e].getPos();return s.x<t.x||s.y<t.y?s:t}),{x:1/0,y:1/0})}setOriginRatio(t){ot(this,st,t,"f")}on(t,e){it(this,tt,"f").set(t,e)}updatePosition(t){it(this,et,"f").leftTop.setPos(rt.calcAnchorPosition(X.leftTop,t)),it(this,et,"f").rightTop.setPos(rt.calcAnchorPosition(X.rightTop,t)),it(this,et,"f").rightBottom.setPos(rt.calcAnchorPosition(X.rightBottom,t)),it(this,et,"f").leftBottom.setPos(rt.calcAnchorPosition(X.leftBottom,t))}show(){it(this,et,"f").leftTop.show(),it(this,et,"f").rightTop.show(),it(this,et,"f").rightBottom.show(),it(this,et,"f").leftBottom.show()}hide(){it(this,et,"f").leftTop.hide(),it(this,et,"f").rightTop.hide(),it(this,et,"f").rightBottom.hide(),it(this,et,"f").leftBottom.hide()}addToLayer(t){it(this,et,"f").leftTop.addToLayer(t),it(this,et,"f").rightTop.addToLayer(t),it(this,et,"f").rightBottom.addToLayer(t),it(this,et,"f").leftBottom.addToLayer(t)}destroy(){it(this,et,"f").leftTop.destroy(),it(this,et,"f").rightTop.destroy(),it(this,et,"f").rightBottom.destroy(),it(this,et,"f").leftBottom.destroy()}}tt=new WeakMap,et=new WeakMap,st=new WeakMap;const at=rt;var nt,ht,ct=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};nt=new WeakMap,ht=new WeakMap;const dt=class{constructor(t){nt.set(this,new F),ht.set(this,void 0),this.onDragMove=t=>{const e="_dragmoveanchor";if(ct(this,nt,"f").call(e,t),!ct(this,nt,"f").has(e))throw new Error(`"${e}" should be defined`)},function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===o?i.call(t,s):i?i.value=s:e.set(t,s)}(this,ht,new at(t),"f"),ct(this,ht,"f").on("dragmove",this.onDragMove)}setOriginRatio(t){ct(this,ht,"f").setOriginRatio(t)}on(t,e){ct(this,nt,"f").set(t,e)}update(t,e=!0){ct(this,ht,"f").updatePosition(t),e&&Ht.dispatch(E(M.ANCHORS_LAYER))}addToLayer(t){ct(this,ht,"f").addToLayer(t)}show(){ct(this,ht,"f").show()}hide(){ct(this,ht,"f").hide()}destroy(){ct(this,ht,"f").destroy()}};class ft extends G{constructor(t){super(),this.type=z.Z.RECT,this.onDragMove=t=>{this.cbMap.call("dragmove",t),this.sizeTransform?.update(this.getSizePos())},this.getSizePos=()=>{const{x:t,y:e,width:s,height:o}=this.getAttrs();return{x:t,y:e,width:s,height:o}},this.onDragMoveAnchor=t=>{this.setShapeAttrs(t)},this.props={...t}}defineShape(){this.shape=new Z.Z.Rect({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,dash:this.props.dash,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth,fill:this.props.fill,draggable:!0})}addToLayer(t,e){this.defineShape(),this.shape.on("dragmove",this.onDragMove),super.attachBasicEvents(this.shape),this.sizeTransform=new dt(this.getSizePos()),this.sizeTransform.on("_dragmoveanchor",this.onDragMoveAnchor),t.add(this.shape),this.sizeTransform.addToLayer(e),super.addToLayer(t,e)}blur(){super.blur(),this.sizeTransform?.hide()}focus(){super.focus(),this.sizeTransform?.show()}getFillColor(){return this.shape?.getAttr("fill")}setFillColor(t){this.shape?.setAttr("fill",t)}getStrokeColor(){return this.shape?.getAttr("stroke")}getAttrs(){return this.shape?.getAttrs()}hide(){this.shape?.setAttrs({stroke:"transparent"})}setShapeAttrs(t){this.shape?.setAttrs(t),Ht.dispatch(E(M.SHAPES_LAYER))}setAttrs(t){this.setShapeAttrs(t),this.sizeTransform?.update(this.getSizePos())}setStrokeColor(t){this.shape?.setAttr("stroke",t)}setStrokeWidth(t){this.shape?.setAttrs({strokeWidth:t})}getStrokeWidth(){return this.shape?.getAttr("strokeWidth")}getSelfRect(){if(!this.shape)throw new Error("Shape is not defined");const t=this.shape.getAbsolutePosition(),e=this.shape.getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}draggable(t){if(void 0===t)return this.shape?.draggable();this.shape?.draggable(t)}scale(t){const{x:e,y:s,width:o,height:i}=this.getAttrs();this.shape?.setAttrs({x:e*t.wFactor,y:s*t.hFactor,width:o*t.wFactor,height:i*t.hFactor}),this.sizeTransform?.update(this.getSizePos(),!1)}getCloningProps(){const t=this.shape?.getAttrs();return{...this.props,...t&&{x:t.x,y:t.y,width:t.width,height:t.height,stroke:t.stroke,strokeWidth:t.strokeWidth}}}zIndex(t){if(void 0===t)return this.shape?.zIndex();this.shape?.zIndex(t)}crop(t){const{x:e,y:s}=this.getAttrs();this.shape?.setAttrs({x:e-t.x,y:s-t.y}),this.sizeTransform?.update(this.getSizePos(),!1)}clone(){return new ft(this.getCloningProps())}initDraw(t,e){this.type===z.Z.RECT&&this.blur(),this.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y})}destroy(){super.destroy(),this.shape?.destroy(),this.sizeTransform?.destroy()}}const lt=ft,pt=(t,e,s="nonzero")=>{t.beginPath();for(const s of e.ops){const e=s.data;switch(s.op){case"move":t.moveTo(e[0],e[1]);break;case"bcurveTo":t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]);break;case"lineTo":t.lineTo(e[0],e[1])}}"fillPath"===e.type?t.fill(s):t.stroke()},wt=(t,e,s)=>{let o=s.fillWeight;o<0&&(o=s.strokeWidth/2),t.save(),s.fillLineDash&&t.setLineDash(s.fillLineDash),s.fillLineDashOffset&&(t.lineDashOffset=s.fillLineDashOffset),t.strokeStyle=s.fill||"",t.lineWidth=o,pt(t,e),t.restore()},gt=(t,e)=>{const s=e.sets||[],o=e.options;for(const i of s)switch(i.type){case"path":t.save(),t.strokeStyle="none"===o.stroke?"transparent":o.stroke,t.lineWidth=o.strokeWidth,o.strokeLineDash&&t.setLineDash(o.strokeLineDash),o.strokeLineDashOffset&&(t.lineDashOffset=o.strokeLineDashOffset),pt(t,i),t.restore();break;case"fillPath":t.save(),t.fillStyle=o.fill||"";const s="curve"===e.shape||"polygon"===e.shape?"evenodd":"nonzero";pt(t,i,s),t.restore();break;case"fillSketch":wt(t,i,o)}};var ut,yt,mt,vt=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},Et=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class St extends lt{constructor(t){super(t),this.type=z.Z.RECT_ROUGH,ut.set(this,void 0),yt.set(this,void 0),mt.set(this,!1),this.prevWidth=0,this.prevHeight=0,this.onDragMoveSubRect=t=>{this.cbMap.call("dragmove",t);const e=this.getSizePosSubRect();this.sizeTransform?.update(e),this.shape?.setAttrs(e)},this.onDragMoveAnchor=t=>{this.substrateKonvaShape?.setAttrs(t),this.setShapeAttrs(t)},this.getSizePosSubRect=()=>{const{x:t,y:e,width:s,height:o}=this.substrateKonvaShape?.getAttrs();return{x:t,y:e,width:s,height:o}},this.props={...t};const e=_s();vt(this,ut,B.Z.canvas(e),"f")}defineShape(){this.shape=new Z.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:(t,e)=>{const s=e.getWidth(),o=e.getHeight(),i=e.getStroke(),r=e.getStrokeWidth();s===this.prevWidth&&o===this.prevHeight&&Et(this,yt,"f")?(Et(this,yt,"f").options.stroke=i,Et(this,yt,"f").options.strokeWidth=r):(this.prevWidth=s,this.prevHeight=o,vt(this,yt,Et(this,ut,"f").generator.rectangle(0,0,s,o,{roughness:2.5,stroke:i,strokeWidth:r}),"f")),gt(t,Et(this,yt,"f")),t.fillStrokeShape(e)}}),this.substrateKonvaShape=new Z.Z.Rect({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:"transparent",fill:"transparent",draggable:!0}),this.shape.on("dragstart",(()=>{vt(this,mt,!0,"f")})),this.shape.on("dragend",(()=>{vt(this,mt,!1,"f")})),this.substrateKonvaShape.on("dragstart",(()=>{vt(this,mt,!0,"f")})),this.substrateKonvaShape.on("dragend",(()=>{vt(this,mt,!1,"f")})),this.substrateKonvaShape.on("click",(t=>{this.onClick(t)})),this.substrateKonvaShape.on("dragstart",(()=>{this.onDragStart()})),this.substrateKonvaShape.on("mouseover",(()=>{this.cbMap.call("mouseover")})),this.substrateKonvaShape.on("mouseout",(()=>{this.cbMap.call("mouseout")}))}setStrokeWidth(t){super.setStrokeWidth(t/2)}getStrokeWidth(){return 2*super.getStrokeWidth()}addToLayer(t,e){if(super.addToLayer(t,e),!this.substrateKonvaShape)throw new Error("`this.substrateKonvaShape` is not defined");this.substrateKonvaShape.on("dragmove",this.onDragMoveSubRect),t.add(this.substrateKonvaShape)}draggable(t){const e=super.draggable(t);return this.substrateKonvaShape?.setAttr("draggable",t),e}initDraw(t,e){this.substrateKonvaShape?.setAttrs({x:t.x,y:t.y,width:e.x-t.x,height:e.y-t.y}),super.initDraw(t,e)}destroy(){super.destroy(),this.substrateKonvaShape?.destroy()}scale(t){super.scale(t);const{x:e,y:s,width:o,height:i}=this.getAttrs();this.substrateKonvaShape?.setAttrs({x:e,y:s,width:o,height:i})}crop(t){super.crop(t);const{x:e,y:s}=this.getAttrs();this.substrateKonvaShape?.setAttrs({x:e,y:s})}clone(){return new St(this.getCloningProps())}}ut=new WeakMap,yt=new WeakMap,mt=new WeakMap;const bt=St;var xt,Tt,At,Pt=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},kt=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class Rt extends lt{constructor(t){super(t),this.type=z.Z.ELLIPSE_ROUGH,xt.set(this,void 0),Tt.set(this,void 0),At.set(this,!1),this.prevWidth=0,this.prevHeight=0,this.props={...t};const e=_s();Pt(this,xt,B.Z.canvas(e),"f")}defineShape(){this.shape=new Z.Z.Shape({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth/2,fill:"transparent",draggable:!0,sceneFunc:(t,e)=>{const s=e.getWidth(),o=e.getHeight();s===this.prevWidth&&o===this.prevHeight&&kt(this,Tt,"f")?kt(this,Tt,"f").options.stroke=e.getStroke():(this.prevWidth=s,this.prevHeight=o,Pt(this,Tt,kt(this,xt,"f").generator.ellipse(s/2,o/2,s,o,{roughness:2.5,stroke:e.getStroke()}),"f")),gt(t,kt(this,Tt,"f")),t.fillStrokeShape(e)}}),this.shape.on("dragstart",(()=>{Pt(this,At,!0,"f")})),this.shape.on("dragend",(()=>{Pt(this,At,!1,"f")}))}setStrokeWidth(t){super.setStrokeWidth(t/2)}getStrokeWidth(){return 2*super.getStrokeWidth()}scale(t){super.scale(t)}clone(){return new Rt(this.getCloningProps())}}xt=new WeakMap,Tt=new WeakMap,At=new WeakMap;const Lt=Rt;var Ct=s(7085);const Mt={cursor:C.AUTO,shapesLayer:new Z.Z.Layer,anchorsLayer:new Z.Z.Layer,list:[],addingShapeRef:null},Zt=(0,T.Z)({[`${n}`]:(t,e)=>{e.payload.addToLayer(t.shapesLayer,t.anchorsLayer);const s=[...t.list,e.payload];return r().get(e.payload,"type")===z.Z.IMAGE&&I({addedShape:e.payload}),t.shapesLayer.draw(),t.anchorsLayer.draw(),{...t,list:s}},[`${m}`]:(t,e)=>{t.addingShapeRef&&e.payload?.type&&t.addingShapeRef.type!==e.payload.type&&t.addingShapeRef.destroy();const s=r().get(e.payload,"type",null),o=r().get(e.payload,"options",null);let i=null;switch(s){case z.Z.ARROW:i=qe(void 0,o);break;case z.Z.TEXT:i=Qe(void 0,o);break;case z.Z.RECT:case z.Z.RECT_ROUGH:case z.Z.ELLIPSE:case z.Z.ELLIPSE_ROUGH:case z.Z.SELECT_RECT:i=es(void 0,o,s);break;case null:i=null;break;default:console.error(`Can't set adding shape for the selected shape type: ${s}`)}return{...t,addingShapeRef:i}},[`${v}`]:(t,e)=>{const s=e.payload;return I({addedShape:s}),t},[`${p}`]:t=>(t.list.forEach((t=>t.destroy())),t.shapesLayer.draw(),t.anchorsLayer.draw(),O({}),{...t,list:[]}),[`${w}`]:(t,e)=>{const s=t.list.find((t=>t===e.payload));s&&s.destroy(),_();const o=t.list.filter((t=>t!==e.payload));return O({deletedShape:s}),{...t,list:o}},[`${g}`]:(t,e)=>(t.list.forEach((t=>{t!==e.payload&&t.blur()})),t.anchorsLayer.draw(),t.shapesLayer.draw(),_(),t),[`${y}`]:(t,e)=>(t.list.forEach((t=>{t.crop(e.payload)})),t.shapesLayer.draw(),t.anchorsLayer.draw(),t),[`${l}`]:t=>{const e=t.list.find((t=>t.isSelected()));e&&e.destroy(),t.shapesLayer.draw(),t.anchorsLayer.draw(),_();const s=t.list.filter((t=>t!==e));return O({deletedShape:e}),{...t,list:s}},[`${S}`]:(t,e)=>{const s=e.payload;return t.list.find((t=>t.isSelected()))?.zIndex(s===Ct.Q.BringToFront?2*t.list.length:0),t},[`${h}`]:(t,e)=>({...t,cursor:e.payload}),[`${c}`]:(t,e)=>{const s=t.list.find((t=>t.isSelected()));switch(s?.type){case z.Z.ARROW:case z.Z.RECT:case z.Z.RECT_ROUGH:case z.Z.ELLIPSE:case z.Z.ELLIPSE_ROUGH:s.setStrokeColor(e.payload);break;case z.Z.TEXT:s.setFillColor(e.payload);break;default:console.error("Can't set stroke color for the selected shape"),console.log(s)}return t.shapesLayer.draw(),t},[`${d}`]:(t,e)=>{const s=t.list.find((t=>t.isSelected()));switch(s?.type){case z.Z.ARROW:case z.Z.RECT:case z.Z.RECT_ROUGH:case z.Z.ELLIPSE:case z.Z.ELLIPSE_ROUGH:s.setStrokeWidth(e.payload);break;default:console.error("Can't set stroke width for the selected shape"),console.log(s)}return t.shapesLayer.draw(),t},[`${f}`]:(t,e)=>{const s=t.list.find((t=>t.isSelected()));return s?.type===z.Z.TEXT?s.setFontSize(e.payload):(console.error("Can't set font size for the selected shape"),console.log(s)),t.shapesLayer.draw(),t.anchorsLayer.draw(),t},[`${u}`]:(t,e)=>(e.payload&&t.list.forEach((t=>t.scale(e.payload))),t.shapesLayer.draw(),t),[`${E}`]:(t,e)=>{switch(e.payload){case M.SHAPES_LAYER:t.shapesLayer.draw();break;case M.ANCHORS_LAYER:t.anchorsLayer.draw();break;default:t.shapesLayer.draw(),t.anchorsLayer.draw()}return t},[`${b}`]:t=>{const e=t.list.find((t=>t.isSelected()));switch(e?.type){case z.Z.RECT:case z.Z.ELLIPSE:const s=e.getCloningProps(),o=e?.type===z.Z.RECT?bt:Lt,i=es(new o(s));i.addToLayer(t.shapesLayer,t.anchorsLayer);const r=t.list.map((t=>t===e?(t.destroy(),i):t));return t.shapesLayer.draw(),t.anchorsLayer.draw(),I({addedShape:i}),{...t,list:r};default:console.error("Can't sketchify the selected shape"),console.log(e)}return t}},Mt),Dt=(0,a.Z)("SET_SAVE_STAGE"),Wt=(0,a.Z)("SAVE_STAGE"),_t=(0,a.Z)("COPY_STAGE"),It=(0,T.Z)({[`${Dt}`]:(t,e)=>({...t,instance:e.payload}),[`${Wt}`]:(t,e)=>{const s=e.payload;if(!t.instance)throw new Error("SaveStage is not defined");return t.instance.saveFromLayer(s.layer,s.name,s.contentRect),t},[`${_t}`]:(t,e)=>{const s=e.payload;if(!t.instance)throw new Error("SaveStage is not defined");return t.instance.copyFromLayer(s.layer,s.contentRect),t}},{instance:null}),Ot=(0,x.UY)({stage:L,shapes:Zt,saveCanvas:It}),Ht=(0,x.MT)(Ot,(0,x.md)());var zt,Bt,Ut,Ft=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},$t=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class jt extends G{constructor(t,e={}){super(),this.type=z.Z.IMAGE,zt.set(this,void 0),Bt.set(this,void 0),Ut.set(this,void 0),this.onDragMove=()=>{$t(this,Ut,"f")?.update(this.getSizePos())},this.onDragMoveAnchor=t=>{$t(this,zt,"f")?.setAttrs(t)},this.getSizePos=()=>({x:$t(this,zt,"f").x(),y:$t(this,zt,"f").y(),width:$t(this,zt,"f").width(),height:$t(this,zt,"f").height()}),Ft(this,Bt,e,"f"),t instanceof Z.Z.Image?Ft(this,zt,t,"f"):Ft(this,zt,new Z.Z.Image({image:t,draggable:!0,x:e.x,y:e.y,width:e.width,height:e.height}),"f")}addToLayer(t,e){super.addToLayer(t,e),$t(this,zt,"f").on("dragmove",this.onDragMove),Ft(this,Ut,new dt(this.getSizePos()),"f"),$t(this,Ut,"f")?.setOriginRatio($t(this,zt,"f").width()/$t(this,zt,"f").height()),$t(this,Ut,"f").on("_dragmoveanchor",this.onDragMoveAnchor),super.attachBasicEvents($t(this,zt,"f")),t.add($t(this,zt,"f")),$t(this,Ut,"f").addToLayer(e)}destroy(){super.destroy(),$t(this,zt,"f").destroy(),$t(this,Ut,"f")?.destroy()}getSelfRect(){const t=$t(this,zt,"f").getAbsolutePosition(),e=$t(this,zt,"f").getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}blur(){super.blur(),$t(this,Ut,"f")?.hide()}focus(){super.focus(),$t(this,Ut,"f")?.show()}draggable(t){return $t(this,zt,"f")?.setAttr("draggable",t),$t(this,zt,"f")?.getAttr("draggable")}zIndex(t){if(void 0===t)return $t(this,zt,"f").zIndex();$t(this,zt,"f").zIndex(t)}clone(){return new jt($t(this,zt,"f").clone(),{...this.getSizePos()})}initDraw(t,e){}scale(t){}}zt=new WeakMap,Bt=new WeakMap,Ut=new WeakMap;const Gt=jt;var Nt,Yt,Kt,Xt,Vt,qt=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},Jt=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};const Qt={radius:5,stroke:"#855824",fill:"#dddd45",strokeWidth:1},te={radius:6,stroke:"#666",fill:"#ddd",strokeWidth:1};var ee;!function(t){t.START="start",t.CONTROL="control",t.END="end"}(ee||(ee={})),Nt=new WeakMap,Yt=new WeakMap,Kt=new WeakMap,Xt=new WeakMap,Vt=new WeakMap;const se=class{constructor(t,e,s){Nt.set(this,void 0),Yt.set(this,new F),Kt.set(this,void 0),Xt.set(this,void 0),Vt.set(this,void 0),this.on=(t,e)=>{Jt(this,Yt,"f").set(t,e)};let o={x:t,y:e,draggable:!0,visible:!1,...te};s===ee.CONTROL&&(o={...o,...Qt}),qt(this,Nt,new Z.Z.Circle(o),"f"),qt(this,Vt,{x:t,y:e},"f"),qt(this,Kt,{x:0,y:0},"f"),qt(this,Xt,{x:0,y:0},"f"),this.initEvents()}initEvents(){Jt(this,Nt,"f").on("mouseover",Jt(this,Yt,"f").get("mouseover")),Jt(this,Nt,"f").on("mouseout",Jt(this,Yt,"f").get("mouseout")),Jt(this,Nt,"f").on("mousedown",Jt(this,Yt,"f").get("mousedown")),Jt(this,Nt,"f").on("mouseup",Jt(this,Yt,"f").get("mouseup")),Jt(this,Nt,"f").on("dragend",(()=>{Jt(this,Yt,"f").call("dragend");const t=this.getPosition();Jt(this,Vt,"f").x=t.x,Jt(this,Vt,"f").y=t.y,Jt(this,Xt,"f").x=Jt(this,Kt,"f").x,Jt(this,Xt,"f").y=Jt(this,Kt,"f").y})),Jt(this,Nt,"f").on("dragmove",r().throttle(((...t)=>{Jt(this,Yt,"f").call("dragmove",...t)}),50))}getAnchor(){return Jt(this,Nt,"f")}setPosition(t,e){Jt(this,Nt,"f").setAttr("x",t),Jt(this,Nt,"f").setAttr("y",e),Jt(this,Vt,"f").x=t,Jt(this,Vt,"f").y=e,Jt(this,Xt,"f").x=Jt(this,Kt,"f").x,Jt(this,Xt,"f").y=Jt(this,Kt,"f").y}getPosition(){const{x:t,y:e}=Jt(this,Nt,"f").getAttrs();return{x:t,y:e}}draw(){Jt(this,Nt,"f").draw()}setDelta(t=0,e=0){Jt(this,Nt,"f").setAttr("x",Jt(this,Vt,"f").x+(t-Jt(this,Xt,"f").x)),Jt(this,Nt,"f").setAttr("y",Jt(this,Vt,"f").y+(e-Jt(this,Xt,"f").y)),Jt(this,Kt,"f").x=t,Jt(this,Kt,"f").y=e}setAttr(t,e){Jt(this,Nt,"f").setAttr(t,e)}visible(t){Jt(this,Nt,"f").visible(t)}destroy(){Jt(this,Nt,"f").destroy()}},oe=(t,e)=>{const s=0-Math.abs(e.x),o=t.x-e.x,i=t.y-e.y,r=s*o+0*i,a=Math.sqrt(s**2+0)*Math.sqrt(o**2+i**2);if(0===a)return 0;const n=Math.acos(r/a);return t.y>e.y?2*Math.PI-n:n},ie=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2);var re,ae,ne,he,ce=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},de=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class fe{constructor(t){re.set(this,void 0),ae.set(this,void 0),ne.set(this,void 0),he.set(this,new F),this.moveStart=()=>{if(!de(this,re,"f"))throw new Error("`this.#anchors` is not defined");const t=de(this,re,"f").start.getPosition(),e=de(this,re,"f").end.getPosition(),s=oe(t,e),o=s-de(this,ne,"f").angles.start,i=this.calculateMovedControlPos(this.calculateRotatedControlPos(o,e),"end");de(this,re,"f").control.setPosition(i.x,i.y),this.moveControl(),de(this,ne,"f").start=t,de(this,ne,"f").control=i,de(this,ne,"f").end=e,de(this,ne,"f").angles.start=s,de(this,ne,"f").angles.end=Math.PI+s},this.moveControl=()=>{de(this,he,"f").call("dragmove")},this.moveEnd=()=>{if(!de(this,re,"f"))throw new Error("`this.#anchors` is not defined");const t=de(this,re,"f").start.getPosition(),e=de(this,re,"f").end.getPosition(),s=oe(e,t),o=s-de(this,ne,"f").angles.end,i=this.calculateMovedControlPos(this.calculateRotatedControlPos(o,t),"start");de(this,re,"f").control.setPosition(i.x,i.y),this.moveControl(),de(this,ne,"f").start=t,de(this,ne,"f").control=i,de(this,ne,"f").end=e,de(this,ne,"f").angles.start=Math.PI+s,de(this,ne,"f").angles.end=s},this.onDragEnd=()=>{de(this,he,"f").call("dragend")},this.visible=t=>{de(this,re,"f")?.start.visible(t),de(this,re,"f")?.control.visible(t),de(this,re,"f")?.end.visible(t)},this.on=(t,e)=>{de(this,he,"f").set(t,e)},ce(this,ae,t,"f"),ce(this,ne,{start:{x:0,y:0},control:{x:0,y:0},end:{x:0,y:0},angles:{start:r().get(t,"angles.start",0),control:r().get(t,"angles.control",0),end:r().get(t,"angles.end",Math.PI)}},"f")}static defineAnchors(t,e,s){let o,i,r,a,n,h;return s?(o=s.start.x,i=s.start.y,r=s.control.x,a=s.control.y,n=s.end.x,h=s.end.y):(o=t.width/4,i=t.height/2,r=t.width/2,a=i,n=3*o,h=i,Math.abs(n-o)>e&&(o=r-e/2,n=r+e/2)),{start:new se(o,i,ee.START),control:new se(r,a,ee.CONTROL),end:new se(n,h,ee.END)}}calculateRotatedControlPos(t,e){if(!de(this,re,"f"))throw new Error("`this.#anchors` is not defined");const s=de(this,re,"f").control.getPosition(),o=s.x-e.x,i=s.y-e.y,r=Math.cos(t),a=Math.sin(t),n=i*r+o*a;return{x:o*r-i*a+e.x,y:n+e.y}}calculateMovedControlPos(t,e){if(!de(this,re,"f"))throw new Error("`this.#anchors` is not defined");const s=ie(de(this,ne,"f").start,de(this,ne,"f").end),o=de(this,re,"f").start.getPosition(),i=de(this,re,"f").end.getPosition(),r=ie(o,i)/s,a="start"===e?o:i,n=ie(t,a),h=(a.x-t.x)/n,c=(a.y-t.y)/n,d=n-n*r;return{x:t.x+d*h,y:t.y+d*c}}draw(){de(this,re,"f")?.start.draw(),de(this,re,"f")?.control.draw(),de(this,re,"f")?.end.draw(),Ht.dispatch(E(M.ANCHORS_LAYER))}setAnchors(t,e){ce(this,re,fe.defineAnchors(t,e,de(this,ae,"f")),"f"),de(this,ne,"f").start=de(this,re,"f").start.getPosition(),de(this,ne,"f").control=de(this,re,"f").control.getPosition(),de(this,ne,"f").end=de(this,re,"f").end.getPosition(),de(this,re,"f").start.on("dragmove",this.moveStart),de(this,re,"f").control.on("dragmove",this.moveControl),de(this,re,"f").end.on("dragmove",this.moveEnd),de(this,re,"f").start.on("dragend",this.onDragEnd),de(this,re,"f").control.on("dragend",this.onDragEnd),de(this,re,"f").end.on("dragend",this.onDragEnd)}addToLayer(t){if(!de(this,re,"f"))throw new Error("`this.#anchors` is not defined");t.add(de(this,re,"f").start.getAnchor()),t.add(de(this,re,"f").control.getAnchor()),t.add(de(this,re,"f").end.getAnchor())}getPositions(){return!de(this,re,"f")&&de(this,ae,"f")?de(this,ae,"f"):{start:de(this,re,"f").start.getPosition(),control:de(this,re,"f").control.getPosition(),end:de(this,re,"f").end.getPosition(),angles:de(this,ne,"f")?.angles}}setAnchorsCoordinates(t){de(this,ne,"f").start=t.start,de(this,ne,"f").control=t.control,de(this,ne,"f").end=t.end,de(this,re,"f")?.start.setPosition(t.start.x,t.start.y),de(this,re,"f")?.control.setPosition(t.control.x,t.control.y),de(this,re,"f")?.end.setPosition(t.end.x,t.end.y);const e=oe(t.start,t.end);de(this,ne,"f").angles.start=e,de(this,ne,"f").angles.end=Math.PI+e}setDelta(t,e){de(this,re,"f")?.start.setDelta(t,e),de(this,re,"f")?.control.setDelta(t,e),de(this,re,"f")?.end.setDelta(t,e)}destroy(){de(this,re,"f")?.start?.destroy(),de(this,re,"f")?.control?.destroy(),de(this,re,"f")?.end?.destroy()}}re=new WeakMap,ae=new WeakMap,ne=new WeakMap,he=new WeakMap;const le=fe;var pe,we,ge,ue,ye=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},me=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};const ve=t=>t*(Math.PI/180);class Ee{constructor(t){pe.set(this,void 0),we.set(this,new F),ge.set(this,void 0),ue.set(this,void 0),this.on=(t,e)=>{me(this,we,"f").set(t,e)},ye(this,pe,new Z.Z.Line({lineCap:"round",lineJoin:"round",stroke:t.stroke,strokeWidth:t.strokeWidth,points:Ee.calculateHeadPoints(t.start,t.control,t.strokeWidth)}),"f"),me(this,pe,"f").on("click",(t=>{me(this,we,"f").call("click",t)})),me(this,pe,"f").on("mouseover",(t=>{me(this,we,"f").call("mouseover",t)})),me(this,pe,"f").on("mouseout",(t=>{me(this,we,"f").call("mouseout",t)})),ye(this,ge,{x:0,y:0},"f"),ye(this,ue,{x:0,y:0},"f")}static calculateHeadPoints(t,e,s){const o={x:0,y:0},i={x:0,y:0};let r;const a=t.x-e.x,n=t.y-e.y;0===a?r=t.y<e.y?ve(90):ve(270):(r=Math.atan(n/a),a>0&&(r+=ve(180)));const h=10*s,c=ve(Math.min(40,h<20?20:h)),d=Math.min(14,4.5*s),f=c-r;o.x=t.x+d*Math.cos(f),o.y=t.y-d*Math.sin(f);const l=ve(90)-(r+c);return i.x=t.x+d*Math.sin(l),i.y=t.y+d*Math.cos(l),[i.x,i.y,t.x,t.y,o.x,o.y]}update(t,e,s){me(this,pe,"f").setPoints(Ee.calculateHeadPoints(t,e,s)),me(this,pe,"f").setAttrs({x:0,y:0,strokeWidth:s}),me(this,pe,"f").draw(),me(this,ue,"f").x=me(this,ge,"f").x,me(this,ue,"f").y=me(this,ge,"f").y}draw(){me(this,pe,"f").draw()}zIndex(t){me(this,pe,"f")?.zIndex(t)}setDelta(t=0,e=0){me(this,pe,"f").setAttr("x",t-me(this,ue,"f").x),me(this,pe,"f").setAttr("y",e-me(this,ue,"f").y),me(this,ge,"f").x=t,me(this,ge,"f").y=e}setAttr(t,e){me(this,pe,"f").setAttr(t,e)}addToLayer(t){t.add(me(this,pe,"f"))}destroy(){me(this,pe,"f").destroy()}}pe=new WeakMap,we=new WeakMap,ge=new WeakMap,ue=new WeakMap;const Se=Ee;var be,xe,Te,Ae,Pe,ke=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},Re=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class Le extends G{constructor(t){super(),this.type=z.Z.ARROW,be.set(this,void 0),xe.set(this,void 0),Te.set(this,void 0),Ae.set(this,void 0),Pe.set(this,void 0),this.redrawArrow=(t=!1)=>{const e=Re(this,xe,"f").getPositions(),s=this.getPathString(e);Re(this,Ae,"f")?.setData(s),Re(this,Te,"f")?.setData(s),Re(this,Pe,"f")?.update(e.start,e.control,Re(this,be,"f").strokeWidth),t&&Ht.dispatch(E())},this.pathMove=()=>{if(!Re(this,Te,"f"))throw new Error("`this.#substratePath` is not defined");const t=Re(this,Te,"f").attrs.x,e=Re(this,Te,"f").attrs.y;Re(this,xe,"f").setDelta(t,e),Re(this,Ae,"f")?.setAttrs({x:t,y:e}),Re(this,Pe,"f")?.setDelta(t,e),Re(this,Pe,"f")?.draw(),Re(this,xe,"f").draw()},this.blur=()=>{super.blur(),Re(this,xe,"f").visible(!1)},this.onAnchor=(t,e)=>{Re(this,xe,"f").on(t,e)},ke(this,be,{...t},"f"),ke(this,xe,new le(Re(this,be,"f").anchorsPosition),"f")}initArrowDraw(t,e){ke(this,Te,new Z.Z.Path({data:t,stroke:"transparent",strokeWidth:12,draggable:!0}),"f"),ke(this,Ae,new Z.Z.Path({data:t,stroke:Re(this,be,"f").stroke||"red",strokeWidth:Re(this,be,"f").strokeWidth,lineCap:"round",lineJoin:"round"}),"f"),Re(this,Te,"f").on("dragmove",this.pathMove),this.attachBasicEvents(Re(this,Te,"f")),e.add(Re(this,Ae,"f")),e.add(Re(this,Te,"f"))}getPathString(t){const e=r().get(Re(this,Ae,"f"),"attrs.x",0),s=r().get(Re(this,Ae,"f"),"attrs.y",0);return`M${t.start.x-e},${t.start.y-s} Q${t.control.x-e},${t.control.y-s} ${t.end.x-e},${t.end.y-s}`}focus(){super.focus(),Re(this,xe,"f").visible(!0)}addToLayer(t,e){Re(this,xe,"f").setAnchors({width:t.parent.attrs.width,height:t.parent.attrs.height},300),Re(this,xe,"f").on("dragmove",(()=>this.redrawArrow(!0))),Re(this,xe,"f").on("dragend",(()=>this.redrawArrow(!0)));const s=Re(this,xe,"f").getPositions();ke(this,Pe,new Se({start:s.start,control:s.control,stroke:Re(this,be,"f").stroke||"red",strokeWidth:Re(this,be,"f").strokeWidth}),"f"),Re(this,Pe,"f").on("click",this.onClick);const o=this.getPathString(s);this.initArrowDraw(o,t),Re(this,Pe,"f").addToLayer(t),Re(this,xe,"f").addToLayer(e),this.redrawArrow(),super.addToLayer(t,e)}setStrokeColor(t){Re(this,Ae,"f")?.setAttr("stroke",t),Re(this,Pe,"f")?.setAttr("stroke",t),Re(this,be,"f").stroke=t,Re(this,Ae,"f")?.draw(),Re(this,Pe,"f")?.draw()}getStrokeColor(){return Re(this,be,"f").stroke}setStrokeWidth(t){Re(this,Ae,"f")?.setAttr("strokeWidth",t),Re(this,be,"f").strokeWidth=t,this.redrawArrow()}getSelfRect(){if(!Re(this,Ae,"f"))throw new Error("Arrow is not defined");const t=Re(this,Ae,"f").getAbsolutePosition(),e=Re(this,Ae,"f").getSelfRect();return{x:e.x+t.x,y:e.y+t.y,width:e.width,height:e.height}}getStrokeWidth(){return Re(this,Ae,"f")?.getAttr("strokeWidth")}draggable(t){return Re(this,Te,"f")?.setAttr("draggable",t),Re(this,Te,"f")?.getAttr("draggable")}scale(t){const e=Re(this,xe,"f").getPositions();Re(this,xe,"f").setAnchorsCoordinates({start:{x:e.start.x*t.wFactor,y:e.start.y*t.hFactor},control:{x:e.control.x*t.wFactor,y:e.control.y*t.hFactor},end:{x:e.end.x*t.wFactor,y:e.end.y*t.hFactor}}),this.redrawArrow()}initDraw(t,e){this.isSelected()&&this.blur(),Re(this,xe,"f").setAnchorsCoordinates({start:{x:e.x,y:e.y},control:{x:(t.x+e.x)/2,y:(t.y+e.y)/2},end:{x:t.x,y:t.y}}),this.redrawArrow(!0)}zIndex(t){if(void 0===t)return Re(this,Ae,"f")?.zIndex();Re(this,Te,"f")?.zIndex(t),Re(this,Ae,"f")?.zIndex(t),Re(this,Pe,"f")?.zIndex(t)}crop(t){const e=Re(this,xe,"f").getPositions();Re(this,xe,"f").setAnchorsCoordinates({start:{x:e.start.x-t.x,y:e.start.y-t.y},control:{x:e.control.x-t.x,y:e.control.y-t.y},end:{x:e.end.x-t.x,y:e.end.y-t.y}}),this.redrawArrow()}clone(){const t=Re(this,xe,"f")?Re(this,xe,"f").getPositions():Re(this,be,"f").anchorsPosition;return new Le({...Re(this,be,"f"),anchorsPosition:t})}destroy(){super.destroy(),Re(this,Ae,"f")?.destroy(),Re(this,Te,"f")?.destroy(),Re(this,Pe,"f")?.destroy(),Re(this,xe,"f")?.destroy()}}be=new WeakMap,xe=new WeakMap,Te=new WeakMap,Ae=new WeakMap,Pe=new WeakMap;const Ce=Le;var Me,Ze,De,We=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},_e=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};!function(t){t.fontSize="fontSize",t.color="color"}(De||(De={})),Me=new WeakMap,Ze=new WeakMap;var Ie,Oe,He=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},ze=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};Ie=new WeakMap,Oe=new WeakMap;var Be,Ue,Fe,$e=function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(t,s):i?i.value=s:e.set(t,s),s},je=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class Ge extends G{constructor(t){super(),this.type=z.Z.TEXT,Be.set(this,void 0),Ue.set(this,void 0),Fe.set(this,void 0),this.focus=()=>{super.focus(),je(this,Fe,"f")?.show()},$e(this,Be,{...t},"f")}addToLayer(t,e){const s=je(this,Be,"f").x||t.parent.attrs.width/2-100,o=je(this,Be,"f").y||t.parent.attrs.height/2-10;$e(this,Ue,new class{constructor(t){Ie.set(this,void 0),Oe.set(this,void 0),this.makeEditable=()=>{ze(this,Ie,"f").hide();const{stage:t}=Ht.getState(),e=t.instance?.absolutePosition();if(!e)throw new Error("Stage is not defined");const s=ze(this,Ie,"f").position();ze(this,Oe,"f").update({value:ze(this,Ie,"f").text(),top:s.y+e.y,left:s.x+e.x,width:ze(this,Ie,"f").width()-2*ze(this,Ie,"f").padding(),height:ze(this,Ie,"f").height()-2*ze(this,Ie,"f").padding()+5,fontSize:ze(this,Ie,"f").fontSize(),lineHeight:ze(this,Ie,"f").lineHeight(),fontFamily:ze(this,Ie,"f").fontFamily(),textAlign:ze(this,Ie,"f").align(),color:ze(this,Ie,"f").fill(),rotation:ze(this,Ie,"f").rotation()}),ze(this,Oe,"f").focus()},He(this,Ie,new Z.Z.Text({...t,draggable:!0}),"f"),ze(this,Ie,"f").on("transform",(()=>{ze(this,Ie,"f").setAttrs({width:ze(this,Ie,"f").width()*ze(this,Ie,"f").scaleX(),scaleX:1})})),He(this,Oe,new class{constructor(t,e=""){Me.set(this,void 0),Ze.set(this,void 0),this.onKeyDown=()=>{const t=_e(this,Ze,"f").getAbsoluteScale().x;this.setTextareaWidth(_e(this,Ze,"f").width()*t),_e(this,Me,"f").style.height="auto",_e(this,Me,"f").style.height=`${_e(this,Me,"f").scrollHeight+_e(this,Ze,"f").fontSize()}px`},We(this,Ze,t,"f"),We(this,Me,document.createElement("textarea"),"f"),_e(this,Me,"f").value=e,document.body.appendChild(_e(this,Me,"f")),_e(this,Me,"f").addEventListener("keydown",this.onKeyDown),_e(this,Me,"f").style.display="none"}setTextareaWidth(t){t||(t=_e(this,Ze,"f").placeholder.length*_e(this,Ze,"f").fontSize());const e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),s=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;(e||s)&&(t=Math.ceil(t)),(document.documentMode||/Edge/.test(navigator.userAgent))&&(t+=1),_e(this,Me,"f").style.width=`${t}px`}update(t){_e(this,Me,"f").style.display="initial",_e(this,Me,"f").value=t.value,_e(this,Me,"f").style.position="absolute",_e(this,Me,"f").style.top=`${t.top}px`,_e(this,Me,"f").style.left=`${t.left}px`,_e(this,Me,"f").style.width=`${t.width}px`,_e(this,Me,"f").style.height=`${t.height}px`,_e(this,Me,"f").style.fontSize=`${t.fontSize}px`,_e(this,Me,"f").style.fontFamily="Lato, Arial",_e(this,Me,"f").style.border="1px dashed #2196f3",_e(this,Me,"f").style.padding="0px",_e(this,Me,"f").style.margin="0px",_e(this,Me,"f").style.overflow="hidden",_e(this,Me,"f").style.background="none",_e(this,Me,"f").style.outline="none",_e(this,Me,"f").style.resize="none",_e(this,Me,"f").style.lineHeight=t.lineHeight,_e(this,Me,"f").style.fontFamily=t.fontFamily,_e(this,Me,"f").style.transformOrigin="left top",_e(this,Me,"f").style.textAlign=t.textAlign,_e(this,Me,"f").style.color=t.color;let e=`rotateZ(${t.rotation}deg)`;navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(e+=`translateY(-${2+Math.round(t.fontSize/20)}px)`),_e(this,Me,"f").style.transform=e,_e(this,Me,"f").style.height="auto",_e(this,Me,"f").style.height=_e(this,Me,"f").scrollHeight+3+"px"}setAttr(t,e){switch(t){case De.fontSize:_e(this,Me,"f").style.fontSize=`${e}px`;break;case De.color:_e(this,Me,"f").style.color=e}}focus(){_e(this,Me,"f").focus()}hide(){_e(this,Me,"f").style.display="none"}getValue(){return _e(this,Me,"f").value}destroy(){_e(this,Me,"f").removeEventListener("keydown",this.onKeyDown),_e(this,Me,"f").parentNode?.removeChild(_e(this,Me,"f"))}}(ze(this,Ie,"f"),t.text),"f")}blur(){ze(this,Ie,"f").text(ze(this,Oe,"f").getValue()),ze(this,Oe,"f").hide(),ze(this,Ie,"f").show()}setAttr(t,e){switch(ze(this,Ie,"f").setAttr(t,e),t){case"fontSize":ze(this,Oe,"f").setAttr(De.fontSize,e);break;case"fill":ze(this,Oe,"f").setAttr(De.color,e)}}draggable(t){return ze(this,Ie,"f").setAttr("draggable",t),ze(this,Ie,"f").getAttr("draggable")}on(t,e){ze(this,Ie,"f").on(t,e)}addToLayer(t){t.add(ze(this,Ie,"f"))}setPosition(t,e){ze(this,Ie,"f").setAttrs({x:t,y:e})}getPosition(){return{x:ze(this,Ie,"f").attrs.x,y:ze(this,Ie,"f").attrs.y}}zIndex(t){if(void 0===t)return ze(this,Ie,"f")?.zIndex();ze(this,Ie,"f")?.zIndex(t)}getText(){return ze(this,Ie,"f").attrs.text}getRotation(){return ze(this,Ie,"f").rotation()}getAttrs(){return ze(this,Ie,"f").getAttrs()}getNode(){return ze(this,Ie,"f")}getSelfRect(){return{...this.getPosition(),width:ze(this,Ie,"f").width(),height:ze(this,Ie,"f").height()}}destroy(){ze(this,Ie,"f")?.destroy(),ze(this,Oe,"f")?.destroy()}}({text:je(this,Be,"f").text||"Some text here",x:s,y:o,fontFamily:"Lato, Arial",fontSize:je(this,Be,"f").fontSize||20,width:je(this,Be,"f").width||200,fill:je(this,Be,"f").fill,rotation:je(this,Be,"f").rotation??0}),"f"),this.attachBasicEvents(je(this,Ue,"f")),je(this,Ue,"f").addToLayer(t),$e(this,Fe,new Z.Z.Transformer({node:je(this,Ue,"f").getNode(),enabledAnchors:["middle-left","middle-right"],borderStroke:"#2196f3",anchorStroke:"#2196f3",anchorFill:"#ffffff",borderStrokeWidth:1,anchorStrokeWidth:1,boundBoxFunc:function(t,e){return e.width=Math.max(30,e.width),e}}),"f"),je(this,Ue,"f").on("dblclick",(()=>{je(this,Ue,"f")?.makeEditable(),je(this,Fe,"f")?.hide(),Ht.dispatch(E(M.SHAPES_LAYER)),Ht.dispatch(E(M.ANCHORS_LAYER))})),je(this,Ue,"f").on("click",this.focus),je(this,Ue,"f").on("transform",(()=>{Ht.dispatch(E(M.SHAPES_LAYER))})),je(this,Fe,"f").hide(),e.add(je(this,Fe,"f")),super.addToLayer(t,e)}setFillColor(t){je(this,Ue,"f")?.setAttr("fill",t),je(this,Be,"f").fill=t}getFillColor(){return je(this,Be,"f").fill}setFontSize(t){je(this,Ue,"f")?.setAttr("fontSize",t),je(this,Be,"f").fontSize=t}blur(){super.blur(),je(this,Ue,"f")?.blur(),je(this,Fe,"f")?.hide()}scale(t){if(!je(this,Ue,"f"))throw new Error("`this.#textNode` is not defined");const e=je(this,Ue,"f").getPosition();je(this,Ue,"f").setPosition(e.x*t.wFactor,e.y*t.hFactor)}setAttrs(t){Object.keys(t).forEach((e=>{je(this,Ue,"f")?.setAttr(e,t[e])}))}crop(t){if(!je(this,Ue,"f"))throw new Error("`this.#textNode` is not defined");const e=je(this,Ue,"f").getPosition();je(this,Ue,"f").setPosition(e.x-t.x,e.y-t.y)}draggable(t){return je(this,Ue,"f")?.draggable(t)??!1}zIndex(t){if(void 0===t)return je(this,Ue,"f")?.zIndex();je(this,Ue,"f")?.zIndex(t)}clone(){const t=je(this,Ue,"f")?.getText(),e=je(this,Ue,"f")?.getRotation(),s=r().get(je(this,Ue,"f")?.getAttrs(),"width");return new Ge({...je(this,Be,"f"),...je(this,Ue,"f")?.getPosition(),...t&&{text:t},...e&&{rotation:e},...s&&{width:s}})}getSelfRect(){if(!je(this,Ue,"f"))throw new Error("TextNode is not defined");return je(this,Ue,"f").getSelfRect()}initDraw(t,e){this.setAttrs({x:t.x,y:t.y,rotation:oe(t,e)*(180/Math.PI)}),Ht.dispatch(E(M.SHAPES_LAYER))}destroy(){super.destroy(),je(this,Ue,"f")?.destroy(),je(this,Fe,"f")?.destroy()}}Be=new WeakMap,Ue=new WeakMap,Fe=new WeakMap;const Ne=Ge,Ye=class extends lt{constructor(t){super({...t,stroke:"#0d87dc",fill:"transparent",strokeWidth:2,dash:[10,5]}),this.type=z.Z.SELECT_RECT}blur(){super.blur(),this.destroy()}scale(){this.destroy()}};class Ke extends lt{constructor(t){super(t),this.type=z.Z.ELLIPSE,this.getSizePos=()=>{const{x:t,y:e,radiusX:s,radiusY:o}=this.getAttrs();return{x:t-s,y:e-o,width:2*s,height:2*o}},this.onDragMoveAnchor=t=>{t.x=t.x+t.width/2,t.y=t.y+t.height/2,this.setShapeAttrs(t)},this.props={...t}}defineShape(){this.shape=new Z.Z.Ellipse({x:this.props.x||0,y:this.props.y||0,width:this.props.width||0,height:this.props.height||0,dash:this.props.dash,stroke:this.props.stroke,strokeWidth:this.props.strokeWidth,fill:this.props.fill,draggable:!0})}getCloningProps(){const t=this.shape?.getAttrs();return{...this.props,...t&&{x:t.x-t.radiusX,y:t.y-t.radiusY,width:2*t.radiusX,height:2*t.radiusY,stroke:t.stroke,strokeWidth:t.strokeWidth}}}clone(){const t=this.getCloningProps();return t.x+=t.width/4,t.y+=t.height/4,new Ke(t)}scale(t){const{x:e,y:s,radiusX:o,radiusY:i}=this.getAttrs();this.shape?.setAttrs({x:e*t.wFactor,y:s*t.hFactor,width:2*o*t.wFactor,height:2*i*t.hFactor}),this.sizeTransform?.update(this.getSizePos(),!1)}initDraw(t,e){this.blur();const s=e.x-t.x,o=e.y-t.y;this.setAttrs({x:t.x+s/2,y:t.y+o/2,width:Math.abs(s),height:Math.abs(o)})}}const Xe=Ke,Ve=t=>{t.on("click",(t=>{Ht.dispatch(g(t))})),t.on("dragstart",(t=>{Ht.dispatch(g(t))})),t.on("mouseover",(()=>{const{shapes:e,stage:s}=Ht.getState();s.isDraggable?t.draggable(!1):t.draggable(!e.addingShapeRef);const o=e.addingShapeRef?C.AUTO:C.MOVE;s.isDraggable||Ht.dispatch(h(o))})),t.on("mouseout",(()=>{const{stage:t}=Ht.getState();t.isDraggable||Ht.dispatch(h(C.AUTO))}))},qe=(t,e)=>{const s=t||new Ce({stroke:r().get(e,"strokeColor","green"),strokeWidth:r().get(e,"strokeWidth")});return s.onAnchor("mouseover",(()=>Ht.dispatch(h(C.POINTER)))),s.onAnchor("mouseout",(()=>Ht.dispatch(h(C.AUTO)))),Ve(s),s},Je=t=>{Ht.dispatch(n(t))},Qe=(t,e)=>{const s=t||new Ne({fill:r().get(e,"fillColor","green"),fontSize:r().get(e,"fontSize")});return Ve(s),s},ts=t=>{Ht.dispatch(n(t))},es=(t,e,s)=>{const o={stroke:r().get(e,"strokeColor","green"),fill:r().get(e,"fill","transparent"),strokeWidth:r().get(e,"strokeWidth",2)},i=(()=>{if(t)return t;switch(s){case z.Z.RECT:return new lt(o);case z.Z.RECT_ROUGH:return new bt(o);case z.Z.ELLIPSE:return new Xe(o);case z.Z.ELLIPSE_ROUGH:return new Lt(o);case z.Z.SELECT_RECT:return new Ye}})();if(!i)throw new Error("rectNode is not defined");return Ve(i),i},ss=t=>{Ht.dispatch(n(t))},os=t=>{Ve(t),Ht.dispatch(n(t))},is=t=>{const{stage:e}=Ht.getState();if(!e.instance)throw new Error("Stage is not defined");const s=e.instance.absolutePosition(),o=new Gt(t.image,t.pos?{x:t.pos.x-s.x,y:t.pos.y-s.y}:{x:e.instance.width()/2-t.image.width/2-s.x,y:e.instance.height()/2-t.image.height/2-s.y});os(o)};var rs=s(3274);const as={onDelete:["backspace","delete","del"],onCopy:["ctrl+c","command+c"],onPaste:["ctrl+v","command+v"],onActivateDrag:{sequence:"space",action:"keydown"},onDisableDrag:{sequence:"space",action:"keyup"},onActivateRatio:{sequence:"shift",action:"keydown"},onDisableRatio:{sequence:"shift",action:"keyup"}},ns=()=>{const t=(0,o.useRef)([]);(0,o.useEffect)((()=>{const t=r().throttle((()=>{e(),s()}),50);return window.addEventListener("focus",t,{capture:!0}),()=>{window.removeEventListener("focus",t)}}),[]);const e=()=>{const{shapes:t}=Ht.getState();Ht.dispatch(k(!1)),t.list.forEach((t=>{t.draggable(!0)})),Ht.dispatch(h(C.AUTO))},s=()=>{Ht.dispatch(R(!1))};return o.createElement(rs.GlobalHotKeys,{keyMap:as,handlers:{onDelete:()=>{Ht.dispatch(l()),Ht.dispatch(h(C.AUTO))},onCopy:()=>{const{shapes:e}=Ht.getState();var s;s="[Shape]",navigator.clipboard?navigator.clipboard.writeText(s).then((()=>{}),(t=>{console.error("Async: Could not copy text: ",t)})):(t=>{const e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();try{document.execCommand("cut")}catch(t){return console.warn("Copy to clipboard failed.",t),!1}finally{document.body.removeChild(e)}})(s),t.current=e.list.reduce(((t,e)=>e.isSelected()?[...t,e.clone()]:t),[])},onPaste:()=>{Ht.dispatch(g()),t.current.forEach((t=>{((t,e)=>{switch(t.type){case z.Z.ARROW:((t,e)=>{const s=qe(t,e);Je(s)})(t.clone(),e);break;case z.Z.TEXT:((t,e)=>{const s=Qe(t,e);ts(s)})(t.clone(),e);break;case z.Z.RECT:case z.Z.RECT_ROUGH:case z.Z.ELLIPSE:case z.Z.ELLIPSE_ROUGH:((t,e,s)=>{const o=es(t,e,void 0);ss(o)})(t.clone(),e);break;case z.Z.IMAGE:os(t.clone());break;default:console.error("Can't clone and connect given shape"),console.log(t)}})(t)})),t.current=[]},onActivateDrag:()=>{const{shapes:t}=Ht.getState();Ht.dispatch(k(!0)),t.list.forEach((t=>{t.draggable(!1)})),Ht.dispatch(h(C.GRAB))},onDisableDrag:e,onActivateRatio:()=>{Ht.dispatch(R(!0))},onDisableRatio:s}})};var hs=s(3379),cs=s.n(hs),ds=s(7795),fs=s.n(ds),ls=s(569),ps=s.n(ls),ws=s(3565),gs=s.n(ws),us=s(9216),ys=s.n(us),ms=s(4589),vs=s.n(ms),Es=s(4087),Ss={};Ss.styleTagTransform=vs(),Ss.setAttributes=gs(),Ss.insert=ps().bind(null,"head"),Ss.domAPI=fs(),Ss.insertStyleElement=ys(),cs()(Es.Z,Ss),Es.Z&&Es.Z.locals&&Es.Z.locals;const bs=t=>{const{children:e}=t,[s,i]=(0,o.useState)(C.AUTO),a=(0,o.useRef)(r().throttle((()=>{Ht.dispatch(P({width:window.innerWidth,height:window.innerHeight}))}),80)),n=(0,o.useRef)((()=>{const{shapes:t}=Ht.getState();i(t.cursor)}));return(0,o.useEffect)((()=>{window.addEventListener("resize",a.current);const t=Ht.subscribe(n.current);return()=>{window.removeEventListener("resize",a.current),t()}}),[]),o.createElement("div",{style:{cursor:s},className:"CanvasWrapper"},e)};var xs,Ts,As=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};xs=new WeakMap,Ts=new WeakMap;const Ps=(t,e,s)=>{const o=document.createElement("svg");return o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o.setAttribute("width",String(t)),o.setAttribute("height",String(e)),o.setAttribute("style",`background-color:${s}`),new Promise(((t,e)=>{const s=new Image,i=new Blob([o.outerHTML],{type:"image/svg+xml"}),r=URL.createObjectURL(i);s.onload=function(){URL.revokeObjectURL(r),t(this)},s.onerror=e,s.src=r}))};var ks,Rs=function(t,e,s,o){if("a"===s&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(t):o?o.value:e.get(t)};class Ls{constructor(t){ks.set(this,void 0),function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===o?i.call(t,s):i?i.value=s:e.set(t,s)}(this,ks,new Z.Z.Stage({container:t,width:10,height:10}),"f")}static normPosAxis(t){return t<0?Math.abs(t):0}trimLayer(t,e){const s=t.clone();return Rs(this,ks,"f").add(s),Rs(this,ks,"f").setAttrs({width:Ls.normPosAxis(e.x)+e.width+60,height:Ls.normPosAxis(e.y)+e.height+60,x:-1*e.x+30,y:-1*e.y+30}),new Promise(((t,e)=>{setTimeout((()=>{const o=s.getCanvas()._canvas;(t=>{let e,s,o,i,r,a,n,h,c,d,f,l,p;if(o=t.canvas.width,i=t.canvas.height,!o&&!i)return!1;for(p=t.getImageData(0,0,o,i),c=new Uint32Array(p.data.buffer),d=0,f=o*i-1,l=!1,s=0;s<i&&!l;s+=1){for(e=0;e<o;e+=1){if(c[d++]&&!r&&(r=s+1,h)){l=!0;break}if(c[f--]&&!h&&(h=i-s-1,r)){l=!0;break}}if(s>i-s&&!r&&!h)return!1}for(r-=1,l=!1,e=0;e<o&&!l;e+=1)for(d=r*o+e,f=r*o+(o-e-1),s=r;s<=h;s+=1){if(c[d]&&!a&&(a=e+1,n)){l=!0;break}if(c[f]&&!n&&(n=o-e-1,a)){l=!0;break}d+=o,f+=o}return a-=1,o===n-a+1&&i===h-r+1||(o=n-a+1,i=h-r+1,t.canvas.width=o,t.canvas.height=i,t.putImageData(p,-a,-r)),!0})(o.getContext("2d"))?t(o):e(new Error("Can't trim given context")),setTimeout((()=>{Rs(this,ks,"f").getLayers().forEach((t=>t.destroy()))}),1e3)}))}))}async saveFromLayer(t,e,s){((t,e)=>{const s=function(t){const e=t.split(",");if(e[0]){const t=e[0].match(/:(.*?);/);if(t){const s=t[1],o=atob(e[1]);let i=o.length;const r=new Uint8Array(i);for(;i--;)r[i]=o.charCodeAt(i);return new Blob([r],{type:s})}}return null}(t);if(!s)throw new Error("blob data is null");const o=document.createElement("a"),i=URL.createObjectURL(s);o.download=e.replace(/(\.[^.]+)$/gi,"")+".png",o.href=i,o.click()})((await this.trimLayer(t,s)).toDataURL(),e)}async copyFromLayer(t,e){window?.navigator?.clipboard?.write?(await this.trimLayer(t,e)).toBlob((t=>{const e=new ClipboardItem({"image/png":t});navigator.clipboard.write([e])})):(t=>{const e=document.createElement("img");e.src=t;const s=document.createElement("div");s.contentEditable="true",s.appendChild(e),document.body.appendChild(s),(t=>{if(!window.getSelection)throw new Error("Can't select text");{const e=window.getSelection(),s=document.createRange();s.selectNodeContents(t),e?.removeAllRanges(),e?.addRange(s)}})(s),document.execCommand("Copy"),document.body.removeChild(s)})((await this.trimLayer(t,e)).toDataURL())}}ks=new WeakMap;var Cs=s(9320),Ms={};Ms.styleTagTransform=vs(),Ms.setAttributes=gs(),Ms.insert=ps().bind(null,"head"),Ms.domAPI=fs(),Ms.insertStyleElement=ys(),cs()(Cs.Z,Ms),Cs.Z&&Cs.Z.locals&&Cs.Z.locals;const Zs=()=>{const t=(0,o.useRef)(null);return(0,o.useEffect)((()=>{Ht.dispatch(Dt(new Ls(t.current)))}),[]),o.createElement("div",{ref:t,className:"SaveCanvasEl"})};var Ds=s(5504),Ws={};Ws.styleTagTransform=vs(),Ws.setAttributes=gs(),Ws.insert=ps().bind(null,"head"),Ws.domAPI=fs(),Ws.insertStyleElement=ys(),cs()(Ds.Z,Ws),Ds.Z&&Ds.Z.locals&&Ds.Z.locals;const _s=()=>{const t=document.querySelector(".shapes-layer");if(t)return t;throw new Error("Shapes layer is not found")};class Is extends o.PureComponent{constructor(){super(...arguments),this.canvasRef=o.createRef(),this.state={mouseIsDown:!1,mouseStartPos:{x:0,y:0}},this.handleStageOnMouseDown=t=>{const{shapes:e,stage:s}=Ht.getState();if(e.addingShapeRef&&s.instance){const o=s.instance.absolutePosition(),{layerX:i,layerY:r}=t.evt,a={x:i-o.x,y:r-o.y};this.setState({mouseIsDown:!0,mouseStartPos:a}),(t=>{switch(t.type){case z.Z.ARROW:Je(t);break;case z.Z.TEXT:ts(t);break;case z.Z.RECT:case z.Z.RECT_ROUGH:case z.Z.ELLIPSE:case z.Z.ELLIPSE_ROUGH:case z.Z.SELECT_RECT:ss(t);break;default:console.error("Can't connect given shape"),console.log(t)}})(e.addingShapeRef),e.addingShapeRef.initDraw(a,a)}},this.handleStageOnMouseUp=t=>{this.setState({mouseIsDown:!1});const{shapes:e,stage:s}=Ht.getState();if(e.addingShapeRef){const o=s.instance.absolutePosition(),{layerX:i,layerY:r}=t.evt,a=ie({x:i-o.x,y:r-o.y},this.state.mouseStartPos);e.addingShapeRef.type===z.Z.TEXT||a>10?(e.addingShapeRef.focus(),Ht.dispatch(v(e.addingShapeRef))):Ht.dispatch(w(e.addingShapeRef)),requestAnimationFrame((()=>{Ht.dispatch(m())}))}},this.handleStageOnMouseMove=t=>{const{shapes:e,stage:s}=Ht.getState();if(this.state.mouseIsDown&&e.addingShapeRef&&s.instance){const o=s.instance.absolutePosition(),{layerX:i,layerY:r}=t.evt;(t=>{const{shape:e,startPos:s,currentPos:o,ratioShiftIsActive:i}=t;if(i&&e.type!==z.Z.ARROW){const t=o.x-s.x,i=o.y-s.y,r=Math.min(Math.abs(t),Math.abs(i));e.initDraw(s,{x:s.x+Math.sign(t)*r,y:s.y+Math.sign(i)*r})}else e.initDraw(s,o)})({shape:e.addingShapeRef,startPos:this.state.mouseStartPos,currentPos:{x:i-o.x,y:r-o.y},ratioShiftIsActive:s.ratioShiftIsActive})}}}componentDidMount(){if(this.canvasRef.current){const t=new class{constructor(t){xs.set(this,void 0),Ts.set(this,new F),this.handleClick=t=>{const{shapes:e}=Ht.getState();e.addingShapeRef||Ht.dispatch(g())},this.handleMouseDown=t=>{As(this,Ts,"f").call("mousedown",t)},this.handleMouseUp=t=>{As(this,Ts,"f").call("mouseup",t)},this.handleMouseMove=t=>{As(this,Ts,"f").call("mousemove",t)},function(t,e,s,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===o?i.call(t,s):i?i.value=s:e.set(t,s)}(this,xs,new Z.Z.Stage({container:t,width:window.innerWidth,height:window.innerHeight}),"f");const{shapes:e}=Ht.getState();this.add(e.shapesLayer),this.add(e.anchorsLayer);try{e.shapesLayer.getCanvas()._canvas.classList.add("shapes-layer"),e.anchorsLayer.getCanvas()._canvas.classList.add("anchors-layer")}catch(t){console.error("Can't set className to the canvas"),console.error(t)}As(this,xs,"f").on("mousedown",this.handleMouseDown),As(this,xs,"f").on("mouseup",this.handleMouseUp),As(this,xs,"f").on("mousemove",this.handleMouseMove),As(this,xs,"f").on("click",this.handleClick)}on(t,e){As(this,Ts,"f").set(t,e)}add(t){As(this,xs,"f").add(t)}setAttrs(t){As(this,xs,"f").setAttrs(t)}draggable(t){if(void 0===t)return As(this,xs,"f").draggable();As(this,xs,"f").draggable(t)}absolutePosition(t){if(void 0===t)return As(this,xs,"f").absolutePosition();As(this,xs,"f").absolutePosition(t)}getBoundingClientRect(){return As(this,xs,"f").container().getBoundingClientRect()}toDataURL(){return As(this,xs,"f").toDataURL()}getPos(){return{x:As(this,xs,"f").x(),y:As(this,xs,"f").y()}}width(){return As(this,xs,"f").width()}height(){return As(this,xs,"f").height()}getContentBoundariesRect(){const{shapes:{list:t}}=Ht.getState();if(0===t.length)return{x:0,y:0,width:0,height:0};const e=t.reduce(((t,e)=>{const s=e.getSelfRect(),o=s.x+s.width,i=s.y+s.height;return{xTopLeft:s.x<t.xTopLeft?s.x:t.xTopLeft,yTopLeft:s.y<t.yTopLeft?s.y:t.yTopLeft,xBottomRight:o>t.xBottomRight?o:t.xBottomRight,yBottomRight:i>t.yBottomRight?i:t.yBottomRight}}),{xTopLeft:1/0,yTopLeft:1/0,xBottomRight:-1/0,yBottomRight:-1/0});return{x:e.xTopLeft,y:e.yTopLeft,width:e.xBottomRight-e.xTopLeft,height:e.yBottomRight-e.yTopLeft}}}(this.canvasRef.current);t.on("mousedown",this.handleStageOnMouseDown),t.on("mouseup",this.handleStageOnMouseUp),t.on("mousemove",this.handleStageOnMouseMove),Ht.dispatch(A(t)),this.canvasRef.current.tabIndex=1,this.props.onReady({startAddingShape:t=>{Ht.dispatch(g());const{type:e,options:s}=t;switch(e){case z.Z.TEXT:case z.Z.ARROW:case z.Z.RECT:case z.Z.RECT_ROUGH:case z.Z.ELLIPSE:case z.Z.ELLIPSE_ROUGH:case z.Z.SELECT_RECT:Ht.dispatch(m({type:e,options:s}));break;case null:Ht.dispatch(m({type:null}));break;default:throw new Error(`Given shape type can't be added: ${e}`)}},setImage:t=>{is(t)},setStrokeColorToActiveShape:t=>{Ht.dispatch(c(t))},setStrokeWidthToActiveShape:t=>{Ht.dispatch(d(t))},setFontSizeToActiveShape:t=>{Ht.dispatch(f(t))},exportCanvasToImage:t=>{const{shapes:e,stage:s}=Ht.getState();if(!s.instance)throw new Error("Stage instance is not defined");Ht.dispatch(Wt({layer:e.shapesLayer,name:t,contentRect:s.instance.getContentBoundariesRect()}))},copyAllToClipboard:()=>{const{stage:t,shapes:e}=Ht.getState();if(!t.instance)throw new Error("Stage instance is not defined");Ht.dispatch(_t({layer:e.shapesLayer,contentRect:t.instance.getContentBoundariesRect()}))},blurShapes:()=>{Ht.dispatch(g())},sketchifyActiveShape:()=>{Ht.dispatch(b())},getShapesAmount:()=>new Promise((t=>{requestAnimationFrame((()=>{const{shapes:e}=Ht.getState();t(e.list.length)}))})),changeOrderOfActiveShape:t=>{Ht.dispatch(S(t))},initBlankCanvas:t=>{const{stage:e}=Ht.getState();if(!e.instance)throw new Error('"instance" is not defined on stage. It looks like stage is not initialized yet.');Ps(t.width,t.height,"#cdcdcd").then((t=>{is({image:t,name:"Blank canvas"})}))},onShapeClicked:W("SHAPE_CLICKED"),onShapeDragStarted:W("SHAPE_DRAG_STARTED"),onShapesBlurred:W("SHAPES_BLURRED"),onShapeAdded:W("SHAPE_ADDED"),onShapeDeleted:W("SHAPE_DELETED")})}}render(){return o.createElement(o.Fragment,null,o.createElement(bs,null,o.createElement(ns,null),o.createElement("div",{ref:this.canvasRef,className:"canvas-el"})),o.createElement(Zs,null))}}const Os=Is;var Hs=s(463),zs=s(8910),Bs=s(8328),Us=s(9998);const Fs=t=>{const{children:e}=t,{state:{menu:s,canvas:{canvasApi:i}}}=(0,o.useContext)(Us.z);return o.createElement(Hs.ZP,{onDrop:async(t,e,o)=>{const r=t[0];if(r){const t=await(0,zs.Z)(r);i?.blurShapes(),i?.setImage({image:t.image,name:t.name,pos:{x:o.clientX-t.image.width/2,y:o.clientY-s.menuHeight-t.image.height/2}})}Bs.qP({eventCategory:Bs.Ak.GlobalInteraction,eventAction:Bs.UZ.DropImage})}},(t=>{const{getRootProps:s}=t;return o.createElement("div",{...s()},e)}))};var $s=s(7732),js=s(6984),Gs={};Gs.styleTagTransform=vs(),Gs.setAttributes=gs(),Gs.insert=ps().bind(null,"head"),Gs.domAPI=fs(),Gs.insertStyleElement=ys(),cs()(js.Z,Gs),js.Z&&js.Z.locals&&js.Z.locals;const Ns=()=>o.createElement("div",{className:"HowToStart"},(0,$s.t)("how-to-start"));var Ys=s(4709);const Ks=()=>{const[t,e]=(0,o.useState)(!1),{state:{canvas:{canvasApi:s}},dispatch:i}=(0,o.useContext)(Us.z),a=t=>{const e=(t.clipboardData||t.originalEvent.clipboardData).items,o=Array.from(e).find((t=>0===t.type.indexOf("image")));if(o){const t=o.getAsFile(),e=new Image;if(!t)throw new Error("blob data is null");const i=URL.createObjectURL(t);e.onload=function(){URL.revokeObjectURL(i),s?.setImage({image:this,name:""})},e.onerror=t=>{console.error(t)},e.src=i}},n=async()=>{if(s){const t=await s.getShapesAmount();e(t>0)}};return(0,o.useEffect)((()=>{document.addEventListener("paste",a);let t=r().noop,e=r().noop;return s&&(t=s.onShapeAdded(n),e=s.onShapeDeleted(n),n()),()=>{document.removeEventListener("paste",a),t(),e(),s?.blurShapes()}}),[s]),o.createElement(Fs,null,!t&&o.createElement(Ns,null),o.createElement(Os,{onReady:t=>{i((0,Ys.T)(t))}}))}}}]);